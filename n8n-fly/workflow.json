{
  "updatedAt": "2026-03-01T14:29:42.094Z",
  "createdAt": "2026-02-20T13:11:32.879Z",
  "id": "rC30SNQvTZG9Zhza",
  "name": "Karma_Rent_Workers",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "tableId": "Message_Buffer",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $json.sender }}"
            },
            {
              "fieldId": "message",
              "fieldValue": "={{ $json.message }}"
            },
            {
              "fieldId": "message_id",
              "fieldValue": "={{ $('Webhook').item.json.body.metadata.messageId }}"
            },
            {
              "fieldId": "timestamp",
              "fieldValue": "={{ $('Webhook').item.json.body.metadata.timestamp }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1168,
        -304
      ],
      "id": "e56ae42c-9d2b-49f8-9e59-2353f6f874a6",
      "name": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
      "credentials": {
        "supabaseApi": {
          "id": "u1mkv2sS5oh337qr",
          "name": "Supabase Karma_Worker"
        }
      }
    },
    {
      "parameters": {
        "content": "Ğ¡Ğ±Ğ¾Ñ€ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°\n\n*Â Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ. Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğ¸ 10 ÑĞµĞº, Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚. Ğ½Ğ° Ğ²ÑĞµ, Ğ° Ğ½Ğµ Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ",
        "height": 500,
        "width": 1896,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1120,
        -400
      ],
      "typeVersion": 1,
      "id": "50e9a8b6-46c8-4d74-babe-d3fe334e6ef6",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "timestamp",
              "order": "=ascending"
            }
          ]
        },
        "options": {}
      },
      "id": "3d1be0b3-5910-43eb-93df-57777209f978",
      "name": "Sort by Message ID",
      "type": "n8n-nodes-base.sort",
      "position": [
        1904,
        -176
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "Message_Buffer",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $('Webhook').item.json.body.metadata.remoteJid }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1648,
        -304
      ],
      "id": "5639a0b2-3528-445d-a6b2-04bdcc0196f6",
      "name": "Ğ‘ĞµÑ€ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ",
      "credentials": {
        "supabaseApi": {
          "id": "u1mkv2sS5oh337qr",
          "name": "Supabase Karma_Worker"
        }
      }
    },
    {
      "parameters": {
        "amount": 3
      },
      "id": "b7b93f28-25b0-4a6c-88dd-65462f02d4a3",
      "name": "Wait 10 Seconds",
      "type": "n8n-nodes-base.wait",
      "position": [
        1408,
        -144
      ],
      "webhookId": "87994c9a-fd20-48b6-8dbe-9af36dc40b2f",
      "typeVersion": 1.1
    },
    {
      "parameters": {},
      "id": "7ca8e5ed-45ee-4e10-9fc9-621725de64c3",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "position": [
        2480,
        -112
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "Ğ¡Ğ±Ğ¾Ñ€ Ğ²ÑĞµÑ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹\n* Ğ¡Ğ²Ğ²ĞµÑ€ĞºĞ° Ñ CRM\n* Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° ",
        "height": 632,
        "width": 1016,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1472,
        160
      ],
      "typeVersion": 1,
      "id": "9bd44ad0-6c47-40fe-b3ec-e6c8e6caa529",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Inject State').first().json.message + '\\n\\nĞ”ĞĞĞĞ«Ğ• Ğ¢Ğ ĞĞĞ¡ĞŸĞĞ Ğ¢Ğ (Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ):\\n\\nĞ‘ĞĞ™ĞšĞ˜:\\n' + (($json.bikes && $json.bikes.length > 0 && $json.bikes[0]['Ğ‘Ğ°Ğ¹Ğº']) ? $json.bikes.map((b, i) => (i+1) + '. ' + b['Ğ‘Ğ°Ğ¹Ğº'] + ' â€” ' + b['ĞšĞ»Ğ°ÑÑ'] + ', ' + b['Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸'] + ' VND/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°: ' + b['Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³']).join('\\n') + '\\nĞ˜Ğ¢ĞĞ“Ğ Ğ‘ĞĞ™ĞšĞĞ’: ' + $json.bikes.length : 'Ğ’ÑĞµ Ğ±Ğ°Ğ¹ĞºĞ¸ Ğ·Ğ°Ğ½ÑÑ‚Ñ‹. ĞĞ° Ğ´Ğ½ÑÑ… Ğ±ÑƒĞ´ÑƒÑ‚!') + '\\n\\nĞĞ’Ğ¢Ğ:\\n' + (($json.cars && $json.cars.length > 0 && $json.cars[0]['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ']) ? $json.cars.map((c, i) => (i+1) + '. ' + c['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ'] + ' â€” ' + c['ĞšĞ»Ğ°ÑÑ'] + ', ' + c['Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸'] + ' VND/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°: ' + c['Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³']).join('\\n') + '\\nĞ˜Ğ¢ĞĞ“Ğ ĞĞ’Ğ¢Ğ: ' + $json.cars.length : 'Ğ’ÑĞµ Ğ°Ğ²Ñ‚Ğ¾ Ğ·Ğ°Ğ½ÑÑ‚Ñ‹.') + '\\n\\nĞ’Ğ•Ğ›ĞĞ¡Ğ˜ĞŸĞ•Ğ”Ğ«:\\n' + (($json.bicycles && $json.bicycles.length > 0 && $json.bicycles[0]['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ']) ? $json.bicycles.map((v, i) => (i+1) + '. ' + v['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ'] + ' â€” ' + v['ĞšĞ»Ğ°ÑÑ'] + ', ' + v['Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸'] + ' VND/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°: ' + v['Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³']).join('\\n') + '\\nĞ˜Ğ¢ĞĞ“Ğ Ğ’Ğ•Ğ›Ğ: ' + $json.bicycles.length : 'Ğ’ÑĞµ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´Ñ‹ Ğ·Ğ°Ğ½ÑÑ‚Ñ‹.') + '\\n\\nğŸ”´ ĞŸĞĞšĞĞ–Ğ˜ Ğ’Ğ¡Ğ• ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ° Ğ²Ñ‹ÑˆĞµ! Ğ•ÑĞ»Ğ¸ Ğ˜Ğ¢ĞĞ“Ğ=9, Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ 9. ĞĞµ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°Ğ¹!\\nğŸ”´ Ğ¯Ğ—Ğ«Ğš: Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ½Ğ° ÑĞ·Ñ‹ĞºĞµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°! English â†’ English.\\nğŸ”´ ĞĞ• Ğ¿ĞµÑ€ĞµÑ‡Ğ¸ÑĞ»ÑĞ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼.\\nğŸ”´ Ğ’Ğ«Ğ‘ĞĞ : ĞµÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ \"Ğ±ĞµÑ€Ñƒ X\" â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ \"Ğ±Ğ°Ğ¹Ğº\"=Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ² STATE! ĞĞµ Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞ¹ \"?\".\\nğŸ”´ ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ•: ĞµÑĞ»Ğ¸ [ÑÑ‚Ğ°Ğ¿: Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ] Ğ˜ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ĞĞ• ÑƒĞºĞ°Ğ·Ğ°Ğ» Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â†’ ÑĞ¿Ñ€Ğ¾ÑĞ¸ \"Ğ±Ğ°Ğ¹Ğº, Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´?\" Ğ‘Ğ•Ğ— ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°. Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ£Ğ–Ğ• ÑĞºĞ°Ğ·Ğ°Ğ» Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚ (Ğ°Ğ²Ñ‚Ğ¾/Ğ±Ğ°Ğ¹Ğº/Ğ²ĞµĞ»Ğ¾) â†’ ĞĞ• Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹, Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸ Ğº ÑƒÑ‚Ğ¾Ñ‡Ğ½ĞµĞ½Ğ¸Ñ.\\n\\nğŸ”´ Ğ”ĞĞ¢Ğ Ğ—ĞĞ•Ğ—Ğ”Ğ: ÑĞ¿Ñ€Ğ¾ÑĞ¸ \"Ñ ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°?\" â€” Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ² \"Ğ´Ğ°Ñ‚Ğ°\" Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“. Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ \"Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°/Ğ¿Ğ¾ÑĞ»ĞµĞ·Ğ°Ğ²Ñ‚Ñ€Ğ°/Ñ‡ĞµÑ€ĞµĞ· N Ğ´Ğ½ĞµĞ¹\" â€” Ğ¿ĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ğ°Ğ¹ Ğ² Ğ´Ğ°Ñ‚Ñƒ.\\n\\nğŸğŸğŸ Ğ‘ĞĞĞ£Ğ¡Ğ« â€” ĞŸĞĞ¡Ğ›Ğ• ĞšĞĞ¢ĞĞ›ĞĞ“Ğ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ”ĞĞ‘ĞĞ’Ğ¬:\\n\"ğŸ Ğ‘Ğ¾Ğ½ÑƒÑ: Ğ¾Ñ‚ 3 Ğ´Ğ½ĞµĞ¹ â€” ĞºĞ°Ñ€Ñ‚Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°! ĞÑ‚ 7 Ğ´Ğ½ĞµĞ¹ â€” Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° ğŸšš\"\\nĞ‘ĞµĞ· ÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚ ĞĞ•ĞŸĞĞ›ĞĞ«Ğ™!\\nğŸ”´ ĞĞ’Ğ¢Ğ: Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğµ Ğ°Ğ²Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ„Ğ¾Ñ‚Ğ¾ Ğ’Ğ£ (Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ğµ)! ĞĞ• Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚!\\n\\nâš ï¸âš ï¸âš ï¸ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ĞšĞĞ–Ğ”ĞĞ“Ğ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ STATE Ğ±Ğ»Ğ¾Ğº:\\nSTATE: {\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚\": \"?\", \"Ğ´Ğ½ĞµĞ¹\": \"?\", \"Ğ´Ğ°Ñ‚Ğ°\": \"?\", \"Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸\": \"?\", \"Ğ¾Ğ¿Ñ‹Ñ‚\": \"?\", \"Ğ±Ğ°Ğ¹Ğº\": \"?\", \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\": \"?\", \"ÑÑ‚Ğ°Ğ¿\": \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\"}\\nĞ—Ğ°Ğ¼ĞµĞ½Ğ¸ ? Ğ½Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°. Ğ‘Ğ•Ğ— Ğ­Ğ¢ĞĞ“Ğ Ğ‘Ğ›ĞĞšĞ ĞĞ¢Ğ’Ğ•Ğ¢ ĞĞ¢ĞšĞ›ĞĞĞĞ.' }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Ğ¢Ñ‹ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ¿Ğ¾ Ğ°Ñ€ĞµĞ½Ğ´Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ° KarmaRent Ğ² ĞÑÑ‡Ğ°Ğ½Ğ³Ğµ.\nĞÑˆĞ¸Ğ±ÑÑ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¾Ğ¼ â†’ \"ĞœÑ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² ĞÑÑ‡Ğ°Ğ½Ğ³Ğµ.\" Ğ˜Ğ½Ğ°Ñ‡Ğµ â€” Ğ½Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹.\n\nĞ¡Ğ¢Ğ˜Ğ›Ğ¬: Ğ¶Ğ¸Ğ²Ğ¾ Ğ¸ Ğ´Ñ€ÑƒĞ¶ĞµĞ»ÑĞ±Ğ½Ğ¾, ĞºĞ°Ğº Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ² Ñ‡Ğ°Ñ‚Ğµ. Ğ¨ÑƒÑ‚ĞºĞ¸, ÑĞ¼Ğ°Ğ¹Ğ»Ğ¸ĞºĞ¸, ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸. ĞĞµ Ğ±ÑƒĞ´ÑŒ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¾Ğ¼.\n\nĞ¯Ğ—Ğ«Ğš: {{ $('Inject State').first().json.clientLang }}. ĞĞ¢Ğ’Ğ•Ğ§ĞĞ™ Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ Ğ­Ğ¢ĞĞœ Ğ¯Ğ—Ğ«ĞšĞ•! Ğ•ÑĞ»Ğ¸ ÑĞ·Ñ‹Ğº â‰  Ğ ÑƒÑÑĞºĞ¸Ğ¹ â€” Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´Ğ¸ Ğ’Ğ¡Ğ: Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ, Ğ±Ğ¾Ğ½ÑƒÑÑ‹, Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹. ĞĞ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ€ÑƒÑÑĞºĞ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ğ²Ğ°!\n\n\nĞ ĞĞ¡ĞŸĞĞ—ĞĞĞ’ĞĞĞ˜Ğ• ĞĞŸĞ«Ğ¢Ğ:\nĞĞ¿Ñ‹Ñ‚ Ğ•Ğ¡Ğ¢Ğ¬: \"Ğ´Ğ°/ÑƒĞ³Ñƒ/Ğ°Ğ³Ğ°/ĞµÑÑ‚ÑŒ/ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾/yes/years/cÃ³/Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ/Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼/báº±ng lÃ¡i/driving for/have a license/have license\"\nĞĞ¿Ñ‹Ñ‚ ĞĞ•Ğ¢: \"Ğ½ĞµÑ‚/Ğ½ĞµÑ‚Ñƒ/Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·/no/khÃ´ng/never\"\nĞĞµ Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹. \"Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼ Ğ´Ğ°Ğ²Ğ½Ğ¾\" = ĞµÑÑ‚ÑŒ. \"Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ\" = ĞµÑÑ‚ÑŒ. \"been driving\" = ĞµÑÑ‚ÑŒ.\n\nĞ ĞĞ¡ĞŸĞĞ—ĞĞĞ’ĞĞĞ˜Ğ• ĞŸĞĞ•Ğ—Ğ”ĞĞš:\nĞ³Ğ¾Ñ€Ğ¾Ğ´: \"Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ/in the city/city driving/trong thÃ nh phá»‘/around town/Ğ² Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğµ\"\nĞ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ: \"Ğ·Ğ° Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ/long distance/highway/ngoáº¡i thÃ nh/long trips\"\nĞĞµ Ğ¿ÑƒÑ‚Ğ°Ğ¹ Ñ ĞĞĞ—Ğ’ĞĞĞ˜Ğ•Ğœ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°. \"Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\" = Ñ‚Ğ¸Ğ¿ Ğ¿Ğ¾ĞµĞ·Ğ´Ğ¾Ğº, ĞĞ• Ğ¸Ğ¼Ñ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°.\n\nĞ¢Ğ ĞĞĞ¡ĞŸĞĞ Ğ¢:\n- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞŸÑ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ¾.\n- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, ĞºĞ»Ğ°ÑÑ, Ñ†ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³.\n- ğŸ”´ ĞŸĞĞšĞĞ–Ğ˜ Ğ’Ğ¡Ğ• ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…! Ğ¡Ğ¼Ğ¾Ñ‚Ñ€Ğ¸ Ğ˜Ğ¢ĞĞ“Ğ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… â€” ĞµÑĞ»Ğ¸ Ğ˜Ğ¢ĞĞ“Ğ=9, Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ 9. ĞĞµ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº!\n- ĞĞµÑ‚ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° â†’ \"Ğš ÑĞ¾Ğ¶Ğ°Ğ»ĞµĞ½Ğ¸Ñ, ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ²ÑĞµ [Ñ‚Ğ¸Ğ¿] Ğ·Ğ°Ğ½ÑÑ‚Ñ‹. ĞšĞ°Ğº Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ â€” ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ!\"\n- Ğ•ÑÑ‚ÑŒ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ñ‚Ğ¸Ğ¿ â†’ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸ ĞºĞ°Ğº Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ñƒ.\n\nĞ¦Ğ•ĞĞ«: âš ï¸ Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞĞ˜ĞšĞĞ“Ğ”Ğ Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ğ¹!\nĞ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ: Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ (ÑÑ‚Ñ€Ğ°Ñ…Ğ¾Ğ²ĞºĞ°, Ğ·Ğ°Ğ»Ğ¾Ğ³, Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ¾). ĞĞµ Ğ·Ğ½Ğ°ĞµÑˆÑŒ â†’ \"Ğ£Ñ‚Ğ¾Ñ‡Ğ½Ñ Ñƒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°.\"\n\nĞ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ = Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¸Ğ½Ñ„Ğ¾. ĞĞ• Ğ¿ĞµÑ€ĞµÑ‡Ğ¸ÑĞ»ÑĞ¹ Ğ¸Ñ… ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ (\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: Ğ°Ğ²Ñ‚Ğ¾, Ğ´Ğ½ĞµĞ¹: 5...\"). ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹.\n\nĞ“Ğ›ĞĞ’ĞĞĞ•: Ğ½Ğµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹ ÑĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ. ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚, Ñ‚Ñ‹ Ğ²Ğ¸Ğ´Ğ¸ÑˆÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ.\n\nĞ–ĞĞ¡Ğ¢ĞšĞ˜Ğ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ:\n- ğŸ”´ Ğ¡Ğ¢ĞĞŸ-ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¿ĞµÑ€ĞµĞ´ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ¼: Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â‰  \"?\", Ğ´Ğ½ĞµĞ¹ â‰  \"?\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ â‰  \"?\", Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\". Ğ•ÑĞ»Ğ¸ Ğ›Ğ®Ğ‘ĞĞ• = \"?\" â†’ Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³. Ğ¡Ğ¿Ñ€Ğ¾ÑĞ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰ĞµĞµ.\n- \"Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ\" / \"Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼\" / \"been driving\" / \"cÃ³ báº±ng lÃ¡i\" = Ğ¾Ğ¿Ñ‹Ñ‚ Ğ•Ğ¡Ğ¢Ğ¬. Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸ ÑÑ€Ğ°Ğ·Ñƒ, Ğ½Ğµ ÑÑ‚Ğ°Ğ²ÑŒ \"?\".\n- ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ°Ğ» Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² ÑÑ€Ğ°Ğ·Ñƒ â†’ Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ²ÑÑ‘, ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰ĞµĞµ.\n- ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹ = 2 Ğ´Ğ½Ñ. 1 Ğ´ĞµĞ½ÑŒ â†’ \"ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 2 Ğ´Ğ½Ñ, Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚?\"\n\nĞ­Ğ¢ĞĞŸĞ« (Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ¿Ğ¾ [ÑÑ‚Ğ°Ğ¿:] Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°):\n\n1. ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\")\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» Ğ¢ĞĞ›Ğ¬ĞšĞ \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚/hi/hello\" â€” Ğ¿Ğ¾Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞ¹ Ğ¸ Ğ·Ğ°Ğ´Ğ°Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼:\n     ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! ğŸ˜Š Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ´Ğ±ĞµÑ€Ñ‘Ğ¼ Ğ²Ğ°Ğ¼ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚. ĞÑ‚Ğ²ĞµÑ‚ÑŒÑ‚Ğµ Ğ½Ğ° Ğ¿Ğ°Ñ€Ñƒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²:\n     â€“ Ğ§Ñ‚Ğ¾ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒĞµÑ‚ â€” Ğ±Ğ°Ğ¹Ğº, Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´?\n     â€“ ĞĞ° ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚Ğµ Ğ°Ñ€ĞµĞ½Ğ´Ñƒ?\n     â€“ ĞŸĞ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ Ğ¸Ğ»Ğ¸ Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸?\"\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¡Ğ ĞĞ—Ğ£ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ» Ñ‚Ğ¸Ğ¿ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ° (\"Ñ…Ğ¾Ñ‡Ñƒ Ğ±Ğ°Ğ¹Ğº\", \"Ğ°Ğ²Ñ‚Ğ¾\") â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ¸ Ğ¿ĞµÑ€ĞµĞ¹Ğ´Ğ¸ Ğº ÑÑ‚Ğ°Ğ¿Ñƒ \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\". ĞĞ• Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹!\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ°Ğ» Ğ’Ğ¡Ğ® Ğ¸Ğ½Ñ„Ñƒ ÑÑ€Ğ°Ğ·Ñƒ (Ñ‚Ğ¸Ğ¿ + Ğ´Ğ½Ğ¸ + Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ + Ğ¾Ğ¿Ñ‹Ñ‚) â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ’Ğ¡Ğ, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸ \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\", ÑÑ€Ğ°Ğ·Ñƒ Ğº \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"!\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ½ĞµÑ‚ â†’ \"Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ [Ñ‚Ğ¸Ğ¿] Ğ·Ğ°Ğ½ÑÑ‚Ñ‹, Ğ½Ğ° Ğ´Ğ½ÑÑ… Ğ±ÑƒĞ´ÑƒÑ‚! ĞœĞ¾Ğ¶ĞµÑ‚, Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒĞµÑ‚ [Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ñ‚Ğ¸Ğ¿]?\"\n\n2. Ğ£Ğ¢ĞĞ§ĞĞ•ĞĞ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\")\n   â†’ Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ: Ğ´Ğ½ĞµĞ¹, Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ (Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ), Ğ¾Ğ¿Ñ‹Ñ‚\n   â†’ Ğ¡Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ (Ğ³Ğ´Ğµ \"?\"), Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ 2-3 Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼\n   â†’ ĞšĞ¾Ğ³Ğ´Ğ° Ğ’Ğ¡Ğ• â‰  \"?\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   â†’ ğŸ”´ ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬: Ğ´Ğ½ĞµĞ¹ â‰  \"?\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ â‰  \"?\", Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\". Ğ•ÑĞ»Ğ¸ Ñ…Ğ¾Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ \"?\" â€” ÑĞ¿Ñ€Ğ¾ÑĞ¸, ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³!\n\n3. ĞŸĞĞ”Ğ‘ĞĞ  (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\")\n   â†’ ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ’Ğ¡Ğ• ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğµ (ĞºĞ°Ğ¶Ğ´ÑƒÑ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñƒ!): Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, ĞºĞ»Ğ°ÑÑ, Ñ†ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°\n   â†’ ğŸ Ğ‘ĞĞĞ£Ğ¡Ğ« â€” Ğ¡Ğ ĞĞ—Ğ£ Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ° Ğ”ĞĞ‘ĞĞ’Ğ¬ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ğ¾ĞºÑƒ:\n     \"ğŸ Ğ‘Ğ¾Ğ½ÑƒÑ: Ğ¾Ñ‚ 3 Ğ´Ğ½ĞµĞ¹ â€” ĞºĞ°Ñ€Ñ‚Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°! ĞÑ‚ 7 Ğ´Ğ½ĞµĞ¹ â€” Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° ğŸšš\"\n     Ğ­Ñ‚Ğ¾ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ. Ğ‘ĞµĞ· Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ½ĞµĞ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹.\n   â†’ ĞĞµÑ‚ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ… â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ½ĞµÑ‚_Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°\"\n\n4. Ğ’Ğ«Ğ‘ĞĞ  (ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» â€” \"Ğ±ĞµÑ€Ñƒ X\")\n   â†’ ğŸ”´ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ² STATE: \"Ğ±Ğ°Ğ¹Ğº\" = Ğ¢ĞĞ§ĞĞĞ• Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸Ğ· ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ° (Ğ½Ğ°Ğ¿Ñ€. \"Honda City\"), \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\" = ÑÑÑ‹Ğ»ĞºĞ° ÑÑ‚Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…\n   â†’ ĞĞ²Ñ‚Ğ¾ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ„Ğ¾Ñ‚Ğ¾ Ğ’Ğ£ (Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ğµ). ĞĞ• ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹ Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚!\n   â†’ Ğ‘Ğ°Ğ¹Ğº/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° (Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ˜Ğ›Ğ˜ Ğ’Ğ£ â€” Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚)\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\"\n\n5. ĞŸĞĞ¡ĞŸĞĞ Ğ¢ (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\")\n   â†’ [Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢] â†’ \"âœ… Ğ—Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾! Ğ¡ĞºĞ¾Ñ€Ğ¾ ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\"\n   â†’ [Ğ¤ĞĞ¢Ğ] Ğ±ĞµĞ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° â†’ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸\n   â†’ Ğ¥Ğ¾Ñ‡ĞµÑ‚ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n6. Ğ—ĞĞ‘Ğ ĞĞĞ˜Ğ ĞĞ’ĞĞ â†’ Ğ¿Ğ¾ Ğ±Ñ€Ğ¾Ğ½Ğ¸ â†’ \"ĞŸĞµÑ€ĞµĞ´Ğ°Ğ¼ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñƒ!\" ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ â†’ Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ğµ.\n\nĞ¡Ğ¢ĞĞŸĞ¡Ğ›ĞĞ’Ğ (\"Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ°\"/\"Ğ½Ğµ Ğ½Ğ°Ğ´Ğ¾\"/\"Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ»\"/\"cancel\"):\nâ†’ \"Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾, ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ â€” Ğ¼Ñ‹ Ğ½Ğ° ÑĞ²ÑĞ·Ğ¸!\"\nâ†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\nâ†’ ğŸ”´ Ğ¡ĞĞ¥Ğ ĞĞĞ¯Ğ™ Ğ²ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ STATE! ĞĞ±Ğ½ÑƒĞ»ÑĞµÑ‚ÑÑ Ğ¢ĞĞ›Ğ¬ĞšĞ ÑÑ‚Ğ°Ğ¿.\n\nĞĞ• ĞŸĞĞ’Ğ¢ĞĞ Ğ¯Ğ™: ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³, Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹, Ğ±Ğ¾Ğ½ÑƒÑÑ‹ â€” ĞµÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ»Ğ¾.\n\nâš ï¸ STATE â€” Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ĞšĞĞ–Ğ”ĞĞ“Ğ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:\nSTATE: {\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚\": \"?\", \"Ğ´Ğ½ĞµĞ¹\": \"?\", \"Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸\": \"?\", \"Ğ¾Ğ¿Ñ‹Ñ‚\": \"?\", \"Ğ±Ğ°Ğ¹Ğº\": \"?\", \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\": \"?\", \"ÑÑ‚Ğ°Ğ¿\": \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\"}\nĞ—Ğ°Ğ¼ĞµĞ½ÑĞ¹ ? Ğ½Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞ¹ Ğ’Ğ¡Ğ• Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ! ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ³Ğ°Ğ¹ ÑÑ‚Ğ°Ğ¿!\nÑ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ = Ğ±Ğ°Ğ¹Ğº/Ğ°Ğ²Ñ‚Ğ¾/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´/?\nĞ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ = Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ/?\nĞ±Ğ°Ğ¹Ğº = Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğµ"
        },
        "systemMessage": ""
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3920,
        -304
      ],
      "id": "977a8dc3-1b96-4b0c-815a-1f366b02b98e",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "content": "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ±Ğ°Ğ¹ĞºĞ° Ğ² Ğ¼ĞµÑÑĞµĞ½Ğ´Ğ¶ĞµÑ€ \n",
        "height": 260,
        "width": 300,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        176
      ],
      "typeVersion": 1,
      "id": "54940db2-5311-4f24-92a0-691e75149987",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://karma-wa.fly.dev/message/sendText/karma",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "karma-evo-2026-secret"
            }
          ]
        },
        "sendBody": true,
        "contentType": "json",
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
            },
            {
              "name": "text",
              "value": "={{ $(\"Extract State\").item.json.output }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2800,
        256
      ],
      "id": "347d496d-8d67-4450-a2a5-f349db069537",
      "name": "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ² WhatsApp"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Inject State').first().json.sessionKey }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1712,
        528
      ],
      "id": "ad542f4d-c01e-4742-8de8-ef468624932b",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "8852bab7-230e-442a-a4a2-994e979c8f9f",
              "operator": {
                "type": "number",
                "operation": "equals"
              },
              "leftValue": "={{ $input.last().json.timestamp }}\n\n",
              "rightValue": "={{ $('Webhook').item.json.body.metadata.timestamp.toString() }}\n"
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "e1a8c728-16b4-4f51-acd9-ff3e625df1c4",
      "name": "ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ",
      "type": "n8n-nodes-base.if",
      "position": [
        2160,
        -288
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "Message_Buffer",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $json.user_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2464,
        -304
      ],
      "id": "651cc2dc-33e6-438e-ad5f-fdccaffe0934",
      "name": "Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
      "credentials": {
        "supabaseApi": {
          "id": "u1mkv2sS5oh337qr",
          "name": "Supabase Karma_Worker"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "message"
            }
          ]
        },
        "options": {}
      },
      "id": "fd34ebe1-d9b6-4656-83ab-997a053e7ced",
      "name": "Ğ¡ÑƒĞ¼Ğ¼Ğ°",
      "type": "n8n-nodes-base.aggregate",
      "position": [
        2752,
        -304
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1536,
        528
      ],
      "id": "15400d68-9790-4bc2-86a5-507f6171ee88",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "XF1cM38UXaYP6qBb",
          "name": "OpenAi D1Motors"
        }
      }
    },
    {
      "parameters": {
        "content": "ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° Ğ²Ğ¾ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ½Ğ° ĞºĞ°Ğ½Ğ°Ğ»Ğµ",
        "height": 860,
        "width": 1804
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -832,
        -512
      ],
      "typeVersion": 1,
      "id": "6bbfa434-a7b2-4551-b7df-8546c9b517b4",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "text",
                    "rightValue": "={{ $json.messageType }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7d2a8cb9-ee05-4c48-a620-6d701b21002b"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3489ec87-b04e-4b1e-ade1-81424608aafa",
                    "leftValue": "audio",
                    "rightValue": "={{ $json.messageType }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6c404022-4092-4ba6-9399-ff9a520d47c6",
                    "leftValue": "image",
                    "rightValue": "={{ $json.messageType }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8e5eedbe-968b-4175-94a3-b505f3068b7e",
                    "leftValue": "document",
                    "rightValue": "={{ $json.messageType }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "document"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -592,
        -256
      ],
      "id": "1ec75ec9-8d5e-4b3d-b345-fbc802bae521",
      "name": "Switch"
    },
    {
      "parameters": {
        "url": "={{ $json.pdf }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true,
              "responseFormat": "file",
              "outputPropertyName": "=data"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -80,
        112
      ],
      "id": "08f44d7b-eeab-4737-bba7-0ca70c5085f7",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "960ff6f3-909b-4028-bfa3-d275c85ed6f9",
              "name": "sender",
              "type": "string",
              "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
            },
            {
              "id": "efed5d73-27e8-4538-b7d9-3044f1ec3288",
              "name": "message",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "ff95a31a-3523-4596-85f9-4578cdc9da0e",
      "name": "Set Payment Response2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        720,
        112
      ]
    },
    {
      "parameters": {
        "jsCode": "// Download image via Evolution API getBase64FromMediaMessage\nconst webhookData = $('Webhook').item.json.body;\nconst mediaData = webhookData.mediaData || {};\nconst metadata = webhookData.metadata || {};\n\n// Build the message object for Evolution API\nconst messageKey = {\n  remoteJid: metadata.remoteJid,\n  id: metadata.messageId,\n  fromMe: false\n};\n\nconst requestBody = {\n  message: {\n    key: messageKey,\n    message: {\n      imageMessage: {\n        url: mediaData.url || '',\n        mimetype: mediaData.mimetype || 'image/jpeg',\n        mediaKey: mediaData.mediaKey || ''\n      }\n    }\n  }\n};\n\ntry {\n  const response = await this.helpers.httpRequest({\n    method: 'POST',\n    url: 'https://karma-wa.fly.dev/chat/getBase64FromMediaMessage/karma',\n    headers: {\n      'apikey': 'karma-evo-2026-secret',\n      'Content-Type': 'application/json'\n    },\n    body: requestBody,\n    json: true,\n    timeout: 15000\n  });\n\n  const base64Data = response.base64 || '';\n  const mime = response.mimetype || mediaData.mimetype || 'image/jpeg';\n\n  if (base64Data) {\n    return [{\n      json: {},\n      binary: {\n        data: {\n          data: base64Data,\n          mimeType: mime,\n          fileName: 'image.jpg'\n        }\n      }\n    }];\n  }\n} catch (e) {\n  // Fallback to thumbnail\n  const thumb = mediaData.jpegThumbnail || '';\n  if (thumb) {\n    return [{\n      json: {},\n      binary: {\n        data: {\n          data: thumb,\n          mimeType: 'image/jpeg',\n          fileName: 'thumb.jpg'\n        }\n      }\n    }];\n  }\n}\n\nreturn [];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -80,
        -64
      ],
      "id": "2be6553a-905f-476e-91c2-a80a06051e07",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "960ff6f3-909b-4028-bfa3-d275c85ed6f9",
              "name": "sender",
              "type": "string",
              "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
            },
            {
              "id": "dbfc6897-26c0-4161-b078-740a98d1aa8c",
              "name": "message",
              "type": "string",
              "value": "={{ $json.content }}"
            }
          ]
        },
        "options": {}
      },
      "id": "c440741f-879e-4a38-977e-dfc587ad8a06",
      "name": "Set Payment Response3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        720,
        -64
      ],
      "alwaysOutputData": false,
      "notesInFlow": false
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "9a8ea6c1-406a-4903-ae12-a910047c5740",
      "name": "Extract PDF Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        192,
        112
      ]
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "GPT-4O"
        },
        "text": "ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸ Ğ½Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ.\n\nĞ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğµ Ğ½Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ (Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚, ID, Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ğµ, Ğ¿Ñ€Ğ°Ğ²Ğ°) â€” Ğ½Ğ°Ñ‡Ğ½Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ñ Ñ‚ĞµĞ³Ğ° [Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢].\nĞ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ â€” Ğ½Ğ°Ñ‡Ğ½Ğ¸ Ñ Ñ‚ĞµĞ³Ğ° [Ğ¤ĞĞ¢Ğ].\n\nĞŸĞ¾ÑĞ»Ğµ Ñ‚ĞµĞ³Ğ° â€” ĞºÑ€Ğ°Ñ‚ĞºĞ¾ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ Ñ‡Ñ‚Ğ¾ Ğ½Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¸.",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        192,
        -64
      ],
      "id": "b41e86c1-a1b0-4d35-b186-6120cb815272",
      "name": "Analyze image1",
      "credentials": {
        "openAiApi": {
          "id": "AOBRqgI9aa99plds",
          "name": "OpenAi Karma_Rent"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2f8abb0f-2aaf-49ed-b2da-f092775f47a3",
              "name": "sender",
              "value": "={{ $json.body.metadata.remoteJid }}",
              "type": "string"
            },
            {
              "id": "70b56414-635b-4e1d-bb0f-d46a5b0f7aba",
              "name": "messageType",
              "value": "={{ $json.body.messageType }}",
              "type": "string"
            },
            {
              "id": "c7bdfe19-e9cd-4d73-b497-cb3f4f46c8ee",
              "name": "text message",
              "value": "={{ $json.body.message }}",
              "type": "string"
            },
            {
              "id": "8429b40f-b61c-4564-ac6b-d925151c2c65",
              "name": "audio message",
              "value": "={{ $json.body.mediaData.base64 }}",
              "type": "string"
            },
            {
              "id": "0cdf4162-4c2d-4bef-9b64-02bd7d6eac69",
              "name": "image",
              "value": "={{ $json.body.mediaData.url }}",
              "type": "string"
            },
            {
              "id": "bdd37591-1ef7-42f1-91ff-a1716485354d",
              "name": "pdf",
              "value": "={{ $json.body.mediaData.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -752,
        -224
      ],
      "id": "52bce193-950a-4002-85bd-bcb3a8fbb236",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4aa71e06-3620-4e33-94be-28a53ff07c6f",
              "name": "sender",
              "value": "={{ $json.sender }}",
              "type": "string"
            },
            {
              "id": "f53588bd-200f-4dab-a639-ff3b3ea640c5",
              "name": "message",
              "value": "={{ $json['text message'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        416,
        -448
      ],
      "id": "ab9755cd-f5b1-4297-88fb-8c38af3b0c1c",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a125f358-6efd-4d14-be3a-d3df77c34274",
              "name": "sender",
              "value": "={{ $json.sender }}",
              "type": "string"
            },
            {
              "id": "19b2a85e-9877-47e2-b82c-8d995b2183c0",
              "name": "audio message",
              "value": "={{ $json['audio message'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -80,
        -240
      ],
      "id": "0989ecc8-00d8-4343-a91c-7e01c79fec05",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "audio message",
        "options": {
          "mimeType": "audio/ogg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        192,
        -240
      ],
      "id": "b662d657-d516-4455-ba4e-991a75f26fd8",
      "name": "Convert to File1"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        416,
        -240
      ],
      "id": "a2bf4a7f-f1da-4a0a-95cc-e4d55d979eff",
      "name": "OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "AOBRqgI9aa99plds",
          "name": "OpenAi Karma_Rent"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fe1c1138-fe9f-4d00-9743-5e66282d9074",
              "name": "sender",
              "value": "={{ $('Edit Fields6').item.json.sender }}",
              "type": "string"
            },
            {
              "id": "ec2514bb-d888-4e2c-b427-617acf2295d6",
              "name": "message",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        720,
        -240
      ],
      "id": "831ddb82-77c4-4d04-bad7-1e0c0ea12a27",
      "name": "Edit Fields7"
    },
    {
      "parameters": {
        "content": "",
        "height": 240,
        "width": 320,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1280,
        -272
      ],
      "typeVersion": 1,
      "id": "30775e05-1a9d-430f-9c2d-faf9efcfb9b4",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "6b2abf67-a83b-4cb7-bc7b-81be5cf2e820",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1184,
        -224
      ],
      "id": "8604b9e9-b4e3-4e67-bce6-19232e582709",
      "name": "WebhookRaw",
      "webhookId": "6b2abf67-a83b-4cb7-bc7b-81be5cf2e820"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "always-true",
              "leftValue": "={{ \"pass\" }}",
              "rightValue": "pass",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -968,
        -224
      ],
      "id": "phone-filter-node-new",
      "name": "Phone Filter"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "user_state",
        "filters": {
          "conditions": [
            {
              "keyName": "jid",
              "condition": "eq",
              "keyValue": "={{ $('Edit Fields4').first().json.sender }}"
            }
          ]
        },
        "limit": 1,
        "options": {}
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2900,
        -304
      ],
      "id": "fe9ca20f-a784-400d-9cfb-37ce29a6f6f8",
      "name": "Get User State",
      "credentials": {
        "supabaseApi": {
          "id": "u1mkv2sS5oh337qr",
          "name": "Supabase Karma_Worker"
        }
      },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// Get state from Supabase\nconst items = $input.all();\nconst summaData = $('Ğ¡ÑƒĞ¼Ğ¼Ğ°').first().json;\nconst senderData = $('Edit Fields4').first().json;\nconst sender = senderData.sender || '';\nconst rawMsg = summaData.message || '';\nconst message = Array.isArray(rawMsg) ? rawMsg.join(' ') : String(rawMsg);\n\n// Detect client language from message\nfunction detectLang(msg) {\n  const m = msg.toLowerCase();\n  // Vietnamese: diacritics or common words\n  if (/[Ã Ã¡áº¡áº£Ã£Ã¢áº§áº¥áº­áº©áº«Äƒáº±áº¯áº·áº³áºµÃ¨Ã©áº¹áº»áº½Ãªá»áº¿á»‡á»ƒá»…Ã¬Ã­á»‹á»‰Ä©Ã²Ã³á»á»ÃµÃ´á»“á»‘á»™á»•á»—Æ¡á»á»›á»£á»Ÿá»¡Ã¹Ãºá»¥á»§Å©Æ°á»«á»©á»±á»­á»¯á»³Ã½á»µá»·á»¹Ä‘]/.test(m)) return 'Tiáº¿ng Viá»‡t';\n  if (/\\b(chÃ o|tÃ´i|cáº§n|thuÃª|ngÃ y|chá»—|báº¡n|xe|lÃ¡i|gá»­i|áº£nh|chá»n|muá»‘n)\\b/.test(m)) return 'Tiáº¿ng Viá»‡t';\n  // Russian: has Cyrillic\n  if (/[Ğ°-ÑÑ‘Ğ-Ğ¯Ğ]/.test(m)) return 'Ğ ÑƒÑÑĞºĞ¸Ğ¹';\n  // English: latin + common English words (no Cyrillic)\n  if (/\\b(hi|hello|hey|need|want|have|day|days|car|bike|motorbike|bicycle|city|experience|choose|take|please|thank|show|me|i|yes|no|ok|sure|great|nice|good|how|much|long|which|what)\\b/i.test(m)) return 'English';\n  // Ambiguous: just a number, emoji, or unrecognizable â†’ null\n  return null;\n}\nconst detectedLang = detectLang(message);\n\n// Today's date for booking rules\nconst _now = new Date();\nconst today = _now.getDate().toString().padStart(2,'0') + '.' + (_now.getMonth()+1).toString().padStart(2,'0') + '.' + (_now.getFullYear() % 100).toString().padStart(2,'0');\n\n// === DATE CHECK: parse date from message + state, warn if > 2 days ===\nfunction parseDateFromText(text, now) {\n  const t = text.toLowerCase();\n  const y = now.getFullYear();\n  const m = now.getMonth(); // 0-based\n  const d = now.getDate();\n  \n  // \"Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°\" / \"tomorrow\" / \"ngÃ y mai\"\n  if (/Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°|\\btomorrow\\b|ngÃ y mai/.test(t)) {\n    const dt = new Date(y, m, d + 1);\n    return dt;\n  }\n  // \"Ğ¿Ğ¾ÑĞ»ĞµĞ·Ğ°Ğ²Ñ‚Ñ€Ğ°\" / \"day after tomorrow\" / \"ngÃ y kia\"\n  if (/Ğ¿Ğ¾ÑĞ»ĞµĞ·Ğ°Ğ²Ñ‚Ñ€Ğ°|day after tomorrow|ngÃ y kia/.test(t)) {\n    const dt = new Date(y, m, d + 2);\n    return dt;\n  }\n  // \"Ñ‡ĞµÑ€ĞµĞ· N Ğ´Ğ½ĞµĞ¹\" / \"in N days\"\n  const inDays = t.match(/Ñ‡ĞµÑ€ĞµĞ·\\s*(\\d+)\\s*Ğ´Ğ½|in\\s*(\\d+)\\s*day/);\n  if (inDays) {\n    const n = parseInt(inDays[1] || inDays[2]);\n    return new Date(y, m, d + n);\n  }\n  // \"DD.MM\" or \"DD.MM.YY\"\n  const dotDate = t.match(/(\\d{1,2})\\.(\\d{1,2})(?:\\.(\\d{2,4}))?/);\n  if (dotDate) {\n    const dd = parseInt(dotDate[1]);\n    const mm = parseInt(dotDate[2]) - 1;\n    const yy = dotDate[3] ? (dotDate[3].length === 2 ? 2000 + parseInt(dotDate[3]) : parseInt(dotDate[3])) : y;\n    return new Date(yy, mm, dd);\n  }\n  // Russian months: \"10 Ğ¼Ğ°Ñ€Ñ‚Ğ°\", \"Ñ 5 Ğ°Ğ¿Ñ€ĞµĞ»Ñ\"\n  const ruMonths = {ÑĞ½Ğ²:0,Ñ„ĞµĞ²:1,Ğ¼Ğ°Ñ€:2,Ğ°Ğ¿Ñ€:3,Ğ¼Ğ°Ñ:4,Ğ¼Ğ°Ğ¹:4,Ğ¸ÑĞ½:5,Ğ¸ÑĞ»:6,Ğ°Ğ²Ğ³:7,ÑĞµĞ½:8,Ğ¾ĞºÑ‚:9,Ğ½Ğ¾Ñ:10,Ğ´ĞµĞº:11};\n  const ruMatch = t.match(/(\\d{1,2})\\s*(ÑĞ½Ğ²|Ñ„ĞµĞ²|Ğ¼Ğ°Ñ€|Ğ°Ğ¿Ñ€|Ğ¼Ğ°Ñ|Ğ¼Ğ°Ğ¹|Ğ¸ÑĞ½|Ğ¸ÑĞ»|Ğ°Ğ²Ğ³|ÑĞµĞ½|Ğ¾ĞºÑ‚|Ğ½Ğ¾Ñ|Ğ´ĞµĞº)/);\n  if (ruMatch) {\n    const dd = parseInt(ruMatch[1]);\n    const mm = ruMonths[ruMatch[2]];\n    if (mm !== undefined) return new Date(y, mm, dd);\n  }\n  // English months: \"march 10\", \"10 march\"\n  const enMonths = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};\n  const enMatch = t.match(/(\\d{1,2})\\s*(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|\\b(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\\w*\\s*(\\d{1,2})/);\n  if (enMatch) {\n    const dd = parseInt(enMatch[1] || enMatch[4]);\n    const monthStr = (enMatch[2] || enMatch[3]);\n    const mm = enMonths[monthStr];\n    if (mm !== undefined) return new Date(y, mm, dd);\n  }\n  return null;\n}\n\nfunction getDaysAway(parsedDate, now) {\n  if (!parsedDate || isNaN(parsedDate.getTime())) return null;\n  const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  const dateStart = new Date(parsedDate.getFullYear(), parsedDate.getMonth(), parsedDate.getDate());\n  return Math.round((dateStart - todayStart) / 86400000);\n}\n\n// Check date from message AND from existing state\nlet dateWarning = '';\nconst parsedMsgDate = parseDateFromText(message, _now);\nconst msgDaysAway = getDaysAway(parsedMsgDate, _now);\n\n// Also check state.Ğ´Ğ°Ñ‚Ğ° if set\nlet stateDaysAway = null;\nif (items.length > 0 && items[0].json.state && items[0].json.state['Ğ´Ğ°Ñ‚Ğ°'] && items[0].json.state['Ğ´Ğ°Ñ‚Ğ°'] !== '?') {\n  const stateDate = parseDateFromText(items[0].json.state['Ğ´Ğ°Ñ‚Ğ°'], _now);\n  stateDaysAway = getDaysAway(stateDate, _now);\n}\n\nconst effectiveDaysAway = msgDaysAway !== null ? msgDaysAway : stateDaysAway;\nif (effectiveDaysAway !== null && effectiveDaysAway > 2) {\n  dateWarning = '\\n[âš ï¸ BOOKING BLOCKED: arrival date ' + effectiveDaysAway + ' days away (max 2). Pick reply by client language:\\n' +\n    '- Ğ ÑƒÑÑĞºĞ¸Ğ¹: \"Ğ¡Ğ¿Ñ€Ğ¾Ñ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹, Ğ»ÑƒÑ‡ÑˆĞµ Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ-Ğ´Ğ²Ğ° Ğ´Ğ¾ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹. ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ½Ğ°Ğ¼ Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğº Ğ´Ğ°Ñ‚Ğµ â€” Ğ²ÑÑ‘ Ğ¿Ğ¾Ğ´Ğ±ĞµÑ€Ñ‘Ğ¼! ğŸ˜Š\"\\n' +\n    '- English: \"Demand is high right now! Better to book 1-2 days before your rental. Write us closer to the date and we\\'ll find everything for you! ğŸ˜Š\"\\n' +\n    '- Tiáº¿ng Viá»‡t: \"Nhu cáº§u hiá»‡n Ä‘ang ráº¥t cao! Tá»‘t nháº¥t nÃªn Ä‘áº·t trÆ°á»›c 1-2 ngÃ y. HÃ£y liÃªn há»‡ gáº§n ngÃ y thuÃª nhÃ© â€” chÃºng tÃ´i sáº½ tÃ¬m má»i thá»© cho báº¡n! ğŸ˜Š\"\\n' +\n    'Do NOT show catalog. Do NOT proceed with booking. ONLY say the above message.]\\n';\n}\n// === END DATE CHECK ===\n\n// Language is determined by majority of messages, not single detection\nlet clientLang = 'Ğ ÑƒÑÑĞºĞ¸Ğ¹'; // default until we compute from counts\n\n// Handle /reset command â€” SILENT reset, no response to user\nif (message.trim() === '/reset') {\n  let currentSession = 0;\n  try {\n    const prevState = items.length > 0 && items[0].json.state ? items[0].json.state : {};\n    currentSession = (prevState.session || 0) + 1;\n  } catch(e) { currentSession = 1; }\n\n  // Reset state in Supabase (keep only session counter)\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://upjyomatlonfgygoniir.supabase.co/rest/v1/user_state',\n      headers: {\n        'apikey': $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Authorization': 'Bearer ' + $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Content-Type': 'application/json',\n        'Prefer': 'resolution=merge-duplicates'\n      },\n      body: { jid: sender, state: { session: currentSession }, updated_at: new Date().toISOString() }\n    });\n  } catch(e) {}\n\n  // Return with ÑÑ‚Ğ°Ğ¿=Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ + no link â†’ Check Booked Logic drops it â†’ silent\n  return [{ json: {\n    sender: sender,\n    ÑÑ‚Ğ°Ğ¿: 'Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½',\n    clientLang: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹',\n    sessionKey: sender + '_v2_s' + currentSession,\n    message: ''\n  } }];\n}\n\n// Test phone numbers (get test flow rules)\nconst TEST_PHONES = ['84586066091', '79262579414', '84788623458'];\nconst senderDigits = sender.replace(/\\D/g, '');\nconst isTest = TEST_PHONES.some(p => senderDigits.includes(p)) || senderDigits.startsWith('7926257');\n\n// Get session counter early (needed for 12h timeout branch too)\nconst sessionNum = (items.length > 0 && items[0].json.state && items[0].json.state.session) ? items[0].json.state.session : 0;\n\n// Build state context\nlet stateContext = '';\nlet prefilledĞ­Ñ‚Ğ°Ğ¿ = 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ';\nif (items.length > 0 && items[0].json.state && Object.keys(items[0].json.state).length > 0) {\n  const state = items[0].json.state;\n\n  // Check state reset: if updated_at > 12h, reset\n  const updatedAt = items[0].json.updated_at;\n  if (updatedAt) {\n    const hoursAgo = (Date.now() - new Date(updatedAt).getTime()) / 3600000;\n    if (hoursAgo > 12) {\n      // State expired, start fresh\n      return [{ json: { sender, ÑÑ‚Ğ°Ğ¿: 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ', clientLang: clientLang, sessionKey: sender + '_v2_s' + sessionNum, message: '[Ğ¡Ğ•Ğ“ĞĞ”ĞĞ¯: ' + today + ']' + dateWarning + '\\nĞ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ:\\n[Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: ?]\\n[Ğ´Ğ½ĞµĞ¹: ?]\\n[Ğ´Ğ°Ñ‚Ğ°: ?]\\n[Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: ?]\\n[Ğ¾Ğ¿Ñ‹Ñ‚: ?]\\n[Ğ±Ğ°Ğ¹Ğº: ?]\\n[Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: ?]\\n[ÑÑ‚Ğ°Ğ¿: Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ]\\n' + '\\n---\\n' + message } }];\n    }\n  }\n  \n  // Build state with mandatory fields template\n  const defaults = {Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: '?', Ğ´Ğ½ĞµĞ¹: '?', Ğ´Ğ°Ñ‚Ğ°: '?', Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: '?', Ğ¾Ğ¿Ñ‹Ñ‚: '?', Ğ±Ğ°Ğ¹Ğº: '?', Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: '?', ÑÑ‚Ğ°Ğ¿: 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'};\n  const merged = {...defaults, ...state};\n\n  // Pre-fill state from client message (before GPT sees it)\n  const msg = message.toLowerCase();\n  if (merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] === '?') {\n    if (/(?:^|\\s)(Ğ°Ğ²Ñ‚Ğ¾|Ğ¼Ğ°ÑˆĞ¸Ğ½|car|cars|automobile|Ã´ tÃ´|xe hÆ¡i)/i.test(msg)) merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ°Ğ²Ñ‚Ğ¾';\n    else if (/(?:^|\\s)(Ğ±Ğ°Ğ¹Ğº|Ğ¼Ğ¾Ñ‚Ğ¾|ÑĞºÑƒÑ‚ĞµÑ€|bike|scooter|motorbike|motorcycle|xe mÃ¡y)/i.test(msg)) merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ±Ğ°Ğ¹Ğº';\n    else if (/(?:^|\\s)(Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´|Ğ²ĞµĞ»Ğ¸Ğº|bicycle|xe Ä‘áº¡p)/i.test(msg)) merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´';\n  }\n  if (merged['Ğ´Ğ½ĞµĞ¹'] === '?') {\n    const dm = msg.match(/(\\d+)\\s*Ğ´Ğ½|for\\s*(\\d+)\\s*day|(\\d+)\\s*ngÃ y/);\n    if (dm) merged['Ğ´Ğ½ĞµĞ¹'] = dm[1] || dm[2] || dm[3];\n  }\n  if (merged['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] === '?') {\n    if (/Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ|in the city|around town|trong thÃ nh|Ğ² Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğµ|around the city|city riding|city driving/.test(msg)) merged['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] = 'Ğ³Ğ¾Ñ€Ğ¾Ğ´';\n    else if (/Ğ·Ğ° Ğ³Ğ¾Ñ€Ğ¾Ğ´|Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ|long distance|highway/.test(msg)) merged['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] = 'Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ';\n  }\n  if (merged['Ğ¾Ğ¿Ñ‹Ñ‚'] === '?') {\n    if (/Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ|Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼|have.*license|been driving|cÃ³ báº±ng|Ğ¾Ğ¿Ñ‹Ñ‚ ĞµÑÑ‚ÑŒ|have experience|experienced|i ride|i drive/.test(msg)) merged['Ğ¾Ğ¿Ñ‹Ñ‚'] = 'ĞµÑÑ‚ÑŒ';\n  }\n  // If user provided all info in one message, skip to Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\n  if (merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] !== '?' && merged['Ğ´Ğ½ĞµĞ¹'] !== '?' && merged['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] !== '?' && merged['Ğ¾Ğ¿Ñ‹Ñ‚'] !== '?' && merged['ÑÑ‚Ğ°Ğ¿'] === 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ') {\n    merged['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€';\n  }\n  // If user provided transport but not all info, skip to Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\n  else if (merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] !== '?' && merged['ÑÑ‚Ğ°Ğ¿'] === 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ') {\n    merged['ÑÑ‚Ğ°Ğ¿'] = 'Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ';\n  }\n  prefilledĞ­Ñ‚Ğ°Ğ¿ = merged['ÑÑ‚Ğ°Ğ¿'];\n  // Language by majority: count messages per language, use the dominant one\n  let langCounts = {};\n  try { langCounts = JSON.parse(merged['_langCounts'] || '{}'); } catch(e) { langCounts = {}; }\n  if (detectedLang) {\n    langCounts[detectedLang] = (langCounts[detectedLang] || 0) + 1;\n  }\n  merged['_langCounts'] = JSON.stringify(langCounts);\n  // Pick language with most messages\n  let maxCount = 0;\n  let dominantLang = null;\n  for (const [lang, count] of Object.entries(langCounts)) {\n    if (count > maxCount) { maxCount = count; dominantLang = lang; }\n  }\n  clientLang = dominantLang || 'Ğ ÑƒÑÑĞºĞ¸Ğ¹';\n  merged['ÑĞ·Ñ‹Ğº'] = clientLang;\n\n  stateContext = 'Ğ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ:\\n';\n  for (const [key, value] of Object.entries(merged)) {\n    stateContext += '[' + key + ': ' + value + ']\\n';\n  }\n}\n\n// If no state at all â€” new user, inject empty template\nif (!stateContext) {\n  // For new users, use detected language from first message\n  if (detectedLang) clientLang = detectedLang;\n  stateContext = 'Ğ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ:\\n[Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: ?]\\n[Ğ´Ğ½ĞµĞ¹: ?]\\n[Ğ´Ğ°Ñ‚Ğ°: ?]\\n[Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: ?]\\n[Ğ¾Ğ¿Ñ‹Ñ‚: ?]\\n[Ğ±Ğ°Ğ¹Ğº: ?]\\n[Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: ?]\\n[ÑÑ‚Ğ°Ğ¿: Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ]\\n';\n}\n\n// ===== DATE CHECK: far date â†’ deterministic warning, skip AI Agent =====\nif (effectiveDaysAway !== null && effectiveDaysAway > 2) {\n  const dateMessages = {\n    'Ğ ÑƒÑÑĞºĞ¸Ğ¹': 'Ğ¡Ğ¿Ñ€Ğ¾Ñ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹, Ğ»ÑƒÑ‡ÑˆĞµ Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ-Ğ´Ğ²Ğ° Ğ´Ğ¾ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹. ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ½Ğ°Ğ¼ Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğº Ğ´Ğ°Ñ‚Ğµ â€” Ğ²ÑÑ‘ Ğ¿Ğ¾Ğ´Ğ±ĞµÑ€Ñ‘Ğ¼! ğŸ˜Š',\n    'English': 'Demand is high right now! Better to book 1-2 days before your rental. Write us closer to the date and we\\'ll find everything for you! ğŸ˜Š',\n    'Tiáº¿ng Viá»‡t': 'Nhu cáº§u hiá»‡n Ä‘ang ráº¥t cao! Tá»‘t nháº¥t nÃªn Ä‘áº·t trÆ°á»›c 1-2 ngÃ y. HÃ£y liÃªn há»‡ gáº§n ngÃ y thuÃª nhÃ© â€” chÃºng tÃ´i sáº½ tÃ¬m má»i thá»© cho báº¡n! ğŸ˜Š'\n  };\n  const dateMsg = dateMessages[clientLang] || dateMessages['Ğ ÑƒÑÑĞºĞ¸Ğ¹'];\n\n  // Send WhatsApp message directly\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://karma-wa.fly.dev/message/sendText/karma',\n      headers: { 'apikey': 'karma-evo-2026-secret', 'Content-Type': 'application/json' },\n      body: { number: sender, text: dateMsg }\n    });\n  } catch(e) {}\n\n  // Save state (keep existing, add date warning flag)\n  let dateState = { ÑÑ‚Ğ°Ğ¿: 'Ğ´Ğ°Ñ‚Ğ°_Ğ´Ğ°Ğ»ĞµĞºĞ¾', session: sessionNum };\n  if (items.length > 0 && items[0].json.state && Object.keys(items[0].json.state).length > 0) {\n    dateState = { ...items[0].json.state, ÑÑ‚Ğ°Ğ¿: 'Ğ´Ğ°Ñ‚Ğ°_Ğ´Ğ°Ğ»ĞµĞºĞ¾' };\n  }\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://upjyomatlonfgygoniir.supabase.co/rest/v1/user_state',\n      headers: {\n        'apikey': $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Authorization': 'Bearer ' + $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Content-Type': 'application/json',\n        'Prefer': 'resolution=merge-duplicates'\n      },\n      body: { jid: sender, state: dateState, updated_at: new Date().toISOString() }\n    });\n  } catch(e) {}\n\n  // Return with Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ ÑÑ‚Ğ°Ğ¿ â†’ Check Stage drops it â†’ silent (no AI)\n  return [{ json: {\n    sender: sender,\n    ÑÑ‚Ğ°Ğ¿: 'Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½',\n    clientLang: clientLang,\n    sessionKey: sender + '_v2_s' + sessionNum,\n    message: ''\n  } }];\n}\n// ===== END DATE CHECK =====\n\n// ===== ĞĞ’Ğ¢Ğ â†’ ĞĞŸĞ•Ğ ĞĞ¢ĞĞ : deterministic redirect, skip AI Agent =====\nconst msgLower = message.toLowerCase();\nconst autoInMsg = /(?:^|\\s)(Ğ°Ğ²Ñ‚Ğ¾|Ğ¼Ğ°ÑˆĞ¸Ğ½|car|cars|automobile|Ã´ tÃ´|xe hÆ¡i)/i.test(msgLower);\nconst autoInState = stateContext.includes('[Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: Ğ°Ğ²Ñ‚Ğ¾]');\nconst isAutoRequest = autoInMsg || autoInState;\nconst earlyStages = ['Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ', 'Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ', 'Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€'];\n\nif (isAutoRequest && earlyStages.includes(prefilledĞ­Ñ‚Ğ°Ğ¿)) {\n  // Pick message by client language\n  const autoMessages = {\n    'Ğ ÑƒÑÑĞºĞ¸Ğ¹': 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñƒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ° Ğ¿Ğ¾ Ğ°Ñ€ĞµĞ½Ğ´Ğµ Ğ°Ğ²Ñ‚Ğ¾, Ğ¾Ğ½ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ²Ğ°Ğ¼! ğŸš—',\n    'English': 'Great! I\\'ll connect you with our car rental manager, they\\'ll message you shortly! ğŸš—',\n    'Tiáº¿ng Viá»‡t': 'Tuyá»‡t vá»i! TÃ´i sáº½ káº¿t ná»‘i báº¡n vá»›i quáº£n lÃ½ cho thuÃª Ã´ tÃ´, há» sáº½ nháº¯n cho báº¡n ngay! ğŸš—'\n  };\n  const autoMsg = autoMessages[clientLang] || autoMessages['Ğ ÑƒÑÑĞºĞ¸Ğ¹'];\n\n  // Send WhatsApp message via Evolution API\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://karma-wa.fly.dev/message/sendText/karma',\n      headers: { 'apikey': 'karma-evo-2026-secret', 'Content-Type': 'application/json' },\n      body: { number: sender, text: autoMsg }\n    });\n  } catch(e) { /* WA send failed, still save state */ }\n\n  // Build state preserving existing fields\n  let autoState = { Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: 'Ğ°Ğ²Ñ‚Ğ¾', ÑÑ‚Ğ°Ğ¿: 'Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€', session: sessionNum };\n  if (items.length > 0 && items[0].json.state && Object.keys(items[0].json.state).length > 0) {\n    autoState = { ...items[0].json.state, Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: 'Ğ°Ğ²Ñ‚Ğ¾', ÑÑ‚Ğ°Ğ¿: 'Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€' };\n  }\n\n  // Save state to Supabase\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://upjyomatlonfgygoniir.supabase.co/rest/v1/user_state',\n      headers: {\n        'apikey': $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Authorization': 'Bearer ' + $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Content-Type': 'application/json',\n        'Prefer': 'resolution=merge-duplicates'\n      },\n      body: { jid: sender, state: autoState, updated_at: new Date().toISOString() }\n    });\n  } catch(e) { /* state save failed */ }\n\n  // Return Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ â†’ Check Stage catches â†’ No Operation â†’ done\n  return [{ json: {\n    sender: sender,\n    ÑÑ‚Ğ°Ğ¿: 'Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€',\n    clientLang: clientLang,\n    sessionKey: sender + '_v2_s' + sessionNum,\n    message: ''\n  } }];\n}\n// ===== END ĞĞ’Ğ¢Ğ â†’ ĞĞŸĞ•Ğ ĞĞ¢ĞĞ  =====\n\n\n// ==================== PROD FLOW (synced with TEST_FLOW 2026-02-25) ====================\nconst PROD_FLOW = `Ğ¢Ñ‹ Ğ²ĞµĞ´Ñ‘ÑˆÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼. Ğ£ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºĞ¸ Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°.\n\nĞ“Ğ›ĞĞ’ĞĞĞ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ: Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ½Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ. ĞĞµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹ ÑĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ â€” ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚. Ğ’ĞµĞ´Ğ¸ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€ ĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾.\n\nĞ¯Ğ—Ğ«Ğš â€” ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:\nğŸ”´ ĞĞ¢Ğ’Ğ•Ğ§ĞĞ™ Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ Ğ¯Ğ—Ğ«ĞšĞ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ. English â†’ English. Tiáº¿ng Viá»‡t â†’ tiáº¿ng Viá»‡t. Ğ ÑƒÑÑĞºĞ¸Ğ¹ â†’ Ñ€ÑƒÑÑĞºĞ¸Ğ¹.\nğŸ”´ Ğ’Ğ¡Ğ Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° ÑĞ·Ñ‹ĞºĞµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°! Ğ’ĞºĞ»ÑÑ‡Ğ°Ñ:\n  - ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: \"Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹\" â†’ \"black\", \"Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹\" â†’ \"tall\", \"ĞºĞ¾Ñ€Ğ¸Ñ‡Ğ½ĞµĞ²Ñ‹Ğ¹\" â†’ \"brown\"\n  - Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸: \"Ğ¼ĞµÑÑ‚\" â†’ \"seats\", \"ĞºÑ€Ğ¾ÑÑĞ¾Ğ²ĞµÑ€\" â†’ \"crossover\", \"ÑĞµĞ´Ğ°Ğ½\" â†’ \"sedan\"\n  - Ğ‘Ğ¾Ğ½ÑƒÑÑ‹ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´Ğ¸\n  - Ğ‘Ñ€ĞµĞ½Ğ´/Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ (Honda, Mazda, Kia, NVX)\nğŸ”´ Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ²ĞµÑ€ĞµĞ½ Ğ² Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğµ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ° â€” Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸ ĞµĞ³Ğ¾, ĞĞ• Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞ¹ Ñ€ÑƒÑÑĞºĞ¸Ğµ ÑĞ»Ğ¾Ğ²Ğ°!\n\nĞ–ĞĞ¡Ğ¢ĞšĞ˜Ğ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ:\n- ĞĞ• ĞŸĞĞšĞĞ—Ğ«Ğ’ĞĞ™ ĞšĞĞ¢ĞĞ›ĞĞ“ Ğ¿Ğ¾ĞºĞ° Ğ½Ğµ ÑĞ¾Ğ±Ñ€Ğ°Ğ» Ğ’Ğ¡Ğ• Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ: Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚, Ğ´Ğ½ĞµĞ¹, Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ, Ğ¾Ğ¿Ñ‹Ñ‚. Ğ•ÑĞ»Ğ¸ Ñ…Ğ¾Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ = \"?\" â€” ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¿Ñ€Ğ¾ÑĞ¸.\n- Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ» Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€. \"Ğ°Ğ²Ñ‚Ğ¾ Ğ½Ğ° 5 Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\") â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ²ÑÑ‘, ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰ĞµĞµ.\n- Ğ¦Ğ•ĞĞ« Ğ¸ ĞœĞĞ”Ğ•Ğ›Ğ˜ â€” Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞĞµ Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ğ¹ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ (ÑÑ‚Ñ€Ğ°Ñ…Ğ¾Ğ²ĞºÑƒ, ÑĞºĞ¸Ğ´ĞºĞ¸, ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ). ĞĞµ Ğ·Ğ½Ğ°ĞµÑˆÑŒ â†’ \"ÑƒÑ‚Ğ¾Ñ‡Ğ½Ñ Ñƒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°\".\n- Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ñ…Ğ¾Ñ‡ĞµÑ‚ Ğ½Ğ° 1 Ğ´ĞµĞ½ÑŒ â†’ \"Ğ£ Ğ½Ğ°Ñ Ğ°Ñ€ĞµĞ½Ğ´Ğ° Ğ¾Ñ‚ 2 Ğ´Ğ½ĞµĞ¹. ĞŸĞ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚ 2 Ğ´Ğ½Ñ?\"\n- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° = Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¸Ğ½Ñ„Ğ¾. ĞĞµ Ğ¾Ğ·Ğ²ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ¹ (\"Ñ Ğ²Ğ¸Ğ¶Ñƒ Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹...\").\n\nĞ¢Ğ˜ĞŸ Ğ¢Ğ ĞĞĞ¡ĞŸĞĞ Ğ¢Ğ â€” ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ°Ğ²Ñ‚Ğ¾/Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ°/car/Ã´ tÃ´/xe hÆ¡i\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ ĞĞ’Ğ¢Ğ (cars). Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ¹ĞºĞ¸!\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ±Ğ°Ğ¹Ğº/Ğ¼Ğ¾Ñ‚Ğ¾Ñ†Ğ¸ĞºĞ»/ÑĞºÑƒÑ‚ĞµÑ€/motorbike/scooter/xe mÃ¡y\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ Ğ‘ĞĞ™ĞšĞ˜ (bikes). Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾!\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´/bicycle/xe Ä‘áº¡p\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ Ğ’Ğ•Ğ›ĞĞ¡Ğ˜ĞŸĞ•Ğ”Ğ« (bicycles).\nğŸ”´ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ĞĞ• ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ» Ñ‚Ğ¸Ğ¿ â†’ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ ÑĞ¿Ñ€Ğ¾ÑĞ¸: \"ĞšĞ°ĞºĞ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â€” Ğ±Ğ°Ğ¹Ğº, Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´?\"\nğŸ”´ ĞŸĞĞšĞĞ–Ğ˜ Ğ’Ğ¡Ğ• ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°! Ğ•ÑĞ»Ğ¸ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… 9 Ğ¼Ğ°ÑˆĞ¸Ğ½ â€” Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ²ÑĞµ 9. ĞĞµ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ¹!\n\nĞ­Ğ¢ĞĞŸĞ« (Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ¿Ğ¾ [ÑÑ‚Ğ°Ğ¿:] Ğ¸ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ğ¾Ğ»ĞµĞ¹ STATE):\n\n1. ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\" Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚)\n   â†’ ĞŸĞ¾Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞ¹, ÑĞ¿Ñ€Ğ¾ÑĞ¸ ĞºĞ°ĞºĞ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ (Ğ±Ğ°Ğ¹Ğº/Ğ°Ğ²Ñ‚Ğ¾/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´)\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑÑ€Ğ°Ğ·Ñƒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ» Ñ‚Ğ¸Ğ¿ â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ¸ Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\"\n\n2. Ğ£Ğ¢ĞĞ§ĞĞ•ĞĞ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\")\n   â†’ ĞÑƒĞ¶Ğ½Ğ¾ ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ: Ğ´Ğ½ĞµĞ¹, Ñ ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°, Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ, Ğ¾Ğ¿Ñ‹Ñ‚ Ğ²Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ\n   â†’ Ğ¡Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ (Ğ³Ğ´Ğµ \"?\")\n   â†’ ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑĞ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ 2-3 Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼\n   â†’ ĞšĞ¾Ğ³Ğ´Ğ° Ğ’Ğ¡Ğ• ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ¾ (Ğ´Ğ½ĞµĞ¹ â‰  \"?\", Ğ´Ğ°Ñ‚Ğ° â‰  \"?\", Ğ³Ğ¾Ñ€Ğ¾Ğ´ â‰  \"?\", Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\") â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   â†’ ğŸ”´ ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¼ ÑÑ‚Ğ°Ğ¿Ğµ!\n\n3. ĞŸĞĞ”Ğ‘ĞĞ  (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\")\n   â†’ ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ’Ğ¡Ğ• ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğµ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°: Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, ĞºĞ»Ğ°ÑÑ, Ñ†ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°\n   â†’ ĞĞ”Ğ˜Ğ Ğ ĞĞ— ÑĞºĞ°Ğ¶Ğ¸ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ (ĞŸĞ•Ğ Ğ•Ğ’Ğ•Ğ”Ğ˜ Ğ½Ğ° ÑĞ·Ñ‹Ğº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°!):\n     - Ğ¾Ñ‚ 3 Ğ´Ğ½ĞµĞ¹ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹: Ğ´Ğ°Ñ€Ğ¸Ğ¼ ĞºĞ°Ñ€Ñ‚Ñƒ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°\n     - Ğ¾Ñ‚ 7 Ğ´Ğ½ĞµĞ¹: Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ \"Ñ‡Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ?\" â€” Ğ´Ğ°Ğ¹ ĞºÑ€Ğ°Ñ‚ĞºĞ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº (Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ + Ñ†ĞµĞ½Ğ°), Ğ½Ğµ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° â†’ \"Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ [Ñ‚Ğ¸Ğ¿] Ğ½ĞµÑ‚, ĞºĞ°Ğº Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ â€” ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ!\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ½ĞµÑ‚_Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°\"\n\n4. Ğ’Ğ«Ğ‘ĞĞ  (ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ â€” \"Ğ±ĞµÑ€Ñƒ X\" / \"Ñ…Ğ¾Ñ‡Ñƒ X\")\n   â†’ Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ² STATE Ğ¿Ğ¾Ğ»Ğµ \"Ğ±Ğ°Ğ¹Ğº\" = Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸\n   â†’ Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=Ğ°Ğ²Ñ‚Ğ¾ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ñ (Ğ’Ğ£). Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ’Ğ£!\n   â†’ Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=Ğ±Ğ°Ğ¹Ğº/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° (Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ˜Ğ›Ğ˜ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° â€” Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚)\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\"\n   â†’ ĞŸĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ» â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n5. ĞŸĞĞ¡ĞŸĞĞ Ğ¢ (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\")\n   â†’ [Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢] â†’ \"âœ… Ğ—Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾! Ğ¡ĞºĞ¾Ñ€Ğ¾ ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\"\n   â†’ ğŸ”´ ĞŸĞĞ¡Ğ›Ğ• Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ±Ñ€Ğ¾Ğ½Ğ¸, ĞµÑĞ»Ğ¸ Ğ´Ğ½ĞµĞ¹ >= 3, Ğ¡Ğ ĞĞ—Ğ£ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ:\n     \"ğŸ—ºï¸ Ğ‘Ğ¾Ğ½ÑƒÑ! Ğ’Ğ¾Ñ‚ ĞºĞ°Ñ€Ñ‚Ğ° Ğ´Ğ¾ÑÑ‚Ğ¾Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ĞµĞ¹ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°: https://maps.app.goo.gl/9oegqGYXydKWX6tUA?g_st=ac\"\n   â†’ [Ğ¤ĞĞ¢Ğ] Ğ±ĞµĞ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° â†’ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ (Ğ’Ğ£ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾, Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸Ğ»Ğ¸ Ğ’Ğ£ Ğ´Ğ»Ñ Ğ±Ğ°Ğ¹ĞºĞ°/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´Ğ°)\n   â†’ Ğ¥Ğ¾Ñ‡ĞµÑ‚ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n6. Ğ—ĞĞ‘Ğ ĞĞĞ˜Ğ ĞĞ’ĞĞ (ÑÑ‚Ğ°Ğ¿ = \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\")\n   â†’ ĞŸĞ¾ Ğ±Ñ€Ğ¾Ğ½Ğ¸ â†’ \"ĞŸĞµÑ€ĞµĞ´Ğ°Ğ¼ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñƒ, ÑĞºĞ¾Ñ€Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚!\"\n   â†’ ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ â†’ Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ğµ\n\nĞ›ĞĞšĞĞ¦Ğ˜Ğ¯:\nĞ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚: Ğ³Ğ´Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ĞµÑÑŒ / Ğ°Ğ´Ñ€ĞµÑ / location / where are you / á»Ÿ Ä‘Ã¢u / Ğ³Ğ´Ğµ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ / pickup point:\nâ†’ Ğ”Ğ°Ğ¹ ÑÑÑ‹Ğ»ĞºÑƒ: https://maps.app.goo.gl/N9x7DPV7LYf2BSUv6?g_st=ac\nâ†’ ÑÑ‚Ğ°Ğ¿ ĞĞ• Ğ¼ĞµĞ½ÑĞ¹ (Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹)\n\nĞ¡Ğ¢ĞĞŸĞ¡Ğ›ĞĞ’Ğ (\"Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ°\"/\"Ğ½Ğµ Ğ½Ğ°Ğ´Ğ¾\"/\"Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ»\"/\"cancel\"):\nâ†’ \"Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾, ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ â€” Ğ¼Ñ‹ Ğ½Ğ° ÑĞ²ÑĞ·Ğ¸!\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\n\nĞĞ• ĞŸĞĞ’Ğ¢ĞĞ Ğ¯Ğ™:\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ» ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ â€” Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ ÑĞ½Ğ¾Ğ²Ğ° Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ ÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» Ğ¾Ñ‚Ğ²ĞµÑ‚ â€” Ğ½Ğµ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¾Ğ¿ÑÑ‚ÑŒ\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ ÑƒĞ¿Ğ¾Ğ¼ÑĞ½ÑƒĞ» Ğ±Ğ¾Ğ½ÑƒÑÑ‹ â€” Ğ½Ğµ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾\n\nâš ï¸ STATE â€” Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ĞšĞĞ–Ğ”ĞĞ“Ğ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:\nSTATE: {\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚\": \"?\", \"Ğ´Ğ½ĞµĞ¹\": \"?\", \"Ğ´Ğ°Ñ‚Ğ°\": \"?\", \"Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸\": \"?\", \"Ğ¾Ğ¿Ñ‹Ñ‚\": \"?\", \"Ğ±Ğ°Ğ¹Ğº\": \"?\", \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\": \"?\", \"ÑÑ‚Ğ°Ğ¿\": \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\"}\nğŸ”´ Ğ—ĞĞĞ§Ğ•ĞĞ˜Ğ¯ STATE Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ ĞĞ Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ! Ğ”Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ½Ğ° English/Vietnamese:\n   Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ = \"Ğ±Ğ°Ğ¹Ğº\" / \"Ğ°Ğ²Ñ‚Ğ¾\" / \"Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´\" / \"?\"\n   Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ = \"Ğ³Ğ¾Ñ€Ğ¾Ğ´\" / \"Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ\" / \"?\"\n   Ğ¾Ğ¿Ñ‹Ñ‚ = \"ĞµÑÑ‚ÑŒ\" / \"Ğ½ĞµÑ‚\" / \"?\"\n   ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\" / \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\" / \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\" / \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\" / \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\" / \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\nĞ—Ğ°Ğ¼ĞµĞ½ÑĞ¹ ? Ğ½Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞ¹ Ğ’Ğ¡Ğ• Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ!\nğŸ”´ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ°Ğ» ĞĞ•Ğ¡ĞšĞĞ›Ğ¬ĞšĞ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ â€” Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ’Ğ¡Ğ• ÑÑ€Ğ°Ğ·Ñƒ!\n   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"motorbike for 7 days, around the city, I have experience\" â†’ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=\"Ğ±Ğ°Ğ¹Ğº\", Ğ´Ğ½ĞµĞ¹=\"7\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸=\"Ğ³Ğ¾Ñ€Ğ¾Ğ´\", Ğ¾Ğ¿Ñ‹Ñ‚=\"ĞµÑÑ‚ÑŒ\", ÑÑ‚Ğ°Ğ¿=\"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"xe mÃ¡y 5 ngÃ y, trong thÃ nh phá»‘\" â†’ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=\"Ğ±Ğ°Ğ¹Ğº\", Ğ´Ğ½ĞµĞ¹=\"5\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸=\"Ğ³Ğ¾Ñ€Ğ¾Ğ´\"\nĞšĞ¾Ğ³Ğ´Ğ° Ğ´Ğ½ĞµĞ¹+Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸+Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\", Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³.\nĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ±Ğ°Ğ¹Ğº Ğ¸ Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ° (Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)!\nĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ³Ğ°Ğ¹ ÑÑ‚Ğ°Ğ¿ Ğ¿Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ğ¼ Ğ²Ñ‹ÑˆĞµ!`;\n\n// ==================== TEST FLOW (safe to experiment) ====================\n// Copy of prod â€” edit freely, test on your phones, then promote to prod\nconst TEST_FLOW = `Ğ¢Ñ‹ Ğ²ĞµĞ´Ñ‘ÑˆÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼. Ğ£ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºĞ¸ Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°.\n\nĞ“Ğ›ĞĞ’ĞĞĞ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ: Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ½Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ. ĞĞµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹ ÑĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ â€” ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚. Ğ’ĞµĞ´Ğ¸ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€ ĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾.\n\nĞ¯Ğ—Ğ«Ğš â€” ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:\nğŸ”´ ĞĞ¢Ğ’Ğ•Ğ§ĞĞ™ Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ Ğ¯Ğ—Ğ«ĞšĞ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ. English â†’ English. Tiáº¿ng Viá»‡t â†’ tiáº¿ng Viá»‡t. Ğ ÑƒÑÑĞºĞ¸Ğ¹ â†’ Ñ€ÑƒÑÑĞºĞ¸Ğ¹.\nğŸ”´ Ğ’Ğ¡Ğ Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° ÑĞ·Ñ‹ĞºĞµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°! Ğ’ĞºĞ»ÑÑ‡Ğ°Ñ:\n  - ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: \"Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹\" â†’ \"black\", \"Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹\" â†’ \"tall\", \"ĞºĞ¾Ñ€Ğ¸Ñ‡Ğ½ĞµĞ²Ñ‹Ğ¹\" â†’ \"brown\"\n  - Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸: \"Ğ¼ĞµÑÑ‚\" â†’ \"seats\", \"ĞºÑ€Ğ¾ÑÑĞ¾Ğ²ĞµÑ€\" â†’ \"crossover\", \"ÑĞµĞ´Ğ°Ğ½\" â†’ \"sedan\"\n  - Ğ‘Ğ¾Ğ½ÑƒÑÑ‹ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´Ğ¸\n  - Ğ‘Ñ€ĞµĞ½Ğ´/Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ (Honda, Mazda, Kia, NVX)\nğŸ”´ Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ²ĞµÑ€ĞµĞ½ Ğ² Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğµ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ° â€” Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸ ĞµĞ³Ğ¾, ĞĞ• Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞ¹ Ñ€ÑƒÑÑĞºĞ¸Ğµ ÑĞ»Ğ¾Ğ²Ğ°!\n\nĞ–ĞĞ¡Ğ¢ĞšĞ˜Ğ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ:\n- ĞĞ• ĞŸĞĞšĞĞ—Ğ«Ğ’ĞĞ™ ĞšĞĞ¢ĞĞ›ĞĞ“ Ğ¿Ğ¾ĞºĞ° Ğ½Ğµ ÑĞ¾Ğ±Ñ€Ğ°Ğ» Ğ’Ğ¡Ğ• Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ: Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚, Ğ´Ğ½ĞµĞ¹, Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ, Ğ¾Ğ¿Ñ‹Ñ‚. Ğ•ÑĞ»Ğ¸ Ñ…Ğ¾Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ = \"?\" â€” ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¿Ñ€Ğ¾ÑĞ¸.\n- Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ» Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€. \"Ğ°Ğ²Ñ‚Ğ¾ Ğ½Ğ° 5 Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\") â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ²ÑÑ‘, ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰ĞµĞµ.\n- Ğ¦Ğ•ĞĞ« Ğ¸ ĞœĞĞ”Ğ•Ğ›Ğ˜ â€” Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞĞµ Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ğ¹ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ (ÑÑ‚Ñ€Ğ°Ñ…Ğ¾Ğ²ĞºÑƒ, ÑĞºĞ¸Ğ´ĞºĞ¸, ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ). ĞĞµ Ğ·Ğ½Ğ°ĞµÑˆÑŒ â†’ \"ÑƒÑ‚Ğ¾Ñ‡Ğ½Ñ Ñƒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°\".\n- Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ñ…Ğ¾Ñ‡ĞµÑ‚ Ğ½Ğ° 1 Ğ´ĞµĞ½ÑŒ â†’ \"Ğ£ Ğ½Ğ°Ñ Ğ°Ñ€ĞµĞ½Ğ´Ğ° Ğ¾Ñ‚ 2 Ğ´Ğ½ĞµĞ¹. ĞŸĞ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚ 2 Ğ´Ğ½Ñ?\"\n- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° = Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¸Ğ½Ñ„Ğ¾. ĞĞµ Ğ¾Ğ·Ğ²ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ¹ (\"Ñ Ğ²Ğ¸Ğ¶Ñƒ Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹...\").\n\nĞ¢Ğ˜ĞŸ Ğ¢Ğ ĞĞĞ¡ĞŸĞĞ Ğ¢Ğ â€” ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ°Ğ²Ñ‚Ğ¾/Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ°/car/Ã´ tÃ´/xe hÆ¡i\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ ĞĞ’Ğ¢Ğ (cars). Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ¹ĞºĞ¸!\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ±Ğ°Ğ¹Ğº/Ğ¼Ğ¾Ñ‚Ğ¾Ñ†Ğ¸ĞºĞ»/ÑĞºÑƒÑ‚ĞµÑ€/motorbike/scooter/xe mÃ¡y\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ Ğ‘ĞĞ™ĞšĞ˜ (bikes). Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾!\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´/bicycle/xe Ä‘áº¡p\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ Ğ’Ğ•Ğ›ĞĞ¡Ğ˜ĞŸĞ•Ğ”Ğ« (bicycles).\nğŸ”´ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ĞĞ• ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ» Ñ‚Ğ¸Ğ¿ â†’ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ ÑĞ¿Ñ€Ğ¾ÑĞ¸: \"ĞšĞ°ĞºĞ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â€” Ğ±Ğ°Ğ¹Ğº, Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´?\"\nğŸ”´ ĞŸĞĞšĞĞ–Ğ˜ Ğ’Ğ¡Ğ• ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°! Ğ•ÑĞ»Ğ¸ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… 9 Ğ¼Ğ°ÑˆĞ¸Ğ½ â€” Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ²ÑĞµ 9. ĞĞµ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ¹!\n\nĞ­Ğ¢ĞĞŸĞ« (Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ¿Ğ¾ [ÑÑ‚Ğ°Ğ¿:] Ğ¸ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ğ¾Ğ»ĞµĞ¹ STATE):\n\n1. ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\" Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚)\n   â†’ ĞŸĞ¾Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞ¹, ÑĞ¿Ñ€Ğ¾ÑĞ¸ ĞºĞ°ĞºĞ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ (Ğ±Ğ°Ğ¹Ğº/Ğ°Ğ²Ñ‚Ğ¾/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´)\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑÑ€Ğ°Ğ·Ñƒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ» Ñ‚Ğ¸Ğ¿ â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ¸ Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\"\n\n2. Ğ£Ğ¢ĞĞ§ĞĞ•ĞĞ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\")\n   â†’ ĞÑƒĞ¶Ğ½Ğ¾ ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ: Ğ´Ğ½ĞµĞ¹, Ñ ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°, Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ, Ğ¾Ğ¿Ñ‹Ñ‚ Ğ²Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ\n   â†’ Ğ¡Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ (Ğ³Ğ´Ğµ \"?\")\n   â†’ ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑĞ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ 2-3 Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼\n   â†’ ĞšĞ¾Ğ³Ğ´Ğ° Ğ’Ğ¡Ğ• ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ¾ (Ğ´Ğ½ĞµĞ¹ â‰  \"?\", Ğ´Ğ°Ñ‚Ğ° â‰  \"?\", Ğ³Ğ¾Ñ€Ğ¾Ğ´ â‰  \"?\", Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\") â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   â†’ ğŸ”´ ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¼ ÑÑ‚Ğ°Ğ¿Ğµ!\n\n3. ĞŸĞĞ”Ğ‘ĞĞ  (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\")\n   â†’ ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ’Ğ¡Ğ• ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğµ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°: Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, ĞºĞ»Ğ°ÑÑ, Ñ†ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°\n   â†’ ĞĞ”Ğ˜Ğ Ğ ĞĞ— ÑĞºĞ°Ğ¶Ğ¸ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ (ĞŸĞ•Ğ Ğ•Ğ’Ğ•Ğ”Ğ˜ Ğ½Ğ° ÑĞ·Ñ‹Ğº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°!):\n     - Ğ¾Ñ‚ 3 Ğ´Ğ½ĞµĞ¹ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹: Ğ´Ğ°Ñ€Ğ¸Ğ¼ ĞºĞ°Ñ€Ñ‚Ñƒ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°\n     - Ğ¾Ñ‚ 7 Ğ´Ğ½ĞµĞ¹: Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ \"Ñ‡Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ?\" â€” Ğ´Ğ°Ğ¹ ĞºÑ€Ğ°Ñ‚ĞºĞ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº (Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ + Ñ†ĞµĞ½Ğ°), Ğ½Ğµ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° â†’ \"Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ [Ñ‚Ğ¸Ğ¿] Ğ½ĞµÑ‚, ĞºĞ°Ğº Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ â€” ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ!\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ½ĞµÑ‚_Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°\"\n\n4. Ğ’Ğ«Ğ‘ĞĞ  (ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ â€” \"Ğ±ĞµÑ€Ñƒ X\" / \"Ñ…Ğ¾Ñ‡Ñƒ X\")\n   â†’ Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ² STATE Ğ¿Ğ¾Ğ»Ğµ \"Ğ±Ğ°Ğ¹Ğº\" = Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸\n   â†’ Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=Ğ°Ğ²Ñ‚Ğ¾ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ñ (Ğ’Ğ£). Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ’Ğ£!\n   â†’ Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=Ğ±Ğ°Ğ¹Ğº/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° (Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ˜Ğ›Ğ˜ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° â€” Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚)\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\"\n   â†’ ĞŸĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ» â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n5. ĞŸĞĞ¡ĞŸĞĞ Ğ¢ (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\")\n   â†’ [Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢] â†’ \"âœ… Ğ—Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾! Ğ¡ĞºĞ¾Ñ€Ğ¾ ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\"\n   â†’ ğŸ”´ ĞŸĞĞ¡Ğ›Ğ• Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ±Ñ€Ğ¾Ğ½Ğ¸, ĞµÑĞ»Ğ¸ Ğ´Ğ½ĞµĞ¹ >= 3, Ğ¡Ğ ĞĞ—Ğ£ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ:\n     \"ğŸ—ºï¸ Ğ‘Ğ¾Ğ½ÑƒÑ! Ğ’Ğ¾Ñ‚ ĞºĞ°Ñ€Ñ‚Ğ° Ğ´Ğ¾ÑÑ‚Ğ¾Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ĞµĞ¹ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°: https://maps.app.goo.gl/9oegqGYXydKWX6tUA?g_st=ac\"\n   â†’ [Ğ¤ĞĞ¢Ğ] Ğ±ĞµĞ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° â†’ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ (Ğ’Ğ£ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾, Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸Ğ»Ğ¸ Ğ’Ğ£ Ğ´Ğ»Ñ Ğ±Ğ°Ğ¹ĞºĞ°/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´Ğ°)\n   â†’ Ğ¥Ğ¾Ñ‡ĞµÑ‚ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n6. Ğ—ĞĞ‘Ğ ĞĞĞ˜Ğ ĞĞ’ĞĞ (ÑÑ‚Ğ°Ğ¿ = \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\")\n   â†’ ĞŸĞ¾ Ğ±Ñ€Ğ¾Ğ½Ğ¸ â†’ \"ĞŸĞµÑ€ĞµĞ´Ğ°Ğ¼ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñƒ, ÑĞºĞ¾Ñ€Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚!\"\n   â†’ ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ â†’ Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ğµ\n\nĞ›ĞĞšĞĞ¦Ğ˜Ğ¯:\nĞ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚: Ğ³Ğ´Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ĞµÑÑŒ / Ğ°Ğ´Ñ€ĞµÑ / location / where are you / á»Ÿ Ä‘Ã¢u / Ğ³Ğ´Ğµ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ / pickup point:\nâ†’ Ğ”Ğ°Ğ¹ ÑÑÑ‹Ğ»ĞºÑƒ: https://maps.app.goo.gl/N9x7DPV7LYf2BSUv6?g_st=ac\nâ†’ ÑÑ‚Ğ°Ğ¿ ĞĞ• Ğ¼ĞµĞ½ÑĞ¹ (Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹)\n\nĞ¡Ğ¢ĞĞŸĞ¡Ğ›ĞĞ’Ğ (\"Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ°\"/\"Ğ½Ğµ Ğ½Ğ°Ğ´Ğ¾\"/\"Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ»\"/\"cancel\"):\nâ†’ \"Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾, ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ â€” Ğ¼Ñ‹ Ğ½Ğ° ÑĞ²ÑĞ·Ğ¸!\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\n\nĞĞ• ĞŸĞĞ’Ğ¢ĞĞ Ğ¯Ğ™:\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ» ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ â€” Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ ÑĞ½Ğ¾Ğ²Ğ° Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ ÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» Ğ¾Ñ‚Ğ²ĞµÑ‚ â€” Ğ½Ğµ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¾Ğ¿ÑÑ‚ÑŒ\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ ÑƒĞ¿Ğ¾Ğ¼ÑĞ½ÑƒĞ» Ğ±Ğ¾Ğ½ÑƒÑÑ‹ â€” Ğ½Ğµ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾\n\nâš ï¸ STATE â€” Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ĞšĞĞ–Ğ”ĞĞ“Ğ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:\nSTATE: {\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚\": \"?\", \"Ğ´Ğ½ĞµĞ¹\": \"?\", \"Ğ´Ğ°Ñ‚Ğ°\": \"?\", \"Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸\": \"?\", \"Ğ¾Ğ¿Ñ‹Ñ‚\": \"?\", \"Ğ±Ğ°Ğ¹Ğº\": \"?\", \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\": \"?\", \"ÑÑ‚Ğ°Ğ¿\": \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\"}\nğŸ”´ Ğ—ĞĞĞ§Ğ•ĞĞ˜Ğ¯ STATE Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ ĞĞ Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ! Ğ”Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ½Ğ° English/Vietnamese:\n   Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ = \"Ğ±Ğ°Ğ¹Ğº\" / \"Ğ°Ğ²Ñ‚Ğ¾\" / \"Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´\" / \"?\"\n   Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ = \"Ğ³Ğ¾Ñ€Ğ¾Ğ´\" / \"Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ\" / \"?\"\n   Ğ¾Ğ¿Ñ‹Ñ‚ = \"ĞµÑÑ‚ÑŒ\" / \"Ğ½ĞµÑ‚\" / \"?\"\n   ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\" / \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\" / \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\" / \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\" / \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\" / \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\nĞ—Ğ°Ğ¼ĞµĞ½ÑĞ¹ ? Ğ½Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞ¹ Ğ’Ğ¡Ğ• Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ!\nğŸ”´ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ°Ğ» ĞĞ•Ğ¡ĞšĞĞ›Ğ¬ĞšĞ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ â€” Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ’Ğ¡Ğ• ÑÑ€Ğ°Ğ·Ñƒ!\n   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"motorbike for 7 days, around the city, I have experience\" â†’ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=\"Ğ±Ğ°Ğ¹Ğº\", Ğ´Ğ½ĞµĞ¹=\"7\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸=\"Ğ³Ğ¾Ñ€Ğ¾Ğ´\", Ğ¾Ğ¿Ñ‹Ñ‚=\"ĞµÑÑ‚ÑŒ\", ÑÑ‚Ğ°Ğ¿=\"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"xe mÃ¡y 5 ngÃ y, trong thÃ nh phá»‘\" â†’ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=\"Ğ±Ğ°Ğ¹Ğº\", Ğ´Ğ½ĞµĞ¹=\"5\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸=\"Ğ³Ğ¾Ñ€Ğ¾Ğ´\"\nĞšĞ¾Ğ³Ğ´Ğ° Ğ´Ğ½ĞµĞ¹+Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸+Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\", Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³.\nĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ±Ğ°Ğ¹Ğº Ğ¸ Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ° (Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)!\nĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ³Ğ°Ğ¹ ÑÑ‚Ğ°Ğ¿ Ğ¿Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ğ¼ Ğ²Ñ‹ÑˆĞµ!`;\n\n// Select flow based on phone\nconst flowRules = isTest ? TEST_FLOW : PROD_FLOW;\n\n// Extract ÑÑ‚Ğ°Ğ¿ for Check Stage\n// Use pre-filled ÑÑ‚Ğ°Ğ¿\nconst currentĞ­Ñ‚Ğ°Ğ¿ = prefilledĞ­Ñ‚Ğ°Ğ¿;\n// If state was reset by 12h check above, this won't run (already returned)\n// Collect _langCounts from state (may not exist for new users)\nlet outputLangCounts = '{}';\ntry {\n  if (items.length > 0 && items[0].json.state) {\n    outputLangCounts = items[0].json.state['_langCounts'] || '{}';\n    // Apply current message detection\n    const lc = JSON.parse(outputLangCounts);\n    if (detectedLang) lc[detectedLang] = (lc[detectedLang] || 0) + 1;\n    outputLangCounts = JSON.stringify(lc);\n  } else if (detectedLang) {\n    outputLangCounts = JSON.stringify({[detectedLang]: 1});\n  }\n} catch(e) {}\n\nreturn [{\n  json: {\n    sender: sender,\n    ÑÑ‚Ğ°Ğ¿: currentĞ­Ñ‚Ğ°Ğ¿,\n    clientLang: clientLang,\n    sessionKey: sender + '_v2_s' + sessionNum,\n    _langCounts: outputLangCounts,\n    message: '[Ğ¡Ğ•Ğ“ĞĞ”ĞĞ¯: ' + today + ']' + dateWarning + '\\n[Ğ¯Ğ—Ğ«Ğš ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ: ' + clientLang + ']\\n' + stateContext + flowRules + '---\\nğŸ”´ ĞĞ¢Ğ’Ğ•Ğ§ĞĞ™ Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ ' + clientLang + '! Ğ•ÑĞ»Ğ¸ ' + clientLang + ' â‰  Ğ ÑƒÑÑĞºĞ¸Ğ¹ â€” Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´Ğ¸ Ğ’Ğ¡Ğ: Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹, Ğ±Ğ¾Ğ½ÑƒÑÑ‹, Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹. ĞĞ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ€ÑƒÑÑĞºĞ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ğ²Ğ° Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ!\\n---\\nĞ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°: ' + message\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3060,
        -304
      ],
      "id": "d858893a-adb6-401f-9d26-db806f1c43d1",
      "name": "Inject State"
    },
    {
      "parameters": {
        "jsCode": "// Get AI Agent response\nconst aiOutput = $input.first().json.output || $input.first().json.text || '';\nconst sender = $('Edit Fields4').first().json.sender || '';\n\nlet state = {};\n\n// Method 1: Extract STATE: {...} block from GPT response\nconst stateMatch = aiOutput.match(/STATE:\\s*\\{([^}]+)\\}/);\nif (stateMatch) {\n  try {\n    state = JSON.parse('{' + stateMatch[1] + '}');\n  } catch(e) {}\n}\n\n// Load previous state from Supabase and merge (preserve what GPT didn't fill)\ntry {\n  const prev = $('Get User State').first().json.state || {};\n  // prev = old state, state = what GPT just reported\n  // Merge: GPT values win over prev, but prev fills gaps\n  const defaults = {Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: '?', Ğ´Ğ½ĞµĞ¹: '?', Ğ´Ğ°Ñ‚Ğ°: '?', Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: '?', Ğ¾Ğ¿Ñ‹Ñ‚: '?', Ğ±Ğ°Ğ¹Ğº: '?', Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: '?', ÑÑ‚Ğ°Ğ¿: 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'};\n  state = {...defaults, ...prev, ...state};\n} catch(e) {\n  if (Object.keys(state).length === 0) {\n    state = {Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: '?', Ğ´Ğ½ĞµĞ¹: '?', Ğ´Ğ°Ñ‚Ğ°: '?', Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: '?', Ğ¾Ğ¿Ñ‹Ñ‚: '?', Ğ±Ğ°Ğ¹Ğº: '?', Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: '?', ÑÑ‚Ğ°Ğ¿: 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'};\n  }\n}\n\n// Smart Extract: ALWAYS parse client message to fill MISSING fields\nlet clientMsg = '';\ntry {\n  const raw = $('Ğ¡ÑƒĞ¼Ğ¼Ğ°').first().json.message;\n  clientMsg = (Array.isArray(raw) ? raw.join(' ') : String(raw || '')).toLowerCase();\n} catch(e) {}\n\nif (!clientMsg) {\n  try {\n    const ef = $('Edit Fields4').first().json;\n    clientMsg = (ef.message || ef.text || '').toLowerCase();\n  } catch(e) {}\n}\n\n// Parse transport type (only if still missing)\nif (!state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] || state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] === '?') {\n  if (/(?:^|\\s)(Ğ°Ğ²Ñ‚Ğ¾|Ğ¼Ğ°ÑˆĞ¸Ğ½|car|cars|automobile|Ã´ tÃ´|xe hÆ¡i)/i.test(clientMsg)) state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ°Ğ²Ñ‚Ğ¾';\n  else if (/(?:^|\\s)(Ğ±Ğ°Ğ¹Ğº|Ğ¼Ğ¾Ñ‚Ğ¾|ÑĞºÑƒÑ‚ĞµÑ€|bike|scooter|motorbike|motorcycle|xe mÃ¡y)/i.test(clientMsg)) state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ±Ğ°Ğ¹Ğº';\n  else if (/(?:^|\\s)(Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´|Ğ²ĞµĞ»Ğ¸Ğº|bicycle|xe Ä‘áº¡p)/i.test(clientMsg)) state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´';\n}\n\n// Parse days\nif (!state['Ğ´Ğ½ĞµĞ¹'] || state['Ğ´Ğ½ĞµĞ¹'] === '?') {\n  const dm = clientMsg.match(/(\\d+)\\s*Ğ´Ğ½|for\\s*(\\d+)\\s*day|(\\d+)\\s*ngÃ y/);\n  if (dm) state['Ğ´Ğ½ĞµĞ¹'] = dm[1] || dm[2] || dm[3];\n}\n\n// Parse trips\nif (!state['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] || state['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] === '?') {\n  if (/Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ|in the city|around town|trong thÃ nh|Ğ² Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğµ|around the city|city riding|city driving/.test(clientMsg)) state['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] = 'Ğ³Ğ¾Ñ€Ğ¾Ğ´';\n  else if (/Ğ·Ğ° Ğ³Ğ¾Ñ€Ğ¾Ğ´|Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ|long distance|highway/.test(clientMsg)) state['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] = 'Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ';\n}\n\n// Parse experience\nif (!state['Ğ¾Ğ¿Ñ‹Ñ‚'] || state['Ğ¾Ğ¿Ñ‹Ñ‚'] === '?') {\n  if (/Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ|Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼|have.*license|been driving|cÃ³ báº±ng|Ğ¾Ğ¿Ñ‹Ñ‚ ĞµÑÑ‚ÑŒ|have experience|experienced|i ride|i drive/.test(clientMsg)) state['Ğ¾Ğ¿Ñ‹Ñ‚'] = 'ĞµÑÑ‚ÑŒ';\n  else if (/Ğ½ĞµÑ‚ Ğ¾Ğ¿Ñ‹Ñ‚Ğ°|Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·|no experience|never driven|never rode|first time|chÆ°a bao giá»/.test(clientMsg)) state['Ğ¾Ğ¿Ñ‹Ñ‚'] = 'Ğ½ĞµÑ‚';\n}\n\n// Detect ÑÑ‚Ğ°Ğ¿ from AI response (override if detectable)\nconst aiText = aiOutput.toLowerCase();\nif (aiText.includes('Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾') || aiText.includes('Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¾') || aiText.includes('booked') || aiText.includes('Ä‘Ã£ Ä‘áº·t'))\n  state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½';\nelse if (aiText.includes('vnd/ÑÑƒÑ‚ĞºĞ¸') || aiText.includes('vnd/day') || aiText.includes('vnd/ngÃ y'))\n  state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€';\nelse if ((aiText.includes('Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞº') || aiText.includes('Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚') || aiText.includes('passport') || aiText.includes('driver') || aiText.includes('license') || aiText.includes('báº±ng lÃ¡i') || aiText.includes('há»™ chiáº¿u')) &&\n         (aiText.includes('Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ¸Ñ‚Ğµ') || aiText.includes('Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ') || aiText.includes('Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ') || aiText.includes('Ğ¶Ğ´Ñƒ') || aiText.includes('send') || aiText.includes('upload') || aiText.includes('gá»­i')))\n  state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚';\n\n// Detect bike/car choice from client message (multilingual)\nconst choiceRu = clientMsg.match(/Ğ±ĞµÑ€Ñƒ\\s+(.+?)$/m);\nconst choiceEn = clientMsg.match(/(?:i(?:'ll| will)?\\s*)?(?:take|choose|want)\\s+(?:the\\s+)?(.+?)$/m);\nconst choiceVn = clientMsg.match(/(?:tÃ´i\\s+)?chá»n\\s+(.+?)$/m);\nconst choiceGeneric = clientMsg.match(/(?:Ñ…Ğ¾Ñ‡Ñƒ|Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°Ñ|Ğ´Ğ°Ğ²Ğ°Ğ¹)\\s+(.+?)$/m);\nconst choice = choiceRu ? choiceRu[1] : (choiceEn ? choiceEn[1] : (choiceVn ? choiceVn[1] : (choiceGeneric ? choiceGeneric[1] : null)));\nif (choice) {\n  const model = choice.trim();\n  if (model.length > 2 && model.length < 40) {\n    state['Ğ±Ğ°Ğ¹Ğº'] = model.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');\n    if (state['ÑÑ‚Ğ°Ğ¿'] === 'Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€') state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚';\n  }\n}\n\n// Also detect choice from AI output (GPT says \"Ğ²Ñ‹ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»Ğ¸ X\" / \"you chose X\")\nif (!state['Ğ±Ğ°Ğ¹Ğº'] || state['Ğ±Ğ°Ğ¹Ğº'] === '?') {\n  const aiChoiceRu = aiOutput.match(/Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»Ğ¸\\s+(.+?)[\\!\\.\\,]/);\n  const aiChoiceEn = aiOutput.match(/(?:chose|chosen|selected)\\s+(?:the\\s+)?(.+?)[\\!\\.\\,]/i);\n  const aiChoiceVn = aiOutput.match(/(?:chá»n|Ä‘Ã£ chá»n)\\s+(.+?)[\\!\\.\\,]/);\n  const aiChoice = aiChoiceRu ? aiChoiceRu[1] : (aiChoiceEn ? aiChoiceEn[1] : (aiChoiceVn ? aiChoiceVn[1] : null));\n  if (aiChoice && aiChoice.trim().length > 2 && aiChoice.trim().length < 40) {\n    state['Ğ±Ğ°Ğ¹Ğº'] = aiChoice.trim();\n  }\n}\n\n// Phase 1: Save catalog links when Merge Transport ran (step 1 = catalog shown)\ntry {\n  const merged = $('Merge Transport').first().json;\n  const catalogLinks = {};\n  const allVehicles = [...(merged.bikes || []), ...(merged.cars || []), ...(merged.bicycles || [])];\n  for (const v of allVehicles) {\n    const name = v['Ğ‘Ğ°Ğ¹Ğº'] || v['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ'] || '';\n    const link = v['Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³'] || '';\n    if (name && link.startsWith('https://')) {\n      catalogLinks[name.toLowerCase()] = link;\n    }\n  }\n  if (Object.keys(catalogLinks).length > 0) {\n    state['_catalogLinks'] = JSON.stringify(catalogLinks);\n  }\n} catch(e) {} // Merge Transport not in this execution path â€” that's fine\n\n// Phase 2: Smart link lookup from saved catalog (works on steps 2/3 too)\nif (state['Ğ±Ğ°Ğ¹Ğº'] && state['Ğ±Ğ°Ğ¹Ğº'] !== '?' && (!state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] || state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] === '?')) {\n  try {\n    const catalogLinks = JSON.parse(state['_catalogLinks'] || '{}');\n    const modelName = state['Ğ±Ğ°Ğ¹Ğº'].toLowerCase();\n    // Priority 1: exact match\n    if (catalogLinks[modelName]) {\n      state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] = catalogLinks[modelName];\n    } else {\n      // Priority 2: one contains the other (prefer shorter catName = more specific)\n      let bestMatch = null;\n      let bestLen = Infinity;\n      for (const [catName, link] of Object.entries(catalogLinks)) {\n        if (catName.includes(modelName) || modelName.includes(catName)) {\n          if (catName.length < bestLen) {\n            bestMatch = link;\n            bestLen = catName.length;\n          }\n        }\n      }\n      if (bestMatch) {\n        state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] = bestMatch;\n      } else {\n        // Priority 3: word overlap (at least 2 words match)\n        for (const [catName, link] of Object.entries(catalogLinks)) {\n          const catWords = catName.split(' ').filter(w => w.length > 2);\n          const modelWords = modelName.split(' ').filter(w => w.length > 2);\n          const overlap = modelWords.filter(w => catWords.includes(w));\n          if (overlap.length >= 2 || (overlap.length >= 1 && modelWords.length === 1)) {\n            state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] = link;\n            break;\n          }\n        }\n      }\n    }\n  } catch(e) {}\n}\n\n// ===== TRANSITION GUARD: Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ only from Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ =====\n// Prevents AI from skipping document verification step\nconst prevĞ­Ñ‚Ğ°Ğ¿ = (() => {\n  try { return $('Get User State').first().json.state?.['ÑÑ‚Ğ°Ğ¿'] || 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'; }\n  catch(e) { return 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'; }\n})();\nif (state['ÑÑ‚Ğ°Ğ¿'] === 'Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½' && prevĞ­Ñ‚Ğ°Ğ¿ !== 'Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚') {\n  // Illegal jump â€” force Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ (document required first)\n  state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚';\n}\n// ===== END TRANSITION GUARD =====\n\n// Preserve language + langCounts in state\ntry {\n  const injected = $('Inject State').first().json;\n  if (injected.clientLang) {\n    state['ÑĞ·Ñ‹Ğº'] = injected.clientLang;\n  }\n  if (injected._langCounts) {\n    state['_langCounts'] = injected._langCounts;\n  }\n} catch(e) {}\n\n// Clean response for WhatsApp\nlet cleanOutput = aiOutput.replace(/STATE:\\s*\\{[^}]+\\}\\n?/g, '').trim();\n\nreturn [{\n  json: {\n    output: cleanOutput,\n    sender: sender,\n    state: state,\n    hasState: Object.keys(state).length > 0\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2200,
        256
      ],
      "id": "3555a285-2983-42fb-a95c-ff6edff24a5e",
      "name": "Extract State"
    },
    {
      "parameters": {
        "jsCode": "// Upsert user state to Supabase\nconst sender = $json.sender || '';\nconst state = $json.state || {};\n\nif (!sender) {\n  return [{ json: { success: false, error: 'no sender' } }];\n}\n\nconst key = $env.SUPABASE_SERVICE_ROLE_KEY;\nconst url = 'https://upjyomatlonfgygoniir.supabase.co/rest/v1/user_state';\n\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: url,\n  headers: {\n    'apikey': key,\n    'Authorization': 'Bearer ' + key,\n    'Content-Type': 'application/json',\n    'Prefer': 'resolution=merge-duplicates'\n  },\n  body: {\n    jid: sender,\n    state: state,\n    updated_at: new Date().toISOString()\n  },\n  returnFullResponse: true\n});\n\nreturn [{ json: { success: true, status: response.statusCode || 201, sender } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2400,
        256
      ],
      "id": "e16baf7d-8a56-4ea9-8a58-0a97e02dea96",
      "name": "Save User State",
      "credentials": {}
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "check-booked",
              "leftValue": "={{ $('Inject State').first().json.ÑÑ‚Ğ°Ğ¿ || '' }}",
              "rightValue": "Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "check-cancelled",
              "leftValue": "={{ $('Inject State').first().json.ÑÑ‚Ğ°Ğ¿ || '' }}",
              "rightValue": "Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "check-operator",
              "leftValue": "={{ $('Inject State').first().json.ÑÑ‚Ğ°Ğ¿ || '' }}",
              "rightValue": "Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3200,
        -304
      ],
      "id": "e87cf19d-2206-49f2-80b4-d2cad1a85628",
      "name": "Check Stage"
    },
    {
      "id": "get-bikes-prefetch",
      "name": "Get Ğ‘Ğ°Ğ¹ĞºĞ¸",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        3440,
        -304
      ],
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 379274933,
          "mode": "id"
        },
        "filtersUI": {},
        "combineFilters": "AND",
        "options": {
          "returnAllMatches": true
        },
        "authentication": "serviceAccount"
      },
      "credentials": {
        "googleApi": {
          "id": "OMzR72oEyu6XISKt",
          "name": "Google Sheets account_KARMA_RENT"
        }
      }
    },
    {
      "id": "agg-bikes",
      "name": "Aggregate Ğ‘Ğ°Ğ¹ĞºĞ¸",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3680,
        -304
      ],
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "bikes",
        "include": "allFields",
        "options": {}
      },
      "alwaysOutputData": true
    },
    {
      "id": "filter-free-bikes",
      "name": "Filter Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [
        3560,
        -304
      ],
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "cond-free",
              "leftValue": "={{ $json[\" \"] }}",
              "rightValue": "Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
              "operator": {
                "type": "string",
                "operation": "equals",
                "rightType": "value"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true
      },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// Check if booking is complete + determine sheet + send booking card\nconst state = $input.first().json.state || {};\nconst stage = String(state['ÑÑ‚Ğ°Ğ¿'] || '');\nconst link = String(state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] || '');\nconst transport = String(state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] || '');\nconst sender = $input.first().json.sender || '';\n\nconst isBooked = (stage === 'Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½') && link.startsWith('https://');\n\nif (isBooked) {\n  const SHEET_GIDS = {\n    'Ğ±Ğ°Ğ¹Ğº': 379274933,\n    'Ğ°Ğ²Ñ‚Ğ¾': 1158744889,\n    'Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´': 1795232281\n  };\n  const sheetGid = SHEET_GIDS[transport] || 379274933;\n\n  // === BOOKING CARD ===\n  const phone = '+' + sender.replace('@s.whatsapp.net', '');\n  const model = (state['Ğ±Ğ°Ğ¹Ğº'] && state['Ğ±Ğ°Ğ¹Ğº'] !== '?') ? state['Ğ±Ğ°Ğ¹Ğº'] : '';\n  const days = (state['Ğ´Ğ½ĞµĞ¹'] && state['Ğ´Ğ½ĞµĞ¹'] !== '?') ? state['Ğ´Ğ½ĞµĞ¹'] : '';\n  const date = (state['Ğ´Ğ°Ñ‚Ğ°'] && state['Ğ´Ğ°Ñ‚Ğ°'] !== '?') ? state['Ğ´Ğ°Ñ‚Ğ°'] : '';\n  const tName = transport === 'Ğ±Ğ°Ğ¹Ğº' ? 'Ğ‘Ğ°Ğ¹Ğº' : (transport === 'Ğ°Ğ²Ñ‚Ğ¾' ? 'ĞĞ²Ñ‚Ğ¾' : 'Ğ’ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´');\n\n  // Calculate return date if possible\n  let returnDate = '';\n  if (date && days) {\n    try {\n      let d;\n      const dotMatch = date.match(/(\\d{1,2})\\.(\\d{1,2})\\.(\\d{2,4})/);\n      if (dotMatch) {\n        const y = dotMatch[3].length === 2 ? 2000 + parseInt(dotMatch[3]) : parseInt(dotMatch[3]);\n        d = new Date(y, parseInt(dotMatch[2]) - 1, parseInt(dotMatch[1]));\n      }\n      if (d && !isNaN(d.getTime())) {\n        d.setDate(d.getDate() + parseInt(days));\n        returnDate = d.getDate().toString().padStart(2, '0') + '.' +\n                    (d.getMonth() + 1).toString().padStart(2, '0') + '.' +\n                    (d.getFullYear() % 100).toString().padStart(2, '0');\n      }\n    } catch(e) {}\n  }\n\n  let card = 'Ğ‘Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ\\n';\n  card += '\\n' + phone;\n  card += '\\n\\n' + tName + ' - ' + model;\n  card += '\\n\\nĞ”Ğ½Ğ¸: ' + days;\n  card += '\\n\\nĞ”Ğ°Ñ‚Ğ°: ' + (date ? 'Ñ ' + date : '');\n  card += '\\n\\nĞ¡Ğ´Ğ°Ñ‡Ğ°: ' + returnDate;\n  card += '\\n\\nĞ’Ñ€ĞµĞ¼Ñ: Ğ´Ğ¾';\n  card += '\\n\\nĞ¤Ğ¾Ñ‚Ğ¾ Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°: +';\n  card += '\\n\\nĞ›Ğ¸Ğ¼Ğ¸Ñ‚ ĞºĞ¸Ğ»Ğ¾Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¶Ğ° Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ:- 100 ĞºĞ¼ ÑÑƒÑ‚ĞºĞ¸';\n  card += '\\n\\nĞ”ĞµÑ€Ğ¶Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´Ğ»Ñ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°: ?';\n  card += '\\n\\nĞ¨Ğ»ĞµĞ¼: ?';\n  card += '\\n\\nĞŸÑ€Ğ¾Ğ±ĞµĞ³ ?';\n  card += '\\n\\nĞ‘ĞµĞ½Ğ·Ğ¸Ğ½: ?';\n  card += '\\n\\nĞ”ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚: 100ĞµĞ²Ñ€Ğ¾';\n  card += '\\n\\nĞ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ: ?';\n\n  // Send after 5s delay\n  await new Promise(r => setTimeout(r, 5000));\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://karma-wa.fly.dev/message/sendText/karma',\n      headers: { 'apikey': 'karma-evo-2026-secret', 'Content-Type': 'application/json' },\n      body: { number: sender, text: card }\n    });\n  } catch(e) {}\n\n  return [{ json: { ...$input.first().json, checkin_ready: true, sheetGid: sheetGid } }];\n} else {\n  return [];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2500,
        456
      ],
      "id": "check-booked-checkin",
      "name": "Check Booked Logic"
    },
    {
      "id": "checkin-prep",
      "name": "Checkin Prepare",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2600,
        456
      ],
      "parameters": {
        "jsCode": "// Build checkin data with correct column name per sheet\nconst state = $json.state || {};\nconst transport = String(state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] || 'Ğ±Ğ°Ğ¹Ğº');\nconst link = String(state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] || '');\nconst sheetGid = $json.sheetGid;\n\n// Column A header differs: Ğ‘Ğ°Ğ¹ĞºĞ¸=\" \" (space), ĞĞ²Ñ‚Ğ¾/Ğ’ĞµĞ»Ğ¾=\"Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ\"\nconst statusCol = (transport === 'Ğ±Ğ°Ğ¹Ğº') ? ' ' : 'Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ';\n\nconst result = {\n  'Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³': link,\n  sheetGid: sheetGid\n};\nresult[statusCol] = 'Ğ’ Ğ°Ñ€ĞµĞ½Ğ´Ğµ';\n\n// Add rental start date if available\nconst date = (state['Ğ´Ğ°Ñ‚Ğ°'] && state['Ğ´Ğ°Ñ‚Ğ°'] !== '?') ? state['Ğ´Ğ°Ñ‚Ğ°'] : '';\nif (date) {\n  result['Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°ĞµĞ·Ğ´Ğ°'] = date;\n}\n\nreturn [{ json: result }];"
      }
    },
    {
      "id": "checkin-update",
      "name": "Checkin Update",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        2850,
        456
      ],
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.sheetGid }}",
          "mode": "id"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³"
          ],
          "schema": [
            {
              "id": " ",
              "displayName": " ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Ğ‘Ğ°Ğ¹Ğº",
              "displayName": "Ğ‘Ğ°Ğ¹Ğº",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ĞĞ¾Ğ¼ĞµÑ€ Ğ±Ğ°Ğ¹ĞºĞ°",
              "displayName": "ĞĞ¾Ğ¼ĞµÑ€ Ğ±Ğ°Ğ¹ĞºĞ°",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "ĞšĞ»Ğ°ÑÑ",
              "displayName": "ĞšĞ»Ğ°ÑÑ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³",
              "displayName": "Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸",
              "displayName": "Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ",
              "displayName": "Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°ĞµĞ·Ğ´Ğ°",
              "displayName": "Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°ĞµĞ·Ğ´Ğ°",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ]
        },
        "options": {},
        "authentication": "serviceAccount"
      },
      "credentials": {
        "googleApi": {
          "id": "OMzR72oEyu6XISKt",
          "name": "Google Sheets account_KARMA_RENT"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Evolution API -> ChatFlow format adapter\nconst raw = $input.first().json;\nconst body = raw.body || {};\n\nconst event = body.event || '';\nconst data = body.data || {};\nconst key = data.key || {};\nconst msg = data.message || {};\n\n// Bot messages via API â€” ignore completely\nif (event === 'send.message') return [];\n\n// Manager messages from WhatsApp app â€” mark state as \"Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€\"\nif (key.fromMe === true && event === 'messages.upsert') {\n  const jid = key.remoteJid || '';\n  if (jid) {\n    const supabaseUrl = 'https://upjyomatlonfgygoniir.supabase.co';\n    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVwanlvbWF0bG9uZmd5Z29uaWlyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MTA3MDE1OCwiZXhwIjoyMDg2NjQ2MTU4fQ.oDuT6Bc2mxKHpA1RvZzEa9Wb98qdTghPG4bqgRLvJ3k';\n\n    // First get current state\n    const rows = await this.helpers.httpRequest({\n      method: 'GET',\n      url: supabaseUrl + '/rest/v1/user_state?jid=eq.' + encodeURIComponent(jid) + '&select=state',\n      headers: { 'apikey': supabaseKey, 'Authorization': 'Bearer ' + supabaseKey },\n      json: true\n    });\n    const currentState = (rows.length > 0 && rows[0].state) ? rows[0].state : {};\n    currentState['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€';\n\n    // Upsert state\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: supabaseUrl + '/rest/v1/user_state',\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': 'Bearer ' + supabaseKey,\n        'Content-Type': 'application/json',\n        'Prefer': 'resolution=merge-duplicates'\n      },\n      body: { jid: jid, state: currentState, updated_at: new Date().toISOString() },\n      json: true\n    });\n  }\n  return [];\n}\n\n// Partner messages â€” ignore\nconst pushName = (data.pushName || '').toLowerCase();\nif (pushName.includes('Ğ¿Ğ°Ñ€Ñ‚Ğ½')) return [];\n\n// Non-message events â€” skip\nif (event && event !== 'messages.upsert') return [];\n\nlet messageType = 'text';\nlet message = '';\nlet mediaData = { base64: '', url: '' };\n\nif (msg.conversation) {\n  message = msg.conversation;\n} else if (msg.extendedTextMessage) {\n  message = msg.extendedTextMessage.text || '';\n} else if (msg.imageMessage) {\n  messageType = 'image';\n  message = msg.imageMessage.caption || '';\n  mediaData.url = msg.imageMessage.url || '';\n  mediaData.mediaKey = msg.imageMessage.mediaKey || '';\n  mediaData.directPath = msg.imageMessage.directPath || '';\n  mediaData.mimetype = msg.imageMessage.mimetype || '';\n  mediaData.jpegThumbnail = msg.imageMessage.jpegThumbnail || '';\n  mediaData.messageId = key.id || '';\n  mediaData.remoteJid = key.remoteJid || '';\n} else if (msg.audioMessage) {\n  messageType = 'audio';\n  mediaData.url = msg.audioMessage.url || '';\n} else if (msg.documentMessage) {\n  messageType = 'document';\n  message = msg.documentMessage.fileName || '';\n  mediaData.url = msg.documentMessage.url || '';\n}\n\n// Skip empty messages (protocol events)\nif (!message && messageType === 'text') return [];\n\nreturn [{\n  json: {\n    body: {\n      metadata: {\n        remoteJid: key.remoteJid || '',\n        messageId: key.id || '',\n        timestamp: data.messageTimestamp || Math.floor(Date.now()/1000)\n      },\n      messageType: messageType,\n      message: message,\n      mediaData: mediaData\n    }\n  }\n}];"
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1000,
        -224
      ],
      "id": "evo-adapter-001"
    },
    {
      "id": "get-cars-prefetch",
      "name": "Get ĞĞ²Ñ‚Ğ¾",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        3440,
        -104
      ],
      "parameters": {
        "operation": "read",
        "documentId": {
          "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
          "mode": "id"
        },
        "sheetName": {
          "value": 1158744889,
          "mode": "id"
        },
        "filtersUI": {},
        "combineFilters": "AND",
        "options": {
          "returnAllMatches": true
        },
        "authentication": "serviceAccount"
      },
      "credentials": {
        "googleApi": {
          "id": "OMzR72oEyu6XISKt",
          "name": "Google Sheets account_KARMA_RENT"
        }
      }
    },
    {
      "id": "get-velo-prefetch",
      "name": "Get Ğ’ĞµĞ»Ğ¾",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        3440,
        96
      ],
      "parameters": {
        "operation": "read",
        "documentId": {
          "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
          "mode": "id"
        },
        "sheetName": {
          "value": 1795232281,
          "mode": "id"
        },
        "filtersUI": {},
        "combineFilters": "AND",
        "options": {
          "returnAllMatches": true
        },
        "authentication": "serviceAccount"
      },
      "credentials": {
        "googleApi": {
          "id": "OMzR72oEyu6XISKt",
          "name": "Google Sheets account_KARMA_RENT"
        }
      }
    },
    {
      "id": "filter-free-cars",
      "name": "Filter ĞĞ²Ñ‚Ğ¾",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [
        3560,
        -104
      ],
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "cond-free-car",
              "leftValue": "={{ $json[\"Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ\"] }}",
              "rightValue": "Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
              "operator": {
                "type": "string",
                "operation": "equals",
                "rightType": "value"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true
      },
      "alwaysOutputData": true
    },
    {
      "id": "filter-free-velo",
      "name": "Filter Ğ’ĞµĞ»Ğ¾",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [
        3560,
        96
      ],
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "cond-free-velo",
              "leftValue": "={{ $json[\"Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ\"] }}",
              "rightValue": "Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
              "operator": {
                "type": "string",
                "operation": "equals",
                "rightType": "value"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true
      },
      "alwaysOutputData": true
    },
    {
      "id": "agg-cars",
      "name": "Aggregate ĞĞ²Ñ‚Ğ¾",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3680,
        -104
      ],
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "cars",
        "include": "allFields",
        "options": {}
      },
      "alwaysOutputData": true
    },
    {
      "id": "agg-velo",
      "name": "Aggregate Ğ’ĞµĞ»Ğ¾",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3680,
        96
      ],
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "bicycles",
        "include": "allFields",
        "options": {}
      },
      "alwaysOutputData": true
    },
    {
      "id": "merge-transport",
      "name": "Merge Transport",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3800,
        -104
      ],
      "parameters": {
        "jsCode": "// Combine all transport data from 3 parallel branches\nconst bikesData = $('Aggregate Ğ‘Ğ°Ğ¹ĞºĞ¸').all();\nconst carsData = $('Aggregate ĞĞ²Ñ‚Ğ¾').all();\nconst veloData = $('Aggregate Ğ’ĞµĞ»Ğ¾').all();\n\nconst bikes = (bikesData.length > 0 && bikesData[0].json.bikes) ? bikesData[0].json.bikes : [];\nconst cars = (carsData.length > 0 && carsData[0].json.cars) ? carsData[0].json.cars : [];\nconst bicycles = (veloData.length > 0 && veloData[0].json.bicycles) ? veloData[0].json.bicycles : [];\n\nreturn [{ json: { bikes, cars, bicycles } }];"
      }
    }
  ],
  "connections": {
    "Sort by Message ID": {
      "main": [
        [
          {
            "node": "ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ğ‘ĞµÑ€ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ": {
      "main": [
        [
          {
            "node": "Sort by Message ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹": {
      "main": [
        [
          {
            "node": "Ğ‘ĞµÑ€ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 10 Seconds": {
      "main": [
        []
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Extract State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ": {
      "main": [
        [
          {
            "node": "Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹": {
      "main": [
        [
          {
            "node": "Ğ¡ÑƒĞ¼Ğ¼Ğ°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ğ¡ÑƒĞ¼Ğ¼Ğ°": {
      "main": [
        [
          {
            "node": "Get User State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Extract PDF Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Analyze image1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract PDF Text": {
      "main": [
        [
          {
            "node": "Set Payment Response2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze image1": {
      "main": [
        [
          {
            "node": "Set Payment Response3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Convert to File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File1": {
      "main": [
        [
          {
            "node": "OpenAI1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI1": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields7": {
      "main": [
        [
          {
            "node": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Payment Response3": {
      "main": [
        [
          {
            "node": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Payment Response2": {
      "main": [
        [
          {
            "node": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Phone Filter": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get User State": {
      "main": [
        [
          {
            "node": "Inject State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Inject State": {
      "main": [
        [
          {
            "node": "Check Stage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract State": {
      "main": [
        [
          {
            "node": "Save User State",
            "type": "main",
            "index": 0
          },
          {
            "node": "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ² WhatsApp",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check Booked Logic",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Stage": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Ğ‘Ğ°Ğ¹ĞºĞ¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Ğ‘Ğ°Ğ¹ĞºĞ¸": {
      "main": [
        [
          {
            "node": "Get ĞĞ²Ñ‚Ğ¾",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½": {
      "main": [
        [
          {
            "node": "Aggregate Ğ‘Ğ°Ğ¹ĞºĞ¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ğ‘Ğ°Ğ¹ĞºĞ¸": {
      "main": [
        [
          {
            "node": "Filter Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Checkin Prepare": {
      "main": [
        [
          {
            "node": "Checkin Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Booked Logic": {
      "main": [
        [
          {
            "node": "Checkin Prepare",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WebhookRaw": {
      "main": [
        [
          {
            "node": "Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Phone Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get ĞĞ²Ñ‚Ğ¾": {
      "main": [
        [
          {
            "node": "Filter ĞĞ²Ñ‚Ğ¾",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter ĞĞ²Ñ‚Ğ¾": {
      "main": [
        [
          {
            "node": "Aggregate ĞĞ²Ñ‚Ğ¾",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Ğ’ĞµĞ»Ğ¾": {
      "main": [
        [
          {
            "node": "Filter Ğ’ĞµĞ»Ğ¾",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Ğ’ĞµĞ»Ğ¾": {
      "main": [
        [
          {
            "node": "Aggregate Ğ’ĞµĞ»Ğ¾",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate ĞĞ²Ñ‚Ğ¾": {
      "main": [
        [
          {
            "node": "Get Ğ’ĞµĞ»Ğ¾",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Ğ’ĞµĞ»Ğ¾": {
      "main": [
        [
          {
            "node": "Merge Transport",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Transport": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveExecutionProgress": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": null,
  "versionId": "cb9356af-d7d9-496b-84ea-558faa8f4946",
  "activeVersionId": "cb9356af-d7d9-496b-84ea-558faa8f4946",
  "versionCounter": 667,
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2026-02-20T13:11:32.883Z",
      "createdAt": "2026-02-20T13:11:32.883Z",
      "role": "workflow:owner",
      "workflowId": "rC30SNQvTZG9Zhza",
      "projectId": "PbCq18r4FC91E0Bg",
      "project": {
        "updatedAt": "2026-02-20T11:16:55.833Z",
        "createdAt": "2026-02-20T11:03:31.750Z",
        "id": "PbCq18r4FC91E0Bg",
        "name": "Denis Karmarent <denis@karmarent.app>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "32ebda6a-f598-4a39-9108-5156d43057e3",
        "projectRelations": [
          {
            "updatedAt": "2026-02-20T11:03:31.824Z",
            "createdAt": "2026-02-20T11:03:31.824Z",
            "userId": "32ebda6a-f598-4a39-9108-5156d43057e3",
            "projectId": "PbCq18r4FC91E0Bg",
            "user": {
              "updatedAt": "2026-02-28T17:55:23.000Z",
              "createdAt": "2026-02-20T11:03:19.748Z",
              "id": "32ebda6a-f598-4a39-9108-5156d43057e3",
              "email": "denis@karmarent.app",
              "firstName": "Denis",
              "lastName": "Karmarent",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2026-02-20T11:19:33.722Z",
                "personalization_survey_n8n_version": "2.7.5"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "rC30SNQvTZG9Zhza",
                "userActivatedAt": 1771598040644
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2026-02-28",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2026-03-01T14:29:42.097Z",
    "createdAt": "2026-03-01T14:29:42.097Z",
    "versionId": "cb9356af-d7d9-496b-84ea-558faa8f4946",
    "workflowId": "rC30SNQvTZG9Zhza",
    "nodes": [
      {
        "parameters": {
          "tableId": "Message_Buffer",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "user_id",
                "fieldValue": "={{ $json.sender }}"
              },
              {
                "fieldId": "message",
                "fieldValue": "={{ $json.message }}"
              },
              {
                "fieldId": "message_id",
                "fieldValue": "={{ $('Webhook').item.json.body.metadata.messageId }}"
              },
              {
                "fieldId": "timestamp",
                "fieldValue": "={{ $('Webhook').item.json.body.metadata.timestamp }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1168,
          -304
        ],
        "id": "e56ae42c-9d2b-49f8-9e59-2353f6f874a6",
        "name": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
        "credentials": {
          "supabaseApi": {
            "id": "u1mkv2sS5oh337qr",
            "name": "Supabase Karma_Worker"
          }
        }
      },
      {
        "parameters": {
          "content": "Ğ¡Ğ±Ğ¾Ñ€ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°\n\n*Â Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ. Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğ¸ 10 ÑĞµĞº, Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑ‚. Ğ½Ğ° Ğ²ÑĞµ, Ğ° Ğ½Ğµ Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ",
          "height": 500,
          "width": 1896,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1120,
          -400
        ],
        "typeVersion": 1,
        "id": "50e9a8b6-46c8-4d74-babe-d3fe334e6ef6",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "sortFieldsUi": {
            "sortField": [
              {
                "fieldName": "timestamp",
                "order": "=ascending"
              }
            ]
          },
          "options": {}
        },
        "id": "3d1be0b3-5910-43eb-93df-57777209f978",
        "name": "Sort by Message ID",
        "type": "n8n-nodes-base.sort",
        "position": [
          1904,
          -176
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "Message_Buffer",
          "filters": {
            "conditions": [
              {
                "keyName": "user_id",
                "condition": "eq",
                "keyValue": "={{ $('Webhook').item.json.body.metadata.remoteJid }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1648,
          -304
        ],
        "id": "5639a0b2-3528-445d-a6b2-04bdcc0196f6",
        "name": "Ğ‘ĞµÑ€ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ",
        "credentials": {
          "supabaseApi": {
            "id": "u1mkv2sS5oh337qr",
            "name": "Supabase Karma_Worker"
          }
        }
      },
      {
        "parameters": {
          "amount": 3
        },
        "id": "b7b93f28-25b0-4a6c-88dd-65462f02d4a3",
        "name": "Wait 10 Seconds",
        "type": "n8n-nodes-base.wait",
        "position": [
          1408,
          -144
        ],
        "webhookId": "87994c9a-fd20-48b6-8dbe-9af36dc40b2f",
        "typeVersion": 1.1
      },
      {
        "parameters": {},
        "id": "7ca8e5ed-45ee-4e10-9fc9-621725de64c3",
        "name": "No Operation, do nothing",
        "type": "n8n-nodes-base.noOp",
        "position": [
          2480,
          -112
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "Ğ¡Ğ±Ğ¾Ñ€ Ğ²ÑĞµÑ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹\n* Ğ¡Ğ²Ğ²ĞµÑ€ĞºĞ° Ñ CRM\n* Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° ",
          "height": 632,
          "width": 1016,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1472,
          160
        ],
        "typeVersion": 1,
        "id": "9bd44ad0-6c47-40fe-b3ec-e6c8e6caa529",
        "name": "Sticky Note3"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $('Inject State').first().json.message + '\\n\\nĞ”ĞĞĞĞ«Ğ• Ğ¢Ğ ĞĞĞ¡ĞŸĞĞ Ğ¢Ğ (Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ):\\n\\nĞ‘ĞĞ™ĞšĞ˜:\\n' + (($json.bikes && $json.bikes.length > 0 && $json.bikes[0]['Ğ‘Ğ°Ğ¹Ğº']) ? $json.bikes.map((b, i) => (i+1) + '. ' + b['Ğ‘Ğ°Ğ¹Ğº'] + ' â€” ' + b['ĞšĞ»Ğ°ÑÑ'] + ', ' + b['Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸'] + ' VND/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°: ' + b['Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³']).join('\\n') + '\\nĞ˜Ğ¢ĞĞ“Ğ Ğ‘ĞĞ™ĞšĞĞ’: ' + $json.bikes.length : 'Ğ’ÑĞµ Ğ±Ğ°Ğ¹ĞºĞ¸ Ğ·Ğ°Ğ½ÑÑ‚Ñ‹. ĞĞ° Ğ´Ğ½ÑÑ… Ğ±ÑƒĞ´ÑƒÑ‚!') + '\\n\\nĞĞ’Ğ¢Ğ:\\n' + (($json.cars && $json.cars.length > 0 && $json.cars[0]['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ']) ? $json.cars.map((c, i) => (i+1) + '. ' + c['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ'] + ' â€” ' + c['ĞšĞ»Ğ°ÑÑ'] + ', ' + c['Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸'] + ' VND/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°: ' + c['Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³']).join('\\n') + '\\nĞ˜Ğ¢ĞĞ“Ğ ĞĞ’Ğ¢Ğ: ' + $json.cars.length : 'Ğ’ÑĞµ Ğ°Ğ²Ñ‚Ğ¾ Ğ·Ğ°Ğ½ÑÑ‚Ñ‹.') + '\\n\\nĞ’Ğ•Ğ›ĞĞ¡Ğ˜ĞŸĞ•Ğ”Ğ«:\\n' + (($json.bicycles && $json.bicycles.length > 0 && $json.bicycles[0]['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ']) ? $json.bicycles.map((v, i) => (i+1) + '. ' + v['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ'] + ' â€” ' + v['ĞšĞ»Ğ°ÑÑ'] + ', ' + v['Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸'] + ' VND/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°: ' + v['Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³']).join('\\n') + '\\nĞ˜Ğ¢ĞĞ“Ğ Ğ’Ğ•Ğ›Ğ: ' + $json.bicycles.length : 'Ğ’ÑĞµ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´Ñ‹ Ğ·Ğ°Ğ½ÑÑ‚Ñ‹.') + '\\n\\nğŸ”´ ĞŸĞĞšĞĞ–Ğ˜ Ğ’Ğ¡Ğ• ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ° Ğ²Ñ‹ÑˆĞµ! Ğ•ÑĞ»Ğ¸ Ğ˜Ğ¢ĞĞ“Ğ=9, Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ 9. ĞĞµ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞºĞ°Ğ¹!\\nğŸ”´ Ğ¯Ğ—Ğ«Ğš: Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ½Ğ° ÑĞ·Ñ‹ĞºĞµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°! English â†’ English.\\nğŸ”´ ĞĞ• Ğ¿ĞµÑ€ĞµÑ‡Ğ¸ÑĞ»ÑĞ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼.\\nğŸ”´ Ğ’Ğ«Ğ‘ĞĞ : ĞµÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ \"Ğ±ĞµÑ€Ñƒ X\" â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ \"Ğ±Ğ°Ğ¹Ğº\"=Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ² STATE! ĞĞµ Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞ¹ \"?\".\\nğŸ”´ ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ•: ĞµÑĞ»Ğ¸ [ÑÑ‚Ğ°Ğ¿: Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ] Ğ˜ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ĞĞ• ÑƒĞºĞ°Ğ·Ğ°Ğ» Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â†’ ÑĞ¿Ñ€Ğ¾ÑĞ¸ \"Ğ±Ğ°Ğ¹Ğº, Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´?\" Ğ‘Ğ•Ğ— ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°. Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ£Ğ–Ğ• ÑĞºĞ°Ğ·Ğ°Ğ» Ñ‡Ñ‚Ğ¾ Ñ…Ğ¾Ñ‡ĞµÑ‚ (Ğ°Ğ²Ñ‚Ğ¾/Ğ±Ğ°Ğ¹Ğº/Ğ²ĞµĞ»Ğ¾) â†’ ĞĞ• Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹, Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸ Ğº ÑƒÑ‚Ğ¾Ñ‡Ğ½ĞµĞ½Ğ¸Ñ.\\n\\nğŸ”´ Ğ”ĞĞ¢Ğ Ğ—ĞĞ•Ğ—Ğ”Ğ: ÑĞ¿Ñ€Ğ¾ÑĞ¸ \"Ñ ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°?\" â€” Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ² \"Ğ´Ğ°Ñ‚Ğ°\" Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ”Ğ”.ĞœĞœ.Ğ“Ğ“. Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ \"Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°/Ğ¿Ğ¾ÑĞ»ĞµĞ·Ğ°Ğ²Ñ‚Ñ€Ğ°/Ñ‡ĞµÑ€ĞµĞ· N Ğ´Ğ½ĞµĞ¹\" â€” Ğ¿ĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ğ°Ğ¹ Ğ² Ğ´Ğ°Ñ‚Ñƒ.\\n\\nğŸğŸğŸ Ğ‘ĞĞĞ£Ğ¡Ğ« â€” ĞŸĞĞ¡Ğ›Ğ• ĞšĞĞ¢ĞĞ›ĞĞ“Ğ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ”ĞĞ‘ĞĞ’Ğ¬:\\n\"ğŸ Ğ‘Ğ¾Ğ½ÑƒÑ: Ğ¾Ñ‚ 3 Ğ´Ğ½ĞµĞ¹ â€” ĞºĞ°Ñ€Ñ‚Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°! ĞÑ‚ 7 Ğ´Ğ½ĞµĞ¹ â€” Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° ğŸšš\"\\nĞ‘ĞµĞ· ÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚ ĞĞ•ĞŸĞĞ›ĞĞ«Ğ™!\\nğŸ”´ ĞĞ’Ğ¢Ğ: Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğµ Ğ°Ğ²Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ„Ğ¾Ñ‚Ğ¾ Ğ’Ğ£ (Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ğµ)! ĞĞ• Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚!\\n\\nâš ï¸âš ï¸âš ï¸ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ĞšĞĞ–Ğ”ĞĞ“Ğ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ STATE Ğ±Ğ»Ğ¾Ğº:\\nSTATE: {\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚\": \"?\", \"Ğ´Ğ½ĞµĞ¹\": \"?\", \"Ğ´Ğ°Ñ‚Ğ°\": \"?\", \"Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸\": \"?\", \"Ğ¾Ğ¿Ñ‹Ñ‚\": \"?\", \"Ğ±Ğ°Ğ¹Ğº\": \"?\", \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\": \"?\", \"ÑÑ‚Ğ°Ğ¿\": \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\"}\\nĞ—Ğ°Ğ¼ĞµĞ½Ğ¸ ? Ğ½Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°. Ğ‘Ğ•Ğ— Ğ­Ğ¢ĞĞ“Ğ Ğ‘Ğ›ĞĞšĞ ĞĞ¢Ğ’Ğ•Ğ¢ ĞĞ¢ĞšĞ›ĞĞĞĞ.' }}",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "Ğ¢Ñ‹ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ¿Ğ¾ Ğ°Ñ€ĞµĞ½Ğ´Ğµ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ° KarmaRent Ğ² ĞÑÑ‡Ğ°Ğ½Ğ³Ğµ.\nĞÑˆĞ¸Ğ±ÑÑ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¾Ğ¼ â†’ \"ĞœÑ‹ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² ĞÑÑ‡Ğ°Ğ½Ğ³Ğµ.\" Ğ˜Ğ½Ğ°Ñ‡Ğµ â€” Ğ½Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹.\n\nĞ¡Ğ¢Ğ˜Ğ›Ğ¬: Ğ¶Ğ¸Ğ²Ğ¾ Ğ¸ Ğ´Ñ€ÑƒĞ¶ĞµĞ»ÑĞ±Ğ½Ğ¾, ĞºĞ°Ğº Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ² Ñ‡Ğ°Ñ‚Ğµ. Ğ¨ÑƒÑ‚ĞºĞ¸, ÑĞ¼Ğ°Ğ¹Ğ»Ğ¸ĞºĞ¸, ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸. ĞĞµ Ğ±ÑƒĞ´ÑŒ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¾Ğ¼.\n\nĞ¯Ğ—Ğ«Ğš: {{ $('Inject State').first().json.clientLang }}. ĞĞ¢Ğ’Ğ•Ğ§ĞĞ™ Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ Ğ­Ğ¢ĞĞœ Ğ¯Ğ—Ğ«ĞšĞ•! Ğ•ÑĞ»Ğ¸ ÑĞ·Ñ‹Ğº â‰  Ğ ÑƒÑÑĞºĞ¸Ğ¹ â€” Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´Ğ¸ Ğ’Ğ¡Ğ: Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ, Ğ±Ğ¾Ğ½ÑƒÑÑ‹, Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹. ĞĞ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ€ÑƒÑÑĞºĞ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ğ²Ğ°!\n\n\nĞ ĞĞ¡ĞŸĞĞ—ĞĞĞ’ĞĞĞ˜Ğ• ĞĞŸĞ«Ğ¢Ğ:\nĞĞ¿Ñ‹Ñ‚ Ğ•Ğ¡Ğ¢Ğ¬: \"Ğ´Ğ°/ÑƒĞ³Ñƒ/Ğ°Ğ³Ğ°/ĞµÑÑ‚ÑŒ/ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾/yes/years/cÃ³/Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ/Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼/báº±ng lÃ¡i/driving for/have a license/have license\"\nĞĞ¿Ñ‹Ñ‚ ĞĞ•Ğ¢: \"Ğ½ĞµÑ‚/Ğ½ĞµÑ‚Ñƒ/Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·/no/khÃ´ng/never\"\nĞĞµ Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹. \"Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼ Ğ´Ğ°Ğ²Ğ½Ğ¾\" = ĞµÑÑ‚ÑŒ. \"Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ\" = ĞµÑÑ‚ÑŒ. \"been driving\" = ĞµÑÑ‚ÑŒ.\n\nĞ ĞĞ¡ĞŸĞĞ—ĞĞĞ’ĞĞĞ˜Ğ• ĞŸĞĞ•Ğ—Ğ”ĞĞš:\nĞ³Ğ¾Ñ€Ğ¾Ğ´: \"Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ/in the city/city driving/trong thÃ nh phá»‘/around town/Ğ² Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğµ\"\nĞ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ: \"Ğ·Ğ° Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ/long distance/highway/ngoáº¡i thÃ nh/long trips\"\nĞĞµ Ğ¿ÑƒÑ‚Ğ°Ğ¹ Ñ ĞĞĞ—Ğ’ĞĞĞ˜Ğ•Ğœ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°. \"Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\" = Ñ‚Ğ¸Ğ¿ Ğ¿Ğ¾ĞµĞ·Ğ´Ğ¾Ğº, ĞĞ• Ğ¸Ğ¼Ñ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ°.\n\nĞ¢Ğ ĞĞĞ¡ĞŸĞĞ Ğ¢:\n- Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğµ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞŸÑ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€ĞµÑ‰ĞµĞ½Ğ¾.\n- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, ĞºĞ»Ğ°ÑÑ, Ñ†ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³.\n- ğŸ”´ ĞŸĞĞšĞĞ–Ğ˜ Ğ’Ğ¡Ğ• ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…! Ğ¡Ğ¼Ğ¾Ñ‚Ñ€Ğ¸ Ğ˜Ğ¢ĞĞ“Ğ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… â€” ĞµÑĞ»Ğ¸ Ğ˜Ğ¢ĞĞ“Ğ=9, Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ 9. ĞĞµ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº!\n- ĞĞµÑ‚ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° â†’ \"Ğš ÑĞ¾Ğ¶Ğ°Ğ»ĞµĞ½Ğ¸Ñ, ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ²ÑĞµ [Ñ‚Ğ¸Ğ¿] Ğ·Ğ°Ğ½ÑÑ‚Ñ‹. ĞšĞ°Ğº Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ â€” ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ!\"\n- Ğ•ÑÑ‚ÑŒ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ñ‚Ğ¸Ğ¿ â†’ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ğ¸ ĞºĞ°Ğº Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ñƒ.\n\nĞ¦Ğ•ĞĞ«: âš ï¸ Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞĞ˜ĞšĞĞ“Ğ”Ğ Ğ½Ğµ Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ğ¹!\nĞ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ: Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ (ÑÑ‚Ñ€Ğ°Ñ…Ğ¾Ğ²ĞºĞ°, Ğ·Ğ°Ğ»Ğ¾Ğ³, Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ¾). ĞĞµ Ğ·Ğ½Ğ°ĞµÑˆÑŒ â†’ \"Ğ£Ñ‚Ğ¾Ñ‡Ğ½Ñ Ñƒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°.\"\n\nĞ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ = Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¸Ğ½Ñ„Ğ¾. ĞĞ• Ğ¿ĞµÑ€ĞµÑ‡Ğ¸ÑĞ»ÑĞ¹ Ğ¸Ñ… ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼ (\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: Ğ°Ğ²Ñ‚Ğ¾, Ğ´Ğ½ĞµĞ¹: 5...\"). ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹.\n\nĞ“Ğ›ĞĞ’ĞĞĞ•: Ğ½Ğµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹ ÑĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ. ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚, Ñ‚Ñ‹ Ğ²Ğ¸Ğ´Ğ¸ÑˆÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ.\n\nĞ–ĞĞ¡Ğ¢ĞšĞ˜Ğ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ:\n- ğŸ”´ Ğ¡Ğ¢ĞĞŸ-ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¿ĞµÑ€ĞµĞ´ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ¼: Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â‰  \"?\", Ğ´Ğ½ĞµĞ¹ â‰  \"?\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ â‰  \"?\", Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\". Ğ•ÑĞ»Ğ¸ Ğ›Ğ®Ğ‘ĞĞ• = \"?\" â†’ Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³. Ğ¡Ğ¿Ñ€Ğ¾ÑĞ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰ĞµĞµ.\n- \"Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ\" / \"Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼\" / \"been driving\" / \"cÃ³ báº±ng lÃ¡i\" = Ğ¾Ğ¿Ñ‹Ñ‚ Ğ•Ğ¡Ğ¢Ğ¬. Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸ ÑÑ€Ğ°Ğ·Ñƒ, Ğ½Ğµ ÑÑ‚Ğ°Ğ²ÑŒ \"?\".\n- ĞšĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ°Ğ» Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² ÑÑ€Ğ°Ğ·Ñƒ â†’ Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ²ÑÑ‘, ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰ĞµĞµ.\n- ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹ = 2 Ğ´Ğ½Ñ. 1 Ğ´ĞµĞ½ÑŒ â†’ \"ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 2 Ğ´Ğ½Ñ, Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚?\"\n\nĞ­Ğ¢ĞĞŸĞ« (Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ¿Ğ¾ [ÑÑ‚Ğ°Ğ¿:] Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°):\n\n1. ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\")\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» Ğ¢ĞĞ›Ğ¬ĞšĞ \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚/hi/hello\" â€” Ğ¿Ğ¾Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞ¹ Ğ¸ Ğ·Ğ°Ğ´Ğ°Ğ¹ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼:\n     ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! ğŸ˜Š Ğ”Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾Ğ´Ğ±ĞµÑ€Ñ‘Ğ¼ Ğ²Ğ°Ğ¼ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚. ĞÑ‚Ğ²ĞµÑ‚ÑŒÑ‚Ğµ Ğ½Ğ° Ğ¿Ğ°Ñ€Ñƒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²:\n     â€“ Ğ§Ñ‚Ğ¾ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒĞµÑ‚ â€” Ğ±Ğ°Ğ¹Ğº, Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´?\n     â€“ ĞĞ° ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚Ğµ Ğ°Ñ€ĞµĞ½Ğ´Ñƒ?\n     â€“ ĞŸĞ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ Ğ¸Ğ»Ğ¸ Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸?\"\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¡Ğ ĞĞ—Ğ£ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ» Ñ‚Ğ¸Ğ¿ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ° (\"Ñ…Ğ¾Ñ‡Ñƒ Ğ±Ğ°Ğ¹Ğº\", \"Ğ°Ğ²Ñ‚Ğ¾\") â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ¸ Ğ¿ĞµÑ€ĞµĞ¹Ğ´Ğ¸ Ğº ÑÑ‚Ğ°Ğ¿Ñƒ \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\". ĞĞ• Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹!\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ°Ğ» Ğ’Ğ¡Ğ® Ğ¸Ğ½Ñ„Ñƒ ÑÑ€Ğ°Ğ·Ñƒ (Ñ‚Ğ¸Ğ¿ + Ğ´Ğ½Ğ¸ + Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ + Ğ¾Ğ¿Ñ‹Ñ‚) â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ’Ğ¡Ğ, Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸ \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\", ÑÑ€Ğ°Ğ·Ñƒ Ğº \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"!\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ½ĞµÑ‚ â†’ \"Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ [Ñ‚Ğ¸Ğ¿] Ğ·Ğ°Ğ½ÑÑ‚Ñ‹, Ğ½Ğ° Ğ´Ğ½ÑÑ… Ğ±ÑƒĞ´ÑƒÑ‚! ĞœĞ¾Ğ¶ĞµÑ‚, Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑƒĞµÑ‚ [Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ñ‚Ğ¸Ğ¿]?\"\n\n2. Ğ£Ğ¢ĞĞ§ĞĞ•ĞĞ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\")\n   â†’ Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ: Ğ´Ğ½ĞµĞ¹, Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ (Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ), Ğ¾Ğ¿Ñ‹Ñ‚\n   â†’ Ğ¡Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ (Ğ³Ğ´Ğµ \"?\"), Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ 2-3 Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼\n   â†’ ĞšĞ¾Ğ³Ğ´Ğ° Ğ’Ğ¡Ğ• â‰  \"?\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   â†’ ğŸ”´ ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬: Ğ´Ğ½ĞµĞ¹ â‰  \"?\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ â‰  \"?\", Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\". Ğ•ÑĞ»Ğ¸ Ñ…Ğ¾Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ \"?\" â€” ÑĞ¿Ñ€Ğ¾ÑĞ¸, ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³!\n\n3. ĞŸĞĞ”Ğ‘ĞĞ  (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\")\n   â†’ ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ’Ğ¡Ğ• ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğµ (ĞºĞ°Ğ¶Ğ´ÑƒÑ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñƒ!): Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, ĞºĞ»Ğ°ÑÑ, Ñ†ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°\n   â†’ ğŸ Ğ‘ĞĞĞ£Ğ¡Ğ« â€” Ğ¡Ğ ĞĞ—Ğ£ Ğ¿Ğ¾ÑĞ»Ğµ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ° Ğ”ĞĞ‘ĞĞ’Ğ¬ ÑÑ‚Ñƒ ÑÑ‚Ñ€Ğ¾ĞºÑƒ:\n     \"ğŸ Ğ‘Ğ¾Ğ½ÑƒÑ: Ğ¾Ñ‚ 3 Ğ´Ğ½ĞµĞ¹ â€” ĞºĞ°Ñ€Ñ‚Ğ° Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°! ĞÑ‚ 7 Ğ´Ğ½ĞµĞ¹ â€” Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° ğŸšš\"\n     Ğ­Ñ‚Ğ¾ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ. Ğ‘ĞµĞ· Ğ±Ğ¾Ğ½ÑƒÑĞ¾Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ½ĞµĞ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹.\n   â†’ ĞĞµÑ‚ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ… â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ½ĞµÑ‚_Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°\"\n\n4. Ğ’Ğ«Ğ‘ĞĞ  (ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» â€” \"Ğ±ĞµÑ€Ñƒ X\")\n   â†’ ğŸ”´ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ² STATE: \"Ğ±Ğ°Ğ¹Ğº\" = Ğ¢ĞĞ§ĞĞĞ• Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸Ğ· ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ° (Ğ½Ğ°Ğ¿Ñ€. \"Honda City\"), \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\" = ÑÑÑ‹Ğ»ĞºĞ° ÑÑ‚Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…\n   â†’ ĞĞ²Ñ‚Ğ¾ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ñ„Ğ¾Ñ‚Ğ¾ Ğ’Ğ£ (Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ğµ). ĞĞ• ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹ Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚!\n   â†’ Ğ‘Ğ°Ğ¹Ğº/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° (Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ˜Ğ›Ğ˜ Ğ’Ğ£ â€” Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚)\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\"\n\n5. ĞŸĞĞ¡ĞŸĞĞ Ğ¢ (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\")\n   â†’ [Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢] â†’ \"âœ… Ğ—Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾! Ğ¡ĞºĞ¾Ñ€Ğ¾ ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\"\n   â†’ [Ğ¤ĞĞ¢Ğ] Ğ±ĞµĞ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° â†’ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸\n   â†’ Ğ¥Ğ¾Ñ‡ĞµÑ‚ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n6. Ğ—ĞĞ‘Ğ ĞĞĞ˜Ğ ĞĞ’ĞĞ â†’ Ğ¿Ğ¾ Ğ±Ñ€Ğ¾Ğ½Ğ¸ â†’ \"ĞŸĞµÑ€ĞµĞ´Ğ°Ğ¼ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñƒ!\" ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ â†’ Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ğµ.\n\nĞ¡Ğ¢ĞĞŸĞ¡Ğ›ĞĞ’Ğ (\"Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ°\"/\"Ğ½Ğµ Ğ½Ğ°Ğ´Ğ¾\"/\"Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ»\"/\"cancel\"):\nâ†’ \"Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾, ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ â€” Ğ¼Ñ‹ Ğ½Ğ° ÑĞ²ÑĞ·Ğ¸!\"\nâ†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\nâ†’ ğŸ”´ Ğ¡ĞĞ¥Ğ ĞĞĞ¯Ğ™ Ğ²ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ STATE! ĞĞ±Ğ½ÑƒĞ»ÑĞµÑ‚ÑÑ Ğ¢ĞĞ›Ğ¬ĞšĞ ÑÑ‚Ğ°Ğ¿.\n\nĞĞ• ĞŸĞĞ’Ğ¢ĞĞ Ğ¯Ğ™: ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³, Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹, Ğ±Ğ¾Ğ½ÑƒÑÑ‹ â€” ĞµÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ±Ñ‹Ğ»Ğ¾.\n\nâš ï¸ STATE â€” Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ĞšĞĞ–Ğ”ĞĞ“Ğ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:\nSTATE: {\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚\": \"?\", \"Ğ´Ğ½ĞµĞ¹\": \"?\", \"Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸\": \"?\", \"Ğ¾Ğ¿Ñ‹Ñ‚\": \"?\", \"Ğ±Ğ°Ğ¹Ğº\": \"?\", \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\": \"?\", \"ÑÑ‚Ğ°Ğ¿\": \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\"}\nĞ—Ğ°Ğ¼ĞµĞ½ÑĞ¹ ? Ğ½Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞ¹ Ğ’Ğ¡Ğ• Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ! ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ³Ğ°Ğ¹ ÑÑ‚Ğ°Ğ¿!\nÑ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ = Ğ±Ğ°Ğ¹Ğº/Ğ°Ğ²Ñ‚Ğ¾/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´/?\nĞ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ = Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ/?\nĞ±Ğ°Ğ¹Ğº = Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğµ"
          },
          "systemMessage": ""
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          3920,
          -304
        ],
        "id": "977a8dc3-1b96-4b0c-815a-1f366b02b98e",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "content": "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ±Ğ°Ğ¹ĞºĞ° Ğ² Ğ¼ĞµÑÑĞµĞ½Ğ´Ğ¶ĞµÑ€ \n",
          "height": 260,
          "width": 300,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2704,
          176
        ],
        "typeVersion": 1,
        "id": "54940db2-5311-4f24-92a0-691e75149987",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://karma-wa.fly.dev/message/sendText/karma",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "karma-evo-2026-secret"
              }
            ]
          },
          "sendBody": true,
          "contentType": "json",
          "bodyParameters": {
            "parameters": [
              {
                "name": "number",
                "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
              },
              {
                "name": "text",
                "value": "={{ $(\"Extract State\").item.json.output }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2800,
          256
        ],
        "id": "347d496d-8d67-4450-a2a5-f349db069537",
        "name": "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ² WhatsApp"
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Inject State').first().json.sessionKey }}",
          "contextWindowLength": 15
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          1712,
          528
        ],
        "id": "ad542f4d-c01e-4742-8de8-ef468624932b",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 2
            },
            "conditions": [
              {
                "id": "8852bab7-230e-442a-a4a2-994e979c8f9f",
                "operator": {
                  "type": "number",
                  "operation": "equals"
                },
                "leftValue": "={{ $input.last().json.timestamp }}\n\n",
                "rightValue": "={{ $('Webhook').item.json.body.metadata.timestamp.toString() }}\n"
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "id": "e1a8c728-16b4-4f51-acd9-ff3e625df1c4",
        "name": "ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ",
        "type": "n8n-nodes-base.if",
        "position": [
          2160,
          -288
        ],
        "typeVersion": 2.2
      },
      {
        "parameters": {
          "operation": "delete",
          "tableId": "Message_Buffer",
          "filters": {
            "conditions": [
              {
                "keyName": "user_id",
                "condition": "eq",
                "keyValue": "={{ $json.user_id }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          2464,
          -304
        ],
        "id": "651cc2dc-33e6-438e-ad5f-fdccaffe0934",
        "name": "Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
        "credentials": {
          "supabaseApi": {
            "id": "u1mkv2sS5oh337qr",
            "name": "Supabase Karma_Worker"
          }
        }
      },
      {
        "parameters": {
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "message"
              }
            ]
          },
          "options": {}
        },
        "id": "fd34ebe1-d9b6-4656-83ab-997a053e7ced",
        "name": "Ğ¡ÑƒĞ¼Ğ¼Ğ°",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          2752,
          -304
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          1536,
          528
        ],
        "id": "15400d68-9790-4bc2-86a5-507f6171ee88",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "XF1cM38UXaYP6qBb",
            "name": "OpenAi D1Motors"
          }
        }
      },
      {
        "parameters": {
          "content": "ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ±Ğ¾Ñ€ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ±Ğ»Ğ¾ĞºĞ° Ğ²Ğ¾ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¼ Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ½Ğ° ĞºĞ°Ğ½Ğ°Ğ»Ğµ",
          "height": 860,
          "width": 1804
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -832,
          -512
        ],
        "typeVersion": 1,
        "id": "6bbfa434-a7b2-4551-b7df-8546c9b517b4",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "text",
                      "rightValue": "={{ $json.messageType }}",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "7d2a8cb9-ee05-4c48-a620-6d701b21002b"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "3489ec87-b04e-4b1e-ade1-81424608aafa",
                      "leftValue": "audio",
                      "rightValue": "={{ $json.messageType }}",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "audio"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "6c404022-4092-4ba6-9399-ff9a520d47c6",
                      "leftValue": "image",
                      "rightValue": "={{ $json.messageType }}",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "image"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "8e5eedbe-968b-4175-94a3-b505f3068b7e",
                      "leftValue": "document",
                      "rightValue": "={{ $json.messageType }}",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "document"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -592,
          -256
        ],
        "id": "1ec75ec9-8d5e-4b3d-b345-fbc802bae521",
        "name": "Switch"
      },
      {
        "parameters": {
          "url": "={{ $json.pdf }}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true,
                "responseFormat": "file",
                "outputPropertyName": "=data"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -80,
          112
        ],
        "id": "08f44d7b-eeab-4737-bba7-0ca70c5085f7",
        "name": "HTTP Request"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "960ff6f3-909b-4028-bfa3-d275c85ed6f9",
                "name": "sender",
                "type": "string",
                "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
              },
              {
                "id": "efed5d73-27e8-4538-b7d9-3044f1ec3288",
                "name": "message",
                "value": "={{ $json.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "ff95a31a-3523-4596-85f9-4578cdc9da0e",
        "name": "Set Payment Response2",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          720,
          112
        ]
      },
      {
        "parameters": {
          "jsCode": "// Download image via Evolution API getBase64FromMediaMessage\nconst webhookData = $('Webhook').item.json.body;\nconst mediaData = webhookData.mediaData || {};\nconst metadata = webhookData.metadata || {};\n\n// Build the message object for Evolution API\nconst messageKey = {\n  remoteJid: metadata.remoteJid,\n  id: metadata.messageId,\n  fromMe: false\n};\n\nconst requestBody = {\n  message: {\n    key: messageKey,\n    message: {\n      imageMessage: {\n        url: mediaData.url || '',\n        mimetype: mediaData.mimetype || 'image/jpeg',\n        mediaKey: mediaData.mediaKey || ''\n      }\n    }\n  }\n};\n\ntry {\n  const response = await this.helpers.httpRequest({\n    method: 'POST',\n    url: 'https://karma-wa.fly.dev/chat/getBase64FromMediaMessage/karma',\n    headers: {\n      'apikey': 'karma-evo-2026-secret',\n      'Content-Type': 'application/json'\n    },\n    body: requestBody,\n    json: true,\n    timeout: 15000\n  });\n\n  const base64Data = response.base64 || '';\n  const mime = response.mimetype || mediaData.mimetype || 'image/jpeg';\n\n  if (base64Data) {\n    return [{\n      json: {},\n      binary: {\n        data: {\n          data: base64Data,\n          mimeType: mime,\n          fileName: 'image.jpg'\n        }\n      }\n    }];\n  }\n} catch (e) {\n  // Fallback to thumbnail\n  const thumb = mediaData.jpegThumbnail || '';\n  if (thumb) {\n    return [{\n      json: {},\n      binary: {\n        data: {\n          data: thumb,\n          mimeType: 'image/jpeg',\n          fileName: 'thumb.jpg'\n        }\n      }\n    }];\n  }\n}\n\nreturn [];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -80,
          -64
        ],
        "id": "2be6553a-905f-476e-91c2-a80a06051e07",
        "name": "HTTP Request3"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "960ff6f3-909b-4028-bfa3-d275c85ed6f9",
                "name": "sender",
                "type": "string",
                "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
              },
              {
                "id": "dbfc6897-26c0-4161-b078-740a98d1aa8c",
                "name": "message",
                "type": "string",
                "value": "={{ $json.content }}"
              }
            ]
          },
          "options": {}
        },
        "id": "c440741f-879e-4a38-977e-dfc587ad8a06",
        "name": "Set Payment Response3",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          720,
          -64
        ],
        "alwaysOutputData": false,
        "notesInFlow": false
      },
      {
        "parameters": {
          "operation": "pdf",
          "options": {}
        },
        "id": "9a8ea6c1-406a-4903-ae12-a910047c5740",
        "name": "Extract PDF Text",
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1,
        "position": [
          192,
          112
        ]
      },
      {
        "parameters": {
          "resource": "image",
          "operation": "analyze",
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "text": "ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ¸ Ğ½Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ.\n\nĞ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ¿Ğ¾Ñ…Ğ¾Ğ¶Ğµ Ğ½Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ (Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚, ID, Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğµ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ğµ, Ğ¿Ñ€Ğ°Ğ²Ğ°) â€” Ğ½Ğ°Ñ‡Ğ½Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ñ Ñ‚ĞµĞ³Ğ° [Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢].\nĞ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ â€” Ğ½Ğ°Ñ‡Ğ½Ğ¸ Ñ Ñ‚ĞµĞ³Ğ° [Ğ¤ĞĞ¢Ğ].\n\nĞŸĞ¾ÑĞ»Ğµ Ñ‚ĞµĞ³Ğ° â€” ĞºÑ€Ğ°Ñ‚ĞºĞ¾ Ğ¾Ğ¿Ğ¸ÑˆĞ¸ Ñ‡Ñ‚Ğ¾ Ğ½Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¸.",
          "inputType": "base64",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          192,
          -64
        ],
        "id": "b41e86c1-a1b0-4d35-b186-6120cb815272",
        "name": "Analyze image1",
        "credentials": {
          "openAiApi": {
            "id": "AOBRqgI9aa99plds",
            "name": "OpenAi Karma_Rent"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "2f8abb0f-2aaf-49ed-b2da-f092775f47a3",
                "name": "sender",
                "value": "={{ $json.body.metadata.remoteJid }}",
                "type": "string"
              },
              {
                "id": "70b56414-635b-4e1d-bb0f-d46a5b0f7aba",
                "name": "messageType",
                "value": "={{ $json.body.messageType }}",
                "type": "string"
              },
              {
                "id": "c7bdfe19-e9cd-4d73-b497-cb3f4f46c8ee",
                "name": "text message",
                "value": "={{ $json.body.message }}",
                "type": "string"
              },
              {
                "id": "8429b40f-b61c-4564-ac6b-d925151c2c65",
                "name": "audio message",
                "value": "={{ $json.body.mediaData.base64 }}",
                "type": "string"
              },
              {
                "id": "0cdf4162-4c2d-4bef-9b64-02bd7d6eac69",
                "name": "image",
                "value": "={{ $json.body.mediaData.url }}",
                "type": "string"
              },
              {
                "id": "bdd37591-1ef7-42f1-91ff-a1716485354d",
                "name": "pdf",
                "value": "={{ $json.body.mediaData.url }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -752,
          -224
        ],
        "id": "52bce193-950a-4002-85bd-bcb3a8fbb236",
        "name": "Edit Fields4"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "4aa71e06-3620-4e33-94be-28a53ff07c6f",
                "name": "sender",
                "value": "={{ $json.sender }}",
                "type": "string"
              },
              {
                "id": "f53588bd-200f-4dab-a639-ff3b3ea640c5",
                "name": "message",
                "value": "={{ $json['text message'] }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          416,
          -448
        ],
        "id": "ab9755cd-f5b1-4297-88fb-8c38af3b0c1c",
        "name": "Edit Fields5"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a125f358-6efd-4d14-be3a-d3df77c34274",
                "name": "sender",
                "value": "={{ $json.sender }}",
                "type": "string"
              },
              {
                "id": "19b2a85e-9877-47e2-b82c-8d995b2183c0",
                "name": "audio message",
                "value": "={{ $json['audio message'] }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -80,
          -240
        ],
        "id": "0989ecc8-00d8-4343-a91c-7e01c79fec05",
        "name": "Edit Fields6"
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "audio message",
          "options": {
            "mimeType": "audio/ogg"
          }
        },
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          192,
          -240
        ],
        "id": "b662d657-d516-4455-ba4e-991a75f26fd8",
        "name": "Convert to File1"
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          416,
          -240
        ],
        "id": "a2bf4a7f-f1da-4a0a-95cc-e4d55d979eff",
        "name": "OpenAI1",
        "credentials": {
          "openAiApi": {
            "id": "AOBRqgI9aa99plds",
            "name": "OpenAi Karma_Rent"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "fe1c1138-fe9f-4d00-9743-5e66282d9074",
                "name": "sender",
                "value": "={{ $('Edit Fields6').item.json.sender }}",
                "type": "string"
              },
              {
                "id": "ec2514bb-d888-4e2c-b427-617acf2295d6",
                "name": "message",
                "value": "={{ $json.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          720,
          -240
        ],
        "id": "831ddb82-77c4-4d04-bad7-1e0c0ea12a27",
        "name": "Edit Fields7"
      },
      {
        "parameters": {
          "content": "",
          "height": 240,
          "width": 320,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1280,
          -272
        ],
        "typeVersion": 1,
        "id": "30775e05-1a9d-430f-9c2d-faf9efcfb9b4",
        "name": "Sticky Note5"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "6b2abf67-a83b-4cb7-bc7b-81be5cf2e820",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -1184,
          -224
        ],
        "id": "8604b9e9-b4e3-4e67-bce6-19232e582709",
        "name": "WebhookRaw",
        "webhookId": "6b2abf67-a83b-4cb7-bc7b-81be5cf2e820"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 2
            },
            "conditions": [
              {
                "id": "always-true",
                "leftValue": "={{ \"pass\" }}",
                "rightValue": "pass",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -968,
          -224
        ],
        "id": "phone-filter-node-new",
        "name": "Phone Filter"
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "user_state",
          "filters": {
            "conditions": [
              {
                "keyName": "jid",
                "condition": "eq",
                "keyValue": "={{ $('Edit Fields4').first().json.sender }}"
              }
            ]
          },
          "limit": 1,
          "options": {}
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          2900,
          -304
        ],
        "id": "fe9ca20f-a784-400d-9cfb-37ce29a6f6f8",
        "name": "Get User State",
        "credentials": {
          "supabaseApi": {
            "id": "u1mkv2sS5oh337qr",
            "name": "Supabase Karma_Worker"
          }
        },
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "jsCode": "// Get state from Supabase\nconst items = $input.all();\nconst summaData = $('Ğ¡ÑƒĞ¼Ğ¼Ğ°').first().json;\nconst senderData = $('Edit Fields4').first().json;\nconst sender = senderData.sender || '';\nconst rawMsg = summaData.message || '';\nconst message = Array.isArray(rawMsg) ? rawMsg.join(' ') : String(rawMsg);\n\n// Detect client language from message\nfunction detectLang(msg) {\n  const m = msg.toLowerCase();\n  // Vietnamese: diacritics or common words\n  if (/[Ã Ã¡áº¡áº£Ã£Ã¢áº§áº¥áº­áº©áº«Äƒáº±áº¯áº·áº³áºµÃ¨Ã©áº¹áº»áº½Ãªá»áº¿á»‡á»ƒá»…Ã¬Ã­á»‹á»‰Ä©Ã²Ã³á»á»ÃµÃ´á»“á»‘á»™á»•á»—Æ¡á»á»›á»£á»Ÿá»¡Ã¹Ãºá»¥á»§Å©Æ°á»«á»©á»±á»­á»¯á»³Ã½á»µá»·á»¹Ä‘]/.test(m)) return 'Tiáº¿ng Viá»‡t';\n  if (/\\b(chÃ o|tÃ´i|cáº§n|thuÃª|ngÃ y|chá»—|báº¡n|xe|lÃ¡i|gá»­i|áº£nh|chá»n|muá»‘n)\\b/.test(m)) return 'Tiáº¿ng Viá»‡t';\n  // Russian: has Cyrillic\n  if (/[Ğ°-ÑÑ‘Ğ-Ğ¯Ğ]/.test(m)) return 'Ğ ÑƒÑÑĞºĞ¸Ğ¹';\n  // English: latin + common English words (no Cyrillic)\n  if (/\\b(hi|hello|hey|need|want|have|day|days|car|bike|motorbike|bicycle|city|experience|choose|take|please|thank|show|me|i|yes|no|ok|sure|great|nice|good|how|much|long|which|what)\\b/i.test(m)) return 'English';\n  // Ambiguous: just a number, emoji, or unrecognizable â†’ null\n  return null;\n}\nconst detectedLang = detectLang(message);\n\n// Today's date for booking rules\nconst _now = new Date();\nconst today = _now.getDate().toString().padStart(2,'0') + '.' + (_now.getMonth()+1).toString().padStart(2,'0') + '.' + (_now.getFullYear() % 100).toString().padStart(2,'0');\n\n// === DATE CHECK: parse date from message + state, warn if > 2 days ===\nfunction parseDateFromText(text, now) {\n  const t = text.toLowerCase();\n  const y = now.getFullYear();\n  const m = now.getMonth(); // 0-based\n  const d = now.getDate();\n  \n  // \"Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°\" / \"tomorrow\" / \"ngÃ y mai\"\n  if (/\\b(Ğ·Ğ°Ğ²Ñ‚Ñ€Ğ°|tomorrow|ngÃ y mai)\\b/.test(t)) {\n    const dt = new Date(y, m, d + 1);\n    return dt;\n  }\n  // \"Ğ¿Ğ¾ÑĞ»ĞµĞ·Ğ°Ğ²Ñ‚Ñ€Ğ°\" / \"day after tomorrow\" / \"ngÃ y kia\"\n  if (/\\b(Ğ¿Ğ¾ÑĞ»ĞµĞ·Ğ°Ğ²Ñ‚Ñ€Ğ°|day after tomorrow|ngÃ y kia)\\b/.test(t)) {\n    const dt = new Date(y, m, d + 2);\n    return dt;\n  }\n  // \"Ñ‡ĞµÑ€ĞµĞ· N Ğ´Ğ½ĞµĞ¹\" / \"in N days\"\n  const inDays = t.match(/Ñ‡ĞµÑ€ĞµĞ·\\s*(\\d+)\\s*Ğ´Ğ½|in\\s*(\\d+)\\s*day/);\n  if (inDays) {\n    const n = parseInt(inDays[1] || inDays[2]);\n    return new Date(y, m, d + n);\n  }\n  // \"DD.MM\" or \"DD.MM.YY\"\n  const dotDate = t.match(/(\\d{1,2})\\.(\\d{1,2})(?:\\.(\\d{2,4}))?/);\n  if (dotDate) {\n    const dd = parseInt(dotDate[1]);\n    const mm = parseInt(dotDate[2]) - 1;\n    const yy = dotDate[3] ? (dotDate[3].length === 2 ? 2000 + parseInt(dotDate[3]) : parseInt(dotDate[3])) : y;\n    return new Date(yy, mm, dd);\n  }\n  // Russian months: \"10 Ğ¼Ğ°Ñ€Ñ‚Ğ°\", \"Ñ 5 Ğ°Ğ¿Ñ€ĞµĞ»Ñ\"\n  const ruMonths = {ÑĞ½Ğ²:0,Ñ„ĞµĞ²:1,Ğ¼Ğ°Ñ€:2,Ğ°Ğ¿Ñ€:3,Ğ¼Ğ°Ñ:4,Ğ¼Ğ°Ğ¹:4,Ğ¸ÑĞ½:5,Ğ¸ÑĞ»:6,Ğ°Ğ²Ğ³:7,ÑĞµĞ½:8,Ğ¾ĞºÑ‚:9,Ğ½Ğ¾Ñ:10,Ğ´ĞµĞº:11};\n  const ruMatch = t.match(/(\\d{1,2})\\s*(ÑĞ½Ğ²|Ñ„ĞµĞ²|Ğ¼Ğ°Ñ€|Ğ°Ğ¿Ñ€|Ğ¼Ğ°Ñ|Ğ¼Ğ°Ğ¹|Ğ¸ÑĞ½|Ğ¸ÑĞ»|Ğ°Ğ²Ğ³|ÑĞµĞ½|Ğ¾ĞºÑ‚|Ğ½Ğ¾Ñ|Ğ´ĞµĞº)/);\n  if (ruMatch) {\n    const dd = parseInt(ruMatch[1]);\n    const mm = ruMonths[ruMatch[2]];\n    if (mm !== undefined) return new Date(y, mm, dd);\n  }\n  // English months: \"march 10\", \"10 march\"\n  const enMonths = {jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11};\n  const enMatch = t.match(/(\\d{1,2})\\s*(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|\\b(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)\\w*\\s*(\\d{1,2})/);\n  if (enMatch) {\n    const dd = parseInt(enMatch[1] || enMatch[4]);\n    const monthStr = (enMatch[2] || enMatch[3]);\n    const mm = enMonths[monthStr];\n    if (mm !== undefined) return new Date(y, mm, dd);\n  }\n  return null;\n}\n\nfunction getDaysAway(parsedDate, now) {\n  if (!parsedDate || isNaN(parsedDate.getTime())) return null;\n  const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  const dateStart = new Date(parsedDate.getFullYear(), parsedDate.getMonth(), parsedDate.getDate());\n  return Math.round((dateStart - todayStart) / 86400000);\n}\n\n// Check date from message AND from existing state\nlet dateWarning = '';\nconst parsedMsgDate = parseDateFromText(message, _now);\nconst msgDaysAway = getDaysAway(parsedMsgDate, _now);\n\n// Also check state.Ğ´Ğ°Ñ‚Ğ° if set\nlet stateDaysAway = null;\nif (items.length > 0 && items[0].json.state && items[0].json.state['Ğ´Ğ°Ñ‚Ğ°'] && items[0].json.state['Ğ´Ğ°Ñ‚Ğ°'] !== '?') {\n  const stateDate = parseDateFromText(items[0].json.state['Ğ´Ğ°Ñ‚Ğ°'], _now);\n  stateDaysAway = getDaysAway(stateDate, _now);\n}\n\nconst effectiveDaysAway = msgDaysAway !== null ? msgDaysAway : stateDaysAway;\nif (effectiveDaysAway !== null && effectiveDaysAway > 2) {\n  dateWarning = '\\n[âš ï¸ Ğ‘Ğ ĞĞĞ¬ ĞĞ•Ğ’ĞĞ—ĞœĞĞ–ĞĞ: Ğ´Ğ°Ñ‚Ğ° Ğ·Ğ°ĞµĞ·Ğ´Ğ° Ñ‡ĞµÑ€ĞµĞ· ' + effectiveDaysAway + ' Ğ´Ğ½ĞµĞ¹! Ğ‘Ñ€Ğ¾Ğ½ÑŒ Ğ´ĞµĞ¹ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ´Ğ¾ 2 Ğ´Ğ½ĞµĞ¹. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ ÑĞºĞ°Ğ¶Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ: \"Ğ¡Ğ¿Ñ€Ğ¾Ñ ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹, Ğ»ÑƒÑ‡ÑˆĞµ Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ° Ğ´ĞµĞ½ÑŒ-Ğ´Ğ²Ğ° Ğ´Ğ¾ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹. ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ½Ğ°Ğ¼ Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğº Ğ´Ğ°Ñ‚Ğµ â€” Ğ²ÑÑ‘ Ğ¿Ğ¾Ğ´Ğ±ĞµÑ€Ñ‘Ğ¼! ğŸ˜Š\" ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³, ĞĞ• Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€ÑƒĞ¹.]\\n';\n}\n// === END DATE CHECK ===\n// Language is determined by majority of messages, not single detection\nlet clientLang = 'Ğ ÑƒÑÑĞºĞ¸Ğ¹'; // default until we compute from counts\n\n// Handle /reset command â€” SILENT reset, no response to user\nif (message.trim() === '/reset') {\n  let currentSession = 0;\n  try {\n    const prevState = items.length > 0 && items[0].json.state ? items[0].json.state : {};\n    currentSession = (prevState.session || 0) + 1;\n  } catch(e) { currentSession = 1; }\n\n  // Reset state in Supabase (keep only session counter)\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://upjyomatlonfgygoniir.supabase.co/rest/v1/user_state',\n      headers: {\n        'apikey': $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Authorization': 'Bearer ' + $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Content-Type': 'application/json',\n        'Prefer': 'resolution=merge-duplicates'\n      },\n      body: { jid: sender, state: { session: currentSession }, updated_at: new Date().toISOString() }\n    });\n  } catch(e) {}\n\n  // Return with ÑÑ‚Ğ°Ğ¿=Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ + no link â†’ Check Booked Logic drops it â†’ silent\n  return [{ json: {\n    sender: sender,\n    ÑÑ‚Ğ°Ğ¿: 'Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½',\n    clientLang: 'Ğ ÑƒÑÑĞºĞ¸Ğ¹',\n    sessionKey: sender + '_v2_s' + currentSession,\n    message: ''\n  } }];\n}\n\n// Test phone numbers (get test flow rules)\nconst TEST_PHONES = ['84586066091', '79262579414', '84788623458'];\nconst senderDigits = sender.replace(/\\D/g, '');\nconst isTest = TEST_PHONES.some(p => senderDigits.includes(p)) || senderDigits.startsWith('7926257');\n\n// Get session counter early (needed for 12h timeout branch too)\nconst sessionNum = (items.length > 0 && items[0].json.state && items[0].json.state.session) ? items[0].json.state.session : 0;\n\n// Build state context\nlet stateContext = '';\nlet prefilledĞ­Ñ‚Ğ°Ğ¿ = 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ';\nif (items.length > 0 && items[0].json.state && Object.keys(items[0].json.state).length > 0) {\n  const state = items[0].json.state;\n\n  // Check state reset: if updated_at > 12h, reset\n  const updatedAt = items[0].json.updated_at;\n  if (updatedAt) {\n    const hoursAgo = (Date.now() - new Date(updatedAt).getTime()) / 3600000;\n    if (hoursAgo > 12) {\n      // State expired, start fresh\n      return [{ json: { sender, ÑÑ‚Ğ°Ğ¿: 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ', clientLang: clientLang, sessionKey: sender + '_v2_s' + sessionNum, message: '[Ğ¡Ğ•Ğ“ĞĞ”ĞĞ¯: ' + today + ']' + dateWarning + '\\nĞ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ:\\n[Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: ?]\\n[Ğ´Ğ½ĞµĞ¹: ?]\\n[Ğ´Ğ°Ñ‚Ğ°: ?]\\n[Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: ?]\\n[Ğ¾Ğ¿Ñ‹Ñ‚: ?]\\n[Ğ±Ğ°Ğ¹Ğº: ?]\\n[Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: ?]\\n[ÑÑ‚Ğ°Ğ¿: Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ]\\n' + '\\n---\\n' + message } }];\n    }\n  }\n  \n  // Build state with mandatory fields template\n  const defaults = {Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: '?', Ğ´Ğ½ĞµĞ¹: '?', Ğ´Ğ°Ñ‚Ğ°: '?', Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: '?', Ğ¾Ğ¿Ñ‹Ñ‚: '?', Ğ±Ğ°Ğ¹Ğº: '?', Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: '?', ÑÑ‚Ğ°Ğ¿: 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'};\n  const merged = {...defaults, ...state};\n\n  // Pre-fill state from client message (before GPT sees it)\n  const msg = message.toLowerCase();\n  if (merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] === '?') {\n    if (/(?:^|\\s)(Ğ°Ğ²Ñ‚Ğ¾|Ğ¼Ğ°ÑˆĞ¸Ğ½|car|cars|automobile|Ã´ tÃ´|xe hÆ¡i)/i.test(msg)) merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ°Ğ²Ñ‚Ğ¾';\n    else if (/(?:^|\\s)(Ğ±Ğ°Ğ¹Ğº|Ğ¼Ğ¾Ñ‚Ğ¾|ÑĞºÑƒÑ‚ĞµÑ€|bike|scooter|motorbike|motorcycle|xe mÃ¡y)/i.test(msg)) merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ±Ğ°Ğ¹Ğº';\n    else if (/(?:^|\\s)(Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´|Ğ²ĞµĞ»Ğ¸Ğº|bicycle|xe Ä‘áº¡p)/i.test(msg)) merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´';\n  }\n  if (merged['Ğ´Ğ½ĞµĞ¹'] === '?') {\n    const dm = msg.match(/(\\d+)\\s*Ğ´Ğ½|for\\s*(\\d+)\\s*day|(\\d+)\\s*ngÃ y/);\n    if (dm) merged['Ğ´Ğ½ĞµĞ¹'] = dm[1] || dm[2] || dm[3];\n  }\n  if (merged['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] === '?') {\n    if (/Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ|in the city|around town|trong thÃ nh|Ğ² Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğµ|around the city|city riding|city driving/.test(msg)) merged['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] = 'Ğ³Ğ¾Ñ€Ğ¾Ğ´';\n    else if (/Ğ·Ğ° Ğ³Ğ¾Ñ€Ğ¾Ğ´|Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ|long distance|highway/.test(msg)) merged['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] = 'Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ';\n  }\n  if (merged['Ğ¾Ğ¿Ñ‹Ñ‚'] === '?') {\n    if (/Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ|Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼|have.*license|been driving|cÃ³ báº±ng|Ğ¾Ğ¿Ñ‹Ñ‚ ĞµÑÑ‚ÑŒ|have experience|experienced|i ride|i drive/.test(msg)) merged['Ğ¾Ğ¿Ñ‹Ñ‚'] = 'ĞµÑÑ‚ÑŒ';\n  }\n  // If user provided all info in one message, skip to Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\n  if (merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] !== '?' && merged['Ğ´Ğ½ĞµĞ¹'] !== '?' && merged['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] !== '?' && merged['Ğ¾Ğ¿Ñ‹Ñ‚'] !== '?' && merged['ÑÑ‚Ğ°Ğ¿'] === 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ') {\n    merged['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€';\n  }\n  // If user provided transport but not all info, skip to Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\n  else if (merged['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] !== '?' && merged['ÑÑ‚Ğ°Ğ¿'] === 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ') {\n    merged['ÑÑ‚Ğ°Ğ¿'] = 'Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ';\n  }\n  prefilledĞ­Ñ‚Ğ°Ğ¿ = merged['ÑÑ‚Ğ°Ğ¿'];\n  // Language by majority: count messages per language, use the dominant one\n  let langCounts = {};\n  try { langCounts = JSON.parse(merged['_langCounts'] || '{}'); } catch(e) { langCounts = {}; }\n  if (detectedLang) {\n    langCounts[detectedLang] = (langCounts[detectedLang] || 0) + 1;\n  }\n  merged['_langCounts'] = JSON.stringify(langCounts);\n  // Pick language with most messages\n  let maxCount = 0;\n  let dominantLang = null;\n  for (const [lang, count] of Object.entries(langCounts)) {\n    if (count > maxCount) { maxCount = count; dominantLang = lang; }\n  }\n  clientLang = dominantLang || 'Ğ ÑƒÑÑĞºĞ¸Ğ¹';\n  merged['ÑĞ·Ñ‹Ğº'] = clientLang;\n\n  stateContext = 'Ğ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ:\\n';\n  for (const [key, value] of Object.entries(merged)) {\n    stateContext += '[' + key + ': ' + value + ']\\n';\n  }\n}\n\n// If no state at all â€” new user, inject empty template\nif (!stateContext) {\n  stateContext = 'Ğ”ĞĞĞĞ«Ğ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ:\\n[Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: ?]\\n[Ğ´Ğ½ĞµĞ¹: ?]\\n[Ğ´Ğ°Ñ‚Ğ°: ?]\\n[Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: ?]\\n[Ğ¾Ğ¿Ñ‹Ñ‚: ?]\\n[Ğ±Ğ°Ğ¹Ğº: ?]\\n[Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: ?]\\n[ÑÑ‚Ğ°Ğ¿: Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ]\\n';\n}\n\n// ===== ĞĞ’Ğ¢Ğ â†’ ĞĞŸĞ•Ğ ĞĞ¢ĞĞ : deterministic redirect, skip AI Agent =====\nconst msgLower = message.toLowerCase();\nconst autoInMsg = /(?:^|\\s)(Ğ°Ğ²Ñ‚Ğ¾|Ğ¼Ğ°ÑˆĞ¸Ğ½|car|cars|automobile|Ã´ tÃ´|xe hÆ¡i)/i.test(msgLower);\nconst autoInState = stateContext.includes('[Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: Ğ°Ğ²Ñ‚Ğ¾]');\nconst isAutoRequest = autoInMsg || autoInState;\nconst earlyStages = ['Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ', 'Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ', 'Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€'];\n\nif (isAutoRequest && earlyStages.includes(prefilledĞ­Ñ‚Ğ°Ğ¿)) {\n  // Pick message by client language\n  const autoMessages = {\n    'Ğ ÑƒÑÑĞºĞ¸Ğ¹': 'ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾! Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñƒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ° Ğ¿Ğ¾ Ğ°Ñ€ĞµĞ½Ğ´Ğµ Ğ°Ğ²Ñ‚Ğ¾, Ğ¾Ğ½ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ²Ğ°Ğ¼! ğŸš—',\n    'English': 'Great! I\\'ll connect you with our car rental manager, they\\'ll message you shortly! ğŸš—',\n    'Tiáº¿ng Viá»‡t': 'Tuyá»‡t vá»i! TÃ´i sáº½ káº¿t ná»‘i báº¡n vá»›i quáº£n lÃ½ cho thuÃª Ã´ tÃ´, há» sáº½ nháº¯n cho báº¡n ngay! ğŸš—'\n  };\n  const autoMsg = autoMessages[clientLang] || autoMessages['Ğ ÑƒÑÑĞºĞ¸Ğ¹'];\n\n  // Send WhatsApp message via Evolution API\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://karma-wa.fly.dev/message/sendText/karma',\n      headers: { 'apikey': 'karma-evo-2026-secret', 'Content-Type': 'application/json' },\n      body: { number: sender, text: autoMsg }\n    });\n  } catch(e) { /* WA send failed, still save state */ }\n\n  // Build state preserving existing fields\n  let autoState = { Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: 'Ğ°Ğ²Ñ‚Ğ¾', ÑÑ‚Ğ°Ğ¿: 'Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€', session: sessionNum };\n  if (items.length > 0 && items[0].json.state && Object.keys(items[0].json.state).length > 0) {\n    autoState = { ...items[0].json.state, Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: 'Ğ°Ğ²Ñ‚Ğ¾', ÑÑ‚Ğ°Ğ¿: 'Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€' };\n  }\n\n  // Save state to Supabase\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://upjyomatlonfgygoniir.supabase.co/rest/v1/user_state',\n      headers: {\n        'apikey': $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Authorization': 'Bearer ' + $env.SUPABASE_SERVICE_ROLE_KEY,\n        'Content-Type': 'application/json',\n        'Prefer': 'resolution=merge-duplicates'\n      },\n      body: { jid: sender, state: autoState, updated_at: new Date().toISOString() }\n    });\n  } catch(e) { /* state save failed */ }\n\n  // Return Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ â†’ Check Stage catches â†’ No Operation â†’ done\n  return [{ json: {\n    sender: sender,\n    ÑÑ‚Ğ°Ğ¿: 'Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€',\n    clientLang: clientLang,\n    sessionKey: sender + '_v2_s' + sessionNum,\n    message: ''\n  } }];\n}\n// ===== END ĞĞ’Ğ¢Ğ â†’ ĞĞŸĞ•Ğ ĞĞ¢ĞĞ  =====\n\n\n// ==================== PROD FLOW (synced with TEST_FLOW 2026-02-25) ====================\nconst PROD_FLOW = `Ğ¢Ñ‹ Ğ²ĞµĞ´Ñ‘ÑˆÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼. Ğ£ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºĞ¸ Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°.\n\nĞ“Ğ›ĞĞ’ĞĞĞ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ: Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ½Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ. ĞĞµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹ ÑĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ â€” ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚. Ğ’ĞµĞ´Ğ¸ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€ ĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾.\n\nĞ¯Ğ—Ğ«Ğš â€” ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:\nğŸ”´ ĞĞ¢Ğ’Ğ•Ğ§ĞĞ™ Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ Ğ¯Ğ—Ğ«ĞšĞ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ. English â†’ English. Tiáº¿ng Viá»‡t â†’ tiáº¿ng Viá»‡t. Ğ ÑƒÑÑĞºĞ¸Ğ¹ â†’ Ñ€ÑƒÑÑĞºĞ¸Ğ¹.\nğŸ”´ Ğ’Ğ¡Ğ Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° ÑĞ·Ñ‹ĞºĞµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°! Ğ’ĞºĞ»ÑÑ‡Ğ°Ñ:\n  - ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: \"Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹\" â†’ \"black\", \"Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹\" â†’ \"tall\", \"ĞºĞ¾Ñ€Ğ¸Ñ‡Ğ½ĞµĞ²Ñ‹Ğ¹\" â†’ \"brown\"\n  - Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸: \"Ğ¼ĞµÑÑ‚\" â†’ \"seats\", \"ĞºÑ€Ğ¾ÑÑĞ¾Ğ²ĞµÑ€\" â†’ \"crossover\", \"ÑĞµĞ´Ğ°Ğ½\" â†’ \"sedan\"\n  - Ğ‘Ğ¾Ğ½ÑƒÑÑ‹ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´Ğ¸\n  - Ğ‘Ñ€ĞµĞ½Ğ´/Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ (Honda, Mazda, Kia, NVX)\nğŸ”´ Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ²ĞµÑ€ĞµĞ½ Ğ² Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğµ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ° â€” Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸ ĞµĞ³Ğ¾, ĞĞ• Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞ¹ Ñ€ÑƒÑÑĞºĞ¸Ğµ ÑĞ»Ğ¾Ğ²Ğ°!\n\nĞ–ĞĞ¡Ğ¢ĞšĞ˜Ğ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ:\n- ĞĞ• ĞŸĞĞšĞĞ—Ğ«Ğ’ĞĞ™ ĞšĞĞ¢ĞĞ›ĞĞ“ Ğ¿Ğ¾ĞºĞ° Ğ½Ğµ ÑĞ¾Ğ±Ñ€Ğ°Ğ» Ğ’Ğ¡Ğ• Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ: Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚, Ğ´Ğ½ĞµĞ¹, Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ, Ğ¾Ğ¿Ñ‹Ñ‚. Ğ•ÑĞ»Ğ¸ Ñ…Ğ¾Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ = \"?\" â€” ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¿Ñ€Ğ¾ÑĞ¸.\n- Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ» Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€. \"Ğ°Ğ²Ñ‚Ğ¾ Ğ½Ğ° 5 Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\") â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ²ÑÑ‘, ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰ĞµĞµ.\n- Ğ¦Ğ•ĞĞ« Ğ¸ ĞœĞĞ”Ğ•Ğ›Ğ˜ â€” Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞĞµ Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ğ¹ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ (ÑÑ‚Ñ€Ğ°Ñ…Ğ¾Ğ²ĞºÑƒ, ÑĞºĞ¸Ğ´ĞºĞ¸, ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ). ĞĞµ Ğ·Ğ½Ğ°ĞµÑˆÑŒ â†’ \"ÑƒÑ‚Ğ¾Ñ‡Ğ½Ñ Ñƒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°\".\n- ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹ = 2 Ğ´Ğ½Ñ. 1 Ğ´ĞµĞ½ÑŒ â†’ \"ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 2 Ğ´Ğ½Ñ, Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚?\"\n- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° = Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¸Ğ½Ñ„Ğ¾. ĞĞµ Ğ¾Ğ·Ğ²ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ¹ (\"Ñ Ğ²Ğ¸Ğ¶Ñƒ Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹...\").\n\nĞ¢Ğ˜ĞŸ Ğ¢Ğ ĞĞĞ¡ĞŸĞĞ Ğ¢Ğ â€” ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ°Ğ²Ñ‚Ğ¾/Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ°/car/Ã´ tÃ´/xe hÆ¡i\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ ĞĞ’Ğ¢Ğ (cars). Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ¹ĞºĞ¸!\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ±Ğ°Ğ¹Ğº/Ğ¼Ğ¾Ñ‚Ğ¾Ñ†Ğ¸ĞºĞ»/ÑĞºÑƒÑ‚ĞµÑ€/motorbike/scooter/xe mÃ¡y\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ Ğ‘ĞĞ™ĞšĞ˜ (bikes). Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾!\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´/bicycle/xe Ä‘áº¡p\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ Ğ’Ğ•Ğ›ĞĞ¡Ğ˜ĞŸĞ•Ğ”Ğ« (bicycles).\nğŸ”´ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ĞĞ• ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ» Ñ‚Ğ¸Ğ¿ â†’ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ ÑĞ¿Ñ€Ğ¾ÑĞ¸: \"ĞšĞ°ĞºĞ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â€” Ğ±Ğ°Ğ¹Ğº, Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´?\"\nğŸ”´ ĞŸĞĞšĞĞ–Ğ˜ Ğ’Ğ¡Ğ• ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°! Ğ•ÑĞ»Ğ¸ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… 9 Ğ¼Ğ°ÑˆĞ¸Ğ½ â€” Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ²ÑĞµ 9. ĞĞµ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ¹!\n\nĞ­Ğ¢ĞĞŸĞ« (Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ¿Ğ¾ [ÑÑ‚Ğ°Ğ¿:] Ğ¸ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ğ¾Ğ»ĞµĞ¹ STATE):\n\n1. ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\" Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚)\n   â†’ ĞŸĞ¾Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞ¹, ÑĞ¿Ñ€Ğ¾ÑĞ¸ ĞºĞ°ĞºĞ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ (Ğ±Ğ°Ğ¹Ğº/Ğ°Ğ²Ñ‚Ğ¾/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´)\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑÑ€Ğ°Ğ·Ñƒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ» Ñ‚Ğ¸Ğ¿ â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ¸ Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\"\n\n2. Ğ£Ğ¢ĞĞ§ĞĞ•ĞĞ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\")\n   â†’ ĞÑƒĞ¶Ğ½Ğ¾ ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ: Ğ´Ğ½ĞµĞ¹, Ñ ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°, Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ, Ğ¾Ğ¿Ñ‹Ñ‚ Ğ²Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ\n   â†’ Ğ¡Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ (Ğ³Ğ´Ğµ \"?\")\n   â†’ ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑĞ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ 2-3 Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼\n   â†’ ĞšĞ¾Ğ³Ğ´Ğ° Ğ’Ğ¡Ğ• ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ¾ (Ğ´Ğ½ĞµĞ¹ â‰  \"?\", Ğ´Ğ°Ñ‚Ğ° â‰  \"?\", Ğ³Ğ¾Ñ€Ğ¾Ğ´ â‰  \"?\", Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\") â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   â†’ ğŸ”´ ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¼ ÑÑ‚Ğ°Ğ¿Ğµ!\n\n3. ĞŸĞĞ”Ğ‘ĞĞ  (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\")\n   â†’ ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ’Ğ¡Ğ• ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğµ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°: Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, ĞºĞ»Ğ°ÑÑ, Ñ†ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°\n   â†’ ĞĞ”Ğ˜Ğ Ğ ĞĞ— ÑĞºĞ°Ğ¶Ğ¸ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ (ĞŸĞ•Ğ Ğ•Ğ’Ğ•Ğ”Ğ˜ Ğ½Ğ° ÑĞ·Ñ‹Ğº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°!):\n     - Ğ¾Ñ‚ 3 Ğ´Ğ½ĞµĞ¹ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹: Ğ´Ğ°Ñ€Ğ¸Ğ¼ ĞºĞ°Ñ€Ñ‚Ñƒ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°\n     - Ğ¾Ñ‚ 7 Ğ´Ğ½ĞµĞ¹: Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ \"Ñ‡Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ?\" â€” Ğ´Ğ°Ğ¹ ĞºÑ€Ğ°Ñ‚ĞºĞ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº (Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ + Ñ†ĞµĞ½Ğ°), Ğ½Ğµ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° â†’ \"Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ [Ñ‚Ğ¸Ğ¿] Ğ½ĞµÑ‚, ĞºĞ°Ğº Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ â€” ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ!\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ½ĞµÑ‚_Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°\"\n\n4. Ğ’Ğ«Ğ‘ĞĞ  (ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ â€” \"Ğ±ĞµÑ€Ñƒ X\" / \"Ñ…Ğ¾Ñ‡Ñƒ X\")\n   â†’ Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ² STATE Ğ¿Ğ¾Ğ»Ğµ \"Ğ±Ğ°Ğ¹Ğº\" = Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸\n   â†’ Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=Ğ°Ğ²Ñ‚Ğ¾ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ñ (Ğ’Ğ£). Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ’Ğ£!\n   â†’ Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=Ğ±Ğ°Ğ¹Ğº/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° (Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ˜Ğ›Ğ˜ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° â€” Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚)\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\"\n   â†’ ĞŸĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ» â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n5. ĞŸĞĞ¡ĞŸĞĞ Ğ¢ (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\")\n   â†’ [Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢] â†’ \"âœ… Ğ—Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾! Ğ¡ĞºĞ¾Ñ€Ğ¾ ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\"\n   â†’ ğŸ”´ ĞŸĞĞ¡Ğ›Ğ• Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ±Ñ€Ğ¾Ğ½Ğ¸, ĞµÑĞ»Ğ¸ Ğ´Ğ½ĞµĞ¹ >= 3, Ğ¡Ğ ĞĞ—Ğ£ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ:\n     \"ğŸ—ºï¸ Ğ‘Ğ¾Ğ½ÑƒÑ! Ğ’Ğ¾Ñ‚ ĞºĞ°Ñ€Ñ‚Ğ° Ğ´Ğ¾ÑÑ‚Ğ¾Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ĞµĞ¹ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°: https://maps.app.goo.gl/9oegqGYXydKWX6tUA?g_st=ac\"\n   â†’ [Ğ¤ĞĞ¢Ğ] Ğ±ĞµĞ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° â†’ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ (Ğ’Ğ£ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾, Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸Ğ»Ğ¸ Ğ’Ğ£ Ğ´Ğ»Ñ Ğ±Ğ°Ğ¹ĞºĞ°/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´Ğ°)\n   â†’ Ğ¥Ğ¾Ñ‡ĞµÑ‚ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n6. Ğ—ĞĞ‘Ğ ĞĞĞ˜Ğ ĞĞ’ĞĞ (ÑÑ‚Ğ°Ğ¿ = \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\")\n   â†’ ĞŸĞ¾ Ğ±Ñ€Ğ¾Ğ½Ğ¸ â†’ \"ĞŸĞµÑ€ĞµĞ´Ğ°Ğ¼ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñƒ, ÑĞºĞ¾Ñ€Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚!\"\n   â†’ ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ â†’ Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ğµ\n\nĞ›ĞĞšĞĞ¦Ğ˜Ğ¯:\nĞ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚: Ğ³Ğ´Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ĞµÑÑŒ / Ğ°Ğ´Ñ€ĞµÑ / location / where are you / á»Ÿ Ä‘Ã¢u / Ğ³Ğ´Ğµ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ / pickup point:\nâ†’ Ğ”Ğ°Ğ¹ ÑÑÑ‹Ğ»ĞºÑƒ: https://maps.app.goo.gl/N9x7DPV7LYf2BSUv6?g_st=ac\nâ†’ ÑÑ‚Ğ°Ğ¿ ĞĞ• Ğ¼ĞµĞ½ÑĞ¹ (Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹)\n\nĞ¡Ğ¢ĞĞŸĞ¡Ğ›ĞĞ’Ğ (\"Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ°\"/\"Ğ½Ğµ Ğ½Ğ°Ğ´Ğ¾\"/\"Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ»\"/\"cancel\"):\nâ†’ \"Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾, ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ â€” Ğ¼Ñ‹ Ğ½Ğ° ÑĞ²ÑĞ·Ğ¸!\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\n\nĞĞ• ĞŸĞĞ’Ğ¢ĞĞ Ğ¯Ğ™:\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ» ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ â€” Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ ÑĞ½Ğ¾Ğ²Ğ° Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ ÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» Ğ¾Ñ‚Ğ²ĞµÑ‚ â€” Ğ½Ğµ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¾Ğ¿ÑÑ‚ÑŒ\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ ÑƒĞ¿Ğ¾Ğ¼ÑĞ½ÑƒĞ» Ğ±Ğ¾Ğ½ÑƒÑÑ‹ â€” Ğ½Ğµ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾\n\nâš ï¸ STATE â€” Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ĞšĞĞ–Ğ”ĞĞ“Ğ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:\nSTATE: {\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚\": \"?\", \"Ğ´Ğ½ĞµĞ¹\": \"?\", \"Ğ´Ğ°Ñ‚Ğ°\": \"?\", \"Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸\": \"?\", \"Ğ¾Ğ¿Ñ‹Ñ‚\": \"?\", \"Ğ±Ğ°Ğ¹Ğº\": \"?\", \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\": \"?\", \"ÑÑ‚Ğ°Ğ¿\": \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\"}\nğŸ”´ Ğ—ĞĞĞ§Ğ•ĞĞ˜Ğ¯ STATE Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ ĞĞ Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ! Ğ”Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ½Ğ° English/Vietnamese:\n   Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ = \"Ğ±Ğ°Ğ¹Ğº\" / \"Ğ°Ğ²Ñ‚Ğ¾\" / \"Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´\" / \"?\"\n   Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ = \"Ğ³Ğ¾Ñ€Ğ¾Ğ´\" / \"Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ\" / \"?\"\n   Ğ¾Ğ¿Ñ‹Ñ‚ = \"ĞµÑÑ‚ÑŒ\" / \"Ğ½ĞµÑ‚\" / \"?\"\n   ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\" / \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\" / \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\" / \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\" / \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\" / \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\nĞ—Ğ°Ğ¼ĞµĞ½ÑĞ¹ ? Ğ½Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞ¹ Ğ’Ğ¡Ğ• Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ!\nğŸ”´ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ°Ğ» ĞĞ•Ğ¡ĞšĞĞ›Ğ¬ĞšĞ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ â€” Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ’Ğ¡Ğ• ÑÑ€Ğ°Ğ·Ñƒ!\n   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"motorbike for 7 days, around the city, I have experience\" â†’ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=\"Ğ±Ğ°Ğ¹Ğº\", Ğ´Ğ½ĞµĞ¹=\"7\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸=\"Ğ³Ğ¾Ñ€Ğ¾Ğ´\", Ğ¾Ğ¿Ñ‹Ñ‚=\"ĞµÑÑ‚ÑŒ\", ÑÑ‚Ğ°Ğ¿=\"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"xe mÃ¡y 5 ngÃ y, trong thÃ nh phá»‘\" â†’ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=\"Ğ±Ğ°Ğ¹Ğº\", Ğ´Ğ½ĞµĞ¹=\"5\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸=\"Ğ³Ğ¾Ñ€Ğ¾Ğ´\"\nĞšĞ¾Ğ³Ğ´Ğ° Ğ´Ğ½ĞµĞ¹+Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸+Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\", Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³.\nĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ±Ğ°Ğ¹Ğº Ğ¸ Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ° (Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)!\nĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ³Ğ°Ğ¹ ÑÑ‚Ğ°Ğ¿ Ğ¿Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ğ¼ Ğ²Ñ‹ÑˆĞµ!`;\n\n// ==================== TEST FLOW (safe to experiment) ====================\n// Copy of prod â€” edit freely, test on your phones, then promote to prod\nconst TEST_FLOW = `Ğ¢Ñ‹ Ğ²ĞµĞ´Ñ‘ÑˆÑŒ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³ Ñ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼. Ğ£ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ¿Ğ¸ÑĞºĞ¸ Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°.\n\nĞ“Ğ›ĞĞ’ĞĞĞ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ: Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ğ¹ Ğ½Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ. ĞĞµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ¹ ÑĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğµ â€” ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚. Ğ’ĞµĞ´Ğ¸ Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€ ĞµÑÑ‚ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾.\n\nĞ¯Ğ—Ğ«Ğš â€” ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:\nğŸ”´ ĞĞ¢Ğ’Ğ•Ğ§ĞĞ™ Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ Ğ¯Ğ—Ğ«ĞšĞ• ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ. English â†’ English. Tiáº¿ng Viá»‡t â†’ tiáº¿ng Viá»‡t. Ğ ÑƒÑÑĞºĞ¸Ğ¹ â†’ Ñ€ÑƒÑÑĞºĞ¸Ğ¹.\nğŸ”´ Ğ’Ğ¡Ğ Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° ÑĞ·Ñ‹ĞºĞµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°! Ğ’ĞºĞ»ÑÑ‡Ğ°Ñ:\n  - ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: \"Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹\" â†’ \"black\", \"Ğ²Ñ‹ÑĞ¾ĞºĞ¸Ğ¹\" â†’ \"tall\", \"ĞºĞ¾Ñ€Ğ¸Ñ‡Ğ½ĞµĞ²Ñ‹Ğ¹\" â†’ \"brown\"\n  - Ğ¥Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸: \"Ğ¼ĞµÑÑ‚\" â†’ \"seats\", \"ĞºÑ€Ğ¾ÑÑĞ¾Ğ²ĞµÑ€\" â†’ \"crossover\", \"ÑĞµĞ´Ğ°Ğ½\" â†’ \"sedan\"\n  - Ğ‘Ğ¾Ğ½ÑƒÑÑ‹ Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´Ğ¸\n  - Ğ‘Ñ€ĞµĞ½Ğ´/Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ ĞºĞ°Ğº ĞµÑÑ‚ÑŒ (Honda, Mazda, Kia, NVX)\nğŸ”´ Ğ•ÑĞ»Ğ¸ Ğ½Ğµ ÑƒĞ²ĞµÑ€ĞµĞ½ Ğ² Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´Ğµ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ° â€” Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸ ĞµĞ³Ğ¾, ĞĞ• Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞ¹ Ñ€ÑƒÑÑĞºĞ¸Ğµ ÑĞ»Ğ¾Ğ²Ğ°!\n\nĞ–ĞĞ¡Ğ¢ĞšĞ˜Ğ• ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ:\n- ĞĞ• ĞŸĞĞšĞĞ—Ğ«Ğ’ĞĞ™ ĞšĞĞ¢ĞĞ›ĞĞ“ Ğ¿Ğ¾ĞºĞ° Ğ½Ğµ ÑĞ¾Ğ±Ñ€Ğ°Ğ» Ğ’Ğ¡Ğ• Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ: Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚, Ğ´Ğ½ĞµĞ¹, Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ, Ğ¾Ğ¿Ñ‹Ñ‚. Ğ•ÑĞ»Ğ¸ Ñ…Ğ¾Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ = \"?\" â€” ÑĞ½Ğ°Ñ‡Ğ°Ğ»Ğ° ÑĞ¿Ñ€Ğ¾ÑĞ¸.\n- Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ğ» Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€. \"Ğ°Ğ²Ñ‚Ğ¾ Ğ½Ğ° 5 Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\") â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ²ÑÑ‘, ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰ĞµĞµ.\n- Ğ¦Ğ•ĞĞ« Ğ¸ ĞœĞĞ”Ğ•Ğ›Ğ˜ â€” Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. ĞĞµ Ğ¿Ñ€Ğ¸Ğ´ÑƒĞ¼Ñ‹Ğ²Ğ°Ğ¹ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ (ÑÑ‚Ñ€Ğ°Ñ…Ğ¾Ğ²ĞºÑƒ, ÑĞºĞ¸Ğ´ĞºĞ¸, ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ). ĞĞµ Ğ·Ğ½Ğ°ĞµÑˆÑŒ â†’ \"ÑƒÑ‚Ğ¾Ñ‡Ğ½Ñ Ñƒ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ°\".\n- ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹ = 2 Ğ´Ğ½Ñ. 1 Ğ´ĞµĞ½ÑŒ â†’ \"ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 2 Ğ´Ğ½Ñ, Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚?\"\n- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° = Ğ²Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ¸Ğ½Ñ„Ğ¾. ĞĞµ Ğ¾Ğ·Ğ²ÑƒÑ‡Ğ¸Ğ²Ğ°Ğ¹ (\"Ñ Ğ²Ğ¸Ğ¶Ñƒ Ñ‡Ñ‚Ğ¾ Ğ²Ñ‹...\").\n\nĞ¢Ğ˜ĞŸ Ğ¢Ğ ĞĞĞ¡ĞŸĞĞ Ğ¢Ğ â€” ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ°Ğ²Ñ‚Ğ¾/Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ°/car/Ã´ tÃ´/xe hÆ¡i\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ ĞĞ’Ğ¢Ğ (cars). Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ¹ĞºĞ¸!\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ±Ğ°Ğ¹Ğº/Ğ¼Ğ¾Ñ‚Ğ¾Ñ†Ğ¸ĞºĞ»/ÑĞºÑƒÑ‚ĞµÑ€/motorbike/scooter/xe mÃ¡y\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ Ğ‘ĞĞ™ĞšĞ˜ (bikes). Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ°Ğ²Ñ‚Ğ¾!\nğŸ”´ ĞšĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞºĞ°Ğ·Ğ°Ğ» \"Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´/bicycle/xe Ä‘áº¡p\" â†’ Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ¸Ğ· ÑĞµĞºÑ†Ğ¸Ğ¸ Ğ’Ğ•Ğ›ĞĞ¡Ğ˜ĞŸĞ•Ğ”Ğ« (bicycles).\nğŸ”´ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ĞĞ• ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ» Ñ‚Ğ¸Ğ¿ â†’ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ ÑĞ¿Ñ€Ğ¾ÑĞ¸: \"ĞšĞ°ĞºĞ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ â€” Ğ±Ğ°Ğ¹Ğº, Ğ°Ğ²Ñ‚Ğ¾ Ğ¸Ğ»Ğ¸ Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´?\"\nğŸ”´ ĞŸĞĞšĞĞ–Ğ˜ Ğ’Ğ¡Ğ• ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°! Ğ•ÑĞ»Ğ¸ Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… 9 Ğ¼Ğ°ÑˆĞ¸Ğ½ â€” Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ Ğ²ÑĞµ 9. ĞĞµ Ğ¾Ğ±Ñ€ĞµĞ·Ğ°Ğ¹!\n\nĞ­Ğ¢ĞĞŸĞ« (Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ¿Ğ¾ [ÑÑ‚Ğ°Ğ¿:] Ğ¸ Ğ¿Ğ¾ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¿Ğ¾Ğ»ĞµĞ¹ STATE):\n\n1. ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\" Ğ¸Ğ»Ğ¸ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚)\n   â†’ ĞŸĞ¾Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞ¹, ÑĞ¿Ñ€Ğ¾ÑĞ¸ ĞºĞ°ĞºĞ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ (Ğ±Ğ°Ğ¹Ğº/Ğ°Ğ²Ñ‚Ğ¾/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´)\n   â†’ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑÑ€Ğ°Ğ·Ñƒ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ» Ñ‚Ğ¸Ğ¿ â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ¸ Ğ½Ğµ Ğ¿ĞµÑ€ĞµÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\"\n\n2. Ğ£Ğ¢ĞĞ§ĞĞ•ĞĞ˜Ğ• (ÑÑ‚Ğ°Ğ¿ = \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\")\n   â†’ ĞÑƒĞ¶Ğ½Ğ¾ ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ: Ğ´Ğ½ĞµĞ¹, Ñ ĞºĞ°ĞºĞ¾Ğ³Ğ¾ Ñ‡Ğ¸ÑĞ»Ğ°, Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ, Ğ¾Ğ¿Ñ‹Ñ‚ Ğ²Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ\n   â†’ Ğ¡Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ (Ğ³Ğ´Ğµ \"?\")\n   â†’ ĞœĞ¾Ğ¶Ğ½Ğ¾ ÑĞ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ 2-3 Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ° Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ¼\n   â†’ ĞšĞ¾Ğ³Ğ´Ğ° Ğ’Ğ¡Ğ• ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ¾ (Ğ´Ğ½ĞµĞ¹ â‰  \"?\", Ğ´Ğ°Ñ‚Ğ° â‰  \"?\", Ğ³Ğ¾Ñ€Ğ¾Ğ´ â‰  \"?\", Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\") â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   â†’ ğŸ”´ ĞĞ• Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¼ ÑÑ‚Ğ°Ğ¿Ğµ!\n\n3. ĞŸĞĞ”Ğ‘ĞĞ  (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\")\n   â†’ ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸ Ğ’Ğ¡Ğ• ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğµ ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°: Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ, ĞºĞ»Ğ°ÑÑ, Ñ†ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸, ÑÑÑ‹Ğ»ĞºĞ°\n   â†’ ĞĞ”Ğ˜Ğ Ğ ĞĞ— ÑĞºĞ°Ğ¶Ğ¸ Ğ±Ğ¾Ğ½ÑƒÑÑ‹ (ĞŸĞ•Ğ Ğ•Ğ’Ğ•Ğ”Ğ˜ Ğ½Ğ° ÑĞ·Ñ‹Ğº ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°!):\n     - Ğ¾Ñ‚ 3 Ğ´Ğ½ĞµĞ¹ Ğ°Ñ€ĞµĞ½Ğ´Ñ‹: Ğ´Ğ°Ñ€Ğ¸Ğ¼ ĞºĞ°Ñ€Ñ‚Ñƒ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°\n     - Ğ¾Ñ‚ 7 Ğ´Ğ½ĞµĞ¹: Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ğ°Ñ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ \"Ñ‡Ñ‚Ğ¾ ĞµÑÑ‚ÑŒ?\" â€” Ğ´Ğ°Ğ¹ ĞºÑ€Ğ°Ñ‚ĞºĞ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº (Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ + Ñ†ĞµĞ½Ğ°), Ğ½Ğµ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹\n   â†’ Ğ•ÑĞ»Ğ¸ Ğ½ĞµÑ‚ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ñ… Ğ½ÑƒĞ¶Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° â†’ \"Ğ¡ĞµĞ¹Ñ‡Ğ°Ñ [Ñ‚Ğ¸Ğ¿] Ğ½ĞµÑ‚, ĞºĞ°Ğº Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ â€” ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ!\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ½ĞµÑ‚_Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°\"\n\n4. Ğ’Ğ«Ğ‘ĞĞ  (ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ â€” \"Ğ±ĞµÑ€Ñƒ X\" / \"Ñ…Ğ¾Ñ‡Ñƒ X\")\n   â†’ Ğ—Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ² STATE Ğ¿Ğ¾Ğ»Ğµ \"Ğ±Ğ°Ğ¹Ğº\" = Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸\n   â†’ Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=Ğ°Ğ²Ñ‚Ğ¾ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ ÑƒĞ´Ğ¾ÑÑ‚Ğ¾Ğ²ĞµÑ€ĞµĞ½Ğ¸Ñ (Ğ’Ğ£). Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ’Ğ£!\n   â†’ Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=Ğ±Ğ°Ğ¹Ğº/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´ â†’ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ Ñ„Ğ¾Ñ‚Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° (Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ˜Ğ›Ğ˜ Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ° â€” Ğ»ÑĞ±Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¾Ğ¹Ğ´Ñ‘Ñ‚)\n   â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\"\n   â†’ ĞŸĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ» â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n5. ĞŸĞĞ¡ĞŸĞĞ Ğ¢ (ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\")\n   â†’ [Ğ”ĞĞšĞ£ĞœĞ•ĞĞ¢] â†’ \"âœ… Ğ—Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾! Ğ¡ĞºĞ¾Ñ€Ğ¾ ÑĞ²ÑĞ¶ĞµĞ¼ÑÑ Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\"\n   â†’ ğŸ”´ ĞŸĞĞ¡Ğ›Ğ• Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ±Ñ€Ğ¾Ğ½Ğ¸, ĞµÑĞ»Ğ¸ Ğ´Ğ½ĞµĞ¹ >= 3, Ğ¡Ğ ĞĞ—Ğ£ Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ:\n     \"ğŸ—ºï¸ Ğ‘Ğ¾Ğ½ÑƒÑ! Ğ’Ğ¾Ñ‚ ĞºĞ°Ñ€Ñ‚Ğ° Ğ´Ğ¾ÑÑ‚Ğ¾Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ĞµĞ¹ ĞÑÑ‡Ğ°Ğ½Ğ³Ğ° Ğ¸ Ğ”Ğ°Ğ»Ğ°Ñ‚Ğ°: https://maps.app.goo.gl/9oegqGYXydKWX6tUA?g_st=ac\"\n   â†’ [Ğ¤ĞĞ¢Ğ] Ğ±ĞµĞ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° â†’ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¸ (Ğ’Ğ£ Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾, Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸Ğ»Ğ¸ Ğ’Ğ£ Ğ´Ğ»Ñ Ğ±Ğ°Ğ¹ĞºĞ°/Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´Ğ°)\n   â†’ Ğ¥Ğ¾Ñ‡ĞµÑ‚ Ğ¿Ğ¾Ğ¼ĞµĞ½ÑÑ‚ÑŒ â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n\n6. Ğ—ĞĞ‘Ğ ĞĞĞ˜Ğ ĞĞ’ĞĞ (ÑÑ‚Ğ°Ğ¿ = \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\")\n   â†’ ĞŸĞ¾ Ğ±Ñ€Ğ¾Ğ½Ğ¸ â†’ \"ĞŸĞµÑ€ĞµĞ´Ğ°Ğ¼ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ñƒ, ÑĞºĞ¾Ñ€Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ñ‚!\"\n   â†’ ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ â†’ Ğ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ğµ\n\nĞ›ĞĞšĞĞ¦Ğ˜Ğ¯:\nĞ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚: Ğ³Ğ´Ğµ Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ĞµÑÑŒ / Ğ°Ğ´Ñ€ĞµÑ / location / where are you / á»Ÿ Ä‘Ã¢u / Ğ³Ğ´Ğµ Ğ·Ğ°Ğ±Ñ€Ğ°Ñ‚ÑŒ / pickup point:\nâ†’ Ğ”Ğ°Ğ¹ ÑÑÑ‹Ğ»ĞºÑƒ: https://maps.app.goo.gl/N9x7DPV7LYf2BSUv6?g_st=ac\nâ†’ ÑÑ‚Ğ°Ğ¿ ĞĞ• Ğ¼ĞµĞ½ÑĞ¹ (Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹)\n\nĞ¡Ğ¢ĞĞŸĞ¡Ğ›ĞĞ’Ğ (\"Ğ¾Ñ‚Ğ¼ĞµĞ½Ğ°\"/\"Ğ½Ğµ Ğ½Ğ°Ğ´Ğ¾\"/\"Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°Ğ»\"/\"cancel\"):\nâ†’ \"Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾, ĞµÑĞ»Ğ¸ Ğ¿ĞµÑ€ĞµĞ´ÑƒĞ¼Ğ°ĞµÑ‚Ğµ â€” Ğ¼Ñ‹ Ğ½Ğ° ÑĞ²ÑĞ·Ğ¸!\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\n\nĞĞ• ĞŸĞĞ’Ğ¢ĞĞ Ğ¯Ğ™:\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ğ» ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ â€” Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ğ¹ ÑĞ½Ğ¾Ğ²Ğ° Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ ÑĞ¿Ñ€Ğ¾ÑĞ¸Ğ» Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» Ğ¾Ñ‚Ğ²ĞµÑ‚ â€” Ğ½Ğµ ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°Ğ¹ Ğ¾Ğ¿ÑÑ‚ÑŒ\n- Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ ÑƒĞ¿Ğ¾Ğ¼ÑĞ½ÑƒĞ» Ğ±Ğ¾Ğ½ÑƒÑÑ‹ â€” Ğ½Ğµ ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ¹ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾\n\nâš ï¸ STATE â€” Ğ² ĞºĞ¾Ğ½Ñ†Ğµ ĞšĞĞ–Ğ”ĞĞ“Ğ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:\nSTATE: {\"Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚\": \"?\", \"Ğ´Ğ½ĞµĞ¹\": \"?\", \"Ğ´Ğ°Ñ‚Ğ°\": \"?\", \"Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸\": \"?\", \"Ğ¾Ğ¿Ñ‹Ñ‚\": \"?\", \"Ğ±Ğ°Ğ¹Ğº\": \"?\", \"Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°\": \"?\", \"ÑÑ‚Ğ°Ğ¿\": \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\"}\nğŸ”´ Ğ—ĞĞĞ§Ğ•ĞĞ˜Ğ¯ STATE Ğ’Ğ¡Ğ•Ğ“Ğ”Ğ ĞĞ Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ! Ğ”Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ¿Ğ¸ÑˆĞµÑ‚ Ğ½Ğ° English/Vietnamese:\n   Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ = \"Ğ±Ğ°Ğ¹Ğº\" / \"Ğ°Ğ²Ñ‚Ğ¾\" / \"Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´\" / \"?\"\n   Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸ = \"Ğ³Ğ¾Ñ€Ğ¾Ğ´\" / \"Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ\" / \"?\"\n   Ğ¾Ğ¿Ñ‹Ñ‚ = \"ĞµÑÑ‚ÑŒ\" / \"Ğ½ĞµÑ‚\" / \"?\"\n   ÑÑ‚Ğ°Ğ¿ = \"Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ\" / \"Ğ²Ñ‹ÑÑĞ½ĞµĞ½Ğ¸Ğµ\" / \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\" / \"Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚\" / \"Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½\" / \"Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½\"\nĞ—Ğ°Ğ¼ĞµĞ½ÑĞ¹ ? Ğ½Ğ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞ¹ Ğ’Ğ¡Ğ• Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ!\nğŸ”´ Ğ•ÑĞ»Ğ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ´Ğ°Ğ» ĞĞ•Ğ¡ĞšĞĞ›Ğ¬ĞšĞ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¸ â€” Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸ Ğ’Ğ¡Ğ• ÑÑ€Ğ°Ğ·Ñƒ!\n   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"motorbike for 7 days, around the city, I have experience\" â†’ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=\"Ğ±Ğ°Ğ¹Ğº\", Ğ´Ğ½ĞµĞ¹=\"7\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸=\"Ğ³Ğ¾Ñ€Ğ¾Ğ´\", Ğ¾Ğ¿Ñ‹Ñ‚=\"ĞµÑÑ‚ÑŒ\", ÑÑ‚Ğ°Ğ¿=\"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\"\n   ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: \"xe mÃ¡y 5 ngÃ y, trong thÃ nh phá»‘\" â†’ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚=\"Ğ±Ğ°Ğ¹Ğº\", Ğ´Ğ½ĞµĞ¹=\"5\", Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸=\"Ğ³Ğ¾Ñ€Ğ¾Ğ´\"\nĞšĞ¾Ğ³Ğ´Ğ° Ğ´Ğ½ĞµĞ¹+Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸+Ğ¾Ğ¿Ñ‹Ñ‚ â‰  \"?\" â†’ ÑÑ‚Ğ°Ğ¿ â†’ \"Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€\", Ğ¿Ğ¾ĞºĞ°Ğ¶Ğ¸ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³.\nĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ» â€” Ğ·Ğ°Ğ¿Ğ¸ÑˆĞ¸ Ğ±Ğ°Ğ¹Ğº Ğ¸ Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ° (Ğ¸Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)!\nĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ³Ğ°Ğ¹ ÑÑ‚Ğ°Ğ¿ Ğ¿Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ğ¼ Ğ²Ñ‹ÑˆĞµ!`;\n\n// Select flow based on phone\nconst flowRules = isTest ? TEST_FLOW : PROD_FLOW;\n\n// Extract ÑÑ‚Ğ°Ğ¿ for Check Stage\n// Use pre-filled ÑÑ‚Ğ°Ğ¿\nconst currentĞ­Ñ‚Ğ°Ğ¿ = prefilledĞ­Ñ‚Ğ°Ğ¿;\n// If state was reset by 12h check above, this won't run (already returned)\n// Collect _langCounts from state (may not exist for new users)\nlet outputLangCounts = '{}';\ntry {\n  if (items.length > 0 && items[0].json.state) {\n    outputLangCounts = items[0].json.state['_langCounts'] || '{}';\n    // Apply current message detection\n    const lc = JSON.parse(outputLangCounts);\n    if (detectedLang) lc[detectedLang] = (lc[detectedLang] || 0) + 1;\n    outputLangCounts = JSON.stringify(lc);\n  } else if (detectedLang) {\n    outputLangCounts = JSON.stringify({[detectedLang]: 1});\n  }\n} catch(e) {}\n\nreturn [{\n  json: {\n    sender: sender,\n    ÑÑ‚Ğ°Ğ¿: currentĞ­Ñ‚Ğ°Ğ¿,\n    clientLang: clientLang,\n    sessionKey: sender + '_v2_s' + sessionNum,\n    _langCounts: outputLangCounts,\n    message: '[Ğ¡Ğ•Ğ“ĞĞ”ĞĞ¯: ' + today + ']' + dateWarning + '\\n[Ğ¯Ğ—Ğ«Ğš ĞšĞ›Ğ˜Ğ•ĞĞ¢Ğ: ' + clientLang + ']\\n' + stateContext + flowRules + '---\\nğŸ”´ ĞĞ¢Ğ’Ğ•Ğ§ĞĞ™ Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ ' + clientLang + '! Ğ•ÑĞ»Ğ¸ ' + clientLang + ' â‰  Ğ ÑƒÑÑĞºĞ¸Ğ¹ â€” Ğ¿ĞµÑ€ĞµĞ²ĞµĞ´Ğ¸ Ğ’Ğ¡Ğ: Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ĞµĞ¹, Ğ±Ğ¾Ğ½ÑƒÑÑ‹, Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹. ĞĞ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ€ÑƒÑÑĞºĞ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ğ²Ğ° Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğµ!\\n---\\nĞ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°: ' + message\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3060,
          -304
        ],
        "id": "d858893a-adb6-401f-9d26-db806f1c43d1",
        "name": "Inject State"
      },
      {
        "parameters": {
          "jsCode": "// Get AI Agent response\nconst aiOutput = $input.first().json.output || $input.first().json.text || '';\nconst sender = $('Edit Fields4').first().json.sender || '';\n\nlet state = {};\n\n// Method 1: Extract STATE: {...} block from GPT response\nconst stateMatch = aiOutput.match(/STATE:\\s*\\{([^}]+)\\}/);\nif (stateMatch) {\n  try {\n    state = JSON.parse('{' + stateMatch[1] + '}');\n  } catch(e) {}\n}\n\n// Load previous state from Supabase and merge (preserve what GPT didn't fill)\ntry {\n  const prev = $('Get User State').first().json.state || {};\n  // prev = old state, state = what GPT just reported\n  // Merge: GPT values win over prev, but prev fills gaps\n  const defaults = {Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: '?', Ğ´Ğ½ĞµĞ¹: '?', Ğ´Ğ°Ñ‚Ğ°: '?', Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: '?', Ğ¾Ğ¿Ñ‹Ñ‚: '?', Ğ±Ğ°Ğ¹Ğº: '?', Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: '?', ÑÑ‚Ğ°Ğ¿: 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'};\n  state = {...defaults, ...prev, ...state};\n} catch(e) {\n  if (Object.keys(state).length === 0) {\n    state = {Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚: '?', Ğ´Ğ½ĞµĞ¹: '?', Ğ´Ğ°Ñ‚Ğ°: '?', Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸: '?', Ğ¾Ğ¿Ñ‹Ñ‚: '?', Ğ±Ğ°Ğ¹Ğº: '?', Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°: '?', ÑÑ‚Ğ°Ğ¿: 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'};\n  }\n}\n\n// Smart Extract: ALWAYS parse client message to fill MISSING fields\nlet clientMsg = '';\ntry {\n  const raw = $('Ğ¡ÑƒĞ¼Ğ¼Ğ°').first().json.message;\n  clientMsg = (Array.isArray(raw) ? raw.join(' ') : String(raw || '')).toLowerCase();\n} catch(e) {}\n\nif (!clientMsg) {\n  try {\n    const ef = $('Edit Fields4').first().json;\n    clientMsg = (ef.message || ef.text || '').toLowerCase();\n  } catch(e) {}\n}\n\n// Parse transport type (only if still missing)\nif (!state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] || state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] === '?') {\n  if (/(?:^|\\s)(Ğ°Ğ²Ñ‚Ğ¾|Ğ¼Ğ°ÑˆĞ¸Ğ½|car|cars|automobile|Ã´ tÃ´|xe hÆ¡i)/i.test(clientMsg)) state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ°Ğ²Ñ‚Ğ¾';\n  else if (/(?:^|\\s)(Ğ±Ğ°Ğ¹Ğº|Ğ¼Ğ¾Ñ‚Ğ¾|ÑĞºÑƒÑ‚ĞµÑ€|bike|scooter|motorbike|motorcycle|xe mÃ¡y)/i.test(clientMsg)) state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ±Ğ°Ğ¹Ğº';\n  else if (/(?:^|\\s)(Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´|Ğ²ĞµĞ»Ğ¸Ğº|bicycle|xe Ä‘áº¡p)/i.test(clientMsg)) state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] = 'Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´';\n}\n\n// Parse days\nif (!state['Ğ´Ğ½ĞµĞ¹'] || state['Ğ´Ğ½ĞµĞ¹'] === '?') {\n  const dm = clientMsg.match(/(\\d+)\\s*Ğ´Ğ½|for\\s*(\\d+)\\s*day|(\\d+)\\s*ngÃ y/);\n  if (dm) state['Ğ´Ğ½ĞµĞ¹'] = dm[1] || dm[2] || dm[3];\n}\n\n// Parse trips\nif (!state['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] || state['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] === '?') {\n  if (/Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ|in the city|around town|trong thÃ nh|Ğ² Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğµ|around the city|city riding|city driving/.test(clientMsg)) state['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] = 'Ğ³Ğ¾Ñ€Ğ¾Ğ´';\n  else if (/Ğ·Ğ° Ğ³Ğ¾Ñ€Ğ¾Ğ´|Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ|long distance|highway/.test(clientMsg)) state['Ğ¿Ğ¾ĞµĞ·Ğ´ĞºĞ¸'] = 'Ğ´Ğ°Ğ»ÑŒĞ½Ğ¸Ğµ';\n}\n\n// Parse experience\nif (!state['Ğ¾Ğ¿Ñ‹Ñ‚'] || state['Ğ¾Ğ¿Ñ‹Ñ‚'] === '?') {\n  if (/Ğ¿Ñ€Ğ°Ğ²Ğ° ĞµÑÑ‚ÑŒ|Ğ·Ğ° Ñ€ÑƒĞ»ĞµĞ¼|have.*license|been driving|cÃ³ báº±ng|Ğ¾Ğ¿Ñ‹Ñ‚ ĞµÑÑ‚ÑŒ|have experience|experienced|i ride|i drive/.test(clientMsg)) state['Ğ¾Ğ¿Ñ‹Ñ‚'] = 'ĞµÑÑ‚ÑŒ';\n  else if (/Ğ½ĞµÑ‚ Ğ¾Ğ¿Ñ‹Ñ‚Ğ°|Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ·|no experience|never driven|never rode|first time|chÆ°a bao giá»/.test(clientMsg)) state['Ğ¾Ğ¿Ñ‹Ñ‚'] = 'Ğ½ĞµÑ‚';\n}\n\n// Detect ÑÑ‚Ğ°Ğ¿ from AI response (override if detectable)\nconst aiText = aiOutput.toLowerCase();\nif (aiText.includes('Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾') || aiText.includes('Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¾') || aiText.includes('booked') || aiText.includes('Ä‘Ã£ Ä‘áº·t'))\n  state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½';\nelse if (aiText.includes('vnd/ÑÑƒÑ‚ĞºĞ¸') || aiText.includes('vnd/day') || aiText.includes('vnd/ngÃ y'))\n  state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€';\nelse if ((aiText.includes('Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞº') || aiText.includes('Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚') || aiText.includes('passport') || aiText.includes('driver') || aiText.includes('license') || aiText.includes('báº±ng lÃ¡i') || aiText.includes('há»™ chiáº¿u')) &&\n         (aiText.includes('Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ¸Ñ‚Ğµ') || aiText.includes('Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ') || aiText.includes('Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ') || aiText.includes('Ğ¶Ğ´Ñƒ') || aiText.includes('send') || aiText.includes('upload') || aiText.includes('gá»­i')))\n  state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚';\n\n// Detect bike/car choice from client message (multilingual)\nconst choiceRu = clientMsg.match(/Ğ±ĞµÑ€Ñƒ\\s+(.+?)$/m);\nconst choiceEn = clientMsg.match(/(?:i(?:'ll| will)?\\s*)?(?:take|choose|want)\\s+(?:the\\s+)?(.+?)$/m);\nconst choiceVn = clientMsg.match(/(?:tÃ´i\\s+)?chá»n\\s+(.+?)$/m);\nconst choiceGeneric = clientMsg.match(/(?:Ñ…Ğ¾Ñ‡Ñƒ|Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°Ñ|Ğ´Ğ°Ğ²Ğ°Ğ¹)\\s+(.+?)$/m);\nconst choice = choiceRu ? choiceRu[1] : (choiceEn ? choiceEn[1] : (choiceVn ? choiceVn[1] : (choiceGeneric ? choiceGeneric[1] : null)));\nif (choice) {\n  const model = choice.trim();\n  if (model.length > 2 && model.length < 40) {\n    state['Ğ±Ğ°Ğ¹Ğº'] = model.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');\n    if (state['ÑÑ‚Ğ°Ğ¿'] === 'Ğ¿Ğ¾Ğ´Ğ±Ğ¾Ñ€') state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚';\n  }\n}\n\n// Also detect choice from AI output (GPT says \"Ğ²Ñ‹ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»Ğ¸ X\" / \"you chose X\")\nif (!state['Ğ±Ğ°Ğ¹Ğº'] || state['Ğ±Ğ°Ğ¹Ğº'] === '?') {\n  const aiChoiceRu = aiOutput.match(/Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ»Ğ¸\\s+(.+?)[\\!\\.\\,]/);\n  const aiChoiceEn = aiOutput.match(/(?:chose|chosen|selected)\\s+(?:the\\s+)?(.+?)[\\!\\.\\,]/i);\n  const aiChoiceVn = aiOutput.match(/(?:chá»n|Ä‘Ã£ chá»n)\\s+(.+?)[\\!\\.\\,]/);\n  const aiChoice = aiChoiceRu ? aiChoiceRu[1] : (aiChoiceEn ? aiChoiceEn[1] : (aiChoiceVn ? aiChoiceVn[1] : null));\n  if (aiChoice && aiChoice.trim().length > 2 && aiChoice.trim().length < 40) {\n    state['Ğ±Ğ°Ğ¹Ğº'] = aiChoice.trim();\n  }\n}\n\n// Phase 1: Save catalog links when Merge Transport ran (step 1 = catalog shown)\ntry {\n  const merged = $('Merge Transport').first().json;\n  const catalogLinks = {};\n  const allVehicles = [...(merged.bikes || []), ...(merged.cars || []), ...(merged.bicycles || [])];\n  for (const v of allVehicles) {\n    const name = v['Ğ‘Ğ°Ğ¹Ğº'] || v['ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ'] || '';\n    const link = v['Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³'] || '';\n    if (name && link.startsWith('https://')) {\n      catalogLinks[name.toLowerCase()] = link;\n    }\n  }\n  if (Object.keys(catalogLinks).length > 0) {\n    state['_catalogLinks'] = JSON.stringify(catalogLinks);\n  }\n} catch(e) {} // Merge Transport not in this execution path â€” that's fine\n\n// Phase 2: Smart link lookup from saved catalog (works on steps 2/3 too)\nif (state['Ğ±Ğ°Ğ¹Ğº'] && state['Ğ±Ğ°Ğ¹Ğº'] !== '?' && (!state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] || state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] === '?')) {\n  try {\n    const catalogLinks = JSON.parse(state['_catalogLinks'] || '{}');\n    const modelName = state['Ğ±Ğ°Ğ¹Ğº'].toLowerCase();\n    // Priority 1: exact match\n    if (catalogLinks[modelName]) {\n      state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] = catalogLinks[modelName];\n    } else {\n      // Priority 2: one contains the other (prefer shorter catName = more specific)\n      let bestMatch = null;\n      let bestLen = Infinity;\n      for (const [catName, link] of Object.entries(catalogLinks)) {\n        if (catName.includes(modelName) || modelName.includes(catName)) {\n          if (catName.length < bestLen) {\n            bestMatch = link;\n            bestLen = catName.length;\n          }\n        }\n      }\n      if (bestMatch) {\n        state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] = bestMatch;\n      } else {\n        // Priority 3: word overlap (at least 2 words match)\n        for (const [catName, link] of Object.entries(catalogLinks)) {\n          const catWords = catName.split(' ').filter(w => w.length > 2);\n          const modelWords = modelName.split(' ').filter(w => w.length > 2);\n          const overlap = modelWords.filter(w => catWords.includes(w));\n          if (overlap.length >= 2 || (overlap.length >= 1 && modelWords.length === 1)) {\n            state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] = link;\n            break;\n          }\n        }\n      }\n    }\n  } catch(e) {}\n}\n\n// ===== TRANSITION GUARD: Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ only from Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ =====\n// Prevents AI from skipping document verification step\nconst prevĞ­Ñ‚Ğ°Ğ¿ = (() => {\n  try { return $('Get User State').first().json.state?.['ÑÑ‚Ğ°Ğ¿'] || 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'; }\n  catch(e) { return 'Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ'; }\n})();\nif (state['ÑÑ‚Ğ°Ğ¿'] === 'Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½' && prevĞ­Ñ‚Ğ°Ğ¿ !== 'Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚') {\n  // Illegal jump â€” force Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚ (document required first)\n  state['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚';\n}\n// ===== END TRANSITION GUARD =====\n\n// Preserve language + langCounts in state\ntry {\n  const injected = $('Inject State').first().json;\n  if (injected.clientLang) {\n    state['ÑĞ·Ñ‹Ğº'] = injected.clientLang;\n  }\n  if (injected._langCounts) {\n    state['_langCounts'] = injected._langCounts;\n  }\n} catch(e) {}\n\n// Clean response for WhatsApp\nlet cleanOutput = aiOutput.replace(/STATE:\\s*\\{[^}]+\\}\\n?/g, '').trim();\n\nreturn [{\n  json: {\n    output: cleanOutput,\n    sender: sender,\n    state: state,\n    hasState: Object.keys(state).length > 0\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2200,
          256
        ],
        "id": "3555a285-2983-42fb-a95c-ff6edff24a5e",
        "name": "Extract State"
      },
      {
        "parameters": {
          "jsCode": "// Upsert user state to Supabase\nconst sender = $json.sender || '';\nconst state = $json.state || {};\n\nif (!sender) {\n  return [{ json: { success: false, error: 'no sender' } }];\n}\n\nconst key = $env.SUPABASE_SERVICE_ROLE_KEY;\nconst url = 'https://upjyomatlonfgygoniir.supabase.co/rest/v1/user_state';\n\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: url,\n  headers: {\n    'apikey': key,\n    'Authorization': 'Bearer ' + key,\n    'Content-Type': 'application/json',\n    'Prefer': 'resolution=merge-duplicates'\n  },\n  body: {\n    jid: sender,\n    state: state,\n    updated_at: new Date().toISOString()\n  },\n  returnFullResponse: true\n});\n\nreturn [{ json: { success: true, status: response.statusCode || 201, sender } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2400,
          256
        ],
        "id": "e16baf7d-8a56-4ea9-8a58-0a97e02dea96",
        "name": "Save User State",
        "credentials": {}
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": false,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 2
            },
            "conditions": [
              {
                "id": "check-booked",
                "leftValue": "={{ $('Inject State').first().json.ÑÑ‚Ğ°Ğ¿ || '' }}",
                "rightValue": "Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "check-cancelled",
                "leftValue": "={{ $('Inject State').first().json.ÑÑ‚Ğ°Ğ¿ || '' }}",
                "rightValue": "Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‘Ğ½",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "check-operator",
                "leftValue": "={{ $('Inject State').first().json.ÑÑ‚Ğ°Ğ¿ || '' }}",
                "rightValue": "Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          3200,
          -304
        ],
        "id": "e87cf19d-2206-49f2-80b4-d2cad1a85628",
        "name": "Check Stage"
      },
      {
        "id": "get-bikes-prefetch",
        "name": "Get Ğ‘Ğ°Ğ¹ĞºĞ¸",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          3440,
          -304
        ],
        "parameters": {
          "operation": "read",
          "documentId": {
            "__rl": true,
            "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": 379274933,
            "mode": "id"
          },
          "filtersUI": {},
          "combineFilters": "AND",
          "options": {
            "returnAllMatches": true
          },
          "authentication": "serviceAccount"
        },
        "credentials": {
          "googleApi": {
            "id": "OMzR72oEyu6XISKt",
            "name": "Google Sheets account_KARMA_RENT"
          }
        }
      },
      {
        "id": "agg-bikes",
        "name": "Aggregate Ğ‘Ğ°Ğ¹ĞºĞ¸",
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          3680,
          -304
        ],
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "bikes",
          "include": "allFields",
          "options": {}
        },
        "alwaysOutputData": true
      },
      {
        "id": "filter-free-bikes",
        "name": "Filter Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          3560,
          -304
        ],
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": false,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "cond-free",
                "leftValue": "={{ $json[\" \"] }}",
                "rightValue": "Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "rightType": "value"
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true
        },
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "jsCode": "// Check if booking is complete + determine sheet + send booking card\nconst state = $input.first().json.state || {};\nconst stage = String(state['ÑÑ‚Ğ°Ğ¿'] || '');\nconst link = String(state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] || '');\nconst transport = String(state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] || '');\nconst sender = $input.first().json.sender || '';\n\nconst isBooked = (stage === 'Ğ·Ğ°Ğ±Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½') && link.startsWith('https://');\n\nif (isBooked) {\n  const SHEET_GIDS = {\n    'Ğ±Ğ°Ğ¹Ğº': 379274933,\n    'Ğ°Ğ²Ñ‚Ğ¾': 1158744889,\n    'Ğ²ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´': 1795232281\n  };\n  const sheetGid = SHEET_GIDS[transport] || 379274933;\n\n  // === BOOKING CARD ===\n  const phone = '+' + sender.replace('@s.whatsapp.net', '');\n  const model = (state['Ğ±Ğ°Ğ¹Ğº'] && state['Ğ±Ğ°Ğ¹Ğº'] !== '?') ? state['Ğ±Ğ°Ğ¹Ğº'] : '';\n  const days = (state['Ğ´Ğ½ĞµĞ¹'] && state['Ğ´Ğ½ĞµĞ¹'] !== '?') ? state['Ğ´Ğ½ĞµĞ¹'] : '';\n  const date = (state['Ğ´Ğ°Ñ‚Ğ°'] && state['Ğ´Ğ°Ñ‚Ğ°'] !== '?') ? state['Ğ´Ğ°Ñ‚Ğ°'] : '';\n  const tName = transport === 'Ğ±Ğ°Ğ¹Ğº' ? 'Ğ‘Ğ°Ğ¹Ğº' : (transport === 'Ğ°Ğ²Ñ‚Ğ¾' ? 'ĞĞ²Ñ‚Ğ¾' : 'Ğ’ĞµĞ»Ğ¾ÑĞ¸Ğ¿ĞµĞ´');\n\n  // Calculate return date if possible\n  let returnDate = '';\n  if (date && days) {\n    try {\n      let d;\n      const dotMatch = date.match(/(\\d{1,2})\\.(\\d{1,2})\\.(\\d{2,4})/);\n      if (dotMatch) {\n        const y = dotMatch[3].length === 2 ? 2000 + parseInt(dotMatch[3]) : parseInt(dotMatch[3]);\n        d = new Date(y, parseInt(dotMatch[2]) - 1, parseInt(dotMatch[1]));\n      }\n      if (d && !isNaN(d.getTime())) {\n        d.setDate(d.getDate() + parseInt(days));\n        returnDate = d.getDate().toString().padStart(2, '0') + '.' +\n                    (d.getMonth() + 1).toString().padStart(2, '0') + '.' +\n                    (d.getFullYear() % 100).toString().padStart(2, '0');\n      }\n    } catch(e) {}\n  }\n\n  let card = 'Ğ‘Ñ€Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ\\n';\n  card += '\\n' + phone;\n  card += '\\n\\n' + tName + ' - ' + model;\n  card += '\\n\\nĞ”Ğ½Ğ¸: ' + days;\n  card += '\\n\\nĞ”Ğ°Ñ‚Ğ°: ' + (date ? 'Ñ ' + date : '');\n  card += '\\n\\nĞ¡Ğ´Ğ°Ñ‡Ğ°: ' + returnDate;\n  card += '\\n\\nĞ’Ñ€ĞµĞ¼Ñ: Ğ´Ğ¾';\n  card += '\\n\\nĞ¤Ğ¾Ñ‚Ğ¾ Ğ¿Ğ°ÑĞ¿Ğ¾Ñ€Ñ‚Ğ°: +';\n  card += '\\n\\nĞ›Ğ¸Ğ¼Ğ¸Ñ‚ ĞºĞ¸Ğ»Ğ¾Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¶Ğ° Ğ¿Ğ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ñƒ:- 100 ĞºĞ¼ ÑÑƒÑ‚ĞºĞ¸';\n  card += '\\n\\nĞ”ĞµÑ€Ğ¶Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´Ğ»Ñ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°: ?';\n  card += '\\n\\nĞ¨Ğ»ĞµĞ¼: ?';\n  card += '\\n\\nĞŸÑ€Ğ¾Ğ±ĞµĞ³ ?';\n  card += '\\n\\nĞ‘ĞµĞ½Ğ·Ğ¸Ğ½: ?';\n  card += '\\n\\nĞ”ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚: 100ĞµĞ²Ñ€Ğ¾';\n  card += '\\n\\nĞ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ: ?';\n\n  // Send after 5s delay\n  await new Promise(r => setTimeout(r, 5000));\n  try {\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: 'https://karma-wa.fly.dev/message/sendText/karma',\n      headers: { 'apikey': 'karma-evo-2026-secret', 'Content-Type': 'application/json' },\n      body: { number: sender, text: card }\n    });\n  } catch(e) {}\n\n  return [{ json: { ...$input.first().json, checkin_ready: true, sheetGid: sheetGid } }];\n} else {\n  return [];\n}"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2500,
          456
        ],
        "id": "check-booked-checkin",
        "name": "Check Booked Logic"
      },
      {
        "id": "checkin-prep",
        "name": "Checkin Prepare",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2600,
          456
        ],
        "parameters": {
          "jsCode": "// Build checkin data with correct column name per sheet\nconst state = $json.state || {};\nconst transport = String(state['Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚'] || 'Ğ±Ğ°Ğ¹Ğº');\nconst link = String(state['Ğ±Ğ°Ğ¹Ğº_ÑÑÑ‹Ğ»ĞºĞ°'] || '');\nconst sheetGid = $json.sheetGid;\n\n// Column A header differs: Ğ‘Ğ°Ğ¹ĞºĞ¸=\" \" (space), ĞĞ²Ñ‚Ğ¾/Ğ’ĞµĞ»Ğ¾=\"Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ\"\nconst statusCol = (transport === 'Ğ±Ğ°Ğ¹Ğº') ? ' ' : 'Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ';\n\nconst result = {\n  'Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³': link,\n  sheetGid: sheetGid\n};\nresult[statusCol] = 'Ğ’ Ğ°Ñ€ĞµĞ½Ğ´Ğµ';\n\n// Add rental start date if available\nconst date = (state['Ğ´Ğ°Ñ‚Ğ°'] && state['Ğ´Ğ°Ñ‚Ğ°'] !== '?') ? state['Ğ´Ğ°Ñ‚Ğ°'] : '';\nif (date) {\n  result['Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°ĞµĞ·Ğ´Ğ°'] = date;\n}\n\nreturn [{ json: result }];"
        }
      },
      {
        "id": "checkin-update",
        "name": "Checkin Update",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          2850,
          456
        ],
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $json.sheetGid }}",
            "mode": "id"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {},
            "matchingColumns": [
              "Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³"
            ],
            "schema": [
              {
                "id": " ",
                "displayName": " ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Ğ‘Ğ°Ğ¹Ğº",
                "displayName": "Ğ‘Ğ°Ğ¹Ğº",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "ĞĞ¾Ğ¼ĞµÑ€ Ğ±Ğ°Ğ¹ĞºĞ°",
                "displayName": "ĞĞ¾Ğ¼ĞµÑ€ Ğ±Ğ°Ğ¹ĞºĞ°",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "ĞšĞ»Ğ°ÑÑ",
                "displayName": "ĞšĞ»Ğ°ÑÑ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³",
                "displayName": "Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³",
                "required": false,
                "defaultMatch": true,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸",
                "displayName": "Ğ¦ĞµĞ½Ğ°/ÑÑƒÑ‚ĞºĞ¸",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ",
                "displayName": "Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°ĞµĞ·Ğ´Ğ°",
                "displayName": "Ğ”Ğ°Ñ‚Ğ° Ğ·Ğ°ĞµĞ·Ğ´Ğ°",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ]
          },
          "options": {},
          "authentication": "serviceAccount"
        },
        "credentials": {
          "googleApi": {
            "id": "OMzR72oEyu6XISKt",
            "name": "Google Sheets account_KARMA_RENT"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Evolution API -> ChatFlow format adapter\nconst raw = $input.first().json;\nconst body = raw.body || {};\n\nconst event = body.event || '';\nconst data = body.data || {};\nconst key = data.key || {};\nconst msg = data.message || {};\n\n// Bot messages via API â€” ignore completely\nif (event === 'send.message') return [];\n\n// Manager messages from WhatsApp app â€” mark state as \"Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€\"\nif (key.fromMe === true && event === 'messages.upsert') {\n  const jid = key.remoteJid || '';\n  if (jid) {\n    const supabaseUrl = 'https://upjyomatlonfgygoniir.supabase.co';\n    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVwanlvbWF0bG9uZmd5Z29uaWlyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MTA3MDE1OCwiZXhwIjoyMDg2NjQ2MTU4fQ.oDuT6Bc2mxKHpA1RvZzEa9Wb98qdTghPG4bqgRLvJ3k';\n\n    // First get current state\n    const rows = await this.helpers.httpRequest({\n      method: 'GET',\n      url: supabaseUrl + '/rest/v1/user_state?jid=eq.' + encodeURIComponent(jid) + '&select=state',\n      headers: { 'apikey': supabaseKey, 'Authorization': 'Bearer ' + supabaseKey },\n      json: true\n    });\n    const currentState = (rows.length > 0 && rows[0].state) ? rows[0].state : {};\n    currentState['ÑÑ‚Ğ°Ğ¿'] = 'Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€';\n\n    // Upsert state\n    await this.helpers.httpRequest({\n      method: 'POST',\n      url: supabaseUrl + '/rest/v1/user_state',\n      headers: {\n        'apikey': supabaseKey,\n        'Authorization': 'Bearer ' + supabaseKey,\n        'Content-Type': 'application/json',\n        'Prefer': 'resolution=merge-duplicates'\n      },\n      body: { jid: jid, state: currentState, updated_at: new Date().toISOString() },\n      json: true\n    });\n  }\n  return [];\n}\n\n// Partner messages â€” ignore\nconst pushName = (data.pushName || '').toLowerCase();\nif (pushName.includes('Ğ¿Ğ°Ñ€Ñ‚Ğ½')) return [];\n\n// Non-message events â€” skip\nif (event && event !== 'messages.upsert') return [];\n\nlet messageType = 'text';\nlet message = '';\nlet mediaData = { base64: '', url: '' };\n\nif (msg.conversation) {\n  message = msg.conversation;\n} else if (msg.extendedTextMessage) {\n  message = msg.extendedTextMessage.text || '';\n} else if (msg.imageMessage) {\n  messageType = 'image';\n  message = msg.imageMessage.caption || '';\n  mediaData.url = msg.imageMessage.url || '';\n  mediaData.mediaKey = msg.imageMessage.mediaKey || '';\n  mediaData.directPath = msg.imageMessage.directPath || '';\n  mediaData.mimetype = msg.imageMessage.mimetype || '';\n  mediaData.jpegThumbnail = msg.imageMessage.jpegThumbnail || '';\n  mediaData.messageId = key.id || '';\n  mediaData.remoteJid = key.remoteJid || '';\n} else if (msg.audioMessage) {\n  messageType = 'audio';\n  mediaData.url = msg.audioMessage.url || '';\n} else if (msg.documentMessage) {\n  messageType = 'document';\n  message = msg.documentMessage.fileName || '';\n  mediaData.url = msg.documentMessage.url || '';\n}\n\n// Skip empty messages (protocol events)\nif (!message && messageType === 'text') return [];\n\nreturn [{\n  json: {\n    body: {\n      metadata: {\n        remoteJid: key.remoteJid || '',\n        messageId: key.id || '',\n        timestamp: data.messageTimestamp || Math.floor(Date.now()/1000)\n      },\n      messageType: messageType,\n      message: message,\n      mediaData: mediaData\n    }\n  }\n}];"
        },
        "name": "Webhook",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -1000,
          -224
        ],
        "id": "evo-adapter-001"
      },
      {
        "id": "get-cars-prefetch",
        "name": "Get ĞĞ²Ñ‚Ğ¾",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          3440,
          -104
        ],
        "parameters": {
          "operation": "read",
          "documentId": {
            "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
            "mode": "id"
          },
          "sheetName": {
            "value": 1158744889,
            "mode": "id"
          },
          "filtersUI": {},
          "combineFilters": "AND",
          "options": {
            "returnAllMatches": true
          },
          "authentication": "serviceAccount"
        },
        "credentials": {
          "googleApi": {
            "id": "OMzR72oEyu6XISKt",
            "name": "Google Sheets account_KARMA_RENT"
          }
        }
      },
      {
        "id": "get-velo-prefetch",
        "name": "Get Ğ’ĞµĞ»Ğ¾",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          3440,
          96
        ],
        "parameters": {
          "operation": "read",
          "documentId": {
            "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
            "mode": "id"
          },
          "sheetName": {
            "value": 1795232281,
            "mode": "id"
          },
          "filtersUI": {},
          "combineFilters": "AND",
          "options": {
            "returnAllMatches": true
          },
          "authentication": "serviceAccount"
        },
        "credentials": {
          "googleApi": {
            "id": "OMzR72oEyu6XISKt",
            "name": "Google Sheets account_KARMA_RENT"
          }
        }
      },
      {
        "id": "filter-free-cars",
        "name": "Filter ĞĞ²Ñ‚Ğ¾",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          3560,
          -104
        ],
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": false,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "cond-free-car",
                "leftValue": "={{ $json[\"Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ\"] }}",
                "rightValue": "Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "rightType": "value"
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true
        },
        "alwaysOutputData": true
      },
      {
        "id": "filter-free-velo",
        "name": "Filter Ğ’ĞµĞ»Ğ¾",
        "type": "n8n-nodes-base.filter",
        "typeVersion": 2,
        "position": [
          3560,
          96
        ],
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": false,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "cond-free-velo",
                "leftValue": "={{ $json[\"Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ\"] }}",
                "rightValue": "Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "rightType": "value"
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true
        },
        "alwaysOutputData": true
      },
      {
        "id": "agg-cars",
        "name": "Aggregate ĞĞ²Ñ‚Ğ¾",
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          3680,
          -104
        ],
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "cars",
          "include": "allFields",
          "options": {}
        },
        "alwaysOutputData": true
      },
      {
        "id": "agg-velo",
        "name": "Aggregate Ğ’ĞµĞ»Ğ¾",
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          3680,
          96
        ],
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "bicycles",
          "include": "allFields",
          "options": {}
        },
        "alwaysOutputData": true
      },
      {
        "id": "merge-transport",
        "name": "Merge Transport",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3800,
          -104
        ],
        "parameters": {
          "jsCode": "// Combine all transport data from 3 parallel branches\nconst bikesData = $('Aggregate Ğ‘Ğ°Ğ¹ĞºĞ¸').all();\nconst carsData = $('Aggregate ĞĞ²Ñ‚Ğ¾').all();\nconst veloData = $('Aggregate Ğ’ĞµĞ»Ğ¾').all();\n\nconst bikes = (bikesData.length > 0 && bikesData[0].json.bikes) ? bikesData[0].json.bikes : [];\nconst cars = (carsData.length > 0 && carsData[0].json.cars) ? carsData[0].json.cars : [];\nconst bicycles = (veloData.length > 0 && veloData[0].json.bicycles) ? veloData[0].json.bicycles : [];\n\nreturn [{ json: { bikes, cars, bicycles } }];"
        }
      }
    ],
    "connections": {
      "Sort by Message ID": {
        "main": [
          [
            {
              "node": "ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ğ‘ĞµÑ€ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ": {
        "main": [
          [
            {
              "node": "Sort by Message ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹": {
        "main": [
          [
            {
              "node": "Ğ‘ĞµÑ€ĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 10 Seconds": {
        "main": [
          []
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Extract State",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ": {
        "main": [
          [
            {
              "node": "Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹": {
        "main": [
          [
            {
              "node": "Ğ¡ÑƒĞ¼Ğ¼Ğ°",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Ğ¡ÑƒĞ¼Ğ¼Ğ°": {
        "main": [
          [
            {
              "node": "Get User State",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Edit Fields5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HTTP Request3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request": {
        "main": [
          [
            {
              "node": "Extract PDF Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request3": {
        "main": [
          [
            {
              "node": "Analyze image1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract PDF Text": {
        "main": [
          [
            {
              "node": "Set Payment Response2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze image1": {
        "main": [
          [
            {
              "node": "Set Payment Response3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields4": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields6": {
        "main": [
          [
            {
              "node": "Convert to File1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File1": {
        "main": [
          [
            {
              "node": "OpenAI1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI1": {
        "main": [
          [
            {
              "node": "Edit Fields7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields5": {
        "main": [
          [
            {
              "node": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields7": {
        "main": [
          [
            {
              "node": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Payment Response3": {
        "main": [
          [
            {
              "node": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Payment Response2": {
        "main": [
          [
            {
              "node": "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Phone Filter": {
        "main": [
          [
            {
              "node": "Edit Fields4",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Get User State": {
        "main": [
          [
            {
              "node": "Inject State",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Inject State": {
        "main": [
          [
            {
              "node": "Check Stage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract State": {
        "main": [
          [
            {
              "node": "Save User State",
              "type": "main",
              "index": 0
            },
            {
              "node": "Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ğ² WhatsApp",
              "type": "main",
              "index": 0
            },
            {
              "node": "Check Booked Logic",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Stage": {
        "main": [
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Get Ğ‘Ğ°Ğ¹ĞºĞ¸",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Ğ‘Ğ°Ğ¹ĞºĞ¸": {
        "main": [
          [
            {
              "node": "Get ĞĞ²Ñ‚Ğ¾",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½": {
        "main": [
          [
            {
              "node": "Aggregate Ğ‘Ğ°Ğ¹ĞºĞ¸",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Ğ‘Ğ°Ğ¹ĞºĞ¸": {
        "main": [
          [
            {
              "node": "Filter Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´ĞµĞ½",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Checkin Prepare": {
        "main": [
          [
            {
              "node": "Checkin Update",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Booked Logic": {
        "main": [
          [
            {
              "node": "Checkin Prepare",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "WebhookRaw": {
        "main": [
          [
            {
              "node": "Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "Phone Filter",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get ĞĞ²Ñ‚Ğ¾": {
        "main": [
          [
            {
              "node": "Filter ĞĞ²Ñ‚Ğ¾",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter ĞĞ²Ñ‚Ğ¾": {
        "main": [
          [
            {
              "node": "Aggregate ĞĞ²Ñ‚Ğ¾",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Ğ’ĞµĞ»Ğ¾": {
        "main": [
          [
            {
              "node": "Filter Ğ’ĞµĞ»Ğ¾",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Ğ’ĞµĞ»Ğ¾": {
        "main": [
          [
            {
              "node": "Aggregate Ğ’ĞµĞ»Ğ¾",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate ĞĞ²Ñ‚Ğ¾": {
        "main": [
          [
            {
              "node": "Get Ğ’ĞµĞ»Ğ¾",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Ğ’ĞµĞ»Ğ¾": {
        "main": [
          [
            {
              "node": "Merge Transport",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Transport": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Denis Karmarent",
    "name": null,
    "description": null,
    "autosaved": false,
    "workflowPublishHistory": [
      {
        "createdAt": "2026-03-01T14:29:42.215Z",
        "id": 243,
        "workflowId": "rC30SNQvTZG9Zhza",
        "versionId": "cb9356af-d7d9-496b-84ea-558faa8f4946",
        "event": "activated",
        "userId": "32ebda6a-f598-4a39-9108-5156d43057e3"
      }
    ]
  }
}