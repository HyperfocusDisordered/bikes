{
  "updatedAt": "2026-02-20T20:14:48.058Z",
  "createdAt": "2026-02-20T13:11:32.879Z",
  "id": "rC30SNQvTZG9Zhza",
  "name": "Karma_Rent_Workers",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "tableId": "Message_Buffer",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $json.sender }}"
            },
            {
              "fieldId": "message",
              "fieldValue": "={{ $json.message }}"
            },
            {
              "fieldId": "message_id",
              "fieldValue": "={{ $('Webhook').item.json.body.metadata.messageId }}"
            },
            {
              "fieldId": "timestamp",
              "fieldValue": "={{ $('Webhook').item.json.body.metadata.timestamp }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1168,
        -304
      ],
      "id": "e56ae42c-9d2b-49f8-9e59-2353f6f874a6",
      "name": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
      "credentials": {
        "supabaseApi": {
          "id": "u1mkv2sS5oh337qr",
          "name": "Supabase Karma_Worker"
        }
      }
    },
    {
      "parameters": {
        "content": "–°–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞\n\n*¬†–ó–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è. –≤ —Ç–µ—á–µ–Ω–∏–∏ 10 —Å–µ–∫, –∏ –æ—Ç–≤–µ—á–∞–µ—Ç. –Ω–∞ –≤—Å–µ, –∞ –Ω–µ –ø–æ –æ–¥–Ω–æ–º—É",
        "height": 500,
        "width": 1896,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1120,
        -400
      ],
      "typeVersion": 1,
      "id": "50e9a8b6-46c8-4d74-babe-d3fe334e6ef6",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "timestamp",
              "order": "=ascending"
            }
          ]
        },
        "options": {}
      },
      "id": "3d1be0b3-5910-43eb-93df-57777209f978",
      "name": "Sort by Message ID",
      "type": "n8n-nodes-base.sort",
      "position": [
        1904,
        -176
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "Message_Buffer",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $('Webhook').item.json.body.metadata.remoteJid }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1648,
        -304
      ],
      "id": "5639a0b2-3528-445d-a6b2-04bdcc0196f6",
      "name": "–ë–µ—Ä–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è",
      "credentials": {
        "supabaseApi": {
          "id": "u1mkv2sS5oh337qr",
          "name": "Supabase Karma_Worker"
        }
      }
    },
    {
      "parameters": {
        "amount": 3
      },
      "id": "b7b93f28-25b0-4a6c-88dd-65462f02d4a3",
      "name": "Wait 10 Seconds",
      "type": "n8n-nodes-base.wait",
      "position": [
        1408,
        -144
      ],
      "webhookId": "87994c9a-fd20-48b6-8dbe-9af36dc40b2f",
      "typeVersion": 1.1
    },
    {
      "parameters": {},
      "id": "7ca8e5ed-45ee-4e10-9fc9-621725de64c3",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "position": [
        2480,
        -112
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "–°–±–æ—Ä –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n* –°–≤–≤–µ—Ä–∫–∞ —Å CRM\n* —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ ",
        "height": 632,
        "width": 1016,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1472,
        160
      ],
      "typeVersion": 1,
      "id": "9bd44ad0-6c47-40fe-b3ec-e6c8e6caa529",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Inject State').first().json.message + '\\n\\n–î–ê–ù–ù–´–ï –ë–ê–ô–ö–û–í (–∞–∫—Ç—É–∞–ª—å–Ω—ã–µ, –ø–æ–ª—è: –°–æ—Å—Ç–æ—è–Ω–∏–µ|–ú–æ–¥–µ–ª—å|–ù–æ–º–µ—Ä|–ö–ª–∞—Å—Å|–°—Å—ã–ª–∫–∞|–¶–µ–Ω–∞/—Å—É—Ç–∫–∏):\\n' + $json.bikes.map(b => Object.values(b).join(' | ')).join('\\n') }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=–¢—ã –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –∞—Ä–µ–Ω–¥–µ –±–∞–π–∫–æ–≤ KarmaRent –≥–æ—Ä–æ–¥–µ –ù—è—á–∞–Ω–≥. \n–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—à–∏–±–∞–µ—Ç—å—Å—è —Ç–æ –≥–æ–≤–æ—Ä–∏ —á—Ç–æ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ. –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –Ω–µ –Ω—É–∂–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –æ–± —ç—Ç–æ–º\n\n–ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–ø–æ–Ω–∏–º–∞–Ω–∏–µ ‚Äî –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä—É–π –≤–æ–ø—Ä–æ—Å. \n–î–æ–±–∞–≤–ª—è–π —Å–º–∞–π–ª–∏–∫–∏ —Ç–∞–º –≥–¥–µ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ, –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫ –∏¬† —Ç–∞–º –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ (–ë–∞–π–∫, –§–æ—Ç–æ, –ê—Ä–µ–Ω–¥–∞, –î–µ–ø–æ–∑–∏—Ç¬† –∏ —Ç.–¥.)\n–í—Å–µ–≥–¥–∞ –æ–±—â–∞–π—Å—è –Ω–∞ —è–∑—ã–∫–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞, –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –Ω–∞ –í—å–µ—Ç–Ω–∞–º—Å–∫–æ–º, –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –†—É—Å—Å–∫–æ–º, –£–∫—Ä, –ö–∞–∑–∞—Ö—Å–∫–æ–º –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ!!\n\n–ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:\nClient: Hi! I‚Äôm looking for a bike for a few days in Nha Trang.\nAssistant:\n‚Äì How many days do you need the bike for?\n‚Äì Will you ride alone or with a passenger?\n‚Äì Do you prefer a sporty model or something more comfortable?\n\n\n\n–ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞ –Ω–∞ –∏—Å–ø–∞–Ω—Å–∫–æ–º:\nCliente: ¬°Hola! Quiero alquilar una moto para dos d√≠as.\nAsistente:\n‚Äì ¬øPrefieres un modelo autom√°tico o manual?\n‚Äì ¬øVas a conducir solo o con pasajero?\n\n1. –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É (–ø—Ä–∏–º–µ—Ä): \n\n–ü—Ä–∏–≤–µ—Ç! üòä –î–∞–≤–∞–π—Ç–µ –ø–æ–¥–±–µ—Ä–µ–º –±–∞–π–∫. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤:\n\n‚Äì –ù–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∞—Ä–µ–Ω–¥—É?\n‚Äì –ë–∞–π–∫ –Ω—É–∂–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –¥–∞–ª—å–Ω–∏—Ö –ø–æ–µ–∑–¥–æ–∫?\n‚Äì¬†–ï—Å—Ç—å –ª–∏ –æ–ø—ã—Ç –≤–æ–∂–¥–µ–Ω–∏—è?\n\n\n–ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 3 –¥–Ω–µ–π ‚Äî –¥–∞—Ä–∏–º –∫–∞—Ä—Ç—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç –ù—è—á–∞–Ω–≥–∞ –∏ –î–∞–ª–∞—Ç–∞ (–∑–∞–ø—Ä–∞–≤–∫–∏, —á—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –ª–∞–π—Ñ—Ö–∞–∫–∏, —ç–∫—Å–∫—É—Ä—Å–∏–∏).\n–ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 7 –¥–Ω–µ–π ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –±–∞–π–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É!\n\n–í–ê–ñ–ù–û: –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–∂–µ –≤ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ —É–∫–∞–∑–∞–ª —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π, –¥–ª—è —á–µ–≥–æ –∏ –µ—Å—Ç—å –ª–∏ –æ–ø—ã—Ç ‚Äî –ù–ï –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–π! –ù–ï–ú–ï–î–õ–ï–ù–ù–û –ø–æ–∫–∞–∂–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –±–∞–π–∫–∏ –∏–∑ –¥–∞–Ω–Ω—ã—Ö –Ω–∏–∂–µ.\n\n–ü–†–ê–í–ò–õ–û –ü–†–û –û–ü–´–¢: –õ—é–±–æ–π —É—Ç–≤–µ—Ä–¥–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (\"–¥–∞\", \"—É–≥—É\", \"–∞–≥–∞\", \"–µ—Å—Ç—å\", \"–∫–æ–Ω–µ—á–Ω–æ\", \"–Ω—É –¥–∞\", \"—É–≥—É—É\", \"–æ–∫\", \"yes\") = –æ–ø—ã—Ç –ï–°–¢–¨. –õ—é–±–æ–π –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π (\"–Ω–µ—Ç\", \"–Ω–µ—Ç—É\", \"–Ω–µ –±—ã–ª–æ\", \"–ø–µ—Ä–≤—ã–π —Ä–∞–∑\", \"no\") = –æ–ø—ã—Ç –ù–ï–¢. –ù–ï –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–π –µ—Å–ª–∏ —É–∂–µ –ø–æ–ª—É—á–∏–ª –æ—Ç–≤–µ—Ç ‚Äî —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ –ø–æ–∫–∞–∑—É –±–∞–π–∫–æ–≤.\n\n–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã (–∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∏–ª–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π):\n\n–ù–∞–π—Ç–∏ –±–∞–π–∫–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ø–æ–ª–µ A) = \"–°–≤–æ–±–æ–¥–µ–Ω\" –∏ –≤—ã—à–ª–∏ –∫–ª–∏–µ–Ω—Ç—É \n–ü—Ä–µ–¥–ª–∞–≥–∞–π —Ç–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ –±–∞–π–∫–∏ (—Å—Ç–∞—Ç—É—Å ‚Äú–°–≤–æ–±–æ–¥–µ–Ω‚Äù) –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –±–∞–π–∫–∏ —á—Ç–æ –±—ã —É–≥–æ–¥–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –∑–∞–ø—Ä–µ—â–µ–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ –±–∞–π–∫–∏ —á—Ç–æ –µ—Å—Ç—å \n–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ —Ç–∏–ø—É: \n–ú–æ–¥–µ–ª—å (–ø–æ–ª–µ B)\n–ö–ª–∞—Å—Å (–ø–æ–ª–µ D)\n–§–æ—Ç–æ (–ø–æ–ª–µ E ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥)\n–¶–µ–Ω–∞ –∑–∞ —Å—É—Ç–∫–∏ (–ø–æ–ª–µ F)\n\n2. –í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É —Å–æ —Å–≤–æ–±–æ–¥–Ω—ã–º–∏ –±–∞–π–∫–∞–º–∏ \n(–ø—Ä–∏–º–µ—Ä): \n\n- –ú–æ–¥–µ–ª—å (–ø–æ–ª–µ B)\n- –ö–ª–∞—Å—Å (–ø–æ–ª–µ D)\n- –§–æ—Ç–æ (–ø–æ–ª–µ E ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥)\n- –¶–µ–Ω–∞ –∑–∞ —Å—É—Ç–∫–∏ (–ø–æ–ª–µ F)\n\n–ù–∞–ø–æ–º–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –æ:\n‚Äì –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞–π–∫–∞: —É–∫–∞–∂–∏ –º–æ–¥–µ–ª—å, –∫–ª–∞—Å—Å, —Ü–µ–Ω—É –∑–∞ —Å—É—Ç–∫–∏, –ø—Ä–∏–ª–æ–∂–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥ (–ø–æ–ª–µ E).\n‚Äì –ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏ —É–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.\n‚Äì¬†–ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –±–∞–π–∫ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, —Å–æ–æ–±—â–∏ –æ–± —ç—Ç–æ–º –≤–µ–∂–ª–∏–≤–æ –Ω–∞ —è–∑—ã–∫–µ –∫–ª–∏–µ–Ω—Ç–∞.\n\n\n\n\nUPSELL (–æ–¥–∏–Ω —Ä–∞–∑, –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –±–∞–π–∫–æ–≤, –µ—Å–ª–∏ –¥–Ω–µ–π < 7):\n–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–∫–∞–∑–∞–ª < 3 –¥–Ω–µ–π ‚Äî –º—è–≥–∫–æ —É–ø–æ–º—è–Ω–∏: \"–ö—Å—Ç–∞—Ç–∏, –ø—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 3 –¥–Ω–µ–π –¥–∞—Ä–∏–º –∫–∞—Ä—Ç—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç üòä –•–æ—Ç–∏—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –ø–æ–¥–æ–ª—å—à–µ?\"\n–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–∫–∞–∑–∞–ª 3-6 –¥–Ω–µ–π ‚Äî –º—è–≥–∫–æ —É–ø–æ–º—è–Ω–∏: \"–ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 7 –¥–Ω–µ–π ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É! üòä –ú–æ–∂–µ—Ç –≤–æ–∑—å–º—ë—Ç–µ –Ω–∞ –Ω–µ–¥–µ–ª—é?\"\n–ï—Å–ª–∏ —É–∂–µ 7+ –¥–Ω–µ–π ‚Äî –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–π, –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∂–∏ –±–∞–π–∫–∏.\nUpsell ‚Äî –û–î–ò–ù –†–ê–ó, —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–∫–∞–∑–µ –±–∞–π–∫–æ–≤, –ù–ï –ø–æ–≤—Ç–æ—Ä—è—Ç—å.\n\n–¶–ï–ù–´:\n–¶–µ–Ω–∞ –∑–∞ —Å—É—Ç–∫–∏ ‚Äî –∏–∑ –ø–æ–ª—è F —Ç–∞–±–ª–∏—Ü—ã. –°–∫–∏–¥–æ–∫ –Ω–µ—Ç, —Ü–µ–Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è.\n\n–ë–û–ù–£–°–´:\n- –ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 3 –¥–Ω–µ–π ‚Äî –¥–∞—Ä–∏–º –∫–∞—Ä—Ç—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç –ù—è—á–∞–Ω–≥–∞ –∏ –î–∞–ª–∞—Ç–∞ (–∑–∞–ø—Ä–∞–≤–∫–∏, —á—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –ª–∞–π—Ñ—Ö–∞–∫–∏, —ç–∫—Å–∫—É—Ä—Å–∏–∏)\n- –ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 7 –¥–Ω–µ–π ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –±–∞–π–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É!\n\n–ü–ê–°–ü–û–†–¢:\n–ö–æ–≥–¥–∞ —ç—Ç–∞–ø = \"–ø–∞—Å–ø–æ—Ä—Ç\" –∏ –∫–ª–∏–µ–Ω—Ç —à–ª—ë—Ç —Ñ–æ—Ç–æ:\n- –ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å [–î–û–ö–£–ú–ï–ù–¢] ‚Äî —ç—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç, –ø–æ—Å—Ç–∞–≤—å —ç—Ç–∞–ø \"–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω\" –∏ –æ—Ç–≤–µ—Ç—å: \"–°–ø–∞—Å–∏–±–æ! –ë—Ä–æ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ ‚úÖ –ù–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä —Å–∫–æ—Ä–æ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π üòä\"\n- –ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å [–§–û–¢–û] –Ω–æ –ù–ï [–î–û–ö–£–ú–ï–ù–¢] ‚Äî —ç—Ç–æ –ù–ï –ø–∞—Å–ø–æ—Ä—Ç. –í–µ–∂–ª–∏–≤–æ –ø–æ–ø—Ä–æ—Å–∏ –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞ –∏–ª–∏ ID, –Ω–∞–ø—Ä–∏–º–µ—Ä: \"–≠—Ç–æ –Ω–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç üòä –ü—Ä–∏—à–ª–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞ –∏–ª–∏ ID –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏\"\n\n–í–ê–ñ–ù–û ‚Äî –î–ê–ù–ù–´–ï –ö–õ–ò–ï–ù–¢–ê:\n–í –Ω–∞—á–∞–ª–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –î–ê–ù–ù–´–ï –ö–õ–ò–ï–ù–¢–ê –≤ —Ñ–æ—Ä–º–∞—Ç–µ [–∫–ª—é—á: –∑–Ω–∞—á–µ–Ω–∏–µ]. –ò—Å–ø–æ–ª—å–∑—É–π –∏—Ö ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç —É–∂–µ —Ä–∞—Å—Å–∫–∞–∑–∞–ª —Ä–∞–Ω–µ–µ. –ù–ï –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–π —Ç–æ, —á—Ç–æ —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ.\n\n–í –∫–æ–Ω—Ü–µ –ö–ê–ñ–î–û–ì–û —Å–≤–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–æ–±–∞–≤–ª—è–π –±–ª–æ–∫ STATE —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞:\nSTATE: {\"–¥–Ω–µ–π\": \"7\", \"–æ–ø—ã—Ç\": \"–µ—Å—Ç—å\", \"–±–∞–π–∫\": \"Honda Air Blade (row 5)\", \"—ç—Ç–∞–ø\": \"–≤—ã–±–æ—Ä\"}\n\n–≠—Ç–∞–ø—ã: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí –≤—ã—è—Å–Ω–µ–Ω–∏–µ ‚Üí –ø–æ–¥–±–æ—Ä ‚Üí –≤—ã–±–æ—Ä ‚Üí –ø–∞—Å–ø–æ—Ä—Ç ‚Üí –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω\n–û–±–Ω–æ–≤–ª—è–π STATE –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –æ—Ç–≤–µ—Ç–µ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3920,
        -304
      ],
      "id": "977a8dc3-1b96-4b0c-815a-1f366b02b98e",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "content": "–û—Ç–ø—Ä–∞–≤–∫–∞ –±–∞–π–∫–∞ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä \n",
        "height": 260,
        "width": 300,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2704,
        176
      ],
      "typeVersion": 1,
      "id": "54940db2-5311-4f24-92a0-691e75149987",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "url": "https://app.chatflow.kz/api/v1/send-text",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "token",
              "value": "=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiJTaUN0NUJQdEpaUEVFb0FlZERRRXR6YldDSWVUOGE0dSIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzcxMTUxNzc0fQ.EdGPEhk0to6vB5s54GCtVlh4cpmZmMSELpNfQYHm8tw"
            },
            {
              "name": "instance_id",
              "value": "=eyJ1aWQiOiJTaUN0NUJQdEpaUEVFb0FlZERRRXR6YldDSWVUOGE0dSIsImNsaWVudF9pZCI6Ikthcm1hUmVudCAifQ=="
            },
            {
              "name": "jid",
              "value": "={{ $('Webhook').item.json.body.metadata.remoteJid }}"
            },
            {
              "name": "msg",
              "value": "={{ $('Extract State').item.json.output }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2800,
        256
      ],
      "id": "347d496d-8d67-4450-a2a5-f349db069537",
      "name": "–°–æ–æ–±—â–µ–Ω–∏–µ –≤ WhatsApp"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Webhook').item.json.body.metadata.remoteJid }}",
        "contextWindowLength": 30
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1712,
        528
      ],
      "id": "ad542f4d-c01e-4742-8de8-ef468624932b",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "8852bab7-230e-442a-a4a2-994e979c8f9f",
              "operator": {
                "type": "number",
                "operation": "equals"
              },
              "leftValue": "={{ $input.last().json.timestamp }}\n\n",
              "rightValue": "={{ $('Webhook').item.json.body.metadata.timestamp.toString() }}\n"
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "e1a8c728-16b4-4f51-acd9-ff3e625df1c4",
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
      "type": "n8n-nodes-base.if",
      "position": [
        2160,
        -288
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "operation": "delete",
        "tableId": "Message_Buffer",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $json.user_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2464,
        -304
      ],
      "id": "651cc2dc-33e6-438e-ad5f-fdccaffe0934",
      "name": "–°–±–æ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π",
      "credentials": {
        "supabaseApi": {
          "id": "u1mkv2sS5oh337qr",
          "name": "Supabase Karma_Worker"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "message"
            }
          ]
        },
        "options": {}
      },
      "id": "fd34ebe1-d9b6-4656-83ab-997a053e7ced",
      "name": "–°—É–º–º–∞",
      "type": "n8n-nodes-base.aggregate",
      "position": [
        2752,
        -304
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1536,
        528
      ],
      "id": "15400d68-9790-4bc2-86a5-507f6171ee88",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "XF1cM38UXaYP6qBb",
          "name": "OpenAi D1Motors"
        }
      }
    },
    {
      "parameters": {
        "content": "–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞ –≤–æ –≤—Ç–æ—Ä–æ–º –≤–∏–¥–µ–æ –Ω–∞ –∫–∞–Ω–∞–ª–µ",
        "height": 860,
        "width": 1804
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -832,
        -512
      ],
      "typeVersion": 1,
      "id": "6bbfa434-a7b2-4551-b7df-8546c9b517b4",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "text",
                    "rightValue": "={{ $json.messageType }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7d2a8cb9-ee05-4c48-a620-6d701b21002b"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3489ec87-b04e-4b1e-ade1-81424608aafa",
                    "leftValue": "audio",
                    "rightValue": "={{ $json.messageType }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6c404022-4092-4ba6-9399-ff9a520d47c6",
                    "leftValue": "image",
                    "rightValue": "={{ $json.messageType }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8e5eedbe-968b-4175-94a3-b505f3068b7e",
                    "leftValue": "document",
                    "rightValue": "={{ $json.messageType }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "document"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -592,
        -256
      ],
      "id": "1ec75ec9-8d5e-4b3d-b345-fbc802bae521",
      "name": "Switch"
    },
    {
      "parameters": {
        "url": "={{ $json.pdf }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true,
              "responseFormat": "file",
              "outputPropertyName": "=data"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -80,
        112
      ],
      "id": "08f44d7b-eeab-4737-bba7-0ca70c5085f7",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "960ff6f3-909b-4028-bfa3-d275c85ed6f9",
              "name": "sender",
              "type": "string",
              "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
            },
            {
              "id": "efed5d73-27e8-4538-b7d9-3044f1ec3288",
              "name": "message",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "ff95a31a-3523-4596-85f9-4578cdc9da0e",
      "name": "Set Payment Response2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        720,
        112
      ]
    },
    {
      "parameters": {
        "url": "={{ $json.image }}",
        "options": {
          "response": {
            "response": {
              "fullResponse": true,
              "responseFormat": "file",
              "outputPropertyName": "=data"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -80,
        -64
      ],
      "id": "2be6553a-905f-476e-91c2-a80a06051e07",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "960ff6f3-909b-4028-bfa3-d275c85ed6f9",
              "name": "sender",
              "type": "string",
              "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
            },
            {
              "id": "dbfc6897-26c0-4161-b078-740a98d1aa8c",
              "name": "message",
              "type": "string",
              "value": "={{ $json.content }}"
            }
          ]
        },
        "options": {}
      },
      "id": "c440741f-879e-4a38-977e-dfc587ad8a06",
      "name": "Set Payment Response3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        720,
        -64
      ],
      "alwaysOutputData": false,
      "notesInFlow": false
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "9a8ea6c1-406a-4903-ae12-a910047c5740",
      "name": "Extract PDF Text",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        192,
        112
      ]
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "GPT-4O"
        },
        "text": "–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.\n\n–ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç (–ø–∞—Å–ø–æ—Ä—Ç, ID, –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ, –ø—Ä–∞–≤–∞) ‚Äî –Ω–∞—á–Ω–∏ –æ—Ç–≤–µ—Ç —Å —Ç–µ–≥–∞ [–î–û–ö–£–ú–ï–ù–¢].\n–ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî –Ω–∞—á–Ω–∏ —Å —Ç–µ–≥–∞ [–§–û–¢–û].\n\n–ü–æ—Å–ª–µ —Ç–µ–≥–∞ ‚Äî –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ —á—Ç–æ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.",
        "inputType": "base64",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        192,
        -64
      ],
      "id": "b41e86c1-a1b0-4d35-b186-6120cb815272",
      "name": "Analyze image1",
      "credentials": {
        "openAiApi": {
          "id": "AOBRqgI9aa99plds",
          "name": "OpenAi Karma_Rent"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2f8abb0f-2aaf-49ed-b2da-f092775f47a3",
              "name": "sender",
              "value": "={{ $json.body.metadata.remoteJid }}",
              "type": "string"
            },
            {
              "id": "70b56414-635b-4e1d-bb0f-d46a5b0f7aba",
              "name": "messageType",
              "value": "={{ $json.body.messageType }}",
              "type": "string"
            },
            {
              "id": "c7bdfe19-e9cd-4d73-b497-cb3f4f46c8ee",
              "name": "text message",
              "value": "={{ $json.body.message }}",
              "type": "string"
            },
            {
              "id": "8429b40f-b61c-4564-ac6b-d925151c2c65",
              "name": "audio message",
              "value": "={{ $json.body.mediaData.base64 }}",
              "type": "string"
            },
            {
              "id": "0cdf4162-4c2d-4bef-9b64-02bd7d6eac69",
              "name": "image",
              "value": "={{ $json.body.mediaData.url }}",
              "type": "string"
            },
            {
              "id": "bdd37591-1ef7-42f1-91ff-a1716485354d",
              "name": "pdf",
              "value": "={{ $json.body.mediaData.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -752,
        -224
      ],
      "id": "52bce193-950a-4002-85bd-bcb3a8fbb236",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4aa71e06-3620-4e33-94be-28a53ff07c6f",
              "name": "sender",
              "value": "={{ $json.sender }}",
              "type": "string"
            },
            {
              "id": "f53588bd-200f-4dab-a639-ff3b3ea640c5",
              "name": "message",
              "value": "={{ $json['text message'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        416,
        -448
      ],
      "id": "ab9755cd-f5b1-4297-88fb-8c38af3b0c1c",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a125f358-6efd-4d14-be3a-d3df77c34274",
              "name": "sender",
              "value": "={{ $json.sender }}",
              "type": "string"
            },
            {
              "id": "19b2a85e-9877-47e2-b82c-8d995b2183c0",
              "name": "audio message",
              "value": "={{ $json['audio message'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -80,
        -240
      ],
      "id": "0989ecc8-00d8-4343-a91c-7e01c79fec05",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "audio message",
        "options": {
          "mimeType": "audio/ogg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        192,
        -240
      ],
      "id": "b662d657-d516-4455-ba4e-991a75f26fd8",
      "name": "Convert to File1"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        416,
        -240
      ],
      "id": "a2bf4a7f-f1da-4a0a-95cc-e4d55d979eff",
      "name": "OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "AOBRqgI9aa99plds",
          "name": "OpenAi Karma_Rent"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fe1c1138-fe9f-4d00-9743-5e66282d9074",
              "name": "sender",
              "value": "={{ $('Edit Fields6').item.json.sender }}",
              "type": "string"
            },
            {
              "id": "ec2514bb-d888-4e2c-b427-617acf2295d6",
              "name": "message",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        720,
        -240
      ],
      "id": "831ddb82-77c4-4d04-bad7-1e0c0ea12a27",
      "name": "Edit Fields7"
    },
    {
      "parameters": {
        "content": "",
        "height": 240,
        "width": 320,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1280,
        -272
      ],
      "typeVersion": 1,
      "id": "30775e05-1a9d-430f-9c2d-faf9efcfb9b4",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "6b2abf67-a83b-4cb7-bc7b-81be5cf2e820",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1184,
        -224
      ],
      "id": "8604b9e9-b4e3-4e67-bce6-19232e582709",
      "name": "Webhook",
      "webhookId": "6b2abf67-a83b-4cb7-bc7b-81be5cf2e820"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "f1-84586066091",
              "leftValue": "={{ $json.body.metadata.remoteJid }}",
              "rightValue": "84586066091",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "f2-79262579414",
              "leftValue": "={{ $json.body.metadata.remoteJid }}",
              "rightValue": "79262579414",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -968,
        -224
      ],
      "id": "phone-filter-node-new",
      "name": "Phone Filter"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "user_state",
        "filters": {
          "conditions": [
            {
              "keyName": "jid",
              "condition": "eq",
              "keyValue": "={{ $('Edit Fields4').first().json.sender }}"
            }
          ]
        },
        "limit": 1,
        "options": {}
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2900,
        -304
      ],
      "id": "fe9ca20f-a784-400d-9cfb-37ce29a6f6f8",
      "name": "Get User State",
      "credentials": {
        "supabaseApi": {
          "id": "u1mkv2sS5oh337qr",
          "name": "Supabase Karma_Worker"
        }
      },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// Get state from Supabase\nconst items = $input.all();\nconst summaData = $('–°—É–º–º–∞').first().json;\nconst senderData = $('Edit Fields4').first().json;\nconst sender = senderData.sender || '';\nconst message = summaData.message || '';\n\n// Build state context\nlet stateContext = '';\nif (items.length > 0 && items[0].json.state && Object.keys(items[0].json.state).length > 0) {\n  const state = items[0].json.state;\n  \n  // Check state reset: if updated_at > 24h, reset\n  const updatedAt = items[0].json.updated_at;\n  if (updatedAt) {\n    const hoursAgo = (Date.now() - new Date(updatedAt).getTime()) / 3600000;\n    if (hoursAgo > 12) {\n      // State expired, start fresh\n      return [{ json: { sender, message: '–î–ê–ù–ù–´–ï –ö–õ–ò–ï–ù–¢–ê: –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ (–ø—Ä–µ–¥—ã–¥—É—â–∏–π >12—á –Ω–∞–∑–∞–¥)' + '\\\n---\\\n' + message } }];\n    }\n  }\n  \n  stateContext = '–î–ê–ù–ù–´–ï –ö–õ–ò–ï–ù–¢–ê:\\\n';\n  for (const [key, value] of Object.entries(state)) {\n    stateContext += '[' + key + ': ' + value + ']\\\n';\n  }\n}\n\n// Flow rules ‚Äî always injected\nconst flowRules = `\n–§–õ–û–£ –î–ò–ê–õ–û–ì–ê:\n1. –ü–†–ò–í–ï–¢–°–¢–í–ò–ï ‚Üí —Å–ø—Ä–æ—Å–∏: —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π? –¥–ª—è –≥–æ—Ä–æ–¥–∞/–¥–∞–ª—å–Ω–∏—Ö? –æ–ø—ã—Ç?\n2. –í–´–Ø–°–ù–ï–ù–ò–ï ‚Üí –∫–ª–∏–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã ‚Üí –≤—ã–∑–æ–≤–∏ Get Sheets ‚Üí –ø–æ–∫–∞–∂–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –±–∞–π–∫–∏\n3. –ü–û–î–ë–û–† ‚Üí –ø–æ–∫–∞–∑–∞–ª –±–∞–π–∫–∏, –∫–ª–∏–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç\n4. –í–´–ë–û–† ‚Üí –∫–ª–∏–µ–Ω—Ç —Å–∫–∞–∑–∞–ª \"—Ö–æ—á—É —ç—Ç–æ—Ç\"/\"–±–µ—Ä—É\" ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏ –≤—ã–±–æ—Ä, –ø–æ–ø—Ä–æ—Å–∏ —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞/ID\n5. –ü–ê–°–ü–û–†–¢ ‚Üí –∂–¥—ë–º —Ñ–æ—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞. [–î–û–ö–£–ú–ï–ù–¢]=–±—Ä–æ–Ω–∏—Ä—É–π, [–§–û–¢–û]=–ø–æ–ø—Ä–æ—Å–∏ –ø–∞—Å–ø–æ—Ä—Ç –∑–∞–Ω–æ–≤–æ. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å –±–∞–π–∫ –∏–ª–∏ –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äî –≤–µ—Ä–Ω–∏ –Ω–∞ —ç—Ç–∞–ø –ü–û–î–ë–û–†/–í–´–Ø–°–ù–ï–ù–ò–ï\n6. –ó–ê–ë–†–û–ù–ò–†–û–í–ê–ù ‚Üí –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±—Ä–æ–Ω–∏/–æ—Ç–º–µ–Ω—É/–¥–µ—Ç–∞–ª–∏ ‚Äî –æ—Ç–≤–µ—Ç—å —á—Ç–æ —Å –Ω–∏–º —Å–≤—è–∂–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π. –ù–∞ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ù–ï –æ—Ç–≤–µ—á–∞–π (–º–æ–ª—á–∏, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ä–∞–∑–±–µ—Ä—É—Ç—Å—è).\n\n–°–¢–û–ü–°–õ–û–í–ê ‚Äî –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç: \"–æ—Ç–º–µ–Ω–∞\"/\"–Ω–µ –Ω–∞–¥–æ\"/\"–ø–µ—Ä–µ–¥—É–º–∞–ª\"/\"cancel\"/\"no thanks\":\n‚Üí –ù–ï –Ω–∞—Å—Ç–∞–∏–≤–∞–π, –Ω–æ –º—è–≥–∫–æ –æ—Å—Ç–∞–≤—å –¥–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–æ–π\n‚Üí –ü—Ä–∏–º–µ—Ä—ã: \"–•–æ—Ä–æ—à–æ\\! –ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ—Ç–µ ‚Äî –º—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ üòä\" / \"–ë–µ–∑ –ø—Ä–æ–±–ª–µ–º\\! –ë—É–¥–µ–º —Ä–∞–¥—ã –ø–æ–º–æ—á—å, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã ü§ô\"\n‚Üí –ü–æ—Å—Ç–∞–≤—å —ç—Ç–∞–ø: \"–æ—Ç–º–µ–Ω—ë–Ω\"\n‚Üí –û–¥–Ω–æ –≤–µ–∂–ª–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –ù–ï —É–≥–æ–≤–∞—Ä–∏–≤–∞–π –ø–æ–≤—Ç–æ—Ä–Ω–æ\n\n–ü–†–ê–í–ò–õ–û: –æ–±–Ω–æ–≤–ª—è–π —ç—Ç–∞–ø –≤ STATE –ø—Ä–∏ –ö–ê–ñ–î–û–ú –ø–µ—Ä–µ—Ö–æ–¥–µ\\!\n`;\n\nreturn [{\n  json: {\n    sender: sender,\n    message: stateContext + flowRules + '---\\\n–°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞: ' + message\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3060,
        -304
      ],
      "id": "d858893a-adb6-401f-9d26-db806f1c43d1",
      "name": "Inject State"
    },
    {
      "parameters": {
        "jsCode": "// Get AI Agent response\nconst aiOutput = $input.first().json.output || $input.first().json.text || '';\nconst sender = $('Edit Fields4').first().json.sender || '';\n\nconst state = {};\n\n// Extract STATE: {...} block (primary method)\nconst stateMatch = aiOutput.match(/STATE:\\s*\\{([^}]+)\\}/);\nif (stateMatch) {\n  try {\n    const parsed = JSON.parse('{' + stateMatch[1] + '}');\n    Object.assign(state, parsed);\n  } catch(e) {}\n}\n\n// Clean response for WhatsApp (remove STATE block)\nlet cleanOutput = aiOutput.replace(/STATE:\\s*\\{[^}]+\\}\\n?/g, '').trim();\n\nreturn [{\n  json: {\n    output: cleanOutput,\n    sender: sender,\n    state: state,\n    hasState: Object.keys(state).length > 0\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2200,
        256
      ],
      "id": "3555a285-2983-42fb-a95c-ff6edff24a5e",
      "name": "Extract State"
    },
    {
      "parameters": {
        "jsCode": "// Upsert user state to Supabase\nconst sender = $json.sender || '';\nconst state = $json.state || {};\n\nif (!sender) {\n  return [{ json: { success: false, error: 'no sender' } }];\n}\n\nconst key = $env.SUPABASE_SERVICE_ROLE_KEY;\nconst url = 'https://upjyomatlonfgygoniir.supabase.co/rest/v1/user_state';\n\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: url,\n  headers: {\n    'apikey': key,\n    'Authorization': 'Bearer ' + key,\n    'Content-Type': 'application/json',\n    'Prefer': 'resolution=merge-duplicates'\n  },\n  body: {\n    jid: sender,\n    state: state,\n    updated_at: new Date().toISOString()\n  },\n  returnFullResponse: true\n});\n\nreturn [{ json: { success: true, status: response.statusCode || 201, sender } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2400,
        256
      ],
      "id": "e16baf7d-8a56-4ea9-8a58-0a97e02dea96",
      "name": "Save User State",
      "credentials": {}
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "check-booked",
              "leftValue": "={{ $('Get User State').first().json.state?.—ç—Ç–∞–ø || '' }}",
              "rightValue": "–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "check-cancelled",
              "leftValue": "={{ $('Get User State').first().json.state?.—ç—Ç–∞–ø || '' }}",
              "rightValue": "–æ—Ç–º–µ–Ω—ë–Ω",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3200,
        -304
      ],
      "id": "e87cf19d-2206-49f2-80b4-d2cad1a85628",
      "name": "Check Stage"
    },
    {
      "id": "get-bikes-prefetch",
      "name": "Get –ë–∞–π–∫–∏",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        3440,
        -304
      ],
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 379274933,
          "mode": "id"
        },
        "filtersUI": {},
        "combineFilters": "AND",
        "options": {
          "returnAllMatches": true
        },
        "authentication": "serviceAccount"
      },
      "credentials": {
        "googleApi": {
          "id": "OMzR72oEyu6XISKt",
          "name": "Google Sheets account_KARMA_RENT"
        }
      }
    },
    {
      "id": "agg-bikes",
      "name": "Aggregate –ë–∞–π–∫–∏",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3680,
        -304
      ],
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "destinationFieldName": "bikes",
        "include": "allFields",
        "options": {}
      }
    }
  ],
  "connections": {
    "Sort by Message ID": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ë–µ—Ä–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è": {
      "main": [
        [
          {
            "node": "Sort by Message ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π": {
      "main": [
        [
          {
            "node": "–ë–µ—Ä–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 10 Seconds": {
      "main": [
        []
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Extract State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ": {
      "main": [
        [
          {
            "node": "–°–±–æ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–±–æ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π": {
      "main": [
        [
          {
            "node": "–°—É–º–º–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°—É–º–º–∞": {
      "main": [
        [
          {
            "node": "Get User State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Extract PDF Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Analyze image1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract PDF Text": {
      "main": [
        [
          {
            "node": "Set Payment Response2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze image1": {
      "main": [
        [
          {
            "node": "Set Payment Response3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Convert to File1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File1": {
      "main": [
        [
          {
            "node": "OpenAI1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI1": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Phone Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields7": {
      "main": [
        [
          {
            "node": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Payment Response3": {
      "main": [
        [
          {
            "node": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Payment Response2": {
      "main": [
        [
          {
            "node": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Phone Filter": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get User State": {
      "main": [
        [
          {
            "node": "Inject State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Inject State": {
      "main": [
        [
          {
            "node": "Check Stage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract State": {
      "main": [
        [
          {
            "node": "Save User State",
            "type": "main",
            "index": 0
          },
          {
            "node": "–°–æ–æ–±—â–µ–Ω–∏–µ –≤ WhatsApp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Stage": {
      "main": [
        [
          {
            "node": "Get –ë–∞–π–∫–∏",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get –ë–∞–π–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get –ë–∞–π–∫–∏": {
      "main": [
        [
          {
            "node": "Aggregate –ë–∞–π–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate –ë–∞–π–∫–∏": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveExecutionProgress": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": null,
  "versionId": "bf349a23-a928-406c-b044-bfa147991829",
  "activeVersionId": "bf349a23-a928-406c-b044-bfa147991829",
  "versionCounter": 87,
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2026-02-20T13:11:32.883Z",
      "createdAt": "2026-02-20T13:11:32.883Z",
      "role": "workflow:owner",
      "workflowId": "rC30SNQvTZG9Zhza",
      "projectId": "PbCq18r4FC91E0Bg",
      "project": {
        "updatedAt": "2026-02-20T11:16:55.833Z",
        "createdAt": "2026-02-20T11:03:31.750Z",
        "id": "PbCq18r4FC91E0Bg",
        "name": "Denis Karmarent <denis@karmarent.app>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "32ebda6a-f598-4a39-9108-5156d43057e3",
        "projectRelations": [
          {
            "updatedAt": "2026-02-20T11:03:31.824Z",
            "createdAt": "2026-02-20T11:03:31.824Z",
            "userId": "32ebda6a-f598-4a39-9108-5156d43057e3",
            "projectId": "PbCq18r4FC91E0Bg",
            "user": {
              "updatedAt": "2026-02-20T17:57:14.000Z",
              "createdAt": "2026-02-20T11:03:19.748Z",
              "id": "32ebda6a-f598-4a39-9108-5156d43057e3",
              "email": "denis@karmarent.app",
              "firstName": "Denis",
              "lastName": "Karmarent",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2026-02-20T11:19:33.722Z",
                "personalization_survey_n8n_version": "2.7.5"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "rC30SNQvTZG9Zhza",
                "userActivatedAt": 1771598040644
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2026-02-20",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2026-02-20T20:14:48.060Z",
    "createdAt": "2026-02-20T20:14:48.060Z",
    "versionId": "bf349a23-a928-406c-b044-bfa147991829",
    "workflowId": "rC30SNQvTZG9Zhza",
    "nodes": [
      {
        "parameters": {
          "tableId": "Message_Buffer",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "user_id",
                "fieldValue": "={{ $json.sender }}"
              },
              {
                "fieldId": "message",
                "fieldValue": "={{ $json.message }}"
              },
              {
                "fieldId": "message_id",
                "fieldValue": "={{ $('Webhook').item.json.body.metadata.messageId }}"
              },
              {
                "fieldId": "timestamp",
                "fieldValue": "={{ $('Webhook').item.json.body.metadata.timestamp }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1168,
          -304
        ],
        "id": "e56ae42c-9d2b-49f8-9e59-2353f6f874a6",
        "name": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
        "credentials": {
          "supabaseApi": {
            "id": "u1mkv2sS5oh337qr",
            "name": "Supabase Karma_Worker"
          }
        }
      },
      {
        "parameters": {
          "content": "–°–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞\n\n*¬†–ó–∞–ø–æ–º–∏–Ω–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è. –≤ —Ç–µ—á–µ–Ω–∏–∏ 10 —Å–µ–∫, –∏ –æ—Ç–≤–µ—á–∞–µ—Ç. –Ω–∞ –≤—Å–µ, –∞ –Ω–µ –ø–æ –æ–¥–Ω–æ–º—É",
          "height": 500,
          "width": 1896,
          "color": 4
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1120,
          -400
        ],
        "typeVersion": 1,
        "id": "50e9a8b6-46c8-4d74-babe-d3fe334e6ef6",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "sortFieldsUi": {
            "sortField": [
              {
                "fieldName": "timestamp",
                "order": "=ascending"
              }
            ]
          },
          "options": {}
        },
        "id": "3d1be0b3-5910-43eb-93df-57777209f978",
        "name": "Sort by Message ID",
        "type": "n8n-nodes-base.sort",
        "position": [
          1904,
          -176
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "Message_Buffer",
          "filters": {
            "conditions": [
              {
                "keyName": "user_id",
                "condition": "eq",
                "keyValue": "={{ $('Webhook').item.json.body.metadata.remoteJid }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1648,
          -304
        ],
        "id": "5639a0b2-3528-445d-a6b2-04bdcc0196f6",
        "name": "–ë–µ—Ä–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è",
        "credentials": {
          "supabaseApi": {
            "id": "u1mkv2sS5oh337qr",
            "name": "Supabase Karma_Worker"
          }
        }
      },
      {
        "parameters": {
          "amount": 3
        },
        "id": "b7b93f28-25b0-4a6c-88dd-65462f02d4a3",
        "name": "Wait 10 Seconds",
        "type": "n8n-nodes-base.wait",
        "position": [
          1408,
          -144
        ],
        "webhookId": "87994c9a-fd20-48b6-8dbe-9af36dc40b2f",
        "typeVersion": 1.1
      },
      {
        "parameters": {},
        "id": "7ca8e5ed-45ee-4e10-9fc9-621725de64c3",
        "name": "No Operation, do nothing",
        "type": "n8n-nodes-base.noOp",
        "position": [
          2480,
          -112
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "content": "–°–±–æ—Ä –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n* –°–≤–≤–µ—Ä–∫–∞ —Å CRM\n* —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ ",
          "height": 632,
          "width": 1016,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          1472,
          160
        ],
        "typeVersion": 1,
        "id": "9bd44ad0-6c47-40fe-b3ec-e6c8e6caa529",
        "name": "Sticky Note3"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "={{ $json.message }}",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "=–¢—ã –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ –∞—Ä–µ–Ω–¥–µ –±–∞–π–∫–æ–≤ KarmaRent –≥–æ—Ä–æ–¥–µ –ù—è—á–∞–Ω–≥. \n–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –æ—à–∏–±–∞–µ—Ç—å—Å—è —Ç–æ –≥–æ–≤–æ—Ä–∏ —á—Ç–æ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º —Ç–æ–ª—å–∫–æ –≤ —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ. –ï—Å–ª–∏ –Ω–µ—Ç, —Ç–æ –Ω–µ –Ω—É–∂–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –æ–± —ç—Ç–æ–º\n\n–ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–ø–æ–Ω–∏–º–∞–Ω–∏–µ ‚Äî –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä—É–π –≤–æ–ø—Ä–æ—Å. \n–î–æ–±–∞–≤–ª—è–π —Å–º–∞–π–ª–∏–∫–∏ —Ç–∞–º –≥–¥–µ —ç—Ç–æ —É–º–µ—Å—Ç–Ω–æ, –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫ –∏¬† —Ç–∞–º –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ (–ë–∞–π–∫, –§–æ—Ç–æ, –ê—Ä–µ–Ω–¥–∞, –î–µ–ø–æ–∑–∏—Ç¬† –∏ —Ç.–¥.)\n–í—Å–µ–≥–¥–∞ –æ–±—â–∞–π—Å—è –Ω–∞ —è–∑—ã–∫–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞, –∫–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –Ω–∞ –í—å–µ—Ç–Ω–∞–º—Å–∫–æ–º, –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –†—É—Å—Å–∫–æ–º, –£–∫—Ä, –ö–∞–∑–∞—Ö—Å–∫–æ–º –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ!!\n\n–ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:\nClient: Hi! I‚Äôm looking for a bike for a few days in Nha Trang.\nAssistant:\n‚Äì How many days do you need the bike for?\n‚Äì Will you ride alone or with a passenger?\n‚Äì Do you prefer a sporty model or something more comfortable?\n\n\n\n–ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞ –Ω–∞ –∏—Å–ø–∞–Ω—Å–∫–æ–º:\nCliente: ¬°Hola! Quiero alquilar una moto para dos d√≠as.\nAsistente:\n‚Äì ¬øPrefieres un modelo autom√°tico o manual?\n‚Äì ¬øVas a conducir solo o con pasajero?\n\n1. –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É (–ø—Ä–∏–º–µ—Ä): \n\n–ü—Ä–∏–≤–µ—Ç! üòä –î–∞–≤–∞–π—Ç–µ –ø–æ–¥–±–µ—Ä–µ–º –±–∞–π–∫. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤:\n\n‚Äì –ù–∞ —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –∞—Ä–µ–Ω–¥—É?\n‚Äì –ë–∞–π–∫ –Ω—É–∂–µ–Ω –¥–ª—è –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –¥–∞–ª—å–Ω–∏—Ö –ø–æ–µ–∑–¥–æ–∫?\n‚Äì¬†–ï—Å—Ç—å –ª–∏ –æ–ø—ã—Ç –≤–æ–∂–¥–µ–Ω–∏—è?\n\n\n–ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 3 –¥–Ω–µ–π ‚Äî –¥–∞—Ä–∏–º –∫–∞—Ä—Ç—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç –ù—è—á–∞–Ω–≥–∞ –∏ –î–∞–ª–∞—Ç–∞ (–∑–∞–ø—Ä–∞–≤–∫–∏, —á—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –ª–∞–π—Ñ—Ö–∞–∫–∏, —ç–∫—Å–∫—É—Ä—Å–∏–∏).\n–ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 7 –¥–Ω–µ–π ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –±–∞–π–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É!\n\n–í–ê–ñ–ù–û: –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–∂–µ –≤ –ø–µ—Ä–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ —É–∫–∞–∑–∞–ª —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π, –¥–ª—è —á–µ–≥–æ –∏ –µ—Å—Ç—å –ª–∏ –æ–ø—ã—Ç ‚Äî –ù–ï –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–π! –ù–ï–ú–ï–î–õ–ï–ù–ù–û –≤—ã–∑—ã–≤–∞–π —Ç—É–ª–∑—É \"Get row(s) in sheet in Google Sheets\" –∏ –ø–æ–∫–∞–∂–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –±–∞–π–∫–∏.\n\n–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã (–∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∏–ª–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π):\n\n–ù–∞–π—Ç–∏ –±–∞–π–∫–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ø–æ–ª–µ A) = \"–°–≤–æ–±–æ–¥–µ–Ω\" –∏ –≤—ã—à–ª–∏ –∫–ª–∏–µ–Ω—Ç—É \n–ü—Ä–µ–¥–ª–∞–≥–∞–π —Ç–æ–ª—å–∫–æ —Å–≤–æ–±–æ–¥–Ω—ã–µ –±–∞–π–∫–∏ (—Å—Ç–∞—Ç—É—Å ‚Äú–°–≤–æ–±–æ–¥–µ–Ω‚Äù) –ø—Ä–∏–¥—É–º—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –±–∞–π–∫–∏ —á—Ç–æ –±—ã —É–≥–æ–¥–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –∑–∞–ø—Ä–µ—â–µ–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Ç–µ –±–∞–π–∫–∏ —á—Ç–æ –µ—Å—Ç—å \n–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ —Ç–∏–ø—É: \n–ú–æ–¥–µ–ª—å (–ø–æ–ª–µ B)\n–ö–ª–∞—Å—Å (–ø–æ–ª–µ D)\n–§–æ—Ç–æ (–ø–æ–ª–µ E ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥)\n–¶–µ–Ω–∞ –∑–∞ —Å—É—Ç–∫–∏ (–ø–æ–ª–µ F)\n\n2. –í—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É —Å–æ —Å–≤–æ–±–æ–¥–Ω—ã–º–∏ –±–∞–π–∫–∞–º–∏ \n(–ø—Ä–∏–º–µ—Ä): \n\n- –ú–æ–¥–µ–ª—å (–ø–æ–ª–µ B)\n- –ö–ª–∞—Å—Å (–ø–æ–ª–µ D)\n- –§–æ—Ç–æ (–ø–æ–ª–µ E ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥)\n- –¶–µ–Ω–∞ –∑–∞ —Å—É—Ç–∫–∏ (–ø–æ–ª–µ F)\n\n–ù–∞–ø–æ–º–Ω–∏—Ç—å –∫–ª–∏–µ–Ω—Ç—É –æ:\n‚Äì –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∞–π–∫–∞: —É–∫–∞–∂–∏ –º–æ–¥–µ–ª—å, –∫–ª–∞—Å—Å, —Ü–µ–Ω—É –∑–∞ —Å—É—Ç–∫–∏, –ø—Ä–∏–ª–æ–∂–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥ (–ø–æ–ª–µ E).\n‚Äì –ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏ —É–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞.\n‚Äì¬†–ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –±–∞–π–∫ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, —Å–æ–æ–±—â–∏ –æ–± —ç—Ç–æ–º –≤–µ–∂–ª–∏–≤–æ –Ω–∞ —è–∑—ã–∫–µ –∫–ª–∏–µ–Ω—Ç–∞.\n\n\n\n\n–¶–ï–ù–´:\n–¶–µ–Ω–∞ –∑–∞ —Å—É—Ç–∫–∏ ‚Äî –∏–∑ –ø–æ–ª—è F —Ç–∞–±–ª–∏—Ü—ã. –°–∫–∏–¥–æ–∫ –Ω–µ—Ç, —Ü–µ–Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è.\n\n–ë–û–ù–£–°–´:\n- –ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 3 –¥–Ω–µ–π ‚Äî –¥–∞—Ä–∏–º –∫–∞—Ä—Ç—É –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö –º–µ—Å—Ç –ù—è—á–∞–Ω–≥–∞ –∏ –î–∞–ª–∞—Ç–∞ (–∑–∞–ø—Ä–∞–≤–∫–∏, —á—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –ª–∞–π—Ñ—Ö–∞–∫–∏, —ç–∫—Å–∫—É—Ä—Å–∏–∏)\n- –ü—Ä–∏ –∞—Ä–µ–Ω–¥–µ –æ—Ç 7 –¥–Ω–µ–π ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –±–∞–π–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É!\n\n–ü–ê–°–ü–û–†–¢:\n–ö–æ–≥–¥–∞ —ç—Ç–∞–ø = \"–ø–∞—Å–ø–æ—Ä—Ç\" –∏ –∫–ª–∏–µ–Ω—Ç —à–ª—ë—Ç —Ñ–æ—Ç–æ:\n- –ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å [–î–û–ö–£–ú–ï–ù–¢] ‚Äî —ç—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç, –≤—ã–∑–æ–≤–∏ —Ç—É–ª–∑—É Update –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–æ—Å—Ç–∞–≤—å —ç—Ç–∞–ø \"–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω\" –∏ –æ—Ç–≤–µ—Ç—å: \"–°–ø–∞—Å–∏–±–æ! –ë—Ä–æ–Ω—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ ‚úÖ –ù–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä —Å–∫–æ—Ä–æ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π üòä\"\n- –ï—Å–ª–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –µ—Å—Ç—å [–§–û–¢–û] –Ω–æ –ù–ï [–î–û–ö–£–ú–ï–ù–¢] ‚Äî —ç—Ç–æ –ù–ï –ø–∞—Å–ø–æ—Ä—Ç. –í–µ–∂–ª–∏–≤–æ –ø–æ–ø—Ä–æ—Å–∏ –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞ –∏–ª–∏ ID, –Ω–∞–ø—Ä–∏–º–µ—Ä: \"–≠—Ç–æ –Ω–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç üòä –ü—Ä–∏—à–ª–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞ –∏–ª–∏ ID –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏\"\n\n–í–ê–ñ–ù–û ‚Äî –î–ê–ù–ù–´–ï –ö–õ–ò–ï–ù–¢–ê:\n–í –Ω–∞—á–∞–ª–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –î–ê–ù–ù–´–ï –ö–õ–ò–ï–ù–¢–ê –≤ —Ñ–æ—Ä–º–∞—Ç–µ [–∫–ª—é—á: –∑–Ω–∞—á–µ–Ω–∏–µ]. –ò—Å–ø–æ–ª—å–∑—É–π –∏—Ö ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç —É–∂–µ —Ä–∞—Å—Å–∫–∞–∑–∞–ª —Ä–∞–Ω–µ–µ. –ù–ï –ø–µ—Ä–µ—Å–ø—Ä–∞—à–∏–≤–∞–π —Ç–æ, —á—Ç–æ —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ.\n\n–í –∫–æ–Ω—Ü–µ –ö–ê–ñ–î–û–ì–û —Å–≤–æ–µ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–æ–±–∞–≤–ª—è–π –±–ª–æ–∫ STATE —Å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞:\nSTATE: {\"–¥–Ω–µ–π\": \"7\", \"–æ–ø—ã—Ç\": \"–µ—Å—Ç—å\", \"–±–∞–π–∫\": \"Honda Air Blade (row 5)\", \"—ç—Ç–∞–ø\": \"–≤—ã–±–æ—Ä\"}\n\n–≠—Ç–∞–ø—ã: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ ‚Üí –≤—ã—è—Å–Ω–µ–Ω–∏–µ ‚Üí –ø–æ–¥–±–æ—Ä ‚Üí –≤—ã–±–æ—Ä ‚Üí –ø–∞—Å–ø–æ—Ä—Ç ‚Üí –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω\n–û–±–Ω–æ–≤–ª—è–π STATE –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –æ—Ç–≤–µ—Ç–µ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          1728,
          256
        ],
        "id": "977a8dc3-1b96-4b0c-815a-1f366b02b98e",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "content": "–û—Ç–ø—Ä–∞–≤–∫–∞ –±–∞–π–∫–∞ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä \n",
          "height": 260,
          "width": 300,
          "color": 3
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          2704,
          176
        ],
        "typeVersion": 1,
        "id": "54940db2-5311-4f24-92a0-691e75149987",
        "name": "Sticky Note4"
      },
      {
        "parameters": {
          "url": "https://app.chatflow.kz/api/v1/send-text",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "token",
                "value": "=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiJTaUN0NUJQdEpaUEVFb0FlZERRRXR6YldDSWVUOGE0dSIsInJvbGUiOiJ1c2VyIiwiaWF0IjoxNzcxMTUxNzc0fQ.EdGPEhk0to6vB5s54GCtVlh4cpmZmMSELpNfQYHm8tw"
              },
              {
                "name": "instance_id",
                "value": "=eyJ1aWQiOiJTaUN0NUJQdEpaUEVFb0FlZERRRXR6YldDSWVUOGE0dSIsImNsaWVudF9pZCI6Ikthcm1hUmVudCAifQ=="
              },
              {
                "name": "jid",
                "value": "={{ $('Webhook').item.json.body.metadata.remoteJid }}"
              },
              {
                "name": "msg",
                "value": "={{ $('Extract State').item.json.output }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2800,
          256
        ],
        "id": "347d496d-8d67-4450-a2a5-f349db069537",
        "name": "–°–æ–æ–±—â–µ–Ω–∏–µ –≤ WhatsApp"
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $('Webhook').item.json.body.metadata.remoteJid }}",
          "contextWindowLength": 30
        },
        "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
        "typeVersion": 1.3,
        "position": [
          1712,
          528
        ],
        "id": "ad542f4d-c01e-4742-8de8-ef468624932b",
        "name": "Simple Memory"
      },
      {
        "parameters": {
          "documentId": {
            "__rl": true,
            "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
            "mode": "list",
            "cachedResultName": "Karma Rent Bike Pro1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 379274933,
            "mode": "list",
            "cachedResultName": "–ë–∞–π–∫–∏",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE/edit#gid=379274933"
          },
          "options": {},
          "authentication": "serviceAccount",
          "descriptionType": "manual",
          "toolDescription": "–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç—É —Ç—É–ª–∑—É —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±–∞–π–∫–æ–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã.\n–¢–∞–±–ª–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç: –°–æ—Å—Ç–æ—è–Ω–∏–µ (A), –ë–∞–π–∫/–º–æ–¥–µ–ª—å (B), –ù–æ–º–µ—Ä (C), –ö–ª–∞—Å—Å (D), –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥ (E), –¶–µ–Ω–∞ –∑–∞ —Å—É—Ç–∫–∏ –≤ VND (F).\n\n–ö–û–ì–î–ê –í–´–ó–´–í–ê–¢–¨:\n- –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã (–¥–Ω–∏, –æ–ø—ã—Ç, –≥–æ—Ä–æ–¥)\n- –ß—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ –±–∞–π–∫–∏ (–°–æ—Å—Ç–æ—è–Ω–∏–µ = \"–°–≤–æ–±–æ–¥–µ–Ω\")\n- –ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–∞–π–∫–∞\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç: —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±–∞–π–∫–æ–≤ —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–æ–º, –º–æ–¥–µ–ª—å—é, –∫–ª–∞—Å—Å–æ–º –∏ —Ü–µ–Ω–æ–π. –§–∏–ª—å—Ç—Ä—É–π –ø–æ –°–æ—Å—Ç–æ—è–Ω–∏–µ = \"–°–≤–æ–±–æ–¥–µ–Ω\" –∏ –ø–æ–∫–∞–∑—ã–≤–∞–π –∫–ª–∏–µ–Ω—Ç—É —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ."
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.7,
        "position": [
          1984,
          528
        ],
        "id": "d7cc99c2-bac6-447b-9b40-832b140e7beb",
        "name": "Get row(s) in sheet in Google Sheets",
        "credentials": {
          "googleApi": {
            "id": "OMzR72oEyu6XISKt",
            "name": "Google Sheets account_KARMA_RENT"
          }
        }
      },
      {
        "parameters": {
          "descriptionType": "manual",
          "toolDescription": "–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç—É —Ç—É–ª–∑—É —á—Ç–æ –±—ã –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–π–∫–æ–≤ –ø–æ—Å–ª–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ \n–°–æ—Å—Ç–æ—è–Ω–∏–µ (–ü–æ–ª–µ A) - –í –ê—Ä–µ–Ω–¥–µ",
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
            "mode": "list",
            "cachedResultName": "Karma Rent Bike Pro1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 379274933,
            "mode": "list",
            "cachedResultName": "–ë–∞–π–∫–∏",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE/edit#gid=379274933"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "–°–æ—Å—Ç–æ—è–Ω–∏–µ": "–í –∞—Ä–µ–Ω–¥–µ",
              "row_number": 0
            },
            "matchingColumns": [
              "–°–æ—Å—Ç–æ—è–Ω–∏–µ"
            ],
            "schema": [
              {
                "id": "–°–æ—Å—Ç–æ—è–Ω–∏–µ",
                "displayName": "–°–æ—Å—Ç–æ—è–Ω–∏–µ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ë–∞–π–∫",
                "displayName": "–ë–∞–π–∫",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ù–æ–º–µ—Ä –±–∞–π–∫–∞ ",
                "displayName": "–ù–æ–º–µ—Ä –±–∞–π–∫–∞ ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ö–ª–∞—Å—Å",
                "displayName": "–ö–ª–∞—Å—Å",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–§–æ—Ç–æ",
                "displayName": "–§–æ—Ç–æ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",
                "displayName": "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ö–æ–º–µ–Ω—Ç–∞—Ä–∏–π",
                "displayName": "–ö–æ–º–µ–Ω—Ç–∞—Ä–∏–π",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "authentication": "serviceAccount"
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.7,
        "position": [
          2352,
          528
        ],
        "id": "aeb8f2bf-503c-4af0-a8ac-3e1074972c42",
        "name": "Update row in sheet in Google Sheets",
        "credentials": {
          "googleApi": {
            "id": "OMzR72oEyu6XISKt",
            "name": "Google Sheets account_KARMA_RENT"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 2
            },
            "conditions": [
              {
                "id": "8852bab7-230e-442a-a4a2-994e979c8f9f",
                "operator": {
                  "type": "number",
                  "operation": "equals"
                },
                "leftValue": "={{ $input.last().json.timestamp }}\n\n",
                "rightValue": "={{ $('Webhook').item.json.body.metadata.timestamp.toString() }}\n"
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "id": "e1a8c728-16b4-4f51-acd9-ff3e625df1c4",
        "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
        "type": "n8n-nodes-base.if",
        "position": [
          2160,
          -288
        ],
        "typeVersion": 2.2
      },
      {
        "parameters": {
          "operation": "delete",
          "tableId": "Message_Buffer",
          "filters": {
            "conditions": [
              {
                "keyName": "user_id",
                "condition": "eq",
                "keyValue": "={{ $json.user_id }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          2464,
          -304
        ],
        "id": "651cc2dc-33e6-438e-ad5f-fdccaffe0934",
        "name": "–°–±–æ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π",
        "credentials": {
          "supabaseApi": {
            "id": "u1mkv2sS5oh337qr",
            "name": "Supabase Karma_Worker"
          }
        }
      },
      {
        "parameters": {
          "fieldsToAggregate": {
            "fieldToAggregate": [
              {
                "fieldToAggregate": "message"
              }
            ]
          },
          "options": {}
        },
        "id": "fd34ebe1-d9b6-4656-83ab-997a053e7ced",
        "name": "–°—É–º–º–∞",
        "type": "n8n-nodes-base.aggregate",
        "position": [
          2752,
          -304
        ],
        "typeVersion": 1
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "mode": "list",
            "value": "gpt-4o-mini"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1.2,
        "position": [
          1536,
          528
        ],
        "id": "15400d68-9790-4bc2-86a5-507f6171ee88",
        "name": "OpenAI Chat Model",
        "credentials": {
          "openAiApi": {
            "id": "XF1cM38UXaYP6qBb",
            "name": "OpenAi D1Motors"
          }
        }
      },
      {
        "parameters": {
          "content": "–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞ –≤–æ –≤—Ç–æ—Ä–æ–º –≤–∏–¥–µ–æ –Ω–∞ –∫–∞–Ω–∞–ª–µ",
          "height": 860,
          "width": 1804
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -832,
          -512
        ],
        "typeVersion": 1,
        "id": "6bbfa434-a7b2-4551-b7df-8546c9b517b4",
        "name": "Sticky Note1"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "text",
                      "rightValue": "={{ $json.messageType }}",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "7d2a8cb9-ee05-4c48-a620-6d701b21002b"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "3489ec87-b04e-4b1e-ade1-81424608aafa",
                      "leftValue": "audio",
                      "rightValue": "={{ $json.messageType }}",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "audio"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "6c404022-4092-4ba6-9399-ff9a520d47c6",
                      "leftValue": "image",
                      "rightValue": "={{ $json.messageType }}",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "image"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "8e5eedbe-968b-4175-94a3-b505f3068b7e",
                      "leftValue": "document",
                      "rightValue": "={{ $json.messageType }}",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "document"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -592,
          -256
        ],
        "id": "1ec75ec9-8d5e-4b3d-b345-fbc802bae521",
        "name": "Switch"
      },
      {
        "parameters": {
          "url": "={{ $json.pdf }}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true,
                "responseFormat": "file",
                "outputPropertyName": "=data"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -80,
          112
        ],
        "id": "08f44d7b-eeab-4737-bba7-0ca70c5085f7",
        "name": "HTTP Request"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "960ff6f3-909b-4028-bfa3-d275c85ed6f9",
                "name": "sender",
                "type": "string",
                "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
              },
              {
                "id": "efed5d73-27e8-4538-b7d9-3044f1ec3288",
                "name": "message",
                "value": "={{ $json.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "ff95a31a-3523-4596-85f9-4578cdc9da0e",
        "name": "Set Payment Response2",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          720,
          112
        ]
      },
      {
        "parameters": {
          "url": "={{ $json.image }}",
          "options": {
            "response": {
              "response": {
                "fullResponse": true,
                "responseFormat": "file",
                "outputPropertyName": "=data"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -80,
          -64
        ],
        "id": "2be6553a-905f-476e-91c2-a80a06051e07",
        "name": "HTTP Request3"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "960ff6f3-909b-4028-bfa3-d275c85ed6f9",
                "name": "sender",
                "type": "string",
                "value": "={{ $(\"Webhook\").item.json.body.metadata.remoteJid }}"
              },
              {
                "id": "dbfc6897-26c0-4161-b078-740a98d1aa8c",
                "name": "message",
                "type": "string",
                "value": "={{ $json.content }}"
              }
            ]
          },
          "options": {}
        },
        "id": "c440741f-879e-4a38-977e-dfc587ad8a06",
        "name": "Set Payment Response3",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          720,
          -64
        ],
        "alwaysOutputData": false,
        "notesInFlow": false
      },
      {
        "parameters": {
          "operation": "pdf",
          "options": {}
        },
        "id": "9a8ea6c1-406a-4903-ae12-a910047c5740",
        "name": "Extract PDF Text",
        "type": "n8n-nodes-base.extractFromFile",
        "typeVersion": 1,
        "position": [
          192,
          112
        ]
      },
      {
        "parameters": {
          "resource": "image",
          "operation": "analyze",
          "modelId": {
            "__rl": true,
            "value": "gpt-4o",
            "mode": "list",
            "cachedResultName": "GPT-4O"
          },
          "text": "–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.\n\n–ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç (–ø–∞—Å–ø–æ—Ä—Ç, ID, –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ, –ø—Ä–∞–≤–∞) ‚Äî –Ω–∞—á–Ω–∏ –æ—Ç–≤–µ—Ç —Å —Ç–µ–≥–∞ [–î–û–ö–£–ú–ï–ù–¢].\n–ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî –Ω–∞—á–Ω–∏ —Å —Ç–µ–≥–∞ [–§–û–¢–û].\n\n–ü–æ—Å–ª–µ —Ç–µ–≥–∞ ‚Äî –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏ —á—Ç–æ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏.",
          "inputType": "base64",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          192,
          -64
        ],
        "id": "b41e86c1-a1b0-4d35-b186-6120cb815272",
        "name": "Analyze image1",
        "credentials": {
          "openAiApi": {
            "id": "AOBRqgI9aa99plds",
            "name": "OpenAi Karma_Rent"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "2f8abb0f-2aaf-49ed-b2da-f092775f47a3",
                "name": "sender",
                "value": "={{ $json.body.metadata.remoteJid }}",
                "type": "string"
              },
              {
                "id": "70b56414-635b-4e1d-bb0f-d46a5b0f7aba",
                "name": "messageType",
                "value": "={{ $json.body.messageType }}",
                "type": "string"
              },
              {
                "id": "c7bdfe19-e9cd-4d73-b497-cb3f4f46c8ee",
                "name": "text message",
                "value": "={{ $json.body.message }}",
                "type": "string"
              },
              {
                "id": "8429b40f-b61c-4564-ac6b-d925151c2c65",
                "name": "audio message",
                "value": "={{ $json.body.mediaData.base64 }}",
                "type": "string"
              },
              {
                "id": "0cdf4162-4c2d-4bef-9b64-02bd7d6eac69",
                "name": "image",
                "value": "={{ $json.body.mediaData.url }}",
                "type": "string"
              },
              {
                "id": "bdd37591-1ef7-42f1-91ff-a1716485354d",
                "name": "pdf",
                "value": "={{ $json.body.mediaData.url }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -752,
          -224
        ],
        "id": "52bce193-950a-4002-85bd-bcb3a8fbb236",
        "name": "Edit Fields4"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "4aa71e06-3620-4e33-94be-28a53ff07c6f",
                "name": "sender",
                "value": "={{ $json.sender }}",
                "type": "string"
              },
              {
                "id": "f53588bd-200f-4dab-a639-ff3b3ea640c5",
                "name": "message",
                "value": "={{ $json['text message'] }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          416,
          -448
        ],
        "id": "ab9755cd-f5b1-4297-88fb-8c38af3b0c1c",
        "name": "Edit Fields5"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "a125f358-6efd-4d14-be3a-d3df77c34274",
                "name": "sender",
                "value": "={{ $json.sender }}",
                "type": "string"
              },
              {
                "id": "19b2a85e-9877-47e2-b82c-8d995b2183c0",
                "name": "audio message",
                "value": "={{ $json['audio message'] }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -80,
          -240
        ],
        "id": "0989ecc8-00d8-4343-a91c-7e01c79fec05",
        "name": "Edit Fields6"
      },
      {
        "parameters": {
          "operation": "toBinary",
          "sourceProperty": "audio message",
          "options": {
            "mimeType": "audio/ogg"
          }
        },
        "type": "n8n-nodes-base.convertToFile",
        "typeVersion": 1.1,
        "position": [
          192,
          -240
        ],
        "id": "b662d657-d516-4455-ba4e-991a75f26fd8",
        "name": "Convert to File1"
      },
      {
        "parameters": {
          "resource": "audio",
          "operation": "transcribe",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.openAi",
        "typeVersion": 1.8,
        "position": [
          416,
          -240
        ],
        "id": "a2bf4a7f-f1da-4a0a-95cc-e4d55d979eff",
        "name": "OpenAI1",
        "credentials": {
          "openAiApi": {
            "id": "AOBRqgI9aa99plds",
            "name": "OpenAi Karma_Rent"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "fe1c1138-fe9f-4d00-9743-5e66282d9074",
                "name": "sender",
                "value": "={{ $('Edit Fields6').item.json.sender }}",
                "type": "string"
              },
              {
                "id": "ec2514bb-d888-4e2c-b427-617acf2295d6",
                "name": "message",
                "value": "={{ $json.text }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          720,
          -240
        ],
        "id": "831ddb82-77c4-4d04-bad7-1e0c0ea12a27",
        "name": "Edit Fields7"
      },
      {
        "parameters": {
          "content": "",
          "height": 240,
          "width": 320,
          "color": 6
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          -1280,
          -272
        ],
        "typeVersion": 1,
        "id": "30775e05-1a9d-430f-9c2d-faf9efcfb9b4",
        "name": "Sticky Note5"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "6b2abf67-a83b-4cb7-bc7b-81be5cf2e820",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          -1184,
          -224
        ],
        "id": "8604b9e9-b4e3-4e67-bce6-19232e582709",
        "name": "Webhook",
        "webhookId": "6b2abf67-a83b-4cb7-bc7b-81be5cf2e820"
      },
      {
        "parameters": {
          "descriptionType": "manual",
          "toolDescription": "=‚Äì –ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç –≤—ã—Å–ª–∞–ª —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞, –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–∑–æ–≤–∏ —Ç—É–ª–∑—É \"Update row in sheet in Google Sheets\" —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ \n{\"row_number\": 2, \"–°–æ—Å—Ç–æ—è–Ω–∏–µ\": \"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω\"} \n–≥–¥–µ 2 - —ç—Ç–æ row_number –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –±–∞–π–∫–∞\n\n–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç—É —Ç—É–ª–∑—É —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–π–∫–æ–≤ –ø–æ—Å–ª–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤.\n\n–í–ê–ñ–ù–û:\n- –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –≤—ã–∑–æ–≤–∏ —ç—Ç—É —Ç—É–ª–∑—É\n- –ü–µ—Ä–µ–¥–∞–π row_number –±–∞–π–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±—Ä–∞–ª –∫–ª–∏–µ–Ω—Ç (—Ç—ã –ø–æ–ª—É—á–∏–ª –µ–≥–æ –∏–∑ Get row(s) in sheet)\n- –£—Å—Ç–∞–Ω–æ–≤–∏ –°–æ—Å—Ç–æ—è–Ω–∏–µ = \"–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω\"\n\n–ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª –±–∞–π–∫ —Å row_number = 5, –ø–µ—Ä–µ–¥–∞–π:\nrow_number: 5\n–°–æ—Å—Ç–æ—è–Ω–∏–µ: –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω",
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE",
            "mode": "list",
            "cachedResultName": "Karma Rent Bike Pro1",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 379274933,
            "mode": "list",
            "cachedResultName": "–ë–∞–π–∫–∏",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1knpg3fWFiPLu2dFUQYTiOsuD-GRmcICnLKFnBf-EgGE/edit#gid=379274933"
          },
          "columns": {
            "mappingMode": "autoMapInputData",
            "value": {},
            "matchingColumns": [
              "row_number"
            ],
            "schema": [
              {
                "id": "–°–æ—Å—Ç–æ—è–Ω–∏–µ",
                "displayName": "–°–æ—Å—Ç–æ—è–Ω–∏–µ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ë–∞–π–∫",
                "displayName": "–ë–∞–π–∫",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ù–æ–º–µ—Ä –±–∞–π–∫–∞ ",
                "displayName": "–ù–æ–º–µ—Ä –±–∞–π–∫–∞ ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ö–ª–∞—Å—Å",
                "displayName": "–ö–ª–∞—Å—Å",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–§–æ—Ç–æ",
                "displayName": "–§–æ—Ç–æ",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",
                "displayName": "–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "–ö–æ–º–µ–Ω—Ç–∞—Ä–∏–π",
                "displayName": "–ö–æ–º–µ–Ω—Ç–∞—Ä–∏–π",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "row_number",
                "displayName": "row_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "number",
                "canBeUsedToMatch": true,
                "readOnly": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {},
          "authentication": "serviceAccount"
        },
        "type": "n8n-nodes-base.googleSheetsTool",
        "typeVersion": 4.7,
        "position": [
          2704,
          560
        ],
        "id": "045c8e67-533e-4b6d-85bd-202328732113",
        "name": "Update row in sheet in Google Sheets2",
        "credentials": {
          "googleApi": {
            "id": "OMzR72oEyu6XISKt",
            "name": "Google Sheets account_KARMA_RENT"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 2
            },
            "conditions": [
              {
                "id": "f1-84586066091",
                "leftValue": "={{ $json.body.metadata.remoteJid }}",
                "rightValue": "84586066091",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              },
              {
                "id": "f2-79262579414",
                "leftValue": "={{ $json.body.metadata.remoteJid }}",
                "rightValue": "79262579414",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              }
            ],
            "combinator": "or"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -968,
          -224
        ],
        "id": "phone-filter-node-new",
        "name": "Phone Filter"
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "user_state",
          "filters": {
            "conditions": [
              {
                "keyName": "jid",
                "condition": "eq",
                "keyValue": "={{ $('Edit Fields4').first().json.sender }}"
              }
            ]
          },
          "limit": 1,
          "options": {}
        },
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          2900,
          -304
        ],
        "id": "fe9ca20f-a784-400d-9cfb-37ce29a6f6f8",
        "name": "Get User State",
        "credentials": {
          "supabaseApi": {
            "id": "u1mkv2sS5oh337qr",
            "name": "Supabase Karma_Worker"
          }
        },
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "jsCode": "// Get state from Supabase\\nconst items = $input.all();\\nconst summaData = $('–°—É–º–º–∞').first().json;\\nconst senderData = $('Edit Fields4').first().json;\\nconst sender = senderData.sender || '';\\nconst message = summaData.message || '';\\n\\n// Build state context\\nlet stateContext = '';\\nif (items.length > 0 && items[0].json.state && Object.keys(items[0].json.state).length > 0) {\\n  const state = items[0].json.state;\\n  \\n  // Check state reset: if updated_at > 24h, reset\\n  const updatedAt = items[0].json.updated_at;\\n  if (updatedAt) {\\n    const hoursAgo = (Date.now() - new Date(updatedAt).getTime()) / 3600000;\\n    if (hoursAgo > 12) {\\n      // State expired, start fresh\\n      return [{ json: { sender, message: '–î–ê–ù–ù–´–ï –ö–õ–ò–ï–ù–¢–ê: –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ (–ø—Ä–µ–¥—ã–¥—É—â–∏–π >12—á –Ω–∞–∑–∞–¥)' + '\\\\n---\\\\n' + message } }];\\n    }\\n  }\\n  \\n  stateContext = '–î–ê–ù–ù–´–ï –ö–õ–ò–ï–ù–¢–ê:\\\\n';\\n  for (const [key, value] of Object.entries(state)) {\\n    stateContext += '[' + key + ': ' + value + ']\\\\n';\\n  }\\n}\\n\\n// Flow rules ‚Äî always injected\\nconst flowRules = `\\n–§–õ–û–£ –î–ò–ê–õ–û–ì–ê:\\n1. –ü–†–ò–í–ï–¢–°–¢–í–ò–ï ‚Üí —Å–ø—Ä–æ—Å–∏: —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π? –¥–ª—è –≥–æ—Ä–æ–¥–∞/–¥–∞–ª—å–Ω–∏—Ö? –æ–ø—ã—Ç?\\n2. –í–´–Ø–°–ù–ï–ù–ò–ï ‚Üí –∫–ª–∏–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã ‚Üí –≤—ã–∑–æ–≤–∏ Get Sheets ‚Üí –ø–æ–∫–∞–∂–∏ —Å–≤–æ–±–æ–¥–Ω—ã–µ –±–∞–π–∫–∏\\n3. –ü–û–î–ë–û–† ‚Üí –ø–æ–∫–∞–∑–∞–ª –±–∞–π–∫–∏, –∫–ª–∏–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç\\n4. –í–´–ë–û–† ‚Üí –∫–ª–∏–µ–Ω—Ç —Å–∫–∞–∑–∞–ª \"—Ö–æ—á—É —ç—Ç–æ—Ç\"/\"–±–µ—Ä—É\" ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–¥–∏ –≤—ã–±–æ—Ä, –ø–æ–ø—Ä–æ—Å–∏ —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞/ID\\n5. –ü–ê–°–ü–û–†–¢ ‚Üí –∂–¥—ë–º —Ñ–æ—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞. [–î–û–ö–£–ú–ï–ù–¢]=–±—Ä–æ–Ω–∏—Ä—É–π, [–§–û–¢–û]=–ø–æ–ø—Ä–æ—Å–∏ –ø–∞—Å–ø–æ—Ä—Ç –∑–∞–Ω–æ–≤–æ. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Ö–æ—á–µ—Ç –ø–æ–º–µ–Ω—è—Ç—å –±–∞–π–∫ –∏–ª–∏ –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äî –≤–µ—Ä–Ω–∏ –Ω–∞ —ç—Ç–∞–ø –ü–û–î–ë–û–†/–í–´–Ø–°–ù–ï–ù–ò–ï\\n6. –ó–ê–ë–†–û–ù–ò–†–û–í–ê–ù ‚Üí –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±—Ä–æ–Ω–∏/–æ—Ç–º–µ–Ω—É/–¥–µ—Ç–∞–ª–∏ ‚Äî –æ—Ç–≤–µ—Ç—å —á—Ç–æ —Å –Ω–∏–º —Å–≤—è–∂–µ—Ç—Å—è –æ–ø–µ—Ä–∞—Ç–æ—Ä –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π. –ù–∞ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ù–ï –æ—Ç–≤–µ—á–∞–π (–º–æ–ª—á–∏, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ä–∞–∑–±–µ—Ä—É—Ç—Å—è).\\n\\n–°–¢–û–ü–°–õ–û–í–ê ‚Äî –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –≥–æ–≤–æ—Ä–∏—Ç: \"–æ—Ç–º–µ–Ω–∞\"/\"–Ω–µ –Ω–∞–¥–æ\"/\"–ø–µ—Ä–µ–¥—É–º–∞–ª\"/\"cancel\"/\"no thanks\":\\n‚Üí –ù–ï –Ω–∞—Å—Ç–∞–∏–≤–∞–π, –Ω–æ –º—è–≥–∫–æ –æ—Å—Ç–∞–≤—å –¥–≤–µ—Ä—å –æ—Ç–∫—Ä—ã—Ç–æ–π\\n‚Üí –ü—Ä–∏–º–µ—Ä—ã: \"–•–æ—Ä–æ—à–æ\\! –ï—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–µ—Ç–µ ‚Äî –º—ã –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏ üòä\" / \"–ë–µ–∑ –ø—Ä–æ–±–ª–µ–º\\! –ë—É–¥–µ–º —Ä–∞–¥—ã –ø–æ–º–æ—á—å, –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç–µ –≥–æ—Ç–æ–≤—ã ü§ô\"\\n‚Üí –ü–æ—Å—Ç–∞–≤—å —ç—Ç–∞–ø: \"–æ—Ç–º–µ–Ω—ë–Ω\"\\n‚Üí –û–¥–Ω–æ –≤–µ–∂–ª–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –ù–ï —É–≥–æ–≤–∞—Ä–∏–≤–∞–π –ø–æ–≤—Ç–æ—Ä–Ω–æ\\n\\n–ü–†–ê–í–ò–õ–û: –æ–±–Ω–æ–≤–ª—è–π —ç—Ç–∞–ø –≤ STATE –ø—Ä–∏ –ö–ê–ñ–î–û–ú –ø–µ—Ä–µ—Ö–æ–¥–µ\\!\\n`;\\n\\nreturn [{\\n  json: {\\n    sender: sender,\\n    message: stateContext + flowRules + '---\\\\n–°–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞: ' + message\\n  }\\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          3060,
          -304
        ],
        "id": "d858893a-adb6-401f-9d26-db806f1c43d1",
        "name": "Inject State"
      },
      {
        "parameters": {
          "jsCode": "// Get AI Agent response\nconst aiOutput = $input.first().json.output || $input.first().json.text || '';\nconst sender = $('Edit Fields4').first().json.sender || '';\n\nconst state = {};\n\n// Extract STATE: {...} block (primary method)\nconst stateMatch = aiOutput.match(/STATE:\\s*\\{([^}]+)\\}/);\nif (stateMatch) {\n  try {\n    const parsed = JSON.parse('{' + stateMatch[1] + '}');\n    Object.assign(state, parsed);\n  } catch(e) {}\n}\n\n// Clean response for WhatsApp (remove STATE block)\nlet cleanOutput = aiOutput.replace(/STATE:\\s*\\{[^}]+\\}\\n?/g, '').trim();\n\nreturn [{\n  json: {\n    output: cleanOutput,\n    sender: sender,\n    state: state,\n    hasState: Object.keys(state).length > 0\n  }\n}];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2200,
          256
        ],
        "id": "3555a285-2983-42fb-a95c-ff6edff24a5e",
        "name": "Extract State"
      },
      {
        "parameters": {
          "jsCode": "// Upsert user state to Supabase\nconst sender = $json.sender || '';\nconst state = $json.state || {};\n\nif (!sender) {\n  return [{ json: { success: false, error: 'no sender' } }];\n}\n\nconst key = $env.SUPABASE_SERVICE_ROLE_KEY;\nconst url = 'https://upjyomatlonfgygoniir.supabase.co/rest/v1/user_state';\n\nconst response = await this.helpers.httpRequest({\n  method: 'POST',\n  url: url,\n  headers: {\n    'apikey': key,\n    'Authorization': 'Bearer ' + key,\n    'Content-Type': 'application/json',\n    'Prefer': 'resolution=merge-duplicates'\n  },\n  body: {\n    jid: sender,\n    state: state,\n    updated_at: new Date().toISOString()\n  },\n  returnFullResponse: true\n});\n\nreturn [{ json: { success: true, status: response.statusCode || 201, sender } }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2400,
          256
        ],
        "id": "e16baf7d-8a56-4ea9-8a58-0a97e02dea96",
        "name": "Save User State",
        "credentials": {}
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": false,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 2
            },
            "conditions": [
              {
                "id": "check-booked",
                "leftValue": "={{ $('Get User State').first().json.state?.—ç—Ç–∞–ø || '' }}",
                "rightValue": "–∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "check-cancelled",
                "leftValue": "={{ $('Get User State').first().json.state?.—ç—Ç–∞–ø || '' }}",
                "rightValue": "–æ—Ç–º–µ–Ω—ë–Ω",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          3200,
          -304
        ],
        "id": "e87cf19d-2206-49f2-80b4-d2cad1a85628",
        "name": "Check Stage"
      }
    ],
    "connections": {
      "Sort by Message ID": {
        "main": [
          [
            {
              "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "–ë–µ—Ä–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è": {
        "main": [
          [
            {
              "node": "Sort by Message ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π": {
        "main": [
          [
            {
              "node": "–ë–µ—Ä–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 10 Seconds": {
        "main": [
          []
        ]
      },
      "Simple Memory": {
        "ai_memory": [
          [
            {
              "node": "AI Agent",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "AI Agent": {
        "main": [
          [
            {
              "node": "Extract State",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ": {
        "main": [
          [
            {
              "node": "–°–±–æ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "–°–±–æ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π": {
        "main": [
          [
            {
              "node": "–°—É–º–º–∞",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "–°—É–º–º–∞": {
        "main": [
          [
            {
              "node": "Get User State",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Switch": {
        "main": [
          [
            {
              "node": "Edit Fields5",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Edit Fields6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HTTP Request3",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request": {
        "main": [
          [
            {
              "node": "Extract PDF Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "HTTP Request3": {
        "main": [
          [
            {
              "node": "Analyze image1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract PDF Text": {
        "main": [
          [
            {
              "node": "Set Payment Response2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze image1": {
        "main": [
          [
            {
              "node": "Set Payment Response3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields4": {
        "main": [
          [
            {
              "node": "Switch",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields6": {
        "main": [
          [
            {
              "node": "Convert to File1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to File1": {
        "main": [
          [
            {
              "node": "OpenAI1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI1": {
        "main": [
          [
            {
              "node": "Edit Fields7",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "Phone Filter",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields5": {
        "main": [
          [
            {
              "node": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields7": {
        "main": [
          [
            {
              "node": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Payment Response3": {
        "main": [
          [
            {
              "node": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Payment Response2": {
        "main": [
          [
            {
              "node": "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update row in sheet in Google Sheets2": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Phone Filter": {
        "main": [
          [
            {
              "node": "Edit Fields4",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Get User State": {
        "main": [
          [
            {
              "node": "Inject State",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Inject State": {
        "main": [
          [
            {
              "node": "Check Stage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Extract State": {
        "main": [
          [
            {
              "node": "Save User State",
              "type": "main",
              "index": 0
            },
            {
              "node": "–°–æ–æ–±—â–µ–Ω–∏–µ –≤ WhatsApp",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Stage": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s) in sheet in Google Sheets": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Denis Karmarent",
    "name": null,
    "description": null,
    "autosaved": false,
    "workflowPublishHistory": [
      {
        "createdAt": "2026-02-20T20:14:48.145Z",
        "id": 28,
        "workflowId": "rC30SNQvTZG9Zhza",
        "versionId": "bf349a23-a928-406c-b044-bfa147991829",
        "event": "activated",
        "userId": "32ebda6a-f598-4a39-9108-5156d43057e3"
      }
    ]
  }
}