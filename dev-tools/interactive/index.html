<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bikes Project - Tree View</title>
    <!-- Highlight.js –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/clojure.min.js"></script>
    <style>
        @font-face {
            font-family: 'Randy GG Bold';
            src: url('randy-gg-bold (1).ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Randy GG Bold', monospace;
            background: #0a0a0a;
            color: #e0e0e0;
            padding: 40px;
            padding-right: 490px; /* –û—Ç—Å—Ç—É–ø —Å–ø—Ä–∞–≤–∞ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –ø—Ä–µ–≤—å—é (450px + 40px) */
            line-height: 1.6;
        }
        .tree {
            margin-left: 0;
        }
        .node {
            margin: 4px 0;
            display: grid;
            grid-template-columns: auto 1fr;
            align-items: baseline;
            gap: 16px;
            min-height: 1em;
            padding: 4px 8px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            border-radius: 6px;
            transition: border-color 0.2s, background-color 0.2s;
        }
        /* –£—Ä–æ–≤–µ–Ω—å 1: Hover (–Ω–∞–≤–µ–¥–µ–Ω–∏–µ) - –±–æ–ª–µ–µ —Ç–æ–ª—Å—Ç–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ */
        .node.hover-active {
            border-color: rgba(0, 255, 255, 0.4);
            background-color: rgba(0, 255, 255, 0.08);
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.3);
            border-width: 2px;
        }
        /* –£—Ä–æ–≤–µ–Ω—å 2: Selected (–∫–ª–∏–∫) - –æ–±—ã—á–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ */
        .node.selected {
            border-color: rgba(0, 255, 255, 0.3);
            background-color: rgba(0, 255, 255, 0.05);
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.2);
            border-width: 1px;
        }
        /* –£—Ä–æ–≤–µ–Ω—å 3: Selected + Hover (–∫–ª–∏–∫ + –Ω–∞–≤–µ–¥–µ–Ω–∏–µ) - —Å–∞–º–æ–µ —Ç–æ–ª—Å—Ç–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ */
        .node.selected.hover-active {
            border-color: rgba(0, 255, 255, 0.6);
            background-color: rgba(0, 255, 255, 0.12);
            box-shadow: 0 0 16px rgba(0, 255, 255, 0.4);
            border-width: 3px;
        }
        .key {
            font-weight: 500;
            transition: color 0.2s;
            font-family: 'Randy GG Bold', monospace;
        }
        .key:hover {
            color: #00ffff;
            cursor: pointer;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        .value {
            word-break: break-word;
            font-family: 'Randy GG Bold', monospace;
            color: #5a00ff; /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            text-shadow: 0 0 2px #5a00ff, 0 0 3px #5a00ff, 0 0 6px #5a00ff, 0 0 16px #2a00ff;
            padding: 3px 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            display: inline-block;
            background-color: rgba(255, 255, 255, 0.01);
        }
        /* –ñ–µ–ª—Ç—ã–π –Ω–µ–æ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ª–∏—Ç–µ—Ä–∞–ª–æ–≤ (–æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) */
        .value.string-literal {
            color: #d4ff00 !important;
            text-shadow: 0 0 2px #d4ff00, 0 0 3px #d4ff0080, 0 0 6px #d4ff00, 0 0 16px #d4ff00 !important;
        }
        /* –ë–µ–ª—ã–π –Ω–µ–æ–Ω –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–æ–≤ - –∞–ª–≥–æ—Ä–∏—Ç–º—ã */
        .value.array-item {
            color: #FFFFFF !important; /* –ë–µ–ª—ã–π –Ω–µ–æ–Ω –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–æ–≤ */
            text-shadow: 0 0 2px #FFFFFF, 0 0 4px #FFFFFF, 0 0 8px #FFFFFF !important;
        }
        /* –°—Å—ã–ª–∫–∏ –≤–Ω—É—Ç—Ä–∏ –º–∞—Å—Å–∏–≤–æ–≤ –Ω–∞—Å–ª–µ–¥—É—é—Ç —Ü–≤–µ—Ç–∞ –æ—Ç –æ–±—â–∏—Ö –ø—Ä–∞–≤–∏–ª –¥–ª—è references */
        .bracket {
            color: #00ffff;
            font-weight: bold;
            font-family: 'Randy GG Bold', monospace;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        .children {
            grid-column: 1 / -1;
            margin-left: 4ch;
            padding-left: 0;
            border-left: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: 4px;
        }

        /* –†–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è - –ª–∏–Ω–µ–π–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ */
        /* –£—Ä–æ–≤–Ω–∏: —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π, —Ä–æ–∑–æ–≤—ã–π, –±–∏—Ä—é–∑–æ–≤—ã–π, —Å–∏–Ω–∏–π, —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π, –±–µ–ª—ã–π */
        .level-0 .key { font-size: 24px; color: #5a00ff; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #5a00ff, 0 0 3px #5a00ff, 0 0 6px #5a00ff, 0 0 16px #2a00ff; font-weight: bold; } /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è */
        .level-1 .key { font-size: 20px; color: #AB38BA; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #AB38BA, 0 0 3px #AB38BA80, 0 0 6px #AB38BA, 0 0 16px #AB38BA; } /* –†–æ–∑–æ–≤—ã–π –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è */
        .level-2 .key { font-size: 18px; color: #00ffff; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff; } /* –ë–∏—Ä—é–∑–æ–≤—ã–π –¥–ª—è —Ç—Ä–µ—Ç—å–µ–≥–æ —É—Ä–æ–≤–Ω—è */
        .level-3 .key { font-size: 16px; color: #0050ff; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff; } /* –°–∏–Ω–∏–π –¥–ª—è —á–µ—Ç–≤–µ—Ä—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è */
        .level-4 .key { font-size: 14px; color: #5a00ff; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #5a00ff, 0 0 3px #5a00ff, 0 0 6px #5a00ff, 0 0 16px #2a00ff; } /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è –ø—è—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è */
        .level-5 .key { font-size: 12px; color: #FFFFFF; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #FFFFFF, 0 0 4px #FFFFFF, 0 0 8px #FFFFFF; } /* –ë–µ–ª—ã–π –¥–ª—è —à–µ—Å—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è */
        .level-6 .key { font-size: 11px; color: #FFFFFF; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #FFFFFF, 0 0 4px #FFFFFF, 0 0 8px #FFFFFF; }
        .level-7 .key { font-size: 10px; color: #FFFFFF; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #FFFFFF, 0 0 4px #FFFFFF, 0 0 8px #FFFFFF; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–∑–æ–≤–æ–≤ (references) - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ü–≤–µ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π */
        .reference.key-type-ui,
        .reference.key-type-screen { color: #ff0080 !important; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #ff006f, 0 0 6px #ff006f80, 0 0 20px #ff006f !important; } /* –†–æ–∑–æ–≤—ã–π –∫—Ä–∞—Å–Ω—ã–π –¥–ª—è UI/—Ä–æ—É—Ç–æ–≤ */
        .reference.key-type-action { color: #00ffff !important; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff !important; } /* –ë–∏—Ä—é–∑–æ–≤—ã–π –¥–ª—è —ç–∫—à–µ–Ω–æ–≤ */
        .reference.key-type-bluetooth { color: #0050ff !important; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff !important; } /* –°–∏–Ω–∏–π –¥–ª—è bluetooth */
        .reference.key-type-api { color: #d4ff00 !important; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #00ff40, 0 0 10px #02ffa6, 0 0 5px #05ffa7, 0 0 25px #8300fe !important; } /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è API */
        .reference.key-type-state { color: #ff3700 !important; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #ff3700, 0 0 3px #ff370080, 0 0 6px #ff3700, 0 0 16px #ff3700 !important; } /* –û—Ä–∞–Ω–∂–µ–≤—ã–π –¥–ª—è state */
        .reference.key-type-util { color: #5a00ff !important; font-family: 'Randy GG Bold', monospace; text-shadow: 0 0 2px #5a00ff, 0 0 3px #5a00ff, 0 0 6px #5a00ff, 0 0 16px #2a00ff !important; } /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è utils */

        /* –î–ª—è –∑–Ω–∞—á–µ–Ω–∏–π —Ç–æ–∂–µ –ª–∏–Ω–µ–π–Ω–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ */
        .level-0 .value { font-size: 22px; font-family: 'Randy GG Bold', monospace; }
        .level-1 .value { font-size: 18px; font-family: 'Randy GG Bold', monospace; }
        .level-2 .value { font-size: 16px; font-family: 'Randy GG Bold', monospace; }
        .level-3 .value { font-size: 14px; font-family: 'Randy GG Bold', monospace; }
        .level-4 .value { font-size: 12px; font-family: 'Randy GG Bold', monospace; }
        .level-5 .value { font-size: 11px; font-family: 'Randy GG Bold', monospace; }
        .level-6 .value { font-size: 10px; font-family: 'Randy GG Bold', monospace; }
        .level-7 .value { font-size: 9px; font-family: 'Randy GG Bold', monospace; }

        .arrow {
            color: #0050ff;
            font-weight: bold;
            font-family: 'Randy GG Bold', monospace;
            text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;
        }
        .reference {
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.2s;
            font-family: 'Randy GG Bold', monospace;
        }
        /* –¶–≤–µ—Ç —Å—Å—ã–ª–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å—ã key-type-state/key-type-action */
        .reference.key-type-state:hover {
            background: rgba(255, 121, 0, 0.1);
        }
        .reference.key-type-action:hover {
            background: rgba(0, 255, 222, 0.1);
        }
        .reference.key-type-screen:hover,
        .reference.key-type-util:hover {
            background: rgba(81, 54, 246, 0.1);
        }
        .reference:hover {
            background: rgba(79, 195, 247, 0.1);
        }
        .tooltip {
            display: none !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }
        .tooltip.visible {
            display: none !important;
        }
        .tooltip .callers {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #333;
        }
        .tooltip .callers-title {
            font-weight: bold;
            color: #00ffff;
            margin-bottom: 8px;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        .tooltip .caller-item {
            padding: 4px 0;
            cursor: pointer;
            color: #0050ff;
            text-decoration: underline;
            text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;
        }
        .tooltip .caller-item:hover {
            color: #00ffff;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        .nav-back-btn {
            position: fixed;
            bottom: 20px;
            right: 470px;
            background: #00ffff;
            color: #0a0a0a;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s, transform 0.2s;
            box-shadow: 0 0 10px #00cfff, 0 4px 12px rgba(0, 207, 255, 0.3);
        }
        .nav-back-btn.visible {
            opacity: 1;
            pointer-events: all;
        }
        .nav-back-btn:hover {
            background: #0050ff;
            transform: translateY(-2px);
            box-shadow: 0 0 15px #0025ff, 0 6px 16px rgba(0, 37, 255, 0.4);
        }
        .nav-back-btn:active {
            transform: translateY(0);
        }
        
        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å –ø—Ä–µ–≤—å—é - –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–∞ */
        .preview-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 450px;
            height: 100vh;
            background: #1a1a1a;
            border-left: 2px solid #00ffff;
            z-index: 1001;
            overflow: hidden;
            padding: 0;
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 207, 255, 0.2);
            display: flex;
            flex-direction: column;
        }
        .preview-ui-container {
            height: 50%;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            border-bottom: 2px solid #00ffff;
        }
        .preview-code-container {
            height: 50%;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
        }
        .resize-handle {
            position: absolute;
            left: 0;
            top: 0;
            width: 8px;
            height: 100%;
            cursor: ew-resize;
            background: transparent;
            z-index: 1002;
            transition: background 0.2s;
        }
        .resize-handle:hover {
            background: rgba(0, 255, 255, 0.3);
        }
        .resize-handle::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 40px;
            background: #00ffff;
            opacity: 0.5;
        }
        .preview-section {
            margin-bottom: 24px;
        }
        .preview-section-title {
            color: #0050ff;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;
        }
        .preview-code {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Randy GG Bold', monospace;
            font-size: 12px;
            line-height: 1.6;
            color: #0050ff;
            text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è highlight.js —Å –Ω–µ–æ–Ω–æ–≤–æ–π —Ç–µ–º–æ–π */
        .hljs {
            background: #000000 !important;
            color: #0050ff;
            text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;
        }
        .hljs-comment,
        .hljs-quote {
            color: #3a00fa72;
            text-shadow: none;
        }
        .hljs-keyword,
        .hljs-selector-tag,
        .hljs-addition {
            color: #c800ff;
            text-shadow: 0 0 2px #4a00ff, 0 0 6px #8000ff, 0 0 20px #8000ff;
        }
        .hljs-number,
        .hljs-string,
        .hljs-meta .hljs-meta-string,
        .hljs-literal,
        .hljs-doctag,
        .hljs-regexp {
            color: #0050ff;
            text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;
        }
        .hljs-title,
        .hljs-section,
        .hljs-name,
        .hljs-selector-id,
        .hljs-selector-class {
            color: #ff3700;
            text-shadow: 0 0 2px #ff3700, 0 0 3px #ff370080, 0 0 6px #ff3700, 0 0 16px #ff3700;
        }
        .hljs-attribute,
        .hljs-attr,
        .hljs-variable,
        .hljs-template-variable,
        .hljs-class .hljs-title,
        .hljs-type {
            color: #ff3700;
            text-shadow: 0 0 2px #ff3700, 0 0 3px #ff370080, 0 0 6px #ff3700, 0 0 16px #ff3700;
        }
        .hljs-symbol,
        .hljs-bullet,
        .hljs-subst,
        .hljs-meta,
        .hljs-meta .hljs-keyword,
        .hljs-selector-attr,
        .hljs-selector-pseudo,
        .hljs-link {
            color: #00ffff;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        .hljs-built_in,
        .hljs-deletion {
            color: #ff3700;
            text-shadow: 0 0 2px #ff3700, 0 0 3px #ff370080, 0 0 6px #ff3700, 0 0 16px #ff3700;
        }
        .hljs-formula {
            background: rgba(255, 255, 255, 0.05);
        }
        .hljs-strong {
            font-weight: bold;
        }
        .preview-code .file-path {
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        .preview-code .code-link {
            color: #0050ff;
            text-decoration: underline;
            cursor: pointer;
            text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;
        }
        .preview-code .code-link:hover {
            color: #00ffff;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        .preview-ui {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 16px;
            min-height: 100px;
        }
        .preview-ui-element {
            background: #2a2a2a;
            border: 1px solid #00ffff;
            border-radius: 4px;
            padding: 12px;
            margin: 8px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 0 10px rgba(0, 207, 255, 0.2);
        }
        .preview-ui-icon {
            font-size: 24px;
        }
        .preview-ui-label {
            color: #0050ff;
            font-size: 14px;
            text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;
        }
        .preview-empty {
            color: #00ffff;
            text-align: center;
            padding: 40px 20px;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        .preview-data {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 12px;
            font-size: 12px;
            line-height: 1.6;
        }
        .preview-data pre {
            margin: 0;
            color: #0050ff;
            white-space: pre-wrap;
            word-break: break-word;
            text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;
        }
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ–∫—Ü–∏–∏ –≤—ã–∑—ã–≤–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        .callers-section {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 16px;
        }
        .callers-title {
            color: #00ffff;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        .caller-item {
            color: #ff0080;
            font-size: 11px;
            padding: 4px 8px;
            margin: 4px 0;
            cursor: pointer;
            text-decoration: underline;
            transition: all 0.2s;
            display: block;
            border-radius: 3px;
            text-shadow: 0 0 2px #ff006f, 0 0 6px #ff006f80, 0 0 20px #ff006f;
        }
        .caller-item:hover {
            background: rgba(255, 0, 128, 0.1);
            color: #00ffff;
            text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;
        }
        /* –ü–æ–¥—Å–≤–µ—Ç–∫–∞ UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —ç–∫—à–µ–Ω */
        .node.caller-highlight {
            border-color: rgba(255, 0, 128, 0.6) !important;
            background-color: rgba(255, 0, 128, 0.15) !important;
            box-shadow: 0 0 16px rgba(255, 0, 128, 0.5) !important;
            border-width: 2px !important;
        }
    </style>
</head>
<body>
    <div id="root" class="tree"></div>
    <div id="tooltip" class="tooltip"></div>
    <div id="preview-panel" class="preview-panel">
        <div class="resize-handle" id="resize-handle"></div>
        <div class="preview-callers-container" id="preview-callers-container" style="padding: 20px; border-bottom: 1px solid #333; display: none;">
            <!-- –°–µ–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        <div class="preview-ui-container" id="preview-ui-container">
            <div class="preview-empty">–ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ UI –ø—Ä–µ–≤—å—é</div>
        </div>
        <div class="preview-code-container" id="preview-code-container">
            <div class="preview-empty">–ö–æ–¥ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>
        </div>
    </div>
    <button id="navBackBtn" class="nav-back-btn" title="–ù–∞–∑–∞–¥ (Backspace/Escape)">‚óÄ –ù–∞–∑–∞–¥</button>
    <div id="debug-identifiers" style="position: fixed; bottom: 0; left: 0; right: 0; background: #1a1a1a; border-top: 2px solid #00ffff; padding: 20px; max-height: 300px; overflow: auto; z-index: 998; font-size: 11px; display: none;">
        <div style="font-weight: bold; margin-bottom: 10px; color: #00ffff; text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;">üîç –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏):</div>
        <div id="debug-list"></div>
    </div>
    <button id="debug-toggle" style="position: fixed; bottom: 10px; left: 10px; background: #00ffff; color: #0a0a0a; border: none; border-radius: 4px; padding: 8px 12px; font-size: 12px; cursor: pointer; z-index: 999; box-shadow: 0 0 10px #00cfff;">üîç Debug</button>

    <script>
        let projectData = null;
        let codeLinks = null; // –ö–∞—Ä—Ç–∞ —Å—Å—ã–ª–æ–∫ –Ω–∞ –∫–æ–¥ –∏–∑ code-links.json
        let config = null; // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ config.json
        let navigationStack = []; // –°—Ç–µ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: [{scrollY, element, text}]
        let currentScrollPosition = 0;
        let identifierMap = new Map(); // –ö–∞—Ä—Ç–∞: —Å—Ç—Ä–æ–∫–∞ ‚Üí {key, value, element}
        let callersMap = new Map(); // –ö–∞—Ä—Ç–∞: id ‚Üí [{key, value, path}] - –∫—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é
        let elementNodesMap = new Map(); // –ö–∞—Ä—Ç–∞: –∫–ª—é—á —ç–ª–µ–º–µ–Ω—Ç–∞ ‚Üí DOM node –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
        let tooltipTimeout = null;
        let tooltipElement = null;
        let tooltipSourceElement = null; // –≠–ª–µ–º–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–≤–µ–ª–∏
        let currentPreviewState = null; // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–µ–≤—å—é: { key, value, identifier }
        let clickedElement = null; // –≠–ª–µ–º–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –∫–ª–∏–∫–Ω—É–ª–∏ - –ø—Ä–∏ —É—Ö–æ–¥–µ –º—ã—à–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º selected –Ω–∞ –Ω–µ–≥–æ

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–∞–º–æ–≥–æ –≤–Ω–µ—à–Ω–µ–≥–æ –±–ª–æ–∫–∞ –ø–æ–¥ –º—ã—à—å—é
        function findCurrentHoverElement(e) {
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª–∞—Å—Å–æ–º .node –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º
            const elementsUnderPoint = document.elementsFromPoint(e.clientX, e.clientY);
            
            // –ò—â–µ–º —Å–∞–º—ã–π –≤–Ω–µ—à–Ω–∏–π .node —ç–ª–µ–º–µ–Ω—Ç (–ø–µ—Ä–≤—ã–π –≤ DOM, –∑–Ω–∞—á–∏—Ç —Å–∞–º—ã–π –≤–Ω–µ—à–Ω–∏–π)
            for (let el of elementsUnderPoint) {
                if (el.classList.contains('node')) {
                    return el;
                }
            }
            
            return null;
        }

        // –ï–¥–∏–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è hover –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª–æ–∂–µ–Ω–∏—è –º—ã—à–∏
        function updateHoverStateFromEvent(e) {
            const currentElement = findCurrentHoverElement(e);
            
            // –£–±–∏—Ä–∞–µ–º hover-active —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.querySelectorAll('.node.hover-active').forEach(el => {
                el.classList.remove('hover-active');
            });
            
            if (!currentElement) {
                // –ï—Å–ª–∏ –º—ã—à—å –Ω–µ –Ω–∞–¥ –±–ª–æ–∫–æ–º, –ø—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º hover-active (selected –æ—Å—Ç–∞–µ—Ç—Å—è)
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º hover-active –Ω–∞ —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç (selected –æ—Å—Ç–∞–µ—Ç—Å—è –µ—Å–ª–∏ –±—ã–ª)
            currentElement.classList.add('hover-active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
            const keyElement = currentElement.querySelector('.key');
            if (keyElement) {
                const key = keyElement.textContent.replace(/: $/, '').trim();
                const data = identifierMap.get(key);
                
                if (data) {
                    const extractedId = typeof data.value === 'object' && data.value !== null && data.value.id 
                        ? data.value.id 
                        : extractSimpleIdentifier(data.key);
                    const identifier = extractedId || data.key;
                    updatePreview(data.key, data.value, identifier);
                }
            }
        }

        // –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —ç–ª–µ–º–µ–Ω—Ç—É
        function fastScrollTo(element) {
            const targetPosition = element.getBoundingClientRect().top + window.scrollY - window.innerHeight / 2;
            const startPosition = window.scrollY;
            const distance = targetPosition - startPosition;
            const duration = Math.min(300, Math.abs(distance) / 3); // –ú–∞–∫—Å–∏–º—É–º 300ms, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
            const startTime = performance.now();
            
            function animate(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                // Easing —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                const ease = progress < 0.5 
                    ? 2 * progress * progress 
                    : 1 - Math.pow(-2 * progress + 2, 2) / 2;
                
                window.scrollTo(0, startPosition + distance * ease);
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            
            requestAnimationFrame(animate);
        }

        // –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥
        function goBack() {
            if (navigationStack.length > 0) {
                const prevState = navigationStack.pop();
                if (prevState.element) {
                    fastScrollTo(prevState.element);
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –≤–µ—Ä–Ω—É–ª–∏—Å—å
                    prevState.element.style.background = 'rgba(255, 193, 7, 0.3)';
                    prevState.element.style.transition = 'background 0.5s';
                    setTimeout(() => {
                        prevState.element.style.background = '';
                    }, 1000);
                } else {
                    window.scrollTo({
                        top: prevState.scrollY,
                        behavior: 'auto'
                    });
                }
                updateBackButton();
                // –û–±–Ω–æ–≤–ª—è–µ–º URL –¥–ª—è History API
                updateHistory();
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–ª–∏–∫ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        function navigateToElement(element, identifier) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Å—Ç–µ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            navigationStack.push({
                scrollY: window.scrollY,
                element: document.activeElement || null,
                text: identifier || ''
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –±—Ä–∞—É–∑–µ—Ä–∞ (—Ñ–æ—Ä–º–∞—Ç –∫–∞–∫ –≤ —Ä–∞–±–æ—á–µ–π —Å—Å—ã–ª–∫–µ —Å serverWindowId - UUID —Ñ–æ—Ä–º–∞—Ç)
            function generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0;
                    const v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            const serverWindowId = generateUUID();
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è Cursor Live Preview (–Ω–µ localhost, —á—Ç–æ–±—ã –Ω–µ —Å—á–∏—Ç–∞–ª–æ—Å—å external)
            const baseUrl = window.location.pathname === '/dev-tools/interactive/index.html' ? './' : window.location.pathname;
            history.pushState({ 
                type: 'navigation', 
                element: identifier,
                scrollY: window.scrollY 
            }, '', `?serverWindowId=${serverWindowId}`);
            
            fastScrollTo(element);
            element.style.background = 'rgba(79, 195, 247, 0.3)';
            element.style.transition = 'background 0.5s';
            setTimeout(() => {
                element.style.background = '';
            }, 1500);
            
            updateBackButton();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ "–Ω–∞–∑–∞–¥" –±—Ä–∞—É–∑–µ—Ä–∞
        window.addEventListener('popstate', (e) => {
            if (e.state && e.state.type === 'navigation') {
                goBack();
            }
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–µ–∫–∞
        function updateHistory() {
            if (navigationStack.length === 0) {
                // –ï—Å–ª–∏ —Å—Ç–µ–∫ –ø—É—Å—Ç, —É–±–∏—Ä–∞–µ–º query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
                const baseUrl = window.location.origin + window.location.pathname;
                if (window.location.search) {
                    history.replaceState(null, '', baseUrl);
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
        function updateBackButton() {
            const btn = document.getElementById('navBackBtn');
            if (btn) {
                if (navigationStack.length > 0) {
                    btn.classList.add('visible');
                    btn.textContent = `‚óÄ –ù–∞–∑–∞–¥ (${navigationStack.length})`;
                } else {
                    btn.classList.remove('visible');
                }
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–∞–∑–∞–¥ –ø–æ –∫–ª–∞–≤–∏—à–∞–º
        window.addEventListener('keydown', (e) => {
            if ((e.key === 'Backspace' || e.key === 'Escape') && navigationStack.length > 0) {
                e.preventDefault();
                goBack();
            }
        });

        // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('navBackBtn');
            if (btn) {
                btn.addEventListener('click', goBack);
            }
        });

        // –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏ —Å —ç–º–æ–¥–∑–∏
        function extractSimpleIdentifier(fullString) {
            if (!fullString || typeof fullString !== 'string') return null;
            
            // –ú–∞–ø–ø–∏–Ω–≥ –∏–∫–æ–Ω–æ–∫-–ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –Ω–∞ –ø—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è id
            const iconPrefixMap = {
                '‚ö°': 'func',
                'üåê': 'api',
                'üì∂': 'bluetooth',
                'üîß': 'util',
                'üíæ': 'state'
            };
            
            // –ú–∞–ø–ø–∏–Ω–≥ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ (ble -> bluetooth)
            const prefixMap = {
                'ble': 'bluetooth',
                'func': 'func',
                'api': 'api',
                'util': 'util',
                'state': 'state'
            };
            
            // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
            // 1. –§–æ—Ä–º–∞—Ç —Å –∏–∫–æ–Ω–∫–æ–π –∏ —Ç–æ—á–∫–æ–π: üíæ.current-rental
            const iconDotPattern = /([‚ö°üåêüì∂üîßüíæ])\.([\w-]+)/;
            let match = fullString.match(iconDotPattern);
            if (match) {
                const icon = match[1];
                const name = match[2];
                const prefix = iconPrefixMap[icon];
                if (prefix) {
                    return `${prefix}.${name}`;
                }
            }
            
            // 2. –£–∂–µ –ø—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç: func.set-current-bike
            const simplePattern = /\b(func|api|ble|util|state)\.([\w-]+)/;
            match = fullString.match(simplePattern);
            if (match) {
                const prefix = prefixMap[match[1]] || match[1];
                return `${prefix}.${match[2]}`;
            }
            
            // 3. –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –∏–∫–æ–Ω–∫–∞–º–∏: ‚ö° set-current-bike ‚úèÔ∏è (bike) ‚Üí current-bike
            // –ò–ª–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º: 4Ô∏è‚É£ ‚ö° set-current-bike ‚úèÔ∏è (bike) ‚Üí current-bike
            const newFormatPattern = /([‚ö°üåêüì∂üîßüíæ])\s+([\w-]+)\s+[^\s]+\s*\(/;
            match = fullString.match(newFormatPattern);
            if (match) {
                const icon = match[1];
                const name = match[2];
                const prefix = iconPrefixMap[icon];
                if (prefix) {
                    return `${prefix}.${name}`;
                }
            }
            
            // 3. –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏: func ‚úèÔ∏è set-current-bike(bike) ‚Üí current-bike
            const oldFormatPattern = /\b(func|api|ble|util)\s+[^\s]+\s+([\w-]+)\(/;
            match = fullString.match(oldFormatPattern);
            if (match) {
                const prefix = prefixMap[match[1]] || match[1];
                return `${prefix}.${match[2]}`;
            }
            
            // 4. –§–æ—Ä–º–∞—Ç –±–µ–∑ —ç–º–æ–¥–∑–∏: func set-current-bike(
            const noEmojiPattern = /\b(func|api|ble|util)\s+([\w-]+)\(/;
            match = fullString.match(noEmojiPattern);
            if (match) {
                const prefix = prefixMap[match[1]] || match[1];
                return `${prefix}.${match[2]}`;
            }
            
            return null;
        }

        // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ - —Å–æ–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏ –æ–±—ä–µ–∫—Ç–æ–≤ (–Ω–µ —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–æ–≤)
        function buildIdentifierMap(obj, path = []) {
            if (typeof obj !== 'object' || obj === null) return;
            
            // –ï—Å–ª–∏ —ç—Ç–æ –º–∞—Å—Å–∏–≤ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç
            if (Array.isArray(obj)) {
                for (const item of obj) {
                    if (typeof item === 'object' && item !== null) {
                        // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ - –æ–±—ä–µ–∫—Ç —Å Image –∏–ª–∏ Text, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –∫–∞—Ä—Ç—É
                        if (item.hasOwnProperty('Image')) {
                            const imageEmoji = item.Image;
                            let elementKey = '';
                            if (imageEmoji === 'üö¥') {
                                elementKey = 'üö¥ logo';
                            } else if (imageEmoji === 'üë§') {
                                elementKey = 'üë§ profile';
                            } else if (imageEmoji === '‚öôÔ∏è') {
                                elementKey = '‚öôÔ∏è settings';
                            } else {
                                elementKey = imageEmoji;
                            }
                            // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ identifierMap
                            identifierMap.set(elementKey, { key: elementKey, value: item, path: [...path, elementKey] });
                        } else if (item.hasOwnProperty('Text')) {
                            // –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤ —Ç–æ–∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å, –Ω–æ –æ–±—ã—á–Ω–æ –æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ
                            const textKey = item.Text;
                            identifierMap.set(textKey, { key: textKey, value: item, path: [...path, textKey] });
                        }
                        // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
                        buildIdentifierMap(item, path);
                    }
                }
                return;
            }

            // –≠—Ç–æ –æ–±—ä–µ–∫—Ç - –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á–∏ –≤ –∫–∞—Ä—Ç—É
            for (const [key, value] of Object.entries(obj)) {
                // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ - –º–∞—Å—Å–∏–≤, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –º–∞—Å—Å–∏–≤–∞
                if (Array.isArray(value)) {
                    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞
                    for (const item of value) {
                        if (typeof item === 'object' && item !== null) {
                            // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ - –æ–±—ä–µ–∫—Ç —Å Image –∏–ª–∏ Text, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ –∫–∞—Ä—Ç—É
                            if (item.hasOwnProperty('Image')) {
                                const imageEmoji = item.Image;
                                let elementKey = '';
                                if (imageEmoji === 'üö¥') {
                                    elementKey = 'üö¥ logo';
                                } else if (imageEmoji === 'üë§') {
                                    elementKey = 'üë§ profile';
                                } else if (imageEmoji === '‚öôÔ∏è') {
                                    elementKey = '‚öôÔ∏è settings';
                                } else {
                                    elementKey = imageEmoji;
                                }
                                // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ identifierMap
                                identifierMap.set(elementKey, { key: elementKey, value: item, path: [...path, key, elementKey] });
                            } else if (item.hasOwnProperty('Text')) {
                                const textKey = item.Text;
                                identifierMap.set(textKey, { key: textKey, value: item, path: [...path, key, textKey] });
                            }
                            // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
                            buildIdentifierMap(item, [...path, key]);
                        }
                    }
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É, –Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–ª—é—á
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª—é—á –≤ –∫–∞—Ä—Ç—É
                identifierMap.set(key, { key, value, path: [...path, key] });
                
                // –ï—Å–ª–∏ –≤ –æ–±—ä–µ–∫—Ç–µ –µ—Å—Ç—å –ø–æ–ª–µ 'id', –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ —Ç–æ–∂–µ
                if (typeof value === 'object' && value !== null && value.id) {
                    identifierMap.set(value.id, { key, value, path: [...path, key] });
                }

                // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏–º –¥–µ—Ä–µ–≤–æ
                if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                    buildIdentifierMap(value, [...path, key]);
                }
            }
        }

        // –°–±–æ—Ä –∫–æ–ª–ª–µ—Ä–æ–≤ (–∫—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏) - –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
        function buildCallersMap(obj, path = [], uiElementKey = null, buttonKey = null) {
            if (typeof obj !== 'object' || obj === null) return;

            for (const [key, value] of Object.entries(obj)) {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π –∫–ª—é—á UI —ç–ª–µ–º–µ–Ω—Ç–æ–º
                const isUIElement = /^[üß≠üí¨üì∑üö¥‚óÄÔ∏èüìπüîçüì≤‚ÑπÔ∏èüìä‚ñ∂Ô∏è‚èπÔ∏èüìãüö´]/.test(key) && !key.startsWith('‚ö°');

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –∫–Ω–æ–ø–∫–æ–π (—Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–µ–ª–∫—É ‚Üí)
                const isButton = key.includes('‚Üí');

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π UI —ç–ª–µ–º–µ–Ω—Ç - –±–µ—Ä–µ–º —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π (–±–ª–∏–∂–∞–π—à–∏–π)
                const currentUIElement = isUIElement ? key : uiElementKey;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –∫–Ω–æ–ø–∫—É
                const currentButton = isButton ? key : buttonKey;

                // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ - —Å—Ç—Ä–æ–∫–∞, –∏—â–µ–º –≤ –Ω–µ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
                if (typeof value === 'string') {
                    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º –∏–∑ –∫–∞—Ä—Ç—ã
                    for (const [identifier, idData] of identifierMap.entries()) {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º (–∏–º–µ–µ—Ç id –∏–ª–∏ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
                        const isIdDefinition = idData && typeof idData.value === 'object' && idData.value !== null && idData.value.id;
                        const extractedCallerId = extractSimpleIdentifier(idData ? idData.key : '');
                        const isDefinition = isIdDefinition || (extractedCallerId !== null && idData && typeof idData.value === 'object' && idData.value !== null);

                        if (isDefinition) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫—É –Ω–∞ —ç—Ç–æ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
                            if (value.includes(identifier) || value.includes(idData.key)) {
                                const callerId = idData.value.id || extractSimpleIdentifier(idData.key);
                                if (callerId) {
                                    if (!callersMap.has(callerId)) {
                                        callersMap.set(callerId, []);
                                    }
                                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π UI —ç–ª–µ–º–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–∞–∫ caller
                                    // –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π UI —ç–ª–µ–º–µ–Ω—Ç –≤–≤–µ—Ä—Ö –ø–æ path –∏—Å–ø–æ–ª—å–∑—É—è getElementType
                                    let callerKey = null;

                                    // –ò–¥–µ–º —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö –ø–æ path –∏ –∏—â–µ–º –ø–µ—Ä–≤—ã–π UI —ç–ª–µ–º–µ–Ω—Ç
                                    for (let i = path.length - 1; i >= 0; i--) {
                                        const pathKey = path[i];
                                        const elementType = getElementType(pathKey);

                                        // –í—Ä–µ–º–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                                        if (callerId === 'set-current-bike') {
                                            const data = identifierMap.get(pathKey);
                                            console.log(`[buildCallersMap] Checking path[${i}]:`, pathKey);
                                            console.log(`  - identifierMap data:`, data);
                                            console.log(`  - elementType:`, elementType);
                                        }

                                        if (pathKey && elementType === 'ui') {
                                            callerKey = pathKey;
                                            if (callerId === 'set-current-bike') {
                                                console.log(`[buildCallersMap] Found UI element:`, callerKey);
                                            }
                                            break;
                                        }
                                    }

                                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ UI —ç–ª–µ–º–µ–Ω—Ç –≤ path, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π –∫–ª—é—á
                                    if (!callerKey) {
                                        callerKey = key;
                                        if (callerId === 'set-current-bike') {
                                            console.log(`[buildCallersMap] No UI element found, using key:`, key);
                                        }
                                    }

                                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –∫—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç
                                    const callerInfo = { key: callerKey, value, path: [...path] };
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ –∫–æ–ª–ª–µ—Ä–∞
                                    const exists = callersMap.get(callerId).some(c =>
                                        c.key === callerInfo.key &&
                                        JSON.stringify(c.path) === JSON.stringify(callerInfo.path)
                                    );
                                    if (!exists) {
                                        callersMap.get(callerId).push(callerInfo);
                                    }
                                }
                            }
                        }
                    }
                }

                // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ö–æ–¥–∏–º –¥–µ—Ä–µ–≤–æ, –ø–µ—Ä–µ–¥–∞–≤–∞—è UI —ç–ª–µ–º–µ–Ω—Ç –∏ –∫–Ω–æ–ø–∫—É –¥–∞–ª—å—à–µ
                if (typeof value === 'object' && value !== null) {
                    buildCallersMap(value, [...path, key], currentUIElement, currentButton);
                }
            }
        }

        // –ü–æ–¥—Å—á—ë—Ç –≤—Å–µ—Ö –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –Ω–æ–¥
        function countNodes(obj) {
            if (typeof obj !== 'object' || obj === null) return 0;

            let count = 0;
            for (const value of Object.values(obj)) {
                count += 1;
                if (typeof value === 'object' && value !== null) {
                    count += countNodes(value);
                }
            }
            return count;
        }

        // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–æ–¥
        function getFontSize(nodeCount) {
            // –°—Ä–µ–¥–Ω—è—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ä–∞–∑–º–µ—Ä–∞–º–∏: –º–∏–Ω–∏–º—É–º 12px, –º–∞–∫—Å–∏–º—É–º 28px
            const minSize = 12;
            const maxSize = 28;
            // –£–º–µ—Ä–µ–Ω–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
            const size = Math.min(maxSize, Math.max(minSize, minSize + Math.log(nodeCount + 1) * 4.5));
            return size;
        }

        // –ü–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –¥–µ—Ä–µ–≤–µ –ø–æ –∫–ª—é—á—É
        function findInTree(obj, searchKey) {
            if (typeof obj !== 'object' || obj === null) return null;

            // –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –ø–æ–∏—Å–∫–∞ (–∏—â–µ–º –ø–æ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏)
            const cleanSearchKey = searchKey.replace(/\([^)]*\)/, '').trim();

            for (const [key, value] of Object.entries(obj)) {
                // –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∂–∏, –ø—Ä–æ–±–µ–ª—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                const cleanKey = key.replace(/[^\w\s-()‚Üí]/g, '').trim();
                const cleanKeyNoParams = key.replace(/\([^)]*\)/, '').replace(/[^\w\s-‚Üí]/g, '').trim();
                const cleanSearch = cleanSearchKey.replace(/[^\w\s-‚Üí]/g, '').trim();

                if (cleanKeyNoParams === cleanSearch || cleanKey === cleanSearch || key === searchKey || key.includes(searchKey)) {
                    return { key, value };
                }

                if (typeof value === 'object' && value !== null) {
                    const found = findInTree(value, searchKey);
                    if (found) return found;
                }
            }
            return null;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ HTML –¥–ª—è —Ç—É–ª—Ç–∏–ø–∞
        function createTooltipContent(data, identifier = null) {
            let content = '';
            
            if (typeof data !== 'object' || data === null) {
                content = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } else {
                const lines = [];
                for (const [key, value] of Object.entries(data)) {
                    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
                        lines.push(`${key}: {...}`);
                    } else {
                        lines.push(`${key}: ${JSON.stringify(value)}`);
                    }
                }
                content = `<pre>${lines.join('\n')}</pre>`;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–ª–ª–µ—Ä–∞—Ö
            if (identifier) {
                const simpleId = data.id || extractSimpleIdentifier(identifier);
                if (simpleId && callersMap.has(simpleId)) {
                    const callers = callersMap.get(simpleId);
                    if (callers.length > 0) {
                        content += '<div class="callers">';
                        content += '<div class="callers-title">–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑:</div>';
                        callers.forEach(caller => {
                            const displayKey = caller.key.length > 50 
                                ? caller.key.substring(0, 47) + '...' 
                                : caller.key;
                            content += `<div class="caller-item" data-path="${JSON.stringify(caller.path).replace(/"/g, '&quot;')}">${displayKey}</div>`;
                        });
                        content += '</div>';
                    }
                }
            }
            
            return content;
        }

        // –ü–æ–∫–∞–∑ tooltip —Å–ø—Ä–∞–≤–∞ —Å –ª–æ–≥–∏–∫–æ–π "–Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –∫ –Ω–µ–º—É"
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –±–ª–æ–∫–∞ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ –≤ Clojure —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
        function findClojureKeyValueBlock(lines, keyLineIdx, contextName) {
            const keyLine = lines[keyLineIdx];
            const keyIndent = keyLine.match(/^\s*/)[0].length;

            // –ù–∞—á–∏–Ω–∞–µ–º —Å –∫–ª—é—á–∞
            let blockStart = keyLineIdx;
            let blockEnd = keyLineIdx + 1;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ defn/def –∏–ª–∏ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ
            const defnMatch = keyLine.match(/\(defn\s+[\w-]+/);
            const defMatch = keyLine.match(/\(def\s+[\w-]+/);

            if (defnMatch || defMatch) {
                // –≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
                // –ò—â–µ–º –Ω–∞—á–∞–ª–æ (–º–æ–∂–µ—Ç –±—ã—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤—ã—à–µ)
                for (let i = keyLineIdx - 1; i >= Math.max(0, keyLineIdx - 5); i--) {
                    const line = lines[i].trim();
                    if (line.startsWith(';;')) {
                        blockStart = i;
                    } else if (line.length > 0 && !line.startsWith(';;')) {
                        break;
                    }
                }

                // –ò—â–µ–º –∫–æ–Ω–µ—Ü - –∑–∞–∫—Ä—ã–≤–∞—é—â—É—é —Å–∫–æ–±–∫—É –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ
                let openParens = 0;
                let inString = false;
                let stringChar = null;

                for (let i = keyLineIdx; i < lines.length; i++) {
                    const line = lines[i];
                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        const prevChar = j > 0 ? line[j - 1] : '';

                        if (!inString && (char === '"' || char === "'")) {
                            inString = true;
                            stringChar = char;
                        } else if (inString && char === stringChar && prevChar !== '\\') {
                            inString = false;
                            stringChar = null;
                        }

                        if (!inString) {
                            if (char === '(') openParens++;
                            if (char === ')') openParens--;
                        }
                    }

                    if (openParens === 0 && i > keyLineIdx) {
                        blockEnd = i + 1;
                        break;
                    }
                }

                return { start: blockStart, end: blockEnd };
            }

            // –ò—â–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∫–ª—é—á–∞
            // –í Clojure —Ñ–æ—Ä–º–∞—Ç: :key value –∏–ª–∏ :key (expression)
            const keyMatch = keyLine.match(/:[\w-]+\s+/);
            if (!keyMatch) {
                // –ö–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É
                return { start: blockStart, end: blockEnd };
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–µ
            const afterKey = keyLine.substring(keyLine.indexOf(keyMatch[0]) + keyMatch[0].length).trim();

            if (afterKey.length > 0) {
                // –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–µ
                if (afterKey.startsWith('(') || afterKey.startsWith('[') || afterKey.startsWith('{')) {
                    // –≠—Ç–æ –Ω–∞—á–∞–ª–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è, –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –µ–≥–æ –∫–æ–Ω–µ—Ü
                    let openParens = 0;
                    let openBrackets = 0;
                    let openBraces = 0;
                    let inString = false;
                    let stringChar = null;

                    // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∫–æ–±–∫–∏ –Ω–∞—á–∏–Ω–∞—è —Å —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏
                    for (let i = keyLineIdx; i < lines.length; i++) {
                        const line = lines[i];
                        const searchFrom = (i === keyLineIdx) ? keyLine.indexOf(keyMatch[0]) + keyMatch[0].length : 0;

                        for (let j = searchFrom; j < line.length; j++) {
                            const char = line[j];
                            const prevChar = j > 0 ? line[j - 1] : '';

                            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫
                            if (!inString && (char === '"' || char === "'")) {
                                inString = true;
                                stringChar = char;
                            } else if (inString && char === stringChar && prevChar !== '\\') {
                                inString = false;
                                stringChar = null;
                            }

                            if (!inString) {
                                if (char === '(') openParens++;
                                if (char === ')') openParens--;
                                if (char === '[') openBrackets++;
                                if (char === ']') openBrackets--;
                                if (char === '{') openBraces++;
                                if (char === '}') openBraces--;
                            }
                        }

                        // –ï—Å–ª–∏ –≤—Å–µ —Å–∫–æ–±–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã
                        if (openParens === 0 && openBrackets === 0 && openBraces === 0) {
                            blockEnd = i + 1;
                            break;
                        }
                    }
                } else {
                    // –ü—Ä–æ—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–µ (—Å—Ç—Ä–æ–∫–∞, —á–∏—Å–ª–æ –∏ —Ç.–¥.)
                    blockEnd = keyLineIdx + 1;
                }
            } else {
                // –ó–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–æ–∫–µ
                // –ò—â–µ–º —Å–ª–µ–¥—É—é—â–µ–µ –Ω–µ–ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                for (let i = keyLineIdx + 1; i < lines.length; i++) {
                    const line = lines[i];
                    const trimmed = line.trim();
                    const indent = line.match(/^\s*/)[0].length;

                    if (trimmed.length === 0) {
                        // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                        continue;
                    }

                    // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π –∫–ª—é—á –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è
                    if (indent <= keyIndent && trimmed.startsWith(':')) {
                        blockEnd = i;
                        break;
                    }

                    // –ï—Å–ª–∏ —ç—Ç–æ –≤–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
                    if (indent > keyIndent) {
                        // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏—Å–∫–∞—Ç—å –∫–æ–Ω–µ—Ü –≤—ã—Ä–∞–∂–µ–Ω–∏—è
                        if (trimmed.startsWith('(') || trimmed.startsWith('[') || trimmed.startsWith('{')) {
                            let openParens = 0;
                            let openBrackets = 0;
                            let openBraces = 0;
                            let inString = false;
                            let stringChar = null;

                            for (let j = i; j < lines.length; j++) {
                                const jLine = lines[j];

                                for (let k = 0; k < jLine.length; k++) {
                                    const char = jLine[k];
                                    const prevChar = k > 0 ? jLine[k - 1] : '';

                                    if (!inString && (char === '"' || char === "'")) {
                                        inString = true;
                                        stringChar = char;
                                    } else if (inString && char === stringChar && prevChar !== '\\') {
                                        inString = false;
                                        stringChar = null;
                                    }

                                    if (!inString) {
                                        if (char === '(') openParens++;
                                        if (char === ')') openParens--;
                                        if (char === '[') openBrackets++;
                                        if (char === ']') openBrackets--;
                                        if (char === '{') openBraces++;
                                        if (char === '}') openBraces--;
                                    }
                                }

                                if (openParens === 0 && openBrackets === 0 && openBraces === 0) {
                                    blockEnd = j + 1;
                                    break;
                                }
                            }
                            break;
                        } else {
                            // –ü—Ä–æ—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                            blockEnd = i + 1;
                            break;
                        }
                    } else {
                        // –í–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –∫–ª—é—á–∞ –∏–ª–∏ –≤—ã—à–µ
                        blockEnd = i;
                        break;
                    }
                }
            }

            return { start: blockStart, end: blockEnd };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –≥—Ä–∞–Ω–∏—Ü –±–ª–æ–∫–∞ –∫–æ–¥–∞ –≤ ClojureDart
        function findCodeBlock(lines, startLine, contextName = null) {
            // –ù–∞—á–∏–Ω–∞–µ–º —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (–∏–Ω–¥–µ–∫—Å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0)
            const startIdx = Math.max(0, startLine - 1);

            // –ï—Å–ª–∏ –µ—Å—Ç—å contextName, –∏—â–µ–º –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –∫–ª—é—á –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
            if (contextName) {
                // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞
                const patterns = [
                    // –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∫–ª—é—á–æ–º: :context-name
                    new RegExp(`:${contextName.replace(/-/g, '-')}\\s`),
                    // defn —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º: (defn context-name
                    new RegExp(`\\(defn\\s+${contextName.replace(/-/g, '-')}\\s`),
                    // def —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º: (def context-name
                    new RegExp(`\\(def\\s+${contextName.replace(/-/g, '-')}\\s`),
                    // –ü–æ–∏—Å–∫ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö: ;; context-name
                    new RegExp(`;;.*${contextName.replace(/-/g, '-')}`),
                ];

                // –ò—â–µ–º —Å—Ç—Ä–æ–∫—É —Å –Ω—É–∂–Ω—ã–º –∫–ª—é—á–æ–º, —Ä–∞—Å—à–∏—Ä—è–µ–º –æ–±–ª–∞—Å—Ç—å –ø–æ–∏—Å–∫–∞
                let keyLineIdx = startIdx;
                let foundPattern = false;

                // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –≤ —É–∑–∫–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ (¬±10 —Å—Ç—Ä–æ–∫)
                for (let i = Math.max(0, startIdx - 10); i <= Math.min(lines.length - 1, startIdx + 10); i++) {
                    for (const pattern of patterns) {
                        if (pattern.test(lines[i])) {
                            keyLineIdx = i;
                            foundPattern = true;
                            break;
                        }
                    }
                    if (foundPattern) break;
                }

                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, —Ä–∞—Å—à–∏—Ä—è–µ–º –ø–æ–∏—Å–∫ –¥–æ ¬±30 —Å—Ç—Ä–æ–∫
                if (!foundPattern) {
                    for (let i = Math.max(0, startIdx - 30); i <= Math.min(lines.length - 1, startIdx + 30); i++) {
                        for (const pattern of patterns) {
                            if (pattern.test(lines[i])) {
                                keyLineIdx = i;
                                foundPattern = true;
                                break;
                            }
                        }
                        if (foundPattern) break;
                    }
                }

                // –ù–∞—Ö–æ–¥–∏–º –±–ª–æ–∫ –¥–ª—è —ç—Ç–æ–≥–æ –∫–ª—é—á–∞
                return findClojureKeyValueBlock(lines, keyLineIdx, contextName);
            }

            const startIndent = lines[startIdx].match(/^\s*/)[0].length;
            
            // –ò—â–µ–º –Ω–∞—á–∞–ª–æ –±–ª–æ–∫–∞ - –∏—â–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤—ã—à–µ –∏–ª–∏ –Ω–∞—á–∞–ª–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
            let blockStart = startIdx;
            
            // –ò—â–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞ (–¥–æ 5 —Å—Ç—Ä–æ–∫ –Ω–∞–∑–∞–¥)
            for (let i = startIdx; i >= Math.max(0, startIdx - 5); i--) {
                const line = lines[i].trim();
                if (line.startsWith(';;')) {
                    blockStart = i;
                    break;
                }
            }
            
            // –ò—â–µ–º –Ω–∞—á–∞–ª–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è - –æ—Ç–∫—Ä—ã–≤–∞—é—â—É—é —Å–∫–æ–±–∫—É –Ω–∞ —Ç–æ–º –∂–µ –∏–ª–∏ –º–µ–Ω—å—à–µ–º —É—Ä–æ–≤–Ω–µ –æ—Ç—Å—Ç—É–ø–æ–≤
            for (let i = startIdx; i >= Math.max(0, startIdx - 10); i--) {
                const line = lines[i];
                const trimmed = line.trim();
                const indent = line.match(/^\s*/)[0].length;
                
                // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—â—É—é —Å–∫–æ–±–∫—É –Ω–∞ —Ç–æ–º –∂–µ –∏–ª–∏ –º–µ–Ω—å—à–µ–º —É—Ä–æ–≤–Ω–µ
                if (trimmed && (trimmed.startsWith('(') || trimmed.startsWith('{'))) {
                    if (indent <= startIndent) {
                        blockStart = i;
                        break;
                    }
                }
            }
            
            // –ò—â–µ–º –∫–æ–Ω–µ—Ü –±–ª–æ–∫–∞ - —Å—á–∏—Ç–∞–µ–º —Å–∫–æ–±–∫–∏
            let blockEnd = startIdx;
            let openParens = 0;
            let openBraces = 0;
            let inString = false;
            let stringChar = null;
            
            // –°–Ω–∞—á–∞–ª–∞ —Å—á–∏—Ç–∞–µ–º —Å–∫–æ–±–∫–∏ –¥–æ –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
            for (let i = blockStart; i < startIdx; i++) {
                const line = lines[i];
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    const prevChar = j > 0 ? line[j - 1] : '';
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫
                    if (!inString && (char === '"' || char === "'")) {
                        inString = true;
                        stringChar = char;
                    } else if (inString && char === stringChar && prevChar !== '\\') {
                        inString = false;
                        stringChar = null;
                    }
                    
                    if (!inString) {
                        if (char === '(') openParens++;
                        if (char === ')') openParens--;
                        if (char === '{') openBraces++;
                        if (char === '}') openBraces--;
                    }
                }
            }
            
            // –¢–µ–ø–µ—Ä—å –∏—â–µ–º –∫–æ–Ω–µ—Ü –±–ª–æ–∫–∞
            for (let i = startIdx; i < lines.length; i++) {
                const line = lines[i];
                const trimmed = line.trim();
                const indent = line.match(/^\s*/)[0].length;
                
                // –°—á–∏—Ç–∞–µ–º —Å–∫–æ–±–∫–∏ –≤ —Å—Ç—Ä–æ–∫–µ
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    const prevChar = j > 0 ? line[j - 1] : '';
                    
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫
                    if (!inString && (char === '"' || char === "'")) {
                        inString = true;
                        stringChar = char;
                    } else if (inString && char === stringChar && prevChar !== '\\') {
                        inString = false;
                        stringChar = null;
                    }
                    
                    if (!inString) {
                        if (char === '(') openParens++;
                        if (char === ')') openParens--;
                        if (char === '{') openBraces++;
                        if (char === '}') openBraces--;
                    }
                }
                
                // –ï—Å–ª–∏ –≤—Å–µ —Å–∫–æ–±–∫–∏ –∑–∞–∫—Ä—ã—Ç—ã –∏ –º—ã –ø—Ä–æ—à–ª–∏ –Ω–∞—á–∞–ª—å–Ω—É—é —Å—Ç—Ä–æ–∫—É
                if (i > startIdx && openParens === 0 && openBraces === 0) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                    if (i + 1 < lines.length) {
                        const nextLine = lines[i + 1].trim();
                        const nextIndent = lines[i + 1].match(/^\s*/)[0].length;
                        
                        // –ï—Å–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ —Ç–æ–º –∂–µ –∏–ª–∏ –º–µ–Ω—å—à–µ–º —É—Ä–æ–≤–Ω–µ –æ—Ç—Å—Ç—É–ø–æ–≤
                        if (nextLine && (nextLine.startsWith('(') || nextLine.startsWith(';;') || 
                            (nextIndent <= startIndent && nextLine !== ''))) {
                            blockEnd = i + 1;
                            break;
                        }
                    } else {
                        blockEnd = i + 1;
                        break;
                    }
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –∫–æ–Ω–µ—Ü, –∏—Å–ø–æ–ª—å–∑—É–µ–º —ç–≤—Ä–∏—Å—Ç–∏–∫—É
            if (blockEnd <= blockStart || blockEnd > lines.length) {
                // –ò—â–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–æ–∫
                for (let i = startIdx + 1; i < Math.min(startIdx + 20, lines.length); i++) {
                    const trimmed = lines[i].trim();
                    const indent = lines[i].match(/^\s*/)[0].length;
                    
                    // –ï—Å–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                    if (trimmed === '' || trimmed.startsWith(';;')) {
                        if (i > startIdx + 2) {
                            blockEnd = i;
                            break;
                        }
                    }
                    
                    // –ï—Å–ª–∏ —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ
                    if (trimmed.startsWith('(') && indent <= startIndent && i > startIdx + 3) {
                        blockEnd = i;
                        break;
                    }
                }
                
                // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞—à–ª–∏, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä–æ–º
                if (blockEnd <= blockStart || blockEnd > lines.length) {
                    blockEnd = Math.min(startIdx + 12, lines.length);
                }
            }
            
            return { start: blockStart, end: blockEnd };
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Ç—Å—Ç—É–ø–∞ –∏–∑ –±–ª–æ–∫–∞ –∫–æ–¥–∞
        function dedentCodeBlock(codeBlock) {
            const lines = codeBlock.split('\n');
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø —Å—Ä–µ–¥–∏ –Ω–µ–ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ (–≤ —Å–∏–º–≤–æ–ª–∞—Ö)
            let minIndentChars = Infinity;
            for (const line of lines) {
                if (line.trim().length === 0) continue; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                
                // –°—á–∏—Ç–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç—Å—Ç—É–ø–∞ (–ø—Ä–æ–±–µ–ª—ã –∏ —Ç–∞–±—ã)
                let indentChars = 0;
                for (let i = 0; i < line.length; i++) {
                    if (line[i] === ' ' || line[i] === '\t') {
                        indentChars++;
                    } else {
                        break;
                    }
                }
                
                if (indentChars < minIndentChars && indentChars > 0) {
                    minIndentChars = indentChars;
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –æ—Ç—Å—Ç—É–ø–∞ –∏–ª–∏ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –ø—É—Å—Ç—ã–µ, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
            if (minIndentChars === Infinity || minIndentChars === 0) {
                return codeBlock;
            }
            
            // –£–¥–∞–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç—Å—Ç—É–ø–∞ –∏–∑ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫
            const dedentedLines = lines.map(line => {
                if (line.trim().length === 0) return line; // –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                
                // –£–¥–∞–ª—è–µ–º –ø–µ—Ä–≤—ã–µ minIndentChars —Å–∏–º–≤–æ–ª–æ–≤ –æ—Ç—Å—Ç—É–ø–∞
                let removed = 0;
                for (let i = 0; i < line.length && removed < minIndentChars; i++) {
                    if (line[i] === ' ' || line[i] === '\t') {
                        removed++;
                    } else {
                        break;
                    }
                }
                
                return line.substring(removed);
            });
            
            return dedentedLines.join('\n');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–¥–∞
        async function loadCodePreview(codeLink, containerId, elementKey = null) {
            if (!codeLink) return;
            
            const container = document.getElementById(containerId);
            if (!container) return;
            
            try {
                // –ü–∞—Ä—Å–∏–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É, –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç
                let filePath = codeLink;
                let lineNumber = null;
                let contextName = null;
                
                // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞: "path#L123#context:name"
                if (typeof codeLink === 'string' && codeLink.includes('#')) {
                    const parts = codeLink.split('#');
                    filePath = parts[0];

                    // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏
                    if (parts[1] && parts[1].startsWith('L')) {
                        lineNumber = parseInt(parts[1].replace('L', '')) || null;
                    }

                    // –ò–∑–≤–ª–µ–∫–∞–µ–º context name
                    if (parts[2] && parts[2].startsWith('context:')) {
                        contextName = parts[2].replace('context:', '');
                    }
                }
                
                // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø—É—Ç—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å / –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –ø—É—Ç–∏
                if (!filePath.startsWith('/') && !filePath.startsWith('http://') && !filePath.startsWith('https://')) {
                    filePath = '/' + filePath;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const code = await response.text();
                const lines = code.split('\n');
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é —Ñ–∞–π–ª–∞
                const fileExt = filePath.split('.').pop().toLowerCase();
                let lang = 'clojure'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Clojure
                if (fileExt === 'cljs') lang = 'clojure';
                else if (fileExt === 'cljd') lang = 'clojure';
                else if (fileExt === 'clj') lang = 'clojure';
                
                // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏, –Ω–∞—Ö–æ–¥–∏–º –ø–æ–ª–Ω—ã–π –±–ª–æ–∫ –∫–æ–¥–∞ (–æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞)
                if (lineNumber !== null && !isNaN(lineNumber)) {
                    const block = findCodeBlock(lines, lineNumber, contextName);
                    const blockLines = lines.slice(block.start, block.end);
                    let codeBlock = blockLines.join('\n');
                    
                    // –£–¥–∞–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø –∏–∑ –±–ª–æ–∫–∞
                    codeBlock = dedentCodeBlock(codeBlock);
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º highlight.js –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
                    const highlighted = hljs.highlight(codeBlock, { language: lang }).value;
                    const highlightedLines = highlighted.split('\n');
                    
                    let codeHtml = '<pre><code class="hljs language-' + lang + '">';
                    highlightedLines.forEach((line, index) => {
                        const actualLineNum = block.start + index + 1;
                        const isHighlighted = actualLineNum === lineNumber;
                        const highlightClass = isHighlighted ? ' style="background: rgba(255, 121, 0, 0.3); display: block; padding: 2px 4px; margin: 0 -4px;"' : ' style="display: block; padding: 2px 4px; margin: 0 -4px;"';
                        codeHtml += `<div${highlightClass}><span style="color: #3a00fa72; margin-right: 12px; user-select: none; opacity: 0.7;">${actualLineNum}</span>${line || ' '}</div>`;
                    });
                    codeHtml += '</code></pre>';
                    
                    container.innerHTML = `<div style="font-family: 'Randy GG Bold', monospace; font-size: 12px; line-height: 1.6; overflow-x: auto; background: #000000; border-radius: 4px; padding: 12px;">${codeHtml}</div>`;
                } else {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Å—å —Ñ–∞–π–ª (–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä)
                    const maxLines = 100;
                    const displayLines = lines.slice(0, maxLines);
                    const hasMore = lines.length > maxLines;
                    let codeBlock = displayLines.join('\n');
                    
                    // –£–¥–∞–ª—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ç—Å—Ç—É–ø –∏–∑ –±–ª–æ–∫–∞
                    codeBlock = dedentCodeBlock(codeBlock);
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º highlight.js –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
                    const highlighted = hljs.highlight(codeBlock, { language: lang }).value;
                    const highlightedLines = highlighted.split('\n');
                    
                    let codeHtml = '<pre><code class="hljs language-' + lang + '">';
                    highlightedLines.forEach((line, index) => {
                        codeHtml += `<div style="display: block; padding: 2px 4px; margin: 0 -4px;"><span style="color: #3a00fa72; margin-right: 12px; user-select: none; opacity: 0.7;">${index + 1}</span>${line || ' '}</div>`;
                    });
                    codeHtml += '</code></pre>';
                    
                    if (hasMore) {
                        codeHtml += `<div style="color: #00ffff; padding: 8px 0; text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;">... (–µ—â–µ ${lines.length - maxLines} —Å—Ç—Ä–æ–∫)</div>`;
                    }
                    
                    container.innerHTML = `<div style="font-family: 'Randy GG Bold', monospace; font-size: 12px; line-height: 1.6; overflow-x: auto; background: #000000; border-radius: 4px; padding: 12px;">${codeHtml}</div>`;
                }
            } catch (error) {
                container.innerHTML = `<div style="color: #ff3700; text-shadow: 0 0 2px #ff3700, 0 0 3px #ff370080, 0 0 6px #ff3700, 0 0 16px #ff3700;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–¥–∞: ${escapeHtml(error.message)}</div>`;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞ –∏–∑ code-links.json
        function getCodeLink(identifier) {
            if (!codeLinks || !identifier) return null;

            // –î–ª—è UI –ø—Ä–µ–≤—å—é –∏—â–µ–º preview –≤–µ—Ä—Å–∏—é (preview.*)
            const previewKey = `preview.${identifier}`;
            if (codeLinks[previewKey]) {
                return codeLinks[previewKey];
            }

            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–≤–∞–∂–Ω–æ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —ç–º–æ–¥–∑–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞–≤–±–∞—Ä)
            if (codeLinks[identifier]) {
                return codeLinks[identifier];
            }

            // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–ª—é—á–µ–π
            const simpleId = extractSimpleIdentifier(identifier);

            // –î–ª—è simpleId —Ç–æ–∂–µ –ø—Ä–æ–±—É–µ–º preview –≤–µ—Ä—Å–∏—é
            if (simpleId) {
                const simplePreviewKey = `preview.${simpleId}`;
                if (codeLinks[simplePreviewKey]) {
                    return codeLinks[simplePreviewKey];
                }
                if (codeLinks[simpleId]) {
                    return codeLinks[simpleId];
                }
            }

            // –ü—Ä–æ–±—É–µ–º —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏
            const variants = [
                identifier.replace(/[‚ö°üåêüì∂üîßüíæ]/g, '').trim(),
                identifier.replace(/^[‚ö°üåêüì∂üîßüíæ]\s+/, '').split(' ')[0]
            ];

            for (const variant of variants) {
                if (variant) {
                    const variantPreviewKey = `preview.${variant}`;
                    if (codeLinks[variantPreviewKey]) {
                        return codeLinks[variantPreviewKey];
                    }
                    if (codeLinks[variant]) {
                        return codeLinks[variant];
                    }
                }
            }

            // –û—Ç–ª–∞–¥–∫–∞: –ª–æ–≥–∏—Ä—É–µ–º, –µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞–≤–±–∞—Ä–∞)
            if (identifier.includes('navbar') || identifier.includes('üß≠') ||
                identifier.includes('üö¥') || identifier.includes('üë§') || identifier.includes('‚öôÔ∏è')) {
                console.warn('‚ö†Ô∏è getCodeLink –Ω–µ –Ω–∞—à–µ–ª –∑–∞–ø–∏—Å—å –¥–ª—è:', identifier, '–≤–∞—Ä–∏–∞–Ω—Ç—ã:', variants, 'previewKey:', previewKey);
            }

            return null;
        }

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ –≤–ª–æ–∂–µ–Ω–∏—é –≤ –∫–æ—Ä–Ω–µ–≤—É—é –Ω–æ–¥—É
        function getElementType(key) {
            if (!key) return null;

            const data = identifierMap.get(key);
            if (data && data.path && data.path.length > 0) {
                const rootNode = data.path[0];

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø–æ –∫–æ—Ä–Ω–µ–≤–æ–π –Ω–æ–¥–µ
                if (rootNode === 'üì± ui') return 'ui';
                if (rootNode === 'üíæ state') return 'state';
                if (rootNode === '‚ö° actions') return 'action';
                if (rootNode === 'üåê api') return 'api';
                if (rootNode === 'üì∂ bluetooth') return 'bluetooth';
                if (rootNode === 'üîß utils') return 'util';
            }

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±–µ–∑ identifierMap
            if (key.startsWith('[') && key.endsWith(']')) return 'ui'; // –≠–∫—Ä–∞–Ω—ã
            if (key.includes('‚Üí')) return 'ui'; // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            if (key.startsWith('üíæ')) return 'state';
            if (key.startsWith('‚ö°')) return 'action';
            if (key.startsWith('üåê')) return 'api';
            if (key.startsWith('üì∂')) return 'bluetooth';
            if (key.startsWith('üîß')) return 'util';

            return null;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç–ª–µ–º–µ–Ω—Ç UI —ç–ª–µ–º–µ–Ω—Ç–æ–º
        function isUIElement(key, value) {
            return getElementType(key) === 'ui';
        }
        
        // –ú–æ–∫–æ–≤—ã–π —Å—Ç–µ–π—Ç –¥–ª—è UI –ø—Ä–µ–≤—å—é
        const mockState = {
            'üíæ.current-bike': {
                id: 'BIKE-12345',
                location: '—É–ª. –õ–µ–Ω–∏–Ω–∞, 10',
                battery: 85
            },
            'üíæ.current-rental': {
                id: 'RENTAL-67890',
                duration: 15,
                start: '14:30',
                cost: 45
            },
            'üíæ.user': {
                id: 'USER-001',
                name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤',
                balance: 500
            },
            'üíæ.pwa-installed': false
        };
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –º–æ–∫–æ–≤–æ–≥–æ —Å—Ç–µ–π—Ç–∞
        function getMockValue(path) {
            return mockState[path] || null;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–∑ –∫–ª—é—á–∞
        function getComponentName(key, codeLink) {
            if (!codeLink) return null;

            // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—É—Ç–∏ –∫ –∫–æ–¥—É
            // –ù–∞–ø—Ä–∏–º–µ—Ä: "src/bikes/screens/home.cljd#L111#context:leading-preview" -> "leading-preview"
            if (codeLink.includes('#context:')) {
                const contextMatch = codeLink.match(/#context:([^#]+)/);
                if (contextMatch) {
                    const contextName = contextMatch[1];

                    // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ preview —Ñ—É–Ω–∫—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    if (contextName.endsWith('-preview')) {
                        return contextName;
                    }

                    // –ú–∞–ø–ø–∏–Ω–≥ –∏–º–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–∞ –∏—Ö preview –≤–µ—Ä—Å–∏–∏
                    const componentMap = {
                        'app-bar': 'app-bar-preview',
                        'navbar': 'app-bar-preview',
                        'welcome': 'welcome-preview',
                        'welcomeCard': 'welcome-preview',
                        'leading': 'leading-preview',
                        'logo': 'leading-preview',
                        'profile': 'profile-preview',
                        'settings': 'settings-preview',
                        'scan': 'scan-preview',
                        'scanQR': 'scan-preview',
                        'current-rental': 'current-rental-preview',
                        'bike-rental': 'current-rental-preview',
                        'back': 'rental-back-preview',
                        'camera': 'camera-preview',
                        'bike-info': 'bike-info-preview',
                        'rental-status': 'rental-status-preview',
                        'start': 'start-preview',
                        'end': 'end-preview',
                        'instructions': 'instructions-preview',
                        'no-bike-selected': 'no-bike-selected-preview',
                        'pwa': 'pwa-preview',
                        'pwaPrompt': 'pwa-preview'
                    };

                    return componentMap[contextName] || (contextName + '-preview');
                }
            }
            
            // –ü—ã—Ç–∞–µ–º—Å—è –∏–∑–≤–ª–µ—á—å –∏–∑ –∫–ª—é—á–∞
            if (key.startsWith('[') && key.endsWith(']')) {
                // –≠–∫—Ä–∞–Ω—ã: [üè† home] -> home-screen
                const screenMatch = key.match(/\[.*?(\w+)\]/);
                if (screenMatch) {
                    return screenMatch[1] + '-screen';
                }
            }
            
            // UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: üß≠ navbar -> app-bar, üí¨ welcomeCard -> welcome
            const uiMatch = key.match(/üß≠\s*(\w+)|üí¨\s*(\w+)|üì∑\s*(\w+)|üìπ\s*(\w+)|üö¥\s*(\w+)|üë§\s*(\w+)|‚öôÔ∏è\s*(\w+)|‚óÄÔ∏è\s*(\w+)|‚ÑπÔ∏è\s*(\w+)|üìä\s*(\w+)|‚ñ∂Ô∏è\s*(\w+)|‚èπÔ∏è\s*(\w+)|üì≤\s*(\w+)/);
            if (uiMatch) {
                const componentName = uiMatch[1] || uiMatch[2] || uiMatch[3] || uiMatch[4] || uiMatch[5] || uiMatch[6] || uiMatch[7] || uiMatch[8] || uiMatch[9] || uiMatch[10] || uiMatch[11] || uiMatch[12] || uiMatch[13];
                
                // –ú–∞–ø–ø–∏–Ω–≥ –∏–º–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
                const componentMap = {
                    'navbar': 'app-bar',
                    'welcomeCard': 'welcome',
                    'scanQR': 'scan',
                    'camera': 'camera',
                    'pwaPrompt': 'pwa',
                    'bikeInfo': 'bike-info',
                    'rentalStatus': 'rental-status',
                    'start': 'start',
                    'end': 'end',
                    'back': 'back',
                    'logo': 'leading',
                    'currentRental': 'current-rental'
                };
                
                return componentMap[componentName] || componentName;
            }
            
            return null;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è UI –ø—Ä–µ–≤—å—é —á–µ—Ä–µ–∑ Flutter Web
        async function createUIPreview(key, value, codeLink = null) {
            const componentName = getComponentName(key, codeLink);

            console.log('createUIPreview called:', { key, codeLink, componentName });

            if (!componentName) {
                // –ï—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null
                console.warn('No component name found for:', key, codeLink);
                return null;
            }

            // –°–æ–∑–¥–∞–µ–º iframe –¥–ª—è Flutter Web –ø—Ä–µ–≤—å—é
            const previewId = `flutter-preview-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            const phoneWidth = config?.screen?.width || 390;
            const phoneHeight = config?.screen?.height || 844;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç—Ç–æ —ç–∫—Ä–∞–Ω –∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
            const isScreen = componentName.endsWith('-screen') || key.startsWith('[');

            // URL –¥–ª—è Flutter Web –ø—Ä–µ–≤—å—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º preview
            const previewUrl = `../../build/web/index.html?preview=${encodeURIComponent(componentName)}`;

            let html = '<div class="preview-ui">';

            if (isScreen) {
                // –î–ª—è —ç–∫—Ä–∞–Ω–æ–≤ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –ø–æ–ª–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –±–µ–∑ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
                html += `<div style="border: 2px solid #00ffff; border-radius: 20px; background: #0a0a0a; margin-bottom: 16px; width: ${phoneWidth}px; max-height: ${phoneHeight}px; box-sizing: border-box; overflow: hidden; box-shadow: 0 0 20px rgba(0, 207, 255, 0.3);">`;
                html += `<div style="height: 30px; background: #1a1a1a; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: center; color: #00ffff; font-size: 10px; text-shadow: 0 0 2px #00cfff;">Flutter Preview: ${componentName}</div>`;
                html += `<div style="height: calc(100% - 30px); overflow: hidden;">`;
                html += `<iframe id="${previewId}" src="${previewUrl}" style="width: ${phoneWidth}px; height: ${phoneHeight - 30}px; border: none;" frameborder="0"></iframe>`;
                html += `</div></div>`;
            } else {
                // –î–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞, –≤—ã—Å–æ—Ç–∞ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –¥–æ –º–∞–∫—Å–∏–º—É–º –≤—ã—Å–æ—Ç—ã —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                html += `<div style="border: 2px solid #00ffff; border-radius: 20px; background: #0a0a0a; margin-bottom: 16px; width: ${phoneWidth}px; min-height: 150px; max-height: ${phoneHeight}px; box-sizing: border-box; overflow: auto; box-shadow: 0 0 20px rgba(0, 207, 255, 0.3);">`;
                html += `<div style="height: 30px; background: #1a1a1a; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: center; color: #00ffff; font-size: 10px; text-shadow: 0 0 2px #00cfff;">Flutter Preview: ${componentName}</div>`;
                html += `<div style="padding: 10px; min-height: 120px; display: flex; align-items: center; justify-content: center;">`;
                html += `<iframe id="${previewId}" src="${previewUrl}" style="width: ${phoneWidth - 20}px; height: 400px; border: none; background: white;" frameborder="0"></iframe>`;
                html += `</div></div>`;
            }

            html += `<div style="color: #00ffff; font-size: 11px; margin-top: 8px; text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff;">üí° –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è Flutter –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: ${componentName}</div>`;
            html += '</div>';

            return html;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é –ø–∞–Ω–µ–ª–∏ (—Ç–µ–ø–µ—Ä—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è)
        async function updatePreview(key, value, identifier = null) {
            const previewPanel = document.getElementById('preview-panel');
            const previewCallersContainer = document.getElementById('preview-callers-container');
            const previewUIContainer = document.getElementById('preview-ui-container');
            const previewCodeContainer = document.getElementById('preview-code-container');

            if (!previewPanel || !previewUIContainer || !previewCodeContainer || !previewCallersContainer) return;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –Ω–µ —Ç–æ—Ç –∂–µ —ç–ª–µ–º–µ–Ω—Ç —á—Ç–æ —É–∂–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
            // –£–±–∏—Ä–∞–µ–º —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É, —á—Ç–æ–±—ã –ø—Ä–µ–≤—å—é –≤—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–ª–æ—Å—å –ø—Ä–∏ hover/click
            // if (currentPreviewState && currentPreviewState.key === key && currentPreviewState.identifier === identifier) {
            //     console.log('Already showing preview for:', key);
            //     return; // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º –µ—Å–ª–∏ —É–∂–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
            // }

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–µ–≤—å—é –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–µ–ª–æ–∞–¥–∞
            currentPreviewState = { key, value, identifier };
            sessionStorage.setItem('previewState', JSON.stringify({ key, value: null, identifier }));

            let callersHtml = '';
            let uiHtml = '';
            let codeHtml = '';

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞
            const isUI = isUIElement(key, value);
            const codeLink = identifier ? getCodeLink(identifier) : null;

            // –ü–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—ã–∑—ã–≤–∞—é—â–∏—Ö
            const extractedId = identifier || (typeof value === 'object' && value !== null && value.id
                ? value.id
                : extractSimpleIdentifier(key));

            // 0. –°–µ–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)
            if (extractedId && callersMap.has(extractedId)) {
                const callers = callersMap.get(extractedId);
                if (callers && callers.length > 0) {
                    callersHtml = '<div class="callers-section">';
                    callersHtml += '<div class="callers-title">üîó –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑:</div>';
                    callers.forEach(caller => {
                        const callerKey = caller.key || 'Unknown';
                        // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –∏–∑ –º–∞—Å—Å–∏–≤–∞ path
                        let fullPath = callerKey;
                        if (caller.path && Array.isArray(caller.path) && caller.path.length > 0) {
                            // –û—á–∏—â–∞–µ–º –ø—É—Ç—å –æ—Ç —ç–º–æ–¥–∑–∏ –∏ –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
                            const cleanPath = caller.path.map(p => {
                                // –£–±–∏—Ä–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏ –¥–ª—è screens
                                let cleaned = p.replace(/^\[|\]$/g, '');
                                // –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏ –≤ –Ω–∞—á–∞–ª–µ
                                cleaned = cleaned.replace(/^[‚ö°üåêüì∂üîßüíæüè†üì∑üö¥üß≠üí¨‚óÄÔ∏èüìπüîçüì≤‚ÑπÔ∏èüìä‚ñ∂Ô∏è‚èπÔ∏èüìã]\s*/, '');
                                // –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–µ–ª–∫–∏ –∏ –≤—Å—ë –ø–æ—Å–ª–µ –Ω–∏—Ö
                                cleaned = cleaned.split('‚Üí')[0].trim();
                                return cleaned;
                            }).filter(p => p.length > 0);
                            fullPath = cleanPath.join('.');
                        }
                        callersHtml += `<div class="caller-item" data-caller-key="${callerKey}" title="${fullPath}">${fullPath}</div>`;
                    });
                    callersHtml += '</div>';
                    previewCallersContainer.style.display = 'block';
                } else {
                    previewCallersContainer.style.display = 'none';
                }
            } else {
                previewCallersContainer.style.display = 'none';
            }

            // 1. UI –ø—Ä–µ–≤—å—é –≤ –≤–µ—Ä—Ö–Ω–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
            if (isUI) {
                console.log('UI element detected:', key, 'isUI:', isUI, 'codeLink:', codeLink);
                const uiPreviewHtml = await createUIPreview(key, value, codeLink);
                console.log('createUIPreview result:', uiPreviewHtml ? 'HTML returned' : 'null');
                if (uiPreviewHtml) {
                    uiHtml = uiPreviewHtml;
                } else {
                    console.warn('No Flutter preview available for:', key);
                    uiHtml = '<div class="preview-empty">UI –ø—Ä–µ–≤—å—é –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞</div>';
                }
            } else {
                // –î–ª—è non-UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ
                const elementType = getElementType(key);
                const typeLabels = {
                    'action': '‚ö° Action',
                    'api': 'üåê API',
                    'bluetooth': 'üì∂ Bluetooth',
                    'state': 'üíæ State',
                    'util': 'üîß Utility'
                };
                const typeLabel = typeLabels[elementType] || 'Element';
                uiHtml = `<div class="preview-empty">${typeLabel}: ${key}</div>`;
            }

            // 2. –ö–æ–¥ –ø—Ä–µ–≤—å—é –≤ –Ω–∏–∂–Ω–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
            if (codeLink) {
                codeHtml = '<div class="preview-code">';
                codeHtml += `<span class="file-path">üìÑ ${codeLink}</span>`;

                const codeContainerId = `code-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                codeHtml += `<div id="${codeContainerId}" style="margin-top: 12px; color: #00ffff; text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;"></div>`;
                codeHtml += '</div>';

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–¥ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM
                setTimeout(() => {
                    loadCodePreview(codeLink, codeContainerId, key);
                }, 0);
            } else {
                codeHtml = '<div class="preview-empty">–ù–µ—Ç –∫–æ–¥–∞ –¥–ª—è —ç—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞</div>';
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            previewCallersContainer.innerHTML = callersHtml;
            previewUIContainer.innerHTML = uiHtml;
            previewCodeContainer.innerHTML = codeHtml;

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –∏ hover –¥–ª—è –≤—ã–∑—ã–≤–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            if (callersHtml) {
                const callerItems = previewCallersContainer.querySelectorAll('.caller-item');
                callerItems.forEach(item => {
                    const callerKey = item.getAttribute('data-caller-key');

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –∫ —ç–ª–µ–º–µ–Ω—Ç—É
                    item.addEventListener('click', () => {
                        navigateToElementByKey(callerKey);
                    });

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ hover - –ø–æ–¥—Å–≤–µ—Ç–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –¥–µ—Ä–µ–≤–µ
                    item.addEventListener('mouseenter', () => {
                        highlightCallerElement(callerKey, true);
                    });

                    item.addEventListener('mouseleave', () => {
                        highlightCallerElement(callerKey, false);
                    });
                });
            }
        }
        
        function showTooltip(e, content, identifier = null, sourceElement = null) {
            // Tooltip –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
            const tooltip = document.getElementById('tooltip');
            tooltipElement = tooltip;
            tooltipSourceElement = sourceElement || e.target;
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–∞—É—Ç
            if (tooltipTimeout) {
                clearTimeout(tooltipTimeout);
                tooltipTimeout = null;
            }
            
            // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º tooltip, —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
            tooltip.classList.remove('visible');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é –ø–∞–Ω–µ–ª—å
            if (sourceElement) {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç–∞
                let key = sourceElement.textContent.replace(/: $/, '').trim();
                let data = identifierMap.get(key);
                
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –ø–æ —Ç–æ—á–Ω–æ–º—É –∫–ª—é—á—É, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç
                if (!data && sourceElement.closest('.node')) {
                    const node = sourceElement.closest('.node');
                    const keyElement = node.querySelector('.key');
                    if (keyElement && keyElement !== sourceElement) {
                        key = keyElement.textContent.replace(/: $/, '').trim();
                        data = identifierMap.get(key);
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ –¥–∞–Ω–Ω—ã–µ, –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
                if (data) {
                    updatePreview(data.key, data.value, identifier || key);
                } else {
                    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –≤ –∫–∞—Ä—Ç–µ, –Ω–æ –µ—Å—Ç—å identifier, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ –Ω–µ–≥–æ
                    if (identifier) {
                        const idData = identifierMap.get(identifier);
                        if (idData) {
                            updatePreview(idData.key, idData.value, identifier);
                        }
                    }
                }
            }
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Å–ø—Ä–∞–≤–∞ –æ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–≤–µ–ª–∏
            const padding = 20;
            
            // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —ç–ª–µ–º–µ–Ω—Ç–∞
            const sourceRect = tooltipSourceElement.getBoundingClientRect();
            
            // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã tooltip –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            tooltip.style.visibility = 'hidden';
            tooltip.style.display = 'block';
            const tooltipRect = tooltip.getBoundingClientRect();
            const tooltipWidth = tooltipRect.width;
            const tooltipHeight = tooltipRect.height;
            tooltip.style.visibility = '';
            
            // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —Å–ø—Ä–∞–≤–∞ –æ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞
            let left = sourceRect.right + padding + window.scrollX;
            let top = sourceRect.top + window.scrollY;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ –∑–∞ –ø—Ä–∞–≤—ã–π –∫—Ä–∞–π
            if (left + tooltipWidth > window.innerWidth + window.scrollX) {
                // –ü—Ä–æ–±—É–µ–º —Å–ª–µ–≤–∞ –æ—Ç —ç–ª–µ–º–µ–Ω—Ç–∞
                left = sourceRect.left - tooltipWidth - padding + window.scrollX;
                // –ï—Å–ª–∏ –∏ —Å–ª–µ–≤–∞ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é —ç–∫—Ä–∞–Ω–∞
                if (left < window.scrollX) {
                    left = window.innerWidth + window.scrollX - tooltipWidth - padding;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –ª–∏ –∑–∞ –Ω–∏–∂–Ω–∏–π –∫—Ä–∞–π
            if (top + tooltipHeight > window.innerHeight + window.scrollY) {
                top = window.innerHeight + window.scrollY - tooltipHeight - padding;
                // –ï—Å–ª–∏ –∏ —Å–≤–µ—Ä—Ö—É –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è, –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä—Ö–Ω–µ–º—É –∫—Ä–∞—é
                if (top < window.scrollY) {
                    top = window.scrollY + padding;
                }
            }
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–æ–ª–ª–µ—Ä–æ–≤
            const callerItems = tooltip.querySelectorAll('.caller-item');
            callerItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const path = JSON.parse(item.getAttribute('data-path'));
                    // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ –ø—É—Ç–∏
                    const targetElement = findElementByPath(path);
                    if (targetElement) {
                        navigateToElement(targetElement, path.join('.'));
                    }
                    hideTooltip();
                });
            });
        }

        // –°–∫—Ä—ã—Ç–∏–µ tooltip —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        function hideTooltip(immediate = false) {
            if (tooltipTimeout) {
                clearTimeout(tooltipTimeout);
            }
            
            if (immediate) {
                const tooltip = document.getElementById('tooltip');
                if (tooltip) {
                    tooltip.classList.remove('visible');
                    tooltipElement = null;
                    tooltipSourceElement = null;
                }
            } else {
                tooltipTimeout = setTimeout(() => {
                    const tooltip = document.getElementById('tooltip');
                    if (tooltip) {
                        tooltip.classList.remove('visible');
                        tooltipElement = null;
                        tooltipSourceElement = null;
                    }
                }, 150);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∫ —ç–ª–µ–º–µ–Ω—Ç—É –ø–æ –∫–ª—é—á—É (–æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è navigateToElement)
        function navigateToElementByKey(callerKey) {
            const data = identifierMap.get(callerKey);
            if (!data) {
                console.warn('Element not found for key:', callerKey);
                return;
            }

            const nodeElement = elementNodesMap.get(callerKey);
            if (nodeElement) {
                const identifier = typeof data.value === 'object' && data.value !== null && data.value.id
                    ? data.value.id
                    : extractSimpleIdentifier(callerKey) || callerKey;
                navigateToElement(nodeElement, identifier);
            } else {
                console.warn('DOM node not found for key:', callerKey);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –¥–µ—Ä–µ–≤–µ
        function highlightCallerElement(callerKey, shouldHighlight) {
            // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –ø–æ–¥—Å–≤–µ—Ç–∫—É
            document.querySelectorAll('.node.caller-highlight').forEach(el => {
                el.classList.remove('caller-highlight');
            });

            if (!shouldHighlight) return;

            // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ –∫–ª—é—á—É
            const data = identifierMap.get(callerKey);
            if (!data) return;

            // –ò—â–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç
            const nodeElement = elementNodesMap.get(callerKey);
            if (nodeElement) {
                nodeElement.classList.add('caller-highlight');
                // –£–±—Ä–∞–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ - —Ç–æ–ª—å–∫–æ –ø–æ–¥—Å–≤–µ—Ç–∫–∞
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
        function updateDebugList() {
            const debugList = document.getElementById('debug-list');
            if (!debugList) return;
            
            const allEntries = [];
            for (const [key, data] of identifierMap.entries()) {
                if (!data) continue;
                allEntries.push({
                    mapKey: key,
                    jsonKey: data.key,
                    value: data.value,
                    hasId: typeof data.value === 'object' && data.value !== null && data.value.id
                });
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–ª—é—á—É –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
            allEntries.sort((a, b) => a.mapKey.localeCompare(b.mapKey));
            
            debugList.innerHTML = `
                <div style="margin-bottom: 10px; color: #00ffff; font-size: 10px; text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;">
                    –í—Å–µ–≥–æ –∫–ª—é—á–µ–π –≤ –∫–∞—Ä—Ç–µ: ${allEntries.length}
                </div>
                ${allEntries.map(entry => 
                `<div style="margin: 4px 0; padding: 6px; background: #2a2a2a; border-left: 3px solid #00ffff; font-size: 11px; box-shadow: 0 0 10px rgba(0, 207, 255, 0.2);">
                    <strong style="color: #00ffff; text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;">mapKey:</strong> <code>${escapeHtml(entry.mapKey)}</code><br>
                    <span style="color: #0050ff; text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;">jsonKey:</span> <code>${escapeHtml(entry.jsonKey)}</code><br>
                    ${entry.hasId ? `<span style="color: #00ffff; text-shadow: 0 0 2px #00cfff, 0 0 3px #00cfff80, 0 0 6px #00cfff, 0 0 35px #00cfff;">id:</span> <code>${escapeHtml(entry.value.id)}</code><br>` : ''}
                    <span style="color: #0050ff; text-shadow: 0 0 2px #0025ff, 0 0 3px #0025ff80, 0 0 6px #0025ff, 0 0 16px #0025ff;">value type:</span> ${typeof entry.value === 'object' && entry.value !== null ? 'object' : typeof entry.value}
                </div>`
            ).join('')}`;
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // –ü–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ –ø—É—Ç–∏
        function findElementByPath(path) {
            const keys = document.querySelectorAll('.key');
            for (const keyEl of keys) {
                const keyText = keyEl.textContent.replace(/: $/, '').trim();
                // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ - –∏—â–µ–º –ø–æ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –ø—É—Ç–∏
                if (path.length > 0 && keyText.includes(path[path.length - 1])) {
                    return keyEl;
                }
            }
            return null;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è "—Å–ø–ª—é—â–∏–≤–∞–Ω–∏—è" –æ–±—ä–µ–∫—Ç–æ–≤ —Å –∫–ª—é—á–æ–º "steps" –≤ –º–∞—Å—Å–∏–≤—ã
        function flattenSteps(obj) {
            if (typeof obj !== 'object' || obj === null) {
                return obj;
            }
            
            if (Array.isArray(obj)) {
                return obj.map(item => flattenSteps(item));
            }
            
            // –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∫–ª—é—á "steps" —Å –º–∞—Å—Å–∏–≤–æ–º, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –º–∞—Å—Å–∏–≤
            const keys = Object.keys(obj).filter(k => k !== '_meta');
            if (keys.length === 1 && keys[0] === 'steps' && Array.isArray(obj.steps)) {
                return flattenSteps(obj.steps);
            }
            
            // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ —Å–≤–æ–π—Å—Ç–≤–∞
            const result = {};
            for (const [key, value] of Object.entries(obj)) {
                result[key] = flattenSteps(value);
            }
            return result;
        }

        async function loadData() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å cache-busting
            const response = await fetch('project-data.json?' + Date.now(), {
                cache: 'no-store'
            });
            let rawData = await response.json();
            
            // –£–±–∏—Ä–∞–µ–º —É—Ä–æ–≤–µ–Ω—å "steps" - –∑–∞–º–µ–Ω—è–µ–º –æ–±—ä–µ–∫—Ç—ã —Å –∫–ª—é—á–æ–º "steps" –Ω–∞ –º–∞—Å—Å–∏–≤—ã
            projectData = flattenSteps(rawData);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–¥ —Å cache-busting
            try {
                const codeLinksResponse = await fetch('code-links.json?' + Date.now(), {
                    cache: 'no-store'
                });
                codeLinks = await codeLinksResponse.json();
            } catch (e) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å code-links.json:', e);
                codeLinks = {};
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
            try {
                const configResponse = await fetch('config.json');
                config = await configResponse.json();
            } catch (e) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å config.json:', e);
                config = { screen: { width: 390, height: 844, device: "iPhone 14" } };
            }

            // –°—Ç—Ä–æ–∏–º –∫–∞—Ä—Ç—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
            buildIdentifierMap(projectData);
            
            // –°–æ–±–∏—Ä–∞–µ–º –∫–æ–ª–ª–µ—Ä—ã –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
            buildCallersMap(projectData);

            renderTree(projectData, document.getElementById('root'), 0);

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ root –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä - –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º selected –Ω–∞ –∫–ª–∏–∫–Ω—É—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–∏ —É—Ö–æ–¥–µ –º—ã—à–∏
            const rootContainer = document.getElementById('root');
            if (rootContainer) {
                rootContainer.addEventListener('mouseleave', (e) => {
                    // –£–±–∏—Ä–∞–µ–º hover-active —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    document.querySelectorAll('.node.hover-active').forEach(el => {
                        el.classList.remove('hover-active');
                    });
                    
                    // –£–±–∏—Ä–∞–µ–º selected —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    document.querySelectorAll('.node.selected').forEach(el => {
                        el.classList.remove('selected');
                    });

                    // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–ª–∏–∫–Ω—É—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞ –Ω–µ–≥–æ selected
                    if (clickedElement) {
                        clickedElement.element.classList.add('selected');
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é –∫–ª–∏–∫–Ω—É—Ç–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                        updatePreview(clickedElement.key, clickedElement.value, clickedElement.identifier);
                    }
                });
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø—Ä–µ–≤—å—é –ø–∞–Ω–µ–ª–∏, —á—Ç–æ–±—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –Ω–µ—ë –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª–æ—Å—å –ø—Ä–µ–≤—å—é
            const previewPanel = document.getElementById('preview-panel');
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–µ–ª–æ–∞–¥–∞
            const savedScrollY = sessionStorage.getItem('scrollPosition');
            const savedPreviewState = sessionStorage.getItem('previewState');
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª
            if (savedScrollY) {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                requestAnimationFrame(() => {
                    window.scrollTo(0, parseInt(savedScrollY, 10));
                });
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–≤—å—é –ø–æ—Å–ª–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –¥–µ—Ä–µ–≤–∞
            if (savedPreviewState) {
                try {
                    const previewState = JSON.parse(savedPreviewState);
                    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ identifierMap –∑–∞–ø–æ–ª–Ω–µ–Ω
                    setTimeout(() => {
                        // –ò—â–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤ identifierMap
                        const data = identifierMap.get(previewState.key);
                        if (data) {
                            updatePreview(data.key, data.value, previewState.identifier || previewState.key);
                        } else {
                            // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ identifier
                            if (previewState.identifier) {
                                const found = Array.from(identifierMap.entries()).find(([k, v]) => {
                                    const extractedId = typeof v.value === 'object' && v.value !== null && v.value.id 
                                        ? v.value.id 
                                        : extractSimpleIdentifier(v.key);
                                    return extractedId === previewState.identifier || v.key === previewState.identifier;
                                });
                                if (found) {
                                    updatePreview(found[1].key, found[1].value, previewState.identifier);
                                }
                            }
                        }
                    }, 50);
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é:', e);
                }
            }
            
            // –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
            updateDebugList();
            
            // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–ª–∞–¥–∫–∏
            const debugToggle = document.getElementById('debug-toggle');
            const debugPanel = document.getElementById('debug-identifiers');
            if (debugToggle && debugPanel) {
                debugToggle.addEventListener('click', () => {
                    if (debugPanel.style.display === 'none') {
                        debugPanel.style.display = 'block';
                        updateDebugList();
                    } else {
                        debugPanel.style.display = 'none';
                    }
                });
            }

            // Resizable preview panel - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
            let isResizing = false;
            let startX = 0;
            let startWidth = 0;

            const resizeHandle = document.getElementById('resize-handle');
            const previewPanelForResize = document.getElementById('preview-panel');

            if (resizeHandle && previewPanelForResize) {
                resizeHandle.addEventListener('mousedown', (e) => {
                    isResizing = true;
                    startX = e.clientX;
                    startWidth = previewPanelForResize.offsetWidth;
                    document.body.style.cursor = 'ew-resize';
                    document.body.style.userSelect = 'none';
                    e.preventDefault();
                });

                document.addEventListener('mouseup', () => {
                    if (isResizing) {
                        isResizing = false;
                        document.body.style.cursor = '';
                        document.body.style.userSelect = '';

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —à–∏—Ä–∏–Ω—É –≤ localStorage
                        localStorage.setItem('previewPanelWidth', previewPanelForResize.offsetWidth);
                    }
                });

                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —à–∏—Ä–∏–Ω—É
                const savedWidth = localStorage.getItem('previewPanelWidth');
                if (savedWidth) {
                    const width = parseInt(savedWidth);
                    previewPanelForResize.style.width = width + 'px';
                    document.body.style.paddingRight = (width + 40) + 'px';
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è tooltip (—á—Ç–æ–±—ã –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª—Å—è –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –∫ –Ω–µ–º—É)
            const tooltip = document.getElementById('tooltip');
            if (tooltip) {
                tooltip.addEventListener('mouseenter', () => {
                    if (tooltipTimeout) {
                        clearTimeout(tooltipTimeout);
                        tooltipTimeout = null;
                    }
                });
                tooltip.addEventListener('mouseleave', () => {
                    hideTooltip();
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–≤–∏–∂–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–æ–º –∏ tooltip
            // –ò –¥–ª—è resize preview panel
            document.addEventListener('mousemove', (e) => {
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ resize
                if (isResizing && previewPanelForResize) {
                    const deltaX = startX - e.clientX;
                    const newWidth = Math.max(300, Math.min(800, startWidth + deltaX));
                    previewPanelForResize.style.width = newWidth + 'px';
                    document.body.style.paddingRight = (newWidth + 40) + 'px';
                    return; // –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É tooltip –∫–æ–≥–¥–∞ resize –∞–∫—Ç–∏–≤–µ–Ω
                }

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ tooltip
                if (!tooltipElement || !tooltipSourceElement) return;
                
                if (!tooltipElement.classList.contains('visible')) return;
                
                const tooltipRect = tooltipElement.getBoundingClientRect();
                const sourceRect = tooltipSourceElement.getBoundingClientRect();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∫—É—Ä—Å–æ—Ä –≤ –æ–±–ª–∞—Å—Ç–∏ tooltip –∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–∞
                const inTooltip = e.clientX >= tooltipRect.left && 
                                 e.clientX <= tooltipRect.right &&
                                 e.clientY >= tooltipRect.top && 
                                 e.clientY <= tooltipRect.bottom;
                
                const inSource = e.clientX >= sourceRect.left && 
                               e.clientX <= sourceRect.right &&
                               e.clientY >= sourceRect.top && 
                               e.clientY <= sourceRect.bottom;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –∫—É—Ä—Å–æ—Ä –≤ "–º–æ—Å—Ç—É" –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–æ–º –∏ tooltip
                const minX = Math.min(sourceRect.right, tooltipRect.left);
                const maxX = Math.max(sourceRect.right, tooltipRect.left);
                const minY = Math.min(sourceRect.top, tooltipRect.top);
                const maxY = Math.max(sourceRect.bottom, tooltipRect.bottom);
                
                const inBridge = e.clientX >= minX && 
                                e.clientX <= maxX &&
                                e.clientY >= minY && 
                                e.clientY <= maxY;
                
                // –ï—Å–ª–∏ –∫—É—Ä—Å–æ—Ä –≤ tooltip, —ç–ª–µ–º–µ–Ω—Ç–µ –∏–ª–∏ –º–æ—Å—Ç—É - –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º
                if (inTooltip || inSource || inBridge) {
                    if (tooltipTimeout) {
                        clearTimeout(tooltipTimeout);
                        tooltipTimeout = null;
                    }
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–æ–∫–∏ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
        function renderStringWithLinks(str, container) {
            const sortedKeys = Array.from(identifierMap.entries())
                .map(([key, data]) => ({ key, data, length: key.length }))
                .sort((a, b) => b.length - a.length); // –î–ª–∏–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞
            
            const foundRanges = [];
            const fragments = [];
            
            // –°–Ω–∞—á–∞–ª–∞ —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
            const allMatches = [];
            for (const { key: searchKey, data } of sortedKeys) {
                if (!data) continue;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Å—Ç—Ä–æ–∫–∞ —ç—Ç–æ—Ç –∫–ª—é—á
                if (str.indexOf(searchKey) === -1) continue;
                
                let searchIndex = 0;
                while ((searchIndex = str.indexOf(searchKey, searchIndex)) !== -1) {
                    const endIndex = searchIndex + searchKey.length;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º (—Ä–æ—É—Ç, —Ñ—É–Ω–∫—Ü–∏—è –∏ —Ç.–¥.)
                    const hasId = typeof data.value === 'object' && data.value !== null && data.value.id;
                    const extractedId = extractSimpleIdentifier(searchKey);
                    const isIconBasedDefinition = /^[‚ö°üåêüîßüì∂]/.test(searchKey);
                    const isScreen = (searchKey.startsWith('[') && searchKey.endsWith(']')) || 
                                    (/^\[.*?\]$/.test(searchKey));
                    const isDefinition = hasId || isIconBasedDefinition || isScreen || 
                                        (extractedId !== null && typeof data.value === 'object' && data.value !== null);
                    
                    allMatches.push({
                        start: searchIndex,
                        end: endIndex,
                        key: searchKey,
                        data: data,
                        isDefinition: isDefinition,
                        priority: isDefinition ? 1 : 0 // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
                    });
                    
                    searchIndex = endIndex;
                }
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–≤—ã–º–∏), –∑–∞—Ç–µ–º –ø–æ –ø–æ–∑–∏—Ü–∏–∏
            allMatches.sort((a, b) => {
                if (a.priority !== b.priority) return b.priority - a.priority;
                return a.start - b.start;
            });
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è, —Ä–∞–∑—Ä–µ—à–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
            for (const match of allMatches) {
                    let overlaps = false;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è —Å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞–º–∏
                    for (const range of foundRanges) {
                    // –ï—Å–ª–∏ —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, —Ä–∞–∑—Ä–µ—à–∞–µ–º –µ–º—É –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å –Ω–µ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
                    if (match.isDefinition) {
                        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å –Ω–µ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –Ω–æ –Ω–µ –¥—Ä—É–≥–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
                        const existingFragment = fragments.find(f => f.start === range.start && f.end === range.end);
                        if (existingFragment && existingFragment.isDefinition) {
                            // –î–≤–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è - –ø—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–æ–µ –∫–æ—Ä–æ—á–µ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–º)
                            if (match.end - match.start < existingFragment.end - existingFragment.start) {
                                // –£–¥–∞–ª—è–µ–º –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                                const index = foundRanges.findIndex(r => r.start === range.start && r.end === range.end);
                                if (index !== -1) {
                                    foundRanges.splice(index, 1);
                                    fragments.splice(fragments.indexOf(existingFragment), 1);
                                }
                            } else {
                            overlaps = true;
                            }
                        }
                    } else {
                        // –ù–µ-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ –º–æ–≥—É—Ç –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
                        if (match.start < range.end && match.end > range.start) {
                            overlaps = true;
                        }
                        }
                    }
                    
                    if (!overlaps) {
                    foundRanges.push({ start: match.start, end: match.end });
                        fragments.push({
                            type: 'link',
                        content: match.key,
                        data: match.data,
                        start: match.start,
                        end: match.end,
                        isDefinition: match.isDefinition
                    });
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤, –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º —Ç–µ–∫—Å—Ç
            if (fragments.length === 0) {
                const textSpan = document.createElement('span');
                // –ù–∞—Å–ª–µ–¥—É–µ–º –∫–ª–∞—Å—Å string-literal –∏–ª–∏ step-detail –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                const isStringLiteral = container.classList.contains('string-literal');
                const isArrayItem = container.classList.contains('array-item');
                textSpan.className = isStringLiteral ? 'value string-literal' : (isArrayItem ? 'value array-item' : 'value');
                textSpan.textContent = str;
                container.appendChild(textSpan);
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ–∑–∏—Ü–∏–∏ –∏ —Å—Ç—Ä–æ–∏–º –∏—Ç–æ–≥–æ–≤—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
            fragments.sort((a, b) => a.start - b.start);
            const finalFragments = [];
            let lastIndex = 0;
            
            for (const frag of fragments) {
                if (frag.start > lastIndex) {
                    finalFragments.push({
                        type: 'text',
                        content: str.substring(lastIndex, frag.start)
                    });
                }
                finalFragments.push(frag);
                lastIndex = frag.end;
            }
            
            if (lastIndex < str.length) {
                finalFragments.push({
                    type: 'text',
                    content: str.substring(lastIndex)
                });
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
            finalFragments.forEach(fragment => {
                if (fragment.type === 'link') {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—Å–ª–µ–¥—É–µ–º –ª–∏ –º—ã –∫–ª–∞—Å—Å string-literal –∏–ª–∏ array-item –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                    const isStringLiteral = container.classList.contains('string-literal');
                    const isArrayItem = container.classList.contains('array-item');
                    const textClass = isStringLiteral ? 'value string-literal' : (isArrayItem ? 'value array-item' : 'value');
                    
                    if (!fragment.data || !fragment.data.key) {
                        const textSpan = document.createElement('span');
                        textSpan.className = textClass;
                        textSpan.textContent = fragment.content;
                        container.appendChild(textSpan);
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–µ—Å—Ç—å –≤ identifierMap –∏ —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º)
                    // fragment.data —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ identifierMap, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö –Ω–∞–ø—Ä—è–º—É—é
                    const elData = fragment.data;
                    
                    if (!elData || !elData.key) {
                        const textSpan = document.createElement('span');
                        textSpan.className = textClass;
                        textSpan.textContent = fragment.content;
                        container.appendChild(textSpan);
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–Ω–µ –ø—Ä–æ—Å—Ç–æ –ª—é–±–æ–π –∫–ª—é—á)
                    const hasId = typeof elData.value === 'object' && elData.value !== null && elData.value.id;
                    const extractedId = extractSimpleIdentifier(elData.key);
                    // –ï—Å–ª–∏ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∏–∫–æ–Ω–∫–∏ —Ñ—É–Ω–∫—Ü–∏–∏/API/utils/bluetooth (‚ö°üåêüîßüì∂), —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                    const isIconBasedDefinition = /^[‚ö°üåêüîßüì∂]/.test(elData.key);
                    // –ï—Å–ª–∏ –∫–ª—é—á - —Ä–æ—É—Ç –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö, —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø–æ –∫–ª—é—á—É, –∏ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞)
                    const isScreen = (elData.key.startsWith('[') && elData.key.endsWith(']')) || 
                                    (fragment.content.startsWith('[') && fragment.content.endsWith(']')) ||
                                    (/^\[.*?\]$/.test(elData.key)) ||
                                    (/^\[.*?\]$/.test(fragment.content));
                    const isDefinition = hasId || isIconBasedDefinition || isScreen || (extractedId !== null && typeof elData.value === 'object' && elData.value !== null);
                    
                    if (!isDefinition) {
                        const textSpan = document.createElement('span');
                        textSpan.className = textClass;
                        textSpan.textContent = fragment.content;
                        container.appendChild(textSpan);
                        return;
                    }
                    
                    const searchKey = elData.key;
                    
                    const refSpan = document.createElement('span');
                    refSpan.className = 'reference';
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç —Å—Å—ã–ª–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                    // –ü—Ä–∞–≤–∏–ª–∞: —Ä–æ—É—Ç—ã - —Å–∏–Ω–∏–π, —Ñ—É–Ω–∫—Ü–∏–∏ - –±–∏—Ä—é–∑–æ–≤—ã–π, bluetooth/API —Å–∏—Å—Ç–µ–º—ã - —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π, API –±—ç–∫–µ–Ω–¥–∞ - –∑–µ–ª–µ–Ω—ã–π
                    const linkKey = elData.key;
                    const linkContent = fragment.content;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ —ç–∫—Ä–∞–Ω (—Å–æ–¥–µ—Ä–∂–∏—Ç –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏) - –ü–ï–†–í–´–ú –î–ï–õ–û–ú
                    // –†–æ—É—Ç—ã –≤—Å–µ–≥–¥–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ [–∏–∫–æ–Ω–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ] –∏–ª–∏ [–Ω–∞–∑–≤–∞–Ω–∏–µ]
                    const trimmedLinkContent = linkContent.trim();
                    const trimmedLinkKey = linkKey.trim();
                    const isScreenRoute = (trimmedLinkKey.startsWith('[') && trimmedLinkKey.endsWith(']')) || 
                                        (trimmedLinkContent.startsWith('[') && trimmedLinkContent.endsWith(']')) ||
                                        (/^\[.*?\]$/.test(trimmedLinkContent)) ||
                                        (/^\[.*?\]$/.test(trimmedLinkKey)) ||
                                        (linkKey.includes('[') && linkKey.includes(']')) ||
                                        (linkContent.includes('[') && linkContent.includes(']'));
                    
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞
                    const elementType = getElementType(linkKey) || getElementType(linkContent);
                    if (elementType) {
                        refSpan.classList.add(`key-type-${elementType}`);
                    } else if (isScreenRoute) {
                        // Fallback –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤
                        refSpan.classList.add('key-type-ui');
                    }
                    
                    refSpan.textContent = fragment.content;
                    
                    refSpan.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const elements = document.querySelectorAll('.key');
                        let found = false;
                        
                        // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º searchKey –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                        const normalizedSearchKey = searchKey.trim();
                        
                        for (const el of elements) {
                            let keyText = el.textContent.replace(/: $/, '').trim();
                            
                            // –î–ª—è —Ä–æ—É—Ç–æ–≤ –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Ç–æ—á–Ω–æ
                            if (normalizedSearchKey.startsWith('[') && normalizedSearchKey.endsWith(']')) {
                                if (keyText === normalizedSearchKey) {
                                    navigateToElement(el, normalizedSearchKey);
                                    found = true;
                                    break;
                                }
                            } else {
                                // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º –∫–∞–∫ –æ–±—ã—á–Ω–æ
                                if (keyText === normalizedSearchKey) {
                                    navigateToElement(el, normalizedSearchKey);
                                    found = true;
                                    break;
                                }
                            }
                        }
                        
                        // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —á–∞—Å—Ç–∏—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é –¥–ª—è —Ä–æ—É—Ç–æ–≤
                        if (!found && normalizedSearchKey.startsWith('[') && normalizedSearchKey.endsWith(']')) {
                        for (const el of elements) {
                            const keyText = el.textContent.replace(/: $/, '').trim();
                                // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ —Ä–æ—É—Ç, —É–±–∏—Ä–∞—è –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
                                if (keyText.replace(/\s+/g, '') === normalizedSearchKey.replace(/\s+/g, '')) {
                                    navigateToElement(el, normalizedSearchKey);
                                    found = true;
                                    break;
                                }
                            }
                        }
                        
                        if (!found) {
                            console.warn('–ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:', normalizedSearchKey, '–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏:', Array.from(identifierMap.keys()).filter(k => k.includes('bikeRental') || k.includes('üö¥')));
                        }
                    });
                    
                    // –£–±—Ä–∞–ª–∏ tooltip –¥–ª—è —Å—Å—ã–ª–æ–∫
                    
                    container.appendChild(refSpan);
                } else {
                    // –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –Ω–∞—Å–ª–µ–¥—É–µ–º –∫–ª–∞—Å—Å string-literal –∏–ª–∏ array-item –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
                    const isStringLiteral = container.classList.contains('string-literal');
                    const isArrayItem = container.classList.contains('array-item');
                    const textSpan = document.createElement('span');
                    textSpan.className = isStringLiteral ? 'value string-literal' : (isArrayItem ? 'value array-item' : 'value');
                    textSpan.textContent = fragment.content;
                    container.appendChild(textSpan);
                }
            });
        }

        function renderTree(obj, container, level) {
            if (typeof obj !== 'object' || obj === null) {
                const valueSpan = document.createElement('span');
                valueSpan.className = 'value'; // –û–±—ã—á–Ω—ã–π —Ü–≤–µ—Ç, –Ω–µ –∂–µ–ª—Ç—ã–π
                
                // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
                if (typeof obj === 'string') {
                    renderStringWithLinks(obj, valueSpan);
                } else {
                    valueSpan.textContent = JSON.stringify(obj);
                }
                
                container.appendChild(valueSpan);
                return;
            }

            if (Array.isArray(obj)) {
                // –†–µ–Ω–¥–µ—Ä–∏–º –º–∞—Å—Å–∏–≤—ã –∫–∞–∫ —Å–ø–∏—Å–æ–∫ –±–µ–∑ —Å–∫–æ–±–æ–∫ –∏ –∑–∞–ø—è—Ç—ã—Ö
                obj.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = `node level-${level}`;
                    
                    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ - –æ–±—ä–µ–∫—Ç —Å –∫–ª—é—á–æ–º "Text", —ç—Ç–æ —Ç–µ–∫—Å—Ç (–∂–µ–ª—Ç—ã–π)
                    if (typeof item === 'object' && item !== null && item.hasOwnProperty('Text')) {
                        const valueSpan = document.createElement('span');
                        valueSpan.className = 'value string-literal'; // –ñ–µ–ª—Ç—ã–π –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤
                        valueSpan.textContent = item.Text;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º hover –¥–ª—è –ø—Ä–µ–≤—å—é
                        const itemKey = item.Text;
                        valueSpan.style.cursor = 'pointer';
                        valueSpan.addEventListener('mouseenter', (e) => {
                            updateHoverStateFromEvent(e);
                        });
                        
                        valueSpan.addEventListener('mouseleave', (e) => {
                            updateHoverStateFromEvent(e);
                        });
                        
                        itemDiv.appendChild(valueSpan);
                    }
                    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ - –æ–±—ä–µ–∫—Ç —Å –∫–ª—é—á–æ–º "Image", —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    else if (typeof item === 'object' && item !== null && item.hasOwnProperty('Image')) {
                        const valueSpan = document.createElement('span');
                        valueSpan.className = 'value';
                        valueSpan.textContent = item.Image;
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º hover –¥–ª—è –ø—Ä–µ–≤—å—é —ç–ª–µ–º–µ–Ω—Ç–æ–≤ Image
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ —ç–º–æ–¥–∑–∏
                        const imageEmoji = item.Image;
                        let elementKey = '';
                        if (imageEmoji === 'üö¥') {
                            elementKey = 'üö¥ logo';
                        } else if (imageEmoji === 'üë§') {
                            elementKey = 'üë§ profile';
                        } else if (imageEmoji === '‚öôÔ∏è') {
                            elementKey = '‚öôÔ∏è settings';
                        } else {
                            elementKey = imageEmoji;
                        }
                        
                        valueSpan.style.cursor = 'pointer';
                        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ hover –Ω–∞ valueSpan - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–≤—å—é –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Ç–µ–∫—Å—Ç/–∏–∫–æ–Ω–∫—É
                        valueSpan.addEventListener('mouseenter', (e) => {
                            updateHoverStateFromEvent(e);
                        });
                        
                        valueSpan.addEventListener('mouseleave', (e) => {
                            updateHoverStateFromEvent(e);
                        });
                        
                        itemDiv.appendChild(valueSpan);
                    }
                    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ - –æ–±—ä–µ–∫—Ç —Å –∫–ª—é—á–æ–º "algo", —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º (–±–µ–ª—ã–π, –Ω—É–º–µ—Ä–∞—Ü–∏—è –∏–∑ JSON)
                    else if (typeof item === 'object' && item !== null && item.hasOwnProperty('algo')) {
                        const valueSpan = document.createElement('span');
                        valueSpan.className = 'value array-item'; // –ë–µ–ª—ã–π –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
                        // –ù—É–º–µ—Ä–∞—Ü–∏—è —É–∂–µ –≤ —Å—Ç—Ä–æ–∫–µ –∏–∑ JSON, –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º
                        renderStringWithLinks(item.algo, valueSpan);
                        itemDiv.appendChild(valueSpan);
                    }
                    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞ - —Å—Ç—Ä–æ–∫–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å —ç–º–æ–¥–∑–∏ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ (–∞–ª–≥–æ—Ä–∏—Ç–º)
                    else if (typeof item === 'string') {
                        const valueSpan = document.createElement('span');
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å —ç–º–æ–¥–∑–∏ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ (1Ô∏è‚É£, 2Ô∏è‚É£ –∏ —Ç.–¥.)
                        const hasNumberEmoji = /^[1-9]Ô∏è‚É£|^üîü/.test(item);
                        if (hasNumberEmoji) {
                            valueSpan.className = 'value array-item'; // –ë–µ–ª—ã–π –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
                        } else {
                            valueSpan.className = 'value'; // –û–±—ã—á–Ω—ã–π —Ü–≤–µ—Ç
                        }
                        renderStringWithLinks(item, valueSpan);
                        itemDiv.appendChild(valueSpan);
                    } else {
                        renderTree(item, itemDiv, level + 1);
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º hover –¥–ª—è –≤—Å–µ–≥–æ –±–ª–æ–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ - –í–ê–ñ–ù–û –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞
                    itemDiv.addEventListener('mouseenter', (e) => {
                        updateHoverStateFromEvent(e);
                    });
                    
                    itemDiv.addEventListener('mouseleave', (e) => {
                        updateHoverStateFromEvent(e);
                    });

                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                    itemDiv.addEventListener('click', (e) => {
                        e.stopPropagation();

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–ª–∏–∫–Ω—É–ª–∏ –ª–∏ –Ω–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç - –¥–µ—Å–µ–ª–µ–∫—Ç–∏–º
                        if (clickedElement && clickedElement.element === itemDiv) {
                            // –î–µ—Å–µ–ª–µ–∫—Ç - —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å selected
                            document.querySelectorAll('.node.selected').forEach(el => el.classList.remove('selected'));
                            clickedElement = null;
                            return;
                        }

                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª—é—á —ç–ª–µ–º–µ–Ω—Ç–∞
                        let elementKey = '';
                        let elementValue = item;

                        if (typeof item === 'object' && item !== null) {
                            if (item.hasOwnProperty('Image')) {
                                const imageEmoji = item.Image;
                                if (imageEmoji === 'üö¥') {
                                    elementKey = 'üö¥ logo';
                                } else if (imageEmoji === 'üë§') {
                                    elementKey = 'üë§ profile';
                                } else if (imageEmoji === '‚öôÔ∏è') {
                                    elementKey = '‚öôÔ∏è settings';
                                } else {
                                    elementKey = imageEmoji;
                                }
                            } else if (item.hasOwnProperty('Text')) {
                                elementKey = item.Text;
                            }
                        } else if (typeof item === 'string') {
                            elementKey = item;
                            elementValue = item;
                        }

                        if (elementKey) {
                            // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π selected
                            document.querySelectorAll('.node.selected').forEach(el => el.classList.remove('selected'));
                            // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å selected –∫ –∫–ª–∏–∫–Ω—É—Ç–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                            itemDiv.classList.add('selected');

                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∫–∞–∫ –∫–ª–∏–∫–Ω—É—Ç—ã–π
                            clickedElement = {
                                key: elementKey,
                                value: elementValue,
                                identifier: elementKey,
                                element: itemDiv
                            };
                        }
                    });

                    // –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º mouseleave –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ - —Ç–æ–ª—å–∫–æ –¥–ª—è root –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç –≤ –∫–∞—Ä—Ç—É –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–∞—Å—Å–∏–≤–∞ (–µ—Å–ª–∏ —ç—Ç–æ Image –∏–ª–∏ Text)
                    if (typeof item === 'object' && item !== null) {
                        if (item.hasOwnProperty('Image')) {
                            const imageEmoji = item.Image;
                            let elementKey = '';
                            if (imageEmoji === 'üö¥') {
                                elementKey = 'üö¥ logo';
                            } else if (imageEmoji === 'üë§') {
                                elementKey = 'üë§ profile';
                            } else if (imageEmoji === '‚öôÔ∏è') {
                                elementKey = '‚öôÔ∏è settings';
                            } else {
                                elementKey = imageEmoji;
                            }
                            elementNodesMap.set(elementKey, itemDiv);
                        } else if (item.hasOwnProperty('Text')) {
                            elementNodesMap.set(item.Text, itemDiv);
                        }
                    }

                    container.appendChild(itemDiv);
                });
                return;
            }

            // Object
            const entries = Object.entries(obj).filter(([key]) => key !== '_meta'); // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

            entries.forEach(([key, value], index) => {
                const nodeDiv = document.createElement('div');
                nodeDiv.className = `node level-${level}`;

                const keySpan = document.createElement('span');
                keySpan.className = 'key';
                // –†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ CSS –∫–ª–∞—Å—Å—ã level-0, level-1 –∏ —Ç.–¥.
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ —á–µ—Ä–µ–∑ getElementType
                const elementType = getElementType(key);
                if (elementType) {
                    keySpan.classList.add(`key-type-${elementType}`);
                }

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–ª—é—á –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ - —ç—Ç–æ –ª–∏–±–æ –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º id (–¥–ª—è state), –ª–∏–±–æ –∫–ª—é—á —Å –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º (–¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, API, Bluetooth, utils), –ª–∏–±–æ —Ä–æ—É—Ç –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö
                const hasId = typeof value === 'object' && value !== null && value.id;
                const extractedId = extractSimpleIdentifier(key);
                const isScreen = key.startsWith('[') && key.endsWith(']');
                const isDefinition = hasId || (extractedId !== null && typeof value === 'object' && value !== null) || isScreen;
                if (isDefinition) {
                    // –≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏/API/bluetooth/utils - –¥–µ–ª–∞–µ–º –µ–≥–æ —Å—Å—ã–ª–∫–æ–π
                    keySpan.classList.add('reference');
                    keySpan.style.cursor = 'pointer';
                    // –¢–∏–ø —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤—ã—à–µ —á–µ—Ä–µ–∑ getElementType, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
                    keySpan.style.textDecoration = 'underline';
                    
                    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–µ–ª–æ–∫
                    if (key.includes('‚Üí')) {
                        const parts = key.split('‚Üí');
                        keySpan.innerHTML = parts.map((part, i) => {
                            if (i === 0) return part;
                            return `<span class="arrow">‚Üí</span>${part}`;
                        }).join('');
                    } else {
                        keySpan.textContent = key;
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –∏ hover
                    keySpan.addEventListener('click', (e) => {
                        e.stopPropagation();

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–ª–∏–∫–Ω—É–ª–∏ –ª–∏ –Ω–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç - –¥–µ—Å–µ–ª–µ–∫—Ç–∏–º
                        if (clickedElement && clickedElement.element === nodeDiv) {
                            // –î–µ—Å–µ–ª–µ–∫—Ç - —É–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å selected
                            document.querySelectorAll('.node.selected').forEach(el => el.classList.remove('selected'));
                            clickedElement = null;
                            return;
                        }

                        // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π selected
                        document.querySelectorAll('.node.selected').forEach(el => el.classList.remove('selected'));
                        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å selected –∫ –∫–ª–∏–∫–Ω—É—Ç–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                        nodeDiv.classList.add('selected');

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç –∫–∞–∫ –∫–ª–∏–∫–Ω—É—Ç—ã–π
                        clickedElement = {
                            key: key,
                            value: value,
                            identifier: typeof value === 'object' && value !== null && value.id
                                ? value.id
                                : extractSimpleIdentifier(key) || key,
                            element: nodeDiv
                        };
                        
                        // –ò—â–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
                        // –î–ª—è —Ä–æ—É—Ç–æ–≤ –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∫–æ–±–∫–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª—é—á –∫–∞–∫ –µ—Å—Ç—å
                        let searchKey = key;
                        if (!key.startsWith('[') || !key.endsWith(']')) {
                            // –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–∑ –∫–ª—é—á–∞ (—É–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å—ã —Ç–∏–ø–∞ "4Ô∏è‚É£ ")
                            searchKey = key.replace(/^[\s\d\ufe0f\u20e3\u{1F300}-\u{1F9FF}]*/u, '').trim();
                        }
                        
                        const elements = document.querySelectorAll('.key');
                        let found = false;
                        
                        // –ò—â–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–∫–ª—é—á —Å —Ç–∞–∫–∏–º –∂–µ —Ç–µ–∫—Å—Ç–æ–º, –Ω–æ –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º)
                        for (const el of elements) {
                            const keyText = el.textContent.replace(/: $/, '').trim();
                            
                            // –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                            if (keyText === searchKey) {
                                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ identifierMap, —á—Ç–æ —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                                const elData = identifierMap.get(keyText);
                                const hasId = elData && typeof elData.value === 'object' && elData.value !== null && elData.value.id;
                                const extractedId = extractSimpleIdentifier(keyText);
                                const isScreen = keyText.startsWith('[') && keyText.endsWith(']');
                                const isDefinition = hasId || (extractedId !== null && elData && typeof elData.value === 'object' && elData.value !== null) || isScreen;
                                if (isDefinition) {
                                    // –≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ - –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–µ–º—É
                                    if (el !== keySpan) {
                                        navigateToElement(el, searchKey);
                                        found = true;
                                        break;
                                    }
                                }
                            }
                        }
                        
                        if (!found) {
                            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                            navigateToElement(keySpan, searchKey);
                        }
                    });
                    
                    // –£–±—Ä–∞–ª–∏ tooltip –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                } else {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–ª—é—á —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
                    // (–Ω–∞–ø—Ä–∏–º–µ—Ä, "4Ô∏è‚É£ func ‚úèÔ∏è set-current-bike(bike) ‚Üí current-bike": {})
                    // –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–Ω—É—Ç—Ä–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "2Ô∏è‚É£ valid = util ‚úÖ validate-qr-code(qrCode) ‚Üí valid": {})
                    const cleanKey = key.replace(/^[\s\d\ufe0f\u20e3\u{1F300}-\u{1F9FF}]*/u, '').trim();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –∫–ª—é—á —Å –∏–∫–æ–Ω–∫–∏-–ø—Ä–µ—Ñ–∏–∫—Å–∞ (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç)
                    let isIdentifierReference = /^[‚ö°üåêüì∂üîßüíæ]\s+/.test(cleanKey);
                    
                    // –ï—Å–ª–∏ –Ω–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏
                    if (!isIdentifierReference) {
                        isIdentifierReference = /^(func|api|ble|util|state)\s+/.test(cleanKey);
                    }
                    
                    // –ï—Å–ª–∏ –Ω–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∫–ª—é—á –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–Ω—É—Ç—Ä–∏
                    if (!isIdentifierReference) {
                        // –ò—â–µ–º –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç: "üîß validate-qr-code ‚úÖ (...)" –∏–ª–∏ —Å—Ç–∞—Ä—ã–π: "util ‚úÖ validate-qr-code(...)"
                        const newFormatPattern = /[‚ö°üåêüì∂üîßüíæ]\s+[\w-]+\s+[^\s]+\s*\(/;
                        const oldFormatPattern = /\b(func|api|ble|util|state)\s+[^\s]+\s+([\w-]+)\(/;
                        isIdentifierReference = newFormatPattern.test(key) || oldFormatPattern.test(key);
                    }
                    
                    if (isIdentifierReference) {
                        // –≠—Ç–æ —Å—Å—ã–ª–∫–∞ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä - –¥–µ–ª–∞–µ–º –µ—ë –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∞—Å—Å—ã —Ç–∏–ø–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
                        keySpan.classList.add('reference');
                        keySpan.style.cursor = 'pointer';
                        // –¶–≤–µ—Ç –±—É–¥–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å—ã key-type-action/key-type-state/key-type-util, –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º
                        if (!keySpan.classList.contains('key-type-action') && !keySpan.classList.contains('key-type-state') && !keySpan.classList.contains('key-type-util')) {
                            keySpan.style.color = '#4fc3f7';
                        }
                        keySpan.style.textDecoration = 'underline';
                        
                        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–µ–ª–æ–∫
                        if (key.includes('‚Üí')) {
                            const parts = key.split('‚Üí');
                            keySpan.innerHTML = parts.map((part, i) => {
                                if (i === 0) return part;
                                return `<span class="arrow">‚Üí</span>${part}`;
                            }).join('');
                        } else {
                            keySpan.textContent = key;
                        }
                        
                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–∑ –∫–ª—é—á–∞
                        // –ï—Å–ª–∏ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ–º cleanKey
                        // –ï—Å–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–Ω—É—Ç—Ä–∏ - –∏–∑–≤–ª–µ–∫–∞–µ–º –µ–≥–æ
                        let identifierToFind = cleanKey;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –∏–∫–æ–Ω–∫–∞–º–∏
                        if (!/^[‚ö°üåêüì∂üîßüíæ]\s+/.test(cleanKey) && !/^(func|api|ble|util|state)\s+/.test(cleanKey)) {
                            // –ò—â–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏
                            // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç: "üîß validate-qr-code ‚úÖ (qrCode) ‚Üí valid"
                            const newFormatMatch = key.match(/[‚ö°üåêüì∂üîßüíæ]\s+[\w-]+\s+[^\s]+\s*\([^)]*\)\s*‚Üí[^‚Üí]*/);
                            if (newFormatMatch) {
                                identifierToFind = newFormatMatch[0].trim();
                            } else {
                                // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç: "util ‚úÖ validate-qr-code(qrCode) ‚Üí valid"
                                const oldFormatMatch = key.match(/\b(func|api|ble|util|state)\s+[^\s]+\s+([\w-]+)\([^)]*\)\s*‚Üí[^‚Üí]*/);
                                if (oldFormatMatch) {
                                    identifierToFind = oldFormatMatch[0].trim();
                                }
                            }
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
                        keySpan.addEventListener('click', (e) => {
                            e.stopPropagation();
                            
                            const elements = document.querySelectorAll('.key');
                            let found = false;
                            
                            // –ò—â–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (–∫–ª—é—á —Å —Ç–∞–∫–∏–º –∂–µ —Ç–µ–∫—Å—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º)
                            for (const el of elements) {
                                const keyText = el.textContent.replace(/: $/, '').trim();
                                
                                // –ò—â–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º
                                // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
                                const elData = identifierMap.get(keyText);
                                const hasId = elData && typeof elData.value === 'object' && elData.value !== null && elData.value.id;
                                const extractedId = extractSimpleIdentifier(keyText);
                                const isDefinition = hasId || (extractedId !== null && elData && typeof elData.value === 'object' && elData.value !== null);
                                if (isDefinition) {
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ –∫–ª—é—á —Å –∏—Å–∫–æ–º—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º
                                    // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å—ã —Ç–∏–ø–∞ "4Ô∏è‚É£ " –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                                    const cleanKeyText = keyText.replace(/^[\s\d\ufe0f\u20e3\u{1F300}-\u{1F9FF}]*/u, '').trim();
                                    const cleanIdentifierToFind = identifierToFind.replace(/^[\s\d\ufe0f\u20e3\u{1F300}-\u{1F9FF}]*/u, '').trim();
                                    
                                    // –¢–∞–∫–∂–µ –∏–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                                    const extractFunctionName = (str) => {
                                        // –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω: –∏–∫–æ–Ω–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–∫–æ–Ω–∫–∞ (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
                                        const match = str.match(/[‚ö°üåêüì∂üîßüíæ]\s+([\w-]+)\s+[^\s]+\s*\(/);
                                        return match ? match[1] : null;
                                    };
                                    
                                    const keyFunctionName = extractFunctionName(keyText);
                                    const identifierFunctionName = extractFunctionName(identifierToFind);
                                    
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–∏
                                    const functionNameMatch = keyFunctionName && identifierFunctionName && keyFunctionName === identifierFunctionName;
                                    
                                    if (keyText === identifierToFind || 
                                        cleanKeyText === cleanIdentifierToFind ||
                                        functionNameMatch) {
                                        // –≠—Ç–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ - –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–µ–º—É
                                        navigateToElement(el, identifierToFind);
                                        found = true;
                                        break;
                                    }
                                }
                            }
                            
                            if (!found) {
                                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                                navigateToElement(keySpan, identifierToFind);
                            }
                        });
                        
                        // –£–±—Ä–∞–ª–∏ tooltip –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    } else {
                        // –û–±—ã—á–Ω—ã–π –∫–ª—é—á - –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º
                        if (key.includes('‚Üí')) {
                            const parts = key.split('‚Üí');
                            keySpan.innerHTML = parts.map((part, i) => {
                                if (i === 0) return part;
                                return `<span class="arrow">‚Üí</span>${part}`;
                            }).join('');
                        } else {
                            keySpan.textContent = key;
                        }
                    }
                }

                // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ - –ø—Ä–æ—Å—Ç–æ–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º inline
                if (typeof value !== 'object' || value === null) {
                    keySpan.innerHTML += '<span class="bracket">: </span>';
                    nodeDiv.appendChild(keySpan);

                    const valueSpan = document.createElement('span');
                    // –ñ–µ–ª—Ç—ã–º–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª—é—á–æ–º "Text"
                    if (key === 'Text') {
                        valueSpan.className = 'value string-literal'; // –ñ–µ–ª—Ç—ã–π –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤
                    } else {
                        valueSpan.className = 'value'; // –û–±—ã—á–Ω—ã–π —Ü–≤–µ—Ç
                    }

                    // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
                    if (typeof value === 'string') {
                        renderStringWithLinks(value, valueSpan);
                    } else {
                        valueSpan.textContent = JSON.stringify(value);
                    }

                    nodeDiv.appendChild(valueSpan);
                }
                // –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –∏–ª–∏ –º–∞—Å—Å–∏–≤ - —Ä–µ–Ω–¥–µ—Ä–∏–º –¥–µ—Ç–µ–π
                else if (Array.isArray(value) || (typeof value === 'object' && value !== null && Object.keys(value).length > 0)) {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç–æ–º —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –º–∞—Å—Å–∏–≤–æ–º Text (–≤–ª–æ–∂–µ–Ω–∏–µ 1:1)
                    const keys = Object.keys(value);
                    const isSingleTextArray = keys.length === 1 && 
                        keys[0] === 'Text' && 
                        Array.isArray(value[keys[0]]) && 
                        value[keys[0]].length > 0 &&
                        value[keys[0]].every(item => typeof item === 'object' && item !== null && item.hasOwnProperty('Text'));
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç–æ–º —Å –º–∞—Å—Å–∏–≤–æ–º steps (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç) –∏–ª–∏ algo (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç)
                    const isStepsArray = keys.length === 1 && 
                        (keys[0] === 'steps' || keys[0] === 'algo') && 
                        Array.isArray(value[keys[0]]);
                    
                    if (isSingleTextArray) {
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –Ω–∞ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏: –∫–ª—é—á : –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ Text
                        keySpan.innerHTML += '<span class="bracket">: </span>';
                        nodeDiv.appendChild(keySpan);
                        
                        const textArray = value[keys[0]];
                        textArray.forEach((textObj, index) => {
                            if (textObj && textObj.Text) {
                                const valueSpan = document.createElement('span');
                                valueSpan.className = 'value string-literal'; // –ñ–µ–ª—Ç—ã–π –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤
                                valueSpan.textContent = textObj.Text;
                                if (index < textArray.length - 1) {
                                    valueSpan.textContent += ', ';
                                }
                                nodeDiv.appendChild(valueSpan);
                            }
                        });
                    } else if (isStepsArray) {
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º: –∫–ª—é—á : —à–∞–≥–∏
                        keySpan.innerHTML += '<span class="bracket">: </span>';
                        nodeDiv.appendChild(keySpan);
                        
                        const stepsArray = value[keys[0]];
                        stepsArray.forEach((step, index) => {
                            const stepDiv = document.createElement('div');
                            stepDiv.className = `node level-${level + 1}`;
                            
                            const valueSpan = document.createElement('span');
                            // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ä–µ–∫—Ç —Å –∫–ª—é—á–æ–º algo, –±–µ—Ä–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
                            if (typeof step === 'object' && step !== null && step.hasOwnProperty('algo')) {
                                valueSpan.className = 'value array-item'; // –ë–µ–ª—ã–π –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
                                renderStringWithLinks(step.algo, valueSpan);
                            }
                            // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å —ç–º–æ–¥–∑–∏ –Ω—É–º–µ—Ä–∞—Ü–∏–∏
                            else if (typeof step === 'string') {
                                const hasNumberEmoji = /^[1-9]Ô∏è‚É£|^üîü/.test(step);
                                valueSpan.className = hasNumberEmoji ? 'value array-item' : 'value';
                                renderStringWithLinks(step, valueSpan);
                            } else {
                                valueSpan.textContent = JSON.stringify(step);
                            }
                            
                            stepDiv.appendChild(valueSpan);
                            nodeDiv.appendChild(stepDiv);
                        });
                    } else {
                        // –û–±—ã—á–Ω–æ–µ –≤–ª–æ–∂–µ–Ω–∏–µ - —Ä–µ–Ω–¥–µ—Ä–∏–º –¥–µ—Ç–µ–π
                    nodeDiv.appendChild(keySpan);
                    const childrenDiv = document.createElement('div');
                    childrenDiv.className = 'children';
                    renderTree(value, childrenDiv, level + 1);
                    nodeDiv.appendChild(childrenDiv);
                    }
                } else {
                    nodeDiv.appendChild(keySpan);
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ hover –¥–ª—è –í–°–ï–• —ç–ª–µ–º–µ–Ω—Ç–æ–≤, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–ª—è—Ç—å –ø—Ä–µ–≤—å—é
                // –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø—Ä–µ–≤—å—é –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –≤–∫–ª—é—á–∞—è —ç–∫—Ä–∞–Ω—ã –∏ UI
                const updatePreviewOnHover = (e) => {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π key –Ω–∞–ø—Ä—è–º—É—é (–Ω–µ textContent, —Ç.–∫. —Ç–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å HTML)
                    // –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞–≤–±–∞—Ä–∞ –∏ –¥—Ä—É–≥–∏—Ö UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    let data = identifierMap.get(key);
                    
                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –≤ –∫–∞—Ä—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π key –∏ value –Ω–∞–ø—Ä—è–º—É—é
                    if (!data) {
                        data = { key: key, value: value };
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
                    // –î–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞–≤–±–∞—Ä–∞ –∏ –¥—Ä—É–≥–∏—Ö UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∞–º key –∫–∞–∫ identifier
                    // –µ—Å–ª–∏ extractSimpleIdentifier –≤–µ—Ä–Ω—É–ª null
                    const extractedId = typeof data.value === 'object' && data.value !== null && data.value.id 
                        ? data.value.id 
                        : extractSimpleIdentifier(data.key);
                    
                    // –ï—Å–ª–∏ extractedId null, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∞–º key (–≤–∞–∂–Ω–æ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å —ç–º–æ–¥–∑–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–∞–≤–±–∞—Ä)
                    const identifier = extractedId || data.key;
                    updatePreview(data.key, data.value, identifier);
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º capture phase, —á—Ç–æ–±—ã –æ–Ω –≤—ã–∑—ã–≤–∞–ª—Å—è —Ä–∞–Ω—å—à–µ –¥—Ä—É–≥–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
                keySpan.addEventListener('mouseenter', updatePreviewOnHover, { capture: true });
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ hover-—ç—Ñ—Ñ–µ–∫—Ç–æ–º —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
                nodeDiv.addEventListener('mouseenter', (e) => {
                    updateHoverStateFromEvent(e);
                });
                
                nodeDiv.addEventListener('mouseleave', (e) => {
                    updateHoverStateFromEvent(e);
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è nodeDiv (–Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –∫–ª–∏–∫ –Ω–∞ keySpan)
                nodeDiv.addEventListener('click', (e) => {
                    // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º, –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ keySpan (–æ–Ω —Å–∞–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç)
                    if (e.target !== keySpan && !keySpan.contains(e.target)) {
                        e.stopPropagation();

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–ª–∏–∫–Ω—É–ª–∏ –ª–∏ –Ω–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç - –¥–µ—Å–µ–ª–µ–∫—Ç–∏–º
                        if (clickedElement && clickedElement.element === nodeDiv) {
                            // –î–µ—Å–µ–ª–µ–∫—Ç
                            clickedElement = null;
                            return;
                        }

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç –∫–∞–∫ –∫–ª–∏–∫–Ω—É—Ç—ã–π
                        clickedElement = {
                            key: key,
                            value: value,
                            identifier: typeof value === 'object' && value !== null && value.id
                                ? value.id
                                : extractSimpleIdentifier(key) || key,
                            element: nodeDiv
                        };
                    }
                });

                // –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º mouseleave –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ - —Ç–æ–ª—å–∫–æ –¥–ª—è root –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç –≤ –∫–∞—Ä—Ç—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
                elementNodesMap.set(key, nodeDiv);

                container.appendChild(nodeDiv);
            });
        }

        // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–∞–Ω–µ–ª—å –ø—Ä–µ–≤—å—é –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏–º–∞
        document.addEventListener('DOMContentLoaded', () => {
            const previewPanel = document.getElementById('preview-panel');
            if (previewPanel) {
                previewPanel.style.transform = 'none';
                previewPanel.style.transition = 'none';
            }
        });
        
        loadData();

        // Live Reload —á–µ—Ä–µ–∑ Server-Sent Events
        (function setupLiveReload() {
            const eventSource = new EventSource('/events');

            eventSource.onopen = () => {
                console.log('üîå Live reload connected');
            };

            eventSource.onmessage = (event) => {
                if (event.data === 'reload') {
                    console.log('üîÑ Reloading page...');

                    // –°–æ–∑–¥–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    const overlay = document.createElement('div');
                    overlay.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background: linear-gradient(135deg, rgba(0, 207, 255, 0.95) 0%, rgba(0, 100, 255, 0.95) 100%);
                        z-index: 999999;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        flex-direction: column;
                        gap: 20px;
                        opacity: 0;
                        transition: opacity 0.3s ease;
                    `;

                    const icon = document.createElement('div');
                    icon.style.cssText = `
                        font-size: 64px;
                        animation: spin 1s linear infinite;
                    `;
                    icon.textContent = 'üîÑ';

                    const text = document.createElement('div');
                    text.style.cssText = `
                        font-family: 'Randy GG Bold', monospace;
                        font-size: 24px;
                        color: white;
                        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
                    `;
                    text.textContent = 'Updating...';

                    overlay.appendChild(icon);
                    overlay.appendChild(text);
                    document.body.appendChild(overlay);

                    // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏—é –¥–ª—è –≤—Ä–∞—â–µ–Ω–∏—è
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes spin {
                            from { transform: rotate(0deg); }
                            to { transform: rotate(360deg); }
                        }
                    `;
                    document.head.appendChild(style);

                    // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –æ–≤–µ—Ä–ª–µ—è
                    requestAnimationFrame(() => {
                        overlay.style.opacity = '1';
                    });

                    // Reload —á–µ—Ä–µ–∑ 400ms
                    setTimeout(() => {
                        location.reload();
                    }, 400);
                } else if (event.data === 'connected') {
                    console.log('‚úÖ Live reload ready');
                }
            };

            eventSource.onerror = (error) => {
                console.log('‚ùå Live reload disconnected, retrying...');
                eventSource.close();
                // –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                setTimeout(setupLiveReload, 1000);
            };
        })();

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–∫—Ä–æ–ª–ª–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–∫—Ä–æ–ª–ª–µ
        let scrollSaveTimeout = null;
        window.addEventListener('scroll', () => {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º debounce, —á—Ç–æ–±—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ
            if (scrollSaveTimeout) {
                clearTimeout(scrollSaveTimeout);
            }
            scrollSaveTimeout = setTimeout(() => {
                sessionStorage.setItem('scrollPosition', window.scrollY.toString());
            }, 100); // –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ 100–º—Å –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–∫—Ä–æ–ª–ª–∞
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Å–∫—Ä–æ–ª–ª–∞ –ø–µ—Ä–µ–¥ —É—Ö–æ–¥–æ–º —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            sessionStorage.setItem('scrollPosition', window.scrollY.toString());
        });
    </script>
</body>
</html>

