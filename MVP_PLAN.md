# MVP План разработки

## Этап 1: Базовая PWA (Текущий)

### Цели
- ✅ Пользователь сканирует QR код
- ✅ Открывается веб-версия
- ✅ Предложение установить PWA
- ⏳ Базовая навигация

### Компоненты
- [x] Структура проекта ClojureDart/Flutter
- [x] PWA манифест
- [x] QR Scanner экран (заглушка)
- [x] PWA Install компонент
- [ ] Реальный QR сканер (интеграция qr_code_scanner)
- [ ] Обработка QR кода → переход на экран аренды

### Ограничения на этом этапе
- Bluetooth взаимодействие через API (сервер управляет блокировкой)
- Нет прямого доступа к блокировщику

## Этап 2: Интеграция с Backend API

### Цели
- API для управления арендой
- Аутентификация пользователя
- Получение информации о байке по QR коду

### Компоненты
- [ ] API клиент (HTTP запросы)
- [ ] Аутентификация (токены, сессии)
- [ ] Модели данных (Bike, Rental, User)
- [ ] Обработка ошибок

### API Endpoints (предположительно)
```
POST /api/auth/login
GET  /api/bikes/{qr-code}
POST /api/rentals/start
POST /api/rentals/end
GET  /api/rentals/current
```

## Этап 3: Bluetooth Интеграция (Нативное приложение)

### Цели
- Прямое подключение к блокировщику через Bluetooth
- Разблокировка/блокировка байка
- Мониторинг статуса блокировки

### Компоненты
- [ ] Bluetooth сервис (реализация в bluetooth.cljd)
- [ ] Экран подключения к устройству
- [ ] Экран управления блокировкой
- [ ] Обработка ошибок подключения
- [ ] Автоматическое переподключение

### BLE Протокол
```
Service UUID: 0000ff00-0000-1000-8000-00805f9b34fb

Characteristics:
- Lock Control (WRITE): команды блокировки/разблокировки
- Lock Status (READ/NOTIFY): текущий статус
- Battery Level (READ/NOTIFY): уровень заряда
```

## Этап 4: Улучшения UX

### Цели
- Улучшенный UI/UX
- Анимации
- Офлайн режим
- Push уведомления

### Компоненты
- [ ] Красивый дизайн экранов
- [ ] Анимации переходов
- [ ] Локальное кэширование данных
- [ ] Service Worker для офлайн работы
- [ ] Push уведомления (завершение аренды, напоминания)

## Этап 5: Дополнительные функции

### Цели
- GPS трекинг
- История поездок
- Рейтинг и отзывы
- Платежи

### Компоненты
- [ ] GPS трекинг во время аренды
- [ ] Сохранение маршрута
- [ ] История поездок
- [ ] Система рейтингов
- [ ] Интеграция платежей

## Технический стек

### Frontend
- **ClojureDart** - основной язык
- **Flutter** - UI фреймворк
- **flutter-cljd** - библиотека виджетов
- **flutter_blue_plus** - Bluetooth
- **qr_code_scanner** - QR сканер
- **geolocator** - GPS

### Backend (будущее)
- Clojure/ClojureScript
- PostgreSQL/MongoDB
- WebSocket для real-time обновлений

## Приоритеты для MVP

1. **Критично** (MVP v1):
   - QR сканер
   - PWA установка
   - Базовый UI
   - API интеграция (управление через сервер)

2. **Важно** (MVP v2):
   - Bluetooth интеграция
   - Прямое управление блокировкой
   - Статус мониторинг

3. **Желательно** (MVP v3):
   - GPS трекинг
   - Офлайн режим
   - Push уведомления

## Метрики успеха MVP

- Пользователь может отсканировать QR код
- Пользователь может установить PWA
- Пользователь может начать аренду (через API)
- Пользователь может завершить аренду
- Нативное приложение может управлять блокировкой через Bluetooth

